# src/modules/ROOT/nav.adoc

* xref:changelog/index.adoc[]
** xref:changelog/202409/index.adoc[]
** xref:changelog/202309/index.adoc[]
** xref:changelog/202303/index.adoc[]
** xref:changelog/202209/index.adoc[]
** xref:changelog/202203/index.adoc[]
** xref:changelog/202109/index.adoc[]
** xref:changelog/202103.adoc[]
** xref:changelog/archive/index.adoc[]


# src/modules/ROOT/pages/changelog/202103.adoc

include::ROOT:partial$variables.adoc[]

[#2021-3-x]
= `2021.3`

{PRODUCT_NAME} `2021.3` improves the stability and security of the system; and a lot of new features including a visual automation builder (xref:2021.3@integrator-guide:workflows/index.adoc[{PRODUCT_NAME} {APP_NAME_WORKFLOW}]), support template management and rendering.
{PRODUCT_NAME} also introduces an authentication server that conforms to the https://oauth.net/2/[OAuth2] protocol, which increases security and increases flexibility when it comes to authentication options.

.[#2021_3-important]#<<2021_3-important,Important upgrade notes:>>#
* Authentication changed to the OAuth2 standard, and any authentication logic relying on the previous versions will no longer work.
* The {APP_AUTOMATION} server is now disabled by default.
Set the `CORREDOR_ENABLED=true` in your `.env` file if you wish to have it enabled.
* {PRODUCT_NAME} Messaging is now deprecated and removed.

== `2021.3.13`

*Released on*: 2021-10-07

*Contributors*: Katrin Yordanova (https://github.com/katrinDY[GH]), Vivek Patel (https://github.com/vicpatel[GH]), Jože Fortun (https://github.com/fajfa[GH]), Denis Arh (https://github.com/darh[GH]), Tomaž Jerman (https://github.com/tjerman[GH])

.[#2021_3_13-added]#<<2021_3_13-added,Added:>>#
* Added the invoker and runner credentials in the initial workflow scope (https://github.com/cortezaproject/corteza-server/commit/687d98a6[`687d98a6`]).

.[#2021_3_13-changed]#<<2021_3_13-changed,Changed:>>#
* Improved record value access expressions when no record value is provided.
The check if the values property is present is no longer needed (https://github.com/cortezaproject/corteza-server/commit/47706610[`47706610`]).

.[#2021_3_13-fixed]#<<2021_3_13-fixed,Fixed:>>#
* Added the missing selected workflow scope variable which defines the selected records (https://github.com/cortezaproject/corteza-server/commit/64821e76[`64821e76`]).
* Fixed improper boolean record value to workflow variable casting (https://github.com/cortezaproject/corteza-server/commit/47706610[`47706610`]).
* Fixed workflow trigger loading access control issues (https://github.com/cortezaproject/corteza-server/commit/c0024b0f[`c0024b0f`]).
* Fixed pointer errors for the `count` expression when used within workflows (https://github.com/cortezaproject/corteza-server/commit/9ce01d2d[`9ce01d2d`]).
* Fixed expressions duplicating record values for multi value module fields (https://github.com/cortezaproject/corteza-server/commit/53ebbe0a[`53ebbe0a`]).
* Fixed improper workflow automation button removal (https://github.com/cortezaproject/corteza-server/commit/4f98192e[`4f98192e`]).
* Fixed record duplication when filtering over multi value fields (https://github.com/cortezaproject/corteza-server/commit/ea2aa53b[`ea2aa53b`]).
* Fixed invalid encoding of selected module fields when exporting pages (https://github.com/cortezaproject/corteza-server/commit/3eaa56f3[`3eaa56f3`]).
* Fixed duplicated page block description (https://github.com/cortezaproject/corteza-server/commit/57e860e0[`57e860e0`]).
* Fixed User field editor (https://github.com/cortezaproject/corteza-server/commit/bbe276ca[`bbe276ca`], https://github.com/cortezaproject/corteza-server/commit/ea75a2fb[`ea75a2fb`]).
* Fixed broken Corredor alerts due to the internal redesign (https://github.com/cortezaproject/corteza-server/commit/b6997af2[`b6997af2`]).
* Fixed improper record page back button redirect (https://github.com/cortezaproject/corteza-server/commit/4a8db556[`4a8db556`]).
* Fixed improper actionlog type casting which resulted in broken log messages when the front-end technology stack was unable to parse the values (https://github.com/cortezaproject/corteza-server/commit/9483b16b[`9483b16b`]).

== `2021.3.12`

*Released on*: 2021-09-15

*Contributors*: sgg-adraynrion (https://github.com/sgg-adraynrion[GH]), Jože Fortun (https://github.com/fajfa[GH]), Vivek Patel (https://github.com/vicpatel[GH]), Tomaž Jerman (https://github.com/tjerman[GH])

.[#2021_3_12-added]#<<2021_3_12-added,Added:>>#
* Added workflow email builder function to append recipients (https://github.com/cortezaproject/corteza-server/pull/241)
* Added workflow iterator chunking to be able to process larger datasets

.[#2021_3_12-changed]#<<2021_3_12-changed,Changed:>>#
* Updated `count` expr function, will return length if executed with only one input

.[#2021_3_12-fixed]#<<2021_3_12-fixed,Fixed:>>#
* Fixed improper chart value extraction logic https://github.com/cortezaproject/corteza-js/commit/b9f87d79e7bec28d27a23974f4f2c238eb37f933
* Fixed certain fonts not resolving on Firefox
* Fixed page block title and description cutting off
* Fixed record and user selectors cutting off
* Fixed font-weight definition to support more browsers (https://github.com/cortezaproject/corteza-webapp-admin/commit/d24bf6034b6d6674ea0f598a392f9ae7defa8b7c)

== `2021.3.11`

.[#2021_3_11-important]#<<2021_3_11-important,Important upgrade notes:>>#
* Workflow execution stacktrace may not completely respect the order of the workflow execution.

*Released on*: 2021-08-24

*Contributors*: Vivek Patel (https://github.com/vicpatel[GH]), Tomaž Jerman (https://github.com/tjerman[GH]), Jože Fortun (https://github.com/fajfa[GH]), Denis Arh (https://github.com/darh[GH])

.[#2021_3_11-added]#<<2021_3_11-added,Added:>>#
* Added the ability to enable split login form (1st step email, 2nd step password)
* Added random and additional date manipulation expression functions (https://github.com/cortezaproject/corteza-server/pull/238[#238])
* Added workflow support for messagebus/queue capabilities
* Added workflow functions for role membership management
* Added a deleted indicator when viewing a deleted workflow

.[#2021_3_11-changed]#<<2021_3_11-changed,Changed:>>#
* Changed handling of default auth clients to restrict most modifications.
* Minor UI/UX webapp changes and improvements

.[#2021_3_11-fixed]#<<2021_3_11-fixed,Fixed:>>#
* Skipped IdP due to invalid checks
* Fixed workflow execution stack trace log order for most scenarios (see <<2021_3_11-important,upgrade notes>>).
* Fixed deferred workflow execution; addressed data races and general access control issues
* Triggering of deleted workflows (https://github.com/cortezaproject/corteza-server/issues/198[#198])
* Reworked default record value logic to make it easier to work with from web applications
* Expression function parameter and return value casting for string functions
* Nil pointer panics in auth and document rendering
* Fixed invalid template handle validation
* Fixed improper newline encoding in envoy exported documents

== `2021.3.10`

*Released on*: 2021-07-20

*Contributors*: Denis Arh (https://github.com/darh[GH])

.[#2021_3_10-fixed]#<<2021_3_10-fixed,Fixed:>>#
* Fixed `corteza-vue` NPM package build (it used `2021.9.x` instead of `2021.3.x`)
* Fixed system user creation through workflows

== `2021.3.9`

.[#2021_3_9-important]#<<2021_3_9-important,Important upgrade notes:>>#
* {PRODUCT_NAME} `2021.3.9` included an incorrect build of internal libraries, which may break specific features.
The issue is resolved with `2021.3.10`

*Released on*: 2021-07-14

*Contributors*: Tomaž Jerman (https://github.com/tjerman[GH]), Denis Arh (https://github.com/darh[GH]), Peter Grlica (https://github.com/petergrlica[GH]), Vivek Patel (https://github.com/vicpatel[GH])

.[#2021_3_9-fixed]#<<2021_3_9-fixed,Fixed:>>#
* Refactored parts of the workflow execution logic and state management to improve execution stability and avoid infinite resource locking
* Fixed external authentication provider registration
* Fixed broken `$authUser` and `$authToken` in internal {PRODUCT_NAME} libraries

== `2021.3.8`

*Released on*: 2021-07-06

*Contributors*: Jože Fortun (https://github.com/fajfa[GH]), Tomaž Jerman (https://github.com/tjerman[GH]), Denis Arh (https://github.com/darh[GH]), Peter Grlica (https://github.com/petergrlica[GH])

.[#2021_3_8-changed]#<<2021_3_8-changed,Changed:>>#
* Added throttling for record manipulation api calls

.[#2021_3_8-fixed]#<<2021_3_8-fixed,Fixed:>>#
* Refactored parts of {APP_NAME_WORKFLOW} setup and workflow execution logic to resolve data race conditions
* Fixed improper workflow execution handler closure state management that overwrote the security context
* Fixed {APP_NAME_WORKFLOW} configurator edge-cases where workflows were unable to be saved
* Fixed `onInterval` and `onTimestamp` constraint configuration

.[#2021_3_8-security]#<<2021_3_8-security,Security:>>#
* fixed XSS sanitization on text fields

== `2021.3.7`

.[#2021_3_7-important]#<<2021_3_7-important,Important upgrade notes:>>#
* The {APP_AUTOMATION} workflow step is now disabled if the {APP_AUTOMATION} server is not enabled.
If a {APP_AUTOMATION} workflow step is already in the workflow, but the {APP_AUTOMATION} server is not enabled, the workflow will now throw an error.
* The "change the order in which the workflow and its triggers are saved to conform with the back-end logic" introduces edge cases where some workflows were unable to be updated.
The issue is resolved with `2021.3.8`.

*Released on*: 2021-06-22

*Contributors*: Vivek Patel (https://github.com/vicpatel[GH]), Jože Fortun (https://github.com/fajfa[GH]), Tomaž Jerman (https://github.com/tjerman[GH])

.[#2021_3_7-changed]#<<2021_3_7-changed,Changed:>>#
* Added validation for {APP_AUTOMATION} workflow steps.
* Change `Record` and `User` module field state management to better support dynamic prefilters

.[#2021_3_7-fixed]#<<2021_3_7-fixed,Fixed:>>#
* Rework the auth plugin to selectively clear the `localStorage` instead of clearing the whole thing
* Fixed record updating for modules with deleted fields
* Fixed record value validation for required, forbidden fields
* Fixed improper handling of read-only module fields with default values
* Fixed module and chart timestamp sorting
* Improved record value manipulation from inside workflows
* Fixed invalid input state for deferred trigger configuration (timestamp and interval)
* Change the order in which the workflow and its triggers are saved to conform with the back-end logic
* Add missing invoker when executing client-scripts

.[#2021_3_7-security]#<<2021_3_7-security,Security:>>#
* General system security improvements

== `2021.3.6`

*Released on*: 2021-06-07

*Contributors*: Tomaž Jerman (https://github.com/tjerman[GH]), Vivek Patel (https://github.com/vicpatel[GH]), Jože Fortun (https://github.com/fajfa[GH])

.[#2021_3_6-fixed]#<<2021_3_6-fixed,Fixed:>>#
* Fixed improper module field default value validation when combined with required fields
* Fix pre-filter processing for `User` module fields

.[#2021_3_6-removed]#<<2021_3_6-removed,Removed:>>#
* Temporarily removed the change regarding "fixed ComposeRecord filtering with multi-value fields"

== `2021.3.5`

.[#2021_3_5-important]#<<2021_3_5-important,Important upgrade notes:>>#
* The "fixed ComposeRecord filtering with multi-value fields" introduced some additional edge-cases which prevent the record search from working.
`2021.3.6` temporary reverts the change until it is addressed properly.

*Released on*: 2021-05-25

*Contributors*: Vivek Patel (https://github.com/vicpatel[GH]), Tomaž Jerman (https://github.com/tjerman[GH]), Jože Fortun (https://github.com/fajfa[GH]), Peter Grlica (https://github.com/petergrlica[GH]), Denis Arh (https://github.com/darh[GH])

.[#2021_3_5-added]#<<2021_3_5-added,Added:>>#
* Added additional workflow functions to support `KV` and `KV`-like manipulations

.[#2021_3_5-changed]#<<2021_3_5-changed,Changed:>>#
* Added toast translations for federation notifications

.[#2021_3_5-fixed]#<<2021_3_5-fixed,Fixed:>>#
* Fixed improper logout handling, which preserved some tokens
* Fixed federation structure sync (added a response wrapper to API response)
* Fixed ComposeRecord filtering with multi-value fields
* Fixed improper try-catch workflow step handling that prematurely terminated the workflow execution
* Fixed improper workflow pre-run validations that cycled the execution procedure
* Fixed {APP_AUTOMATION} helpers to properly use ListResponse

== `2021.3.4`

.[#2021_3_4-important]#<<2021_3_4-important,Important upgrade notes:>>#
* The workflow call stack size is now limited to `16` by default and can be overwritten via the `WORKFLOW_CALL_STACK_SIZE` `.env` variable.
The call stack limitation prevents implicit workflow invocations from running infinitely.

*Released on*: 2021-05-14

*Contributors*: Vivek Patel (https://github.com/vicpatel[GH]), Tomaž Jerman (https://github.com/tjerman[GH]), Jože Fortun (https://github.com/fajfa[GH]), Mia Arh (https://github.com/zmija[GH]), Denis Arh (https://github.com/darh[GH])

.[#2021_3_4-added]#<<2021_3_4-added,Added:>>#
* Added a failsafe that prevents infinite workflow executions due to implicit invocations
* Added support for removing SCIM role/group members
* Added a {PRODUCT_NAME} {APP_NAME_ADMIN} screen to set the impersonating user for auth clients using `client_credentials` grant type

.[#2021_3_4-changed]#<<2021_3_4-changed,Changed:>>#
* Hide document preview options for document types where a render driver is not available (such as PDF)

.[#2021_3_4-fixed]#<<2021_3_4-fixed,Fixed:>>#
* Fixed workflows not rendering properly after a save
* Improved workflow import error reporting
* Improve integration between workflows and {APP_AUTOMATION} server
* Fixed session lifetime when doing external authentication
* Fixed error handling in {APP_NAME_COMPOSE} namespace editor
* Fixed the CSV size limitation issue when importing ComposeRecords

== `2021.3.3`

*Released on*: 2021-04-29

*Contributors*: Jože Fortun (https://github.com/fajfa[GH])

.[#2021_3_3-added]#<<2021_3_3-added,Added:>>#
* Added support for copy/pasting across different workflows
* Added support for workflow import & export

== `2021.3.2`

*Released on*: 2021-04-20

*Contributors*: Jože Fortun (https://github.com/fajfa[GH]), Denis Arh (https://github.com/darh[GH])

.[#2021_3_2-added]#<<2021_3_2-added,Added:>>#
* Added session screen on the {PRODUCT_NAME} {APP_NAME_ADMIN} to monitor workflow execution and their status
* Added support for custom initial scope when testing workflows

.[#2021_3_2-fixed]#<<2021_3_2-fixed,Fixed:>>#
* Fixed {APP_NAME_COMPOSE} module configurator field picker bug, where double click didn't add the field
* Fixed {APP_NAME_COMPOSE} module fields not respecting their configured order
* Fixed excessive redirects for authentication procedures

== `2021.3.1`

.[#-important]#<<2021_3_1-important,Important upgrade notes:>>#
* To apply the CRM extension changes, re-provision or import corteza-(server https://github.com/cortezaproject[GH])blob/2021.3.x/provision/700_crm/1600_workflows.yaml[this] through the CLI.

*Released on*: 2021-04-14

*Contributors*: Tomaž Jerman (https://github.com/tjerman[GH]), Jože Fortun (https://github.com/fajfa[GH]), Mia Arh (https://github.com/zmija[GH]), Denis Arh (https://github.com/darh[GH])

.[#2021_3_1-Changed]#<<2021_3_1-Changed,Changed:>>#
* Improve the authentication flow by keeping the user on the same page when possible
* Moved automation scripts under the Automation section in the admin panel
* {APP_NAME_WORKFLOW} swimlanes now need to be double clicked to open the configurator
* The {APP_NAME_WORKFLOW} testing overlay is now automatically removed when the workflow changes
* Improved the `Ctrl/CMD + S` keybinding in the {APP_NAME_WORKFLOW} editor to improve UX
* Tweaked the new workflow creation flow

.[#2021_3_1-fixed]#<<2021_3_1-fixed,Fixed:>>#
* Fixed envoy ComposeRecord resource self and cross-referencing
* Fixed provisioning of auth clients
* Fixed improper one dimensional page block rescaling on {APP_NAME_COMPOSE} page builder
* Fixed bug where record selector default options were not displayed if query existed
* Prevent the workflow steps to reuse step identifiers
* Fixed workflow test tooltip display and content
* Fixed {PRODUCT_NAME} CRM workflow bugs and typos

== `2021.3.0`

*Released on*: 2021-04-04

*Contributors*: Jože Fortun (https://github.com/fajfa[GH]), Tomaž Jerman (https://github.com/tjerman[GH]), Denis Arh (https://github.com/darh[GH]), Mia Arh (https://github.com/zmija[GH]), Peter Grlica (https://github.com/petergrlica[GH])

.[#2021_3_0-added]#<<2021_3_0-added,Added:>>#
* Added support for low-code/no-code automation via xref:2021.3@integrator-guide:workflows/index.adoc[{APP_NAME_WORKFLOW}]
* Introduced an authorization server with support for authorization code and client credential OAuth2 flows
* Added support for document template management and rendering (HTML and PDF)
* Added support for file encoding via envoy
* Compose record federation now supports the Activity Stream protocol

.[#2021_3_0-Changed]#<<2021_3_0-Changed,Changed:>>#
* Upgraded Go version to `1.16`
* Reworked system asset embedding with `//go:embed`
* Codebase cleanup and removed the `With(ctx)` anti-pattern
* Reworked {APP_NAME_COMPOSE} record export using envoy
* Changed {APP_AUTOMATION} server to be disabled by default due to the introduction of {APP_NAME_WORKFLOW}

.[#2021_3_0-removed]#<<2021_3_0-removed,Removed:>>#
* Removed {PRODUCT_NAME} Messaging (web application and API endpoints)
* Removed the authentication web application
* Removed legacy authentication endpoints

.[#2021_3_0-fixed]#<<2021_3_0-fixed,Fixed:>>#
* Pagination & sorting fixes
* Fixed `UserBeforeUpdate`/`UserBeforeDelete` event bus events


# src/modules/ROOT/pages/changelog/202109/00.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.0`

*Released on*: 2021-10-11

*Contributors*:
Tomaž Jerman (https://github.com/tjerman[GH]),
Peter Grlica (https://github.com/petergrlica[GH]),
Mia Arh (https://github.com/zmija[GH]),
Denis Arh (https://github.com/darh[GH]),
sgg-adraynrion (https://github.com/sgg-adraynrion[GH]),
Katrin Yordanova (https://github.com/katrinDY[GH]),
Jože Fortun (https://github.com/fajfa[GH]),
Vivek Patel (https://github.com/vicpatel[GH]),
Matija Rešek (https://github.com/resek[GH]),
Mario Burazer (https://github.com/MarioBur[GH]),
Bill Ewanick (https://github.com/billewanick[GH])

.[#2021_9_0-added]#<<2021_9_0-added,Added:>>#
* Added support for internationalization of {PRODUCT_NAME} web applications (https://github.com/cortezaproject/corteza-server/pull/237[#237], {SERVER_COMMIT_BASE}31132570[`31132570`], {WEBAPP_COMPOSE_COMMIT_BASE}e4eb28b8[`e4eb28b8`], {WEBAPP_ONE_COMMIT_BASE}c3ff0ae1[`c3ff0ae1`]), as well as for some user-provided resources ({APP_NAME_COMPOSE} modules, namespaces, and pages) ({SERVER_COMMIT_BASE}46a7d94d[`46a7d94d`]).
Locale specific number and date-time formatting are also included ({WEBAPP_JS_COMMIT_BASE}da9a450f[`da9a450f`]).
//
* Added a system-managed facility for defining and handling custom API endpoints (https://github.com/cortezaproject/corteza-server/pull/232[#232], {WEBAPP_ADMIN_COMMIT_BASE})652cc074[`652cc074`].
The facility allows you to trivially define new API endpoints for webhooks or custom integrations needed by your business processes.
The facility defines a tight integration with xref:integrator-guide:automation/workflows/index.adoc[] for request processing (https://github.com/cortezaproject/corteza-server/pull/245[#245]).
//
* Added a specialized facility for creating, managing, and running reports({SERVER_COMMIT_BASE}02b3e833[02b3e833]).
The reporting facility defines a dedicated user interface (https://github.com/cortezaproject/corteza-webapp-reporter[corteza-webapp-reporter]).
//
* Extended {APP_NAME_COMPOSE} feature set:
** added role based filtering to user module fields ({WEBAPP_COMPOSE_COMMIT_BASE}da181c30[`da181c30`]),
** added advanced record list filtering using field-specific filters ({WEBAPP_COMPOSE_COMMIT_BASE}5e7e8ce5[`5e7e8ce5`]),
** added a comment page block ({WEBAPP_COMPOSE_COMMIT_BASE}1032399f[`1032399f`]), and general UI/UX tweaks for easier navigation,
** added configurable module field descriptions and hints,
** Added an additional `namespaceID` parameter when searching over namespaces ({SERVER_COMMIT_BASE}21a3c5e6[`21a3c5e6`]).
//
* Added a fake data generator which can be used to create placeholder records and users (https://github.com/cortezaproject/corteza-server/pull/216[#216]).
The data generator is invoked through the CLI @todo CLI ref.
//
* Added support for entire {APP_NAME_COMPOSE} namespace duplication, import, and export directly from the {APP_NAME_COMPOSE} interface ({SERVER_COMMIT_BASE}000664ef[`000664ef`], {SERVER_COMMIT_BASE}533b534f[`533b534f`]).
//
* Extended authentication feature set; allowing authentication sessions to be manually revoked (https://github.com/cortezaproject/corteza-server/pull/254[#254], https://github.com/cortezaproject/corteza-server/pull/210[#210], {SERVER_COMMIT_BASE}1cb2e64d[`1cb2e64d`]), improved the users CLI commands with additional options ({SERVER_COMMIT_BASE}bed63c4f[`bed63c4f`], {SERVER_COMMIT_BASE}e4cd1f5b[`e4cd1f5b`]), and added the `client_credentials` and user impersonation ({SERVER_COMMIT_BASE}b245726c[`b245726c`], {SERVER_COMMIT_BASE}25e4d11f[`25e4d11f`]).
The authentication clients user interface now provides a series of cURL examples for interacting with authentication clients ({WEBAPP_ADMIN_COMMIT_BASE}16ae4c22[`16ae4c22`]).
//
* Added support for SAML authentication providers (https://github.com/cortezaproject/corteza-server/pull/188[#188], {SERVER_COMMIT_BASE}aedb2aef[`aedb2aef`], {SERVER_COMMIT_BASE}670b1609[`670b1609`]).
//
* Added `*.search` RBAC access control operations for all resources {SERVER_COMMIT_BASE}92d2de86[`92d2de86`], {SERVER_COMMIT_BASE}f630a3d9[`f630a3d9`], {SERVER_COMMIT_BASE}0a388382[`0a388382`].
//
* Added support for automation which is triggered before or after a user is suspended ({SERVER_COMMIT_BASE}13fc9d26[`13fc9d26`]).
//
* Extended {APP_NAME_WORKFLOW} feature set:
** added the invoker and runner credentials in the initial scope ({SERVER_COMMIT_BASE}806dbfaa[`806dbfaa`]),
** improved trigger validation based on the workflow configuration ({SERVER_COMMIT_BASE}f40f7982[`f40f7982`]),
** added functions to interact with the RBAC facility ({SERVER_COMMIT_BASE}89ae50db[`89ae50db`]),
** improved the user interface to display configuration and debug errors (the triggers now also show errors),
** added an indicator for when the workflow try-run is running.
//
* Expended the feature set of the expression engine:
** improved support for regular expression ({SERVER_COMMIT_BASE}767f86f0[`767f86f0`]),
** improved KV-like structure usage ({SERVER_COMMIT_BASE}14b3f079[`14b3f079`], {SERVER_COMMIT_BASE}044d02bb[`044d02bb`]).
//
* Improved system setup and configuration flow as well as overall stability ({SERVER_COMMIT_BASE}5a67ecf7[`5a67ecf7`], {SERVER_COMMIT_BASE}a94e39b3[`a94e39b3`], {SERVER_COMMIT_BASE}a229d0ec[`a229d0ec`]):
** Added option to limit the number of users ({SERVER_COMMIT_BASE}1b3a811c[`1b3a811c`]),
** Added support for `.env` file configuration from arbitrary location via the `--env-file` command parameter ({SERVER_COMMIT_BASE6496027a[6496027a]}).
//
* Prepared the store infrastructure for cockroachDB support ({SERVER_COMMIT_BASE}109e23fc[`109e23fc`]).

//
//

.[#2021_9_0-changed]#<<2021_9_0-changed,Changed:>>#
* The user interface of the {PRODUCT_NAME} web applications was changed to increase consistency, accessibility (({SERVER_COMMIT_BASE}58aa46ee[`58aa46ee`], {SERVER_COMMIT_BASE}89ad4311[`89ad4311`])), and better user experience.
More notable changes:
** the navigation was moved under the left sidebar,
** the top bar defines shortcuts to the more common operations related to the viewed page,
** the module field picker was completely reworked ({SERVER_COMMIT_BASE}8364da10[`8364da10`]).
//
* Changed the file field preview to show the last uploaded attachment when the single image option is selected ({WEBAPP_COMPOSE_COMMIT_BASE}2d593af0[`2d593af0`]).
//
* Reworked the RBAC access control facility allowing greater flexibility with resource-specific rules, contextual roles ({SERVER_COMMIT_BASE}2f2c055e[`2f2c055e`]), and improved logging ({SERVER_COMMIT_BASE}922f4c31[`922f4c31`]).
{PRODUCT_NAME} now defines a series of system users and roles which are used for system tasks, such as provisioning and federation.
//
* {APP_NAME_COMPOSE} module, module field, and record RBAC rule configuration buttons are now located under a single drop-down.
//
* Added the reporter webapp to the default list of webapps ({SERVER_COMMIT_BASE}e6950812[`e6950812`]).
//
* Changed workflow deferred triggers to ignore and skip empty constraint values ({SERVER_COMMIT_BASE}8d9a3d54[`8d9a3d54`]).
//
* Upgraded zap logger to v1.19 ({SERVER_COMMIT_BASE}e48ffb2e[`e48ffb2e`]).
//
* Tweaked system logging:
** replaced errors with warnings for runtime OAuth issues ({SERVER_COMMIT_BASE}0cb91793[`0cb91793`]),
** tweaked log stacktrace and added support for depth level control using the `LOG_STACKTRACE_LEVEL` `.env` variable ({SERVER_COMMIT_BASE}28e1774c[`28e1774c`]).
//
* Moved `PROVISION_SETTINGS_` settings into a YAML provision file ({SERVER_COMMIT_BASE}2d78ae42[`2d78ae42`]).
//
* Switch the base image to deb/ubuntu due to library incompatibilities ({SERVER_COMMIT_BASE}00ba60e5[`00ba60e5`]).

//
//

.[#2021_9_0-removed]#<<2021_9_0-removed,Removed:>>#
* Removed `PROVISION_SETTINGS_` in favour of a YAML provision file ({SERVER_COMMIT_BASE}2d78ae42[`2d78ae42`]).
* Removed the `query` parameter from the record list filter endpoint ({SERVER_COMMIT_BASE}10e8b77d[`10e8b77d`]).
* Removed Google maps from the provisioned application list ({SERVER_COMMIT_BASE}d6f24605[`d6f24605`]).
* Removed obsolete settings for the namespace sidebar and {PRODUCT_NAME} {APP_NAME_SHELL} ({SERVER_COMMIT_BASE}b459bd35[`b459bd35`]).
* Removed tabs and panels on {PRODUCT_NAME} {APP_NAME_SHELL}.

//
//

.[#2021_9_0-fixed]#<<2021_9_0-fixed,Fixed:>>#
* Fix broken links in README ({SERVER_COMMIT_BASE}7974ca65[`7974ca65`]).
* Fix inconsistent `grant-validGrant` auth client JSON prop name ({SERVER_COMMIT_BASE}40ddb9db[`40ddb9db`]).
* Fixed attachment upload errors when an empty attachment or an ico file were uploaded ({SERVER_COMMIT_BASE}f5532acf[`f5532acf`]).
* Removed unneeded content from the served webapp content evaluation check ({SERVER_COMMIT_BASE}3638ecac[`3638ecac`]).
* Fixed failing mount when webapps are disabled ({SERVER_COMMIT_BASE}63dbe702[`63dbe702`]).
* Exclude deleted reminders from the reminder list API endpoint ({SERVER_COMMIT_BASE}9f74d5c0[`9f74d5c0`]).
* Prevented duplicate values on multi-value selection fields.
* Fixed the task duplication bug on calendars ({WEBAPP_JS_COMMIT_BASE}2e322054[`2e322054`]).
* Fixed namespace searching be case insensitive ({WEBAPP_COMPOSE_COMMIT_BASE}5ce9572d[`5ce9572d`]).
* Fixed improper actionlog type casting which resulted in broken log messages when the front-end technology stack was unable to parse the values ({SERVER_COMMIT_BASE}5ac8790b[`5ac8790b`], {SERVER_COMMIT_BASE}d1ccbc3e[`d1ccbc3e`]).
* Fix invalid error message if the user is not allowed to search over namespaces ({SERVER_COMMIT_BASE}7cf6c18d[`7cf6c18d`]).
* Fixed missing notifications across web applications.
* Fixed typos in envoy error messages ({SERVER_COMMIT_BASE}0a241fab[`0a241fab`]).
* Fixed notifications disappearing when changing the current page.
* Fix ClaimsToIdentify to return identity with all authenticated roles ({SERVER_COMMIT_BASE}67d7882b[`67d7882b`]).
* Added missing access control properties to resource responses ({SERVER_COMMIT_BASE}774354d6[`774354d6`]).
* Addedd missing access control checks for reminders ({SERVER_COMMIT_BASE}03344782[`03344782`]).
* Fixed improper admin webapp permission display if the user does not have sufficient permissions..
* Fixed improper automation session state representation for prompted sessions ({SERVER_COMMIT_BASE}234d3795[`234d3795`]).
* Fixed expression function parameter and return value casting for string functions.
* Added missing federation structure sync response wrappers ({SERVER_COMMIT_BASE}8ee91eb7[`8ee91eb7`]).
* General stability of the system has been improved.

//
//

.[#2021_9_0-security]#<<2021_9_0-security,Security:>>#
* CLI commands now use the system user when executing commands ({SERVER_COMMIT_BASE}dca5757f[`dca5757f`]).
* Moved import/provisioning access control from Envoy to the invoking service ({SERVER_COMMIT_BASE}a2b964c5[`a2b964c5`]).

//
//

.[#2021_9_0-development]#<<2021_9_0-development,Development:>>#
* Defined a proper facility for testing Integration gateway handling logic ({SERVER_COMMIT_BASE}6ceadf40[`6ceadf40`]).
* Allow store function codegen logic to define imports specific to them ({SERVER_COMMIT_BASE}b95e878c[`b95e878c`]).
* Build and integration pipelines moved to Github Actions.
* Removed misleading federation `etc/` ({SERVER_COMMIT_BASE}d4505482[`d4505482`]).
* Removed the long deprecated storybook ({WEBAPP_COMPOSE_COMMIT_BASE}76270476[`76270476`]).
* Implemented the C3 feature and applied it to web applications ({WEBAPP_COMPOSE_COMMIT_BASE}a318b380[`a318b380`], {WEBAPP_VUE_COMMIT_BASE}4c5e2c24[`4c5e2c24`]).


# src/modules/ROOT/pages/changelog/202109/01.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.1`

*Released on*: 2021-10-18

*Contributors*:
Peter Grlica (https://github.com/petergrlica[GH]),
Denis Arh (https://github.com/darh[GH]),
Katrin Yordanova (https://github.com/katrinDY[GH]),
Jože Fortun (https://github.com/fajfa[GH]),
Vivek Patel (https://github.com/vicpatel[GH]),
Matija Rešek (https://github.com/resek[GH]),
Mario Burazer (https://github.com/MarioBur[GH])

.[#2021_9_1-added]#<<2021_9_1-added,Added:>>#
* Added handle/slug error text in Compose ({WEBAPP_COMPOSE_COMMIT_BASE}c7f543ec[`c7f543ec`]).
//
* Extend record export with filter in Compose ({WEBAPP_COMPOSE_COMMIT_BASE}1f5d2abf[`1f5d2abf`]).
//
* Added tooltip for Integration Gateway endpoint in Admin ({WEBAPP_ADMIN_COMMIT_BASE}d897ba3d[`d897ba3d`]).
//
* Added server sorting fields to integration gateway to support UI ({SERVER_COMMIT_BASE}c388f8[`c388f8`]).
//
* Added Bytes ([]byte) expression type ({SERVER_COMMIT_BASE}614237[`614237`]).

.[#2021_9_1-changed]#<<2021_9_1-changed,Changed:>>#
* Improved colour scheme picker in Compose ({WEBAPP_COMPOSE_COMMIT_BASE}211227ba[`211227ba`]).
//
* Open Admin template previews in new tab ({WEBAPP_ADMIN_COMMIT_BASE}88f05df2[`88f05df2`]).
//
* Refactored message bus to conform to rbac, service and package layer architecture ({SERVER_COMMIT_BASE}54b716[`54b716`]).
//
* Improved Integration Gateway filter handling ({WEBAPP_ADMIN_COMMIT_BASE}c6e3d0e9[`c6e3d0e9`]).

.[#2021_9_1-fixed]#<<2021_9_1-fixed,Fixed:>>#
* Fixed Compose calendar buttons styles.
//
* Fixed back-button on record viewer.
//
* Fixed Admin compose settings not reflected in Compose ({WEBAPP_COMPOSE_COMMIT_BASE}bf9e7064[`bf9e7064`]).
//
* Fixed for unsupported MIME types error message not showing in Compose ({WEBAPP_COMPOSE_COMMIT_BASE}8561dca6[`8561dca6`]).
//
* Fixed query handling when exporting records in Compose ({WEBAPP_COMPOSE_COMMIT_BASE}78e6d296[`78e6d296`]).
//
* Fixed server workflow step duplicate issue ({SERVER_COMMIT_BASE}e2e751[`e2e751`]).
//
* Fixed unique constraint matching on resources on server ({SERVER_COMMIT_BASE}59ffe7[`59ffe7`]).
//
* Fixed: Missing Corteza server image root ssl certificates that caused issues with outbound HTTP and SMTP requests ({SERVER_COMMIT_BASE}8b008545[`8b008545`]).
//
* Fixed invalid z-index for record list filter components ({WEBAPP_COMPOSE_COMMIT_BASE}6171af5b[`6171af5b`]).


# src/modules/ROOT/pages/changelog/202109/02.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.2`

.[#2021_9_2-important]#<<2021_9_2-important,Important upgrade notes:>>#
* If you wish to enable functions for workflow - action log interaction, the `ACTIONLOG_ENABLE_WORKFLOW_FUNCTIONS` `.env` variable must be set.

*Released on*: 2021-11-04

*Contributors*:
Denis Arh (https://github.com/darh[GH]),
Jože Fortun (https://github.com/fajfa[GH]),
Tomaž Jerman (https://github.com/tjerman[GH]),
Katrin Yordanova (https://github.com/katrinDY[GH])

.[#2021_9_2-added]#<<2021_9_2-added,Added:>>#
* Added a user interface to configure SMTP setting; such configuration does not require server restart ({SERVER_COMMIT_BASE}0b69d1a2[`0b69d1a2`], {WEBAPP_ADMIN_COMMIT_BASE}20a85d8[`20a85d8`]).
* Added support for workflow - action log interaction (search, create) ({SERVER_COMMIT_BASE}1014f53a[`1014f53a`]).
* Added support for server plugins ({SERVER_COMMIT_BASE}614d2b30[`614d2b30`]).
* Added workflow import note ({WEBAPP_WORKFLOW_COMMIT_BASE}9d98170[`9d98170`]).

//
//

.[#2021_9_2-changed]#<<2021_9_2-changed,Changed:>>#
* Compose module fields no longer accept reserved system names -- `recordID`, `ownedBy`, `createdBy`, `createdAt`, `updatedBy`, `updatedAt`, `deletedBy`, and `deletedAt` ({SERVER_COMMIT_BASE}20757e58[`20757e58`], {WEBAPP_ADMIN_COMMIT_BASE}20a85d8[`20a85d8`]).
* Resource translations no longer fallback to base language in case of a missing translations ({SERVER_COMMIT_BASE}4cd54a58[`4cd54a58`]).
* Compose webapp now sends `Content-Language and `Accept-Language` HTTP headers ({WEBAPP_COMPOSE_COMMIT_BASE}f8427346[`f8427346`]).
* Server source is now built with -trimpath and without -mod=readonly flags ({SERVER_COMMIT_BASE}0b02535c[`0b02535c`]).
* Namespace export no longer preserves logo/icon references ({SERVER_COMMIT_BASE}dab413ece[`dab413ece`]).
* Initial documentation site redesign (https://github.com/cortezaproject/corteza-docs/commit/14550adf[14550adf]).

//
//

.[#2021_9_2-fixed]#<<2021_9_2-fixed,Fixed:>>#
* Fixed boot-level workflow initialization logic which crashed the server if an enabled workflow defined an invalid trigger configuration ({SERVER_COMMIT_BASE}415982c8[`415982c8`]).
* Fixed workflow saving when the configuration sidebar was opened ({WEBAPP_WORKFLOW_COMMIT_BASE}6d8796e[`6d8796e`]).
* Fixed improper {APP_NAME_COMPOSE} `Checkbox` labels representation for false values ({WEBAPP_COMPOSE_COMMIT_BASE}0330e31[`0330e31`], {WEBAPP_JS_COMMIT_BASE}aef1a14[`aef1a14`]).
* Fixed accent & HTML escaping in translated strings ({SERVER_COMMIT_BASE}556ffc5e[`556ffc5e`]).
* Fixed resource translation issues for current language, accents, and escaped HTML ({webapp_compose_commit_base}05178c2b[`05178c2b`]).
* Hide pages if the parent page is marked as not visible ({WEBAPP_COMPOSE_COMMIT_BASE}957a9de2[`957a9de2`]).
* Fixed broken permission setting from {APP_NAME_COMPOSE} admin panel on module for fields & records ({WEBAPP_COMPOSE_COMMIT_BASE}8ae2a48d[`8ae2a48d`]).
* Fixed RenderOptions expr value assignment via selectors ({SERVER_COMMIT_BASE}556ffc5e[`445f0ed5`]).
* Fixed RBAC rule migration crash on duplicate rules ({SERVER_COMMIT_BASE}e8bc6141[`e8bc6141`]).
* Docker container healthcheck ({SERVER_COMMIT_BASE}9d7cf23c[`9d7cf23c`]).
* Fixed compose false value label ({WEBAPP_JS_COMMIT_BASE}6da6989[`6da6989`]).
* Fixed sidebar shadow ({WEBAPP_VUE_COMMIT_BASE}4a02d90[`4a02d90`]).
* Fixed reporter table column reordering ({WEBAPP_REPORTER_COMMIT_BASE}6b25473[`6b25473`]).
* Fixed {APP_NAME_COMPOSE} error when the automation scripts are not loaded ({WEBAPP_COMPOSE_COMMIT_BASE}bb94645[`bb94645`]).
* Disabled the load button in chart editor ({WEBAPP_COMPOSE_COMMIT_BASE}6912fcd[`6912fcd`]).
* Fixed improper prefilter handling in the chart editor ({WEBAPP_COMPOSE_COMMIT_BASE}aeceb35[`aeceb35`]).
* Fixed improper {APP_NAME_COMPOSE} page exporting with un configured or partially configured page blocks ({SERVER_COMMIT_BASE}032566d9[`032566d9`]).


# src/modules/ROOT/pages/changelog/202109/03.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.3`

*Released on*: 2021-11-10

*Contributors*:
Denis Arh (https://github.com/darh[GH]),
Jože Fortun (https://github.com/fajfa[GH]),
Tomaž Jerman (https://github.com/tjerman[GH])
Matija Rešek (https://github.com/resek[GH]

.[#2021_9_3-changed]#<<2021_9_3-changed,Changed:>>#
* All user's access tokens are now removed after password change ({SERVER_COMMIT_BASE}01577191[`01577191`]).

.[#2021_9_3-fixed]#<<2021_9_3-fixed,Fixed:>>#
* Fixed improper page block ref validation for yaml encode ({SERVER_COMMIT_BASE}5afc715f[`5afc715f`]).
* Fixed unstable RBAC check that was caused by more complex setup of roles and RBAC rules ({SERVER_COMMIT_BASE}a385fe1c[`a385fe1c`]).
* Fixed multi value required field errors ({WEBAPP_COMPOSE_COMMIT_BASE}a5e4fb21[`a5e4fb21`]).
* Fixed display elements configurator sometimes not loading correct information when switching between elements ({WEBAPP_REPORTER_COMMIT_BASE}b8121e5[`b8121e5`]).

.[#2021_9_3-added]#<<2021_9_3-added,Added:>>#
* Added handle error text in Admin ({WEBAPP_ADMIN_COMMIT_BASE}d903a735[`d903a735`]).
* Added handle error text in Reporter ({WEBAPP_REPORTER_COMMIT_BASE}963c2161[`963c2161`]).
* Added handle error text in Workflow ({WEBAPP_WORKFLOW_COMMIT_BASE}cb1b42b3[`cb1b42b3`]).
* Added scenario switcher to Reporter ({SERVER_COMMIT_BASE}4b6b52b3f[`4b6b52b3f`] {WEBAPP_REPORTER_COMMIT_BASE}b8121e5[`b8121e5`], {WEBAPP_JS_COMMIT_BASE}79e13cb[`79e13cb`]).


# src/modules/ROOT/pages/changelog/202109/04.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.4`

*Released on*: 2021-11-26

*Contributors*:
Katrin Yordanova (https://github.com/katrinDY[GH]),
Vivek Patel (https://github.com/vicpatel[GH]),
Jože Fortun (https://github.com/fajfa[GH]),
Denis Arh (https://github.com/darh[GH]),
Tomaž Jerman (https://github.com/tjerman[GH]).

.[#2021_9_4-added]#<<2021_9_4-added,Added:>>#
* Added `.env` options to control OAuth2 access and refresh token lifetime ({SERVER_COMMIT_BASE}14450dc4[`14450dc4`]).
* Added support for base password constraints ({SERVER_COMMIT_BASE}420b5ee1[`420b5ee1`], {WEBAPP_ADMIN_COMMIT_BASE}984a5e99[`984a5e99`]).
* Added translations for webapp-workflow ({WEBAPP_WORKFLOW_COMMIT_BASE}15d12b3[`15d12b3`], {LOCALE_COMMIT_BASE}77de17e[`77de17e`]).
* Added custom processing button ({WEBAPP_VUE_COMMIT_BASE}6ec4157[`6ec4157`], {WEBAPP_COMPOSE_COMMIT_BASE}1b67f4b[`1b67f4b`]).
* Added multi select to workflow options prompts ({WEBAPP_VUE_COMMIT_BASE}661781d[`661781d`]).
* Added warning when workflow triggers paths change ({WEBAPP_WORKFLOW_COMMIT_BASE}07705d21[`07705d21`]).
* Added expandable expressions editor to workflows ({WEBAPP_WORKFLOW_COMMIT_BASE}680149e[`680149e`]).

//
//

.[#2021_9_4-fixed]#<<2021_9_4-fixed,Fixed:>>#
* Fixed improper report filter type casting for ID-like values ({SERVER_COMMIT_BASE}597484914[`597484914`]).
* Fixed default record module field value validation setup ({SERVER_COMMIT_BASE}aced989ae[`aced989ae`]).
* Boolean value (record field) sanitization({SERVER_COMMIT_BASE}edbbf2f0[`edbbf2f0`]).
* Uint64 JSON serialization in {APP_AUTOMATION} payloads ({SERVER_COMMIT_BASE}3241ff4e[`3241ff4e`]).
* Fixed invalid data point labeling for radial charts ({WEBAPP_JS_COMMIT_BASE}4cbeb210[`4cbeb210`]).
* Fixed report table pagination ({WEBAPP_JS_COMMIT_BASE}71dc2d2[`71dc2d2`]).
* Fixed workflow help shortcut opening when inputting `?` ({WEBAPP_WORKFLOW_COMMIT_BASE}8fd0f15[`8fd0f15`]).

//
//

.[#2021_9_4-changed]#<<2021_9_4-changed,Changed:>>#
* Admin role membership management ({WEBAPP_ADMIN_COMMIT_BASE}2df2f48[`2df2f48`]).

//
//

.[#2021_9_4-security]#<<2021_9_4-security,Security:>>#
* Update Bluemonday & net packages ({SERVER_COMMIT_BASE}73c0b312[`73c0b312`]).


# src/modules/ROOT/pages/changelog/202109/05.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.5`

.[#2021_9_5-important]#<<2021_9_5-important,Important upgrade notes:>>#
* The xref:2021.9@devops-guide:cli/record-import.adoc[record import] via the import CLI command requires you to provide module field definitions along with the record import definitions.
The constraint will be lifted in future patch releases.

*Released on*: 2021-12-16

*Contributors*:
Katrin Yordanova (https://github.com/katrinDY[GH]),
Vivek Patel (https://github.com/vicpatel[GH]),
Jože Fortun (https://github.com/fajfa[GH]),
Denis Arh (https://github.com/darh[GH]),
Tomaž Jerman (https://github.com/tjerman[GH]),
Peter Grlica (https://github.com/petergrlica[GH]).

.[#2021_9_5-added]#<<2021_9_5-added,Added:>>#
* Role security (forbidden, permitted, forced) on external authentication providers ({SERVER_COMMIT_BASE}91eb88d2[`91eb88d2`]).
* Workflow functions for attachment management ({SERVER_COMMIT_BASE}8a8c7685[`8a8c7685`]).
* OIDC support for corteza ({SERVER_COMMIT_BASE}a2091db[`a2091db`]).
* Integration Gateway json response postfilter and http request to scope ({SERVER_COMMIT_BASE}b0590d2f[`b0590d2f`]).
* JWT generate workflow function ({SERVER_COMMIT_BASE}eecf8670[`eecf8670`]).
* Unix strftime support to gval functions ({SERVER_COMMIT_BASE}d5001341[`d5001341`]).
* Integer caster to gval functions ({SERVER_COMMIT_BASE}3473a267[`3473a267`]).
* Added support for role permission cloning ({SERVER_COMMIT_BASE}0564fe7[`0564fe7`],
{WEBAPP_ADMIN_COMMIT_BASE}d06cd41[`d06cd41`], {WEBAPP_JS_COMMIT_BASE}9bd530a[`9bd530a`]).
* Added custom processing button ({WEBAPP_VUE_COMMIT_BASE}6ec4157[`6ec4157`]).
* Translations for reporter webapp ({WEBAPP_REPORTER_COMMIT_BASE}6e26d5a[`6e26d5a`], {LOCALE_COMMIT_BASE}931011c[`931011c`]).
* Added additional string manipulation functions to reporter expressions ({SERVER_COMMIT_BASE}a45c914e[`a45c914e`]).
* Added support for xref:2021.9@devops-guide:cli/record-import.adoc[record import] via the import CLI command ({SERVER_COMMIT_BASE}96556f54[`96556f54`]).

//
//

.[#2021_9_5-fixed]#<<2021_9_5-fixed,Fixed:>>#
* Translatable content (modules, names, pages, namespaces) is now sent with current language ({WEBAPP_COMPOSE_COMMIT_BASE}5bd3bd37[`5bd3bd37`]).
* Improve slow performance in some casses with wf-loops by increesing workflow session state flushing from 10 to 1000 ({SERVER_COMMIT_BASE}486a5752[`486a5752`]).
* Prevent table display elements from crashing if an empty join frame is recieved ({WEBAPP_REPORTER_COMMIT_BASE}f244b7b2[`f244b7b2`]).
* Fixed improper report route bindings ({WEBAPP_REPORTER_COMMIT_BASE}d250827b[`d250827b`]).
* Added missing type definition to the report filter perser registry ({SERVER_COMMIT_BASE}08ef5ab10[`08ef5ab10`]).
* Fixed panicking report filter marshaling when invalid ({SERVER_COMMIT_BASE}59ef8da1a[`59ef8da1a`]).
* Fixed improper handling of automation page blocks which define buttons with no references ({SERVER_COMMIT_BASE}047b647af[`047b647af`]).
* Prevent text from exiting container in EditorToolbox ({WEBAPP_ADMIN_COMMIT_BASE}147dcd7[`147dcd7`]).
* Fixed improper date manipulation functions for reporter expressions ({WEBAPP_REPORTER_COMMIT_BASE}46372f55[`46372f55`]).
* Fixed persistent run-as workflow issue after trigger removal ({SERVER_COMMIT_BASE}87f08d8b[`87f08d8b`]).
* Fix access control checks on UI ({WEBAPP_ADMIN_COMMIT_BASE}e902382[`e902382`]).
* Fix user role membership picker ({WEBAPP_ADMIN_COMMIT_BASE}cadb6e1[`cadb6e1`]).
* Fix module field order changing when you navigated to all records ({WEBAPP_COMPOSE_COMMIT_BASE}3525ef8[`3525ef8`]).
* Fix record and user selector editors not rendering properly ({WEBAPP_COMPOSE_COMMIT_BASE}09bca49[`09bca49`]).
* Fix display element configurator options form not resetting properly ({WEBAPP_REPORTER_COMMIT_BASE}6b33655[`6b33655`]).
* Broken translations on password reset ({SERVER_COMMIT_BASE}87f08d8[`87f08d8`])
* Prevent error message from being transformed by toLowerCase() {WEBAPP_WORKFLOW_COMMIT_BASE}32e9325[`32e9325`])

.[#2021_9_5-changed]#<<2021_9_5-changed,Changed:>>#
* Changed chart display element configurator ({WEBAPP_REPORTER_COMMIT_BASE}b553f72[`b553f72`]).

.[#2021_9_5-removed]#<<2021_9_5-removed,Removed:>>#
* Removed the unused `COUNTD` metric aggregation function ({WEBAPP_JS_COMMIT_BASE}29e8ab2a[`29e8ab2a`], {LOCALE_COMMIT_BASE}58a0a3b7[`58a0a3b7`], {WEBAPP_COMPOSE_COMMIT_BASE}4633b238[`4633b238`])


# src/modules/ROOT/pages/changelog/202109/06.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.6`

*Released on*: 2022-01-26

*Contributors*:
Peter Grlica (https://github.com/petergrlica[GH]),
Denis Arh (https://github.com/darh[GH]),
Vivek Patel (https://github.com/vicpatel[GH]),
Tomaž Jerman (https://github.com/tjerman[GH]),
Katrin Yordanova (https://github.com/katrinDY[GH]),
Jože Fortun (https://github.com/fajfa[GH]).

.[#2021_9_6-added]#<<2021_9_6-added,Added:>>#
* Added support for RTL direction.
* Added support for additional arguments when invoking automation scripts via API ({SERVER_COMMIT_BASE}91eb88d2[`91eb88d2`]).
* Added support for resource translation on select field options ({SERVER_COMMIT_BASE}c72902a8[`c72902a8`]).
* Added support for SAML signed requests ({SERVER_COMMIT_BASE}5e4486c7[`5e4486c7`], {WEBAPP_ADMIN_COMMIT_BASE}7ec02f6e[`7ec02f6e`]).
* Added support for SAML HTTP binding ({SERVER_COMMIT_BASE}717cae5c0b[`717cae5c0b`], {WEBAPP_ADMIN_COMMIT_BASE}5cf0597b40[`5cf0597b40`])
* Added option to hide the import button on the record list ({WEBAPP_COMPOSE_COMMIT_BASE}cd982a8[`cd982a8`], {WEBAPP_JS_COMMIT_BASE}9c85d0b[`9c85d0b`], {LOCALE_COMMIT_BASE}874e0b2[`874e0b2`]).
* Added support for version specific `DB_DSN` `.env` variable, simplifying development ({SERVER_COMMIT_BASE}c3516dd[`c3516dd`]).
* Added `find` and `has` expression functions ({SERVER_COMMIT_BASE}86deaea9[`86deaea9`]).
* Added `sort` expr function ({SERVER_COMMIT_BASE}be6b572[`be6b572`])
* Added support for multi-value filtering on record lists ({WEBAPP_COMPOSE_COMMIT_BASE}d0213cb[`d0213cb`]).
* Added processing indicator when deleting records in record list ({WEBAPP_COMPOSE_COMMIT_BASE}6d47c1b[`6d47c1b`])

//
//

.[#2021_9_6-fixed]#<<2021_9_6-fixed,Fixed:>>#
* Refactored workflow execution and fixed runner/invoker logic ({SERVER_COMMIT_BASE}92224360[`92224360`]).
* Fixed improper attachment upload permission checks due to partial request parameters (https://github.com/cortezaproject/corteza-server/pull/309[#309], https://github.com/cortezaproject/corteza-webapp-compose/pull/346[#346]).
* Fixed improper QL argument transformations based on the used database (https://github.com/cortezaproject/corteza-server/pull/308[#308]).
* Fix broken docker container health check on {APP_AUTOMATION} server ({SERVER_CORREDOR_COMMIT_BASE}dce30ba[`dce30ba`]).
* Changed federation locales ({WEBAPP_COMPOSE_COMMIT_BASE}91094e44[`91094e44`]).
* Refactored minio store and fixed invalid bucket name issue ({SERVER_COMMIT_BASE}23a2446[`23a2446`]).
* Fixed scrolling when only one pageBlock is added ({WEBAPP_COMPOSE_COMMIT_BASE}88f3e72[`88f3e72`]).
* Fixed translations on password reset ({SERVER_COMMIT_BASE}87f08d8[`87f08d8`]).
* Fixed RBAC rules and workflows not applying after being imported via namespace import ({SERVER_COMMIT_BASE}ff6cadc0[`ff6cadc0`]).
* Fixed improper handling of empty resource translation strings (resource-translations) ({SERVER_COMMIT_BASE}4b264798[`4b264798`], {WEBAPP_COMPOSE_COMMIT_BASE}043588f1[`043588f1`]).
* Fixed external OIDC for {PRODUCT_NAME} flow ({SERVER_COMMIT_BASE}398242b[`398242b`]).
* Fixed percentage calculation for all types of charts ({WEBAPP_JS_COMMIT_BASE}2b7c949[`2b7c949`]).
* Fixed field picker system field translations ({WEBAPP_VUE_COMMIT_BASE}fa80ade[`fa80ade`], {WEBAPP_COMPOSE_COMMIT_BASE}485187e[`485187e`]).
* Fixed namespace importing -- additional request validation ({SERVER_COMMIT_BASE}ca178714b[`ca178714b`]), improve internal resource identification ({SERVER_COMMIT_BASE}00dd86fb9[`00dd86fb9`], {SERVER_COMMIT_BASE}d247ec678[`d247ec678`], and {SERVER_COMMIT_BASE}8be8be96d[`8be8be96d`]).
* Fixed improper API request content parsing when `Content-Type` defines character set ({SERVER_COMMIT_BASE}d0154cc1b[`d0154cc1b`]).
* Fixed improper error handling for the upload component ({WEBAPP_COMPOSE_COMMIT_BASE}a0a1ac0[`a0a1ac0`]).
* Fixed role-security setting for external providers ({WEBAPP_COMPOSE_COMMIT_BASE}05a40ca[`05a40ca`]).
* Fixed issue with OIDC provider removal ({WEBAPP_COMPOSE_COMMIT_BASE}c078808[`c078808`]).
* Fixed queue name matching on workflow onMessage event ({SERVER_COMMIT_BASE}79d8a842[`79d8a842`])
* Fixed calendar event display for events that span multiple months ({WEBAPP_JS_COMMIT_BASE}4d2f824[`4d2f824`])
* Fixed record list filter for number and id fields ({WEBAPP_COMPOSE_COMMIT_BASE}3b421a1[`3b421a1`])
* Fixed namespace selector overflowing sidebar ({WEBAPP_COMPOSE_COMMIT_BASE}b9aa41e[`b9aa41e`])
* Fixed metric page block field selector options ({WEBAPP_COMPOSE_COMMIT_BASE}cb69c80[`cb69c80`])
* Fixed chart rendering edge case where the canvas did not yet exist ({WEBAPP_COMPOSE_COMMIT_BASE}1b965f8[`1b965f8`]).
* Fixed centering for the empty record list label ({WEBAPP_COMPOSE_COMMIT_BASE}f467e0f[`f467e0f`])
* Fixed inline record editor not checking permissions for deletion ({WEBAPP_COMPOSE_COMMIT_BASE}f74d398[`f74d398`])
* Fixed improper reminder handling, causing them to sometimes not show ({WEBAPP_COMPOSE_COMMIT_BASE}94247f0[`94247f0`])
* Fixed invalid membership fetch for closed roles ({WEBAPP_ADMIN_COMMIT_BASE}88955eb[`88955eb`])
* Fixed column order not persisting for ColumnPicker component ({WEBAPP_COMPOSE_COMMIT_BASE}9659d9f[`9659d9f`], {WEBAPP_JS_COMMIT_BASE}2b7c949[`2b7c949`], {LOCALE_COMMIT_BASE}b53bc6b[`b53bc6b`]).


//
//

.[#2021_9_6-changed]#<<2021_9_6-changed,Changed:>>#
* Make default value not required for multi fields ({WEBAPP_COMPOSE_COMMIT_BASE}aae3f6f[`aae3f6f`])
* Prefill inline record editor related values ({WEBAPP_COMPOSE_COMMIT_BASE}c457679[`c457679`])
* Disable page deletion if it has sub-pages ({WEBAPP_COMPOSE_COMMIT_BASE}67c3b2c[`67c3b2c`])


# src/modules/ROOT/pages/changelog/202109/07.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.7`

*Released on*: 2022-02-10

.[#2021_9_7-fixed]#<<2021_9_7-fixed,Fixed:>>#
* Fixed `set` expression function to properly handle types provided by workflow execution ({SERVER_COMMIT_BASE}f42d707[`f42d707`]).
* Fixed OIDC provider scope string issue ({SERVER_COMMIT_BASE}b1572e1[`b1572e1`]).
* Fixed workflow issues with invoker/runner ({SERVER_COMMIT_BASE}c4d80b88[`c4d80b88`]).
* Fixed resource translations for content and automation page blocks ({SERVER_COMMIT_BASE}8a8cf42e[`8a8cf42e`]).
* Fixed inconsistent NULL order for different DB engines causing paging cursor issues ({SERVER_COMMIT_BASE}2be460ee[`2be460ee`]).


# src/modules/ROOT/pages/changelog/202109/08.adoc

include::ROOT:partial$variables.adoc[]

:PATCH_V: 2021_9_8

= `2021.9.8`

*Released on*: `2022-03-07`

.[#{PATCH_V}-changed]#<<{PATCH_V}-changed,Changed:>>#
. Changed default background colour to white in `MetricConfigurator` ({WEBAPP_COMPOSE_COMMIT_BASE}49a525a[`49a525a`]).

.[#{PATCH_V}-fixed]#<<{PATCH_V}-fixed,Fixed:>>#
. Fixed `count` expression function to properly handle the no argument case when typed values are being used (usually when invoked via workflow expressions) ({SERVER_COMMIT_BASE}5d7d3aa3[`5d7d3aa3`]).
. Fixed improper page blockID assignment on page create ({SERVER_COMMIT_BASE}95065f8e7[`95065f8e7`]).
. Fixed improper page blockID assignment on page create ({SERVER_COMMIT_BASE}95065f8e7[`95065f8e7`]).
. Fixed role management on external auth providers ({WEBAPP_COMPOSE_COMMIT_BASE}d679a59[`d679a59`]).
. Append custom args when executing {APP_AUTOMATION} scripts via Compose REST handlers ({SERVER_COMMIT_BASE}2741e3577[`2741e3577`]).
. Fixed improper handling of unresolved (type any) values ({SERVER_COMMIT_BASE}5ff68c414[`5ff68c414`]).
. Hide refresh data button when no data is present in `MetricConfigurator` ({WEBAPP_COMPOSE_COMMIT_BASE}8fc446c[`8fc446c`]).
. Increase z-index for PageBuilder to avoid toolbar with icons appearing below the Block's title and description ({WEBAPP_COMPOSE_COMMIT_BASE}667a9b0[`667a9b0`]).
. Translate messages in errors component ({WEBAPP_COMPOSE_COMMIT_BASE}acd5473[`acd5473`], {WEBAPP_JS_COMMIT_BASE}1e933b2[`1e933b2`], {LOCALE_COMMIT_BASE}0af18b1[`0af18b1`]).
. Reminders of other people showing up ({WEBAPP_COMPOSE_COMMIT_BASE}63b3efe[`63b3efe`]).
. Translations of field configurators and calendars ({WEBAPP_COMPOSE_COMMIT_BASE}d4a379e[`d4a379e`], {WEBAPP_COMPOSE_COMMIT_BASE}5f00980[`5f00980`]).
. Relative values with charts ({WEBAPP_JS_COMMIT_BASE}eb5c4c7[`eb5c4c7`], {WEBAPP_JS_COMMIT_BASE}025cfd5[`025cfd5`]).
. Fix number of record to be exported in ExporterModal ({WEBAPP_COMPOSE_COMMIT_BASE}eb5c4c7[`eb5c4c7`], {WEBAPP_COMPOSE_COMMIT_BASE}5f36917[`5f36917`]).
. Add missing input string to integration gateway namespace for admin ({LOCALE_COMMIT_BASE}eb5c4c7[`eb5c4c7`], {LOCALE_COMMIT_BASE}64d27e1[`64d27e1`]).
. Fixed cumulative funnel chart value calculations ({WEBAPP_JS_COMMIT_BASE}0fbce36[`0fbce36`]).
. Fixed improper reporter funnel chart display due to invalid data type conversion ({WEBAPP_JS_COMMIT_BASE}c7ca7d1[`c7ca7d1`]).

.[#{PATCH_V}-security]#<<{PATCH_V}-security,Security:>>#
. Strengthen reset-password flow with rate limiting and invalidation of existing tokens({WEBAPP_WORKFLOW_COMMIT_BASE}d2d0245d5[`d2d0245d5`]).
. Improve attachment validation on size and type for compose uploads ({SERVER_COMMIT_BASE}6f19f00b2[`6f19f00b2`]).
. Sanitize back-link on logout page (XSS) ({SERVER_COMMIT_BASE}8c0a62284[`8c0a62284`]).
. Refactor delete all session of user from auth page ({SERVER_COMMIT_BASE}23a8b757ee[`23a8b757ee`]).


# src/modules/ROOT/pages/changelog/202109/09.adoc

include::ROOT:partial$variables.adoc[]

:PATCH_V: 2021_9_9

= `2021.9.9`

*Released on*: `2022-04-05`

.[#{PATCH_V}-added]#<<{PATCH_V}-added,Added:>>#
* Added support for `Boolean` field label resource translations ({SERVER_COMMIT_BASE}11af9dba7[`11af9dba7`], {WEBAPP_COMPOSE_COMMIT_BASE}245c20e24[`245c20e24`]).

.[#{PATCH_V}-changed]#<<{PATCH_V}-changed,Changed:>>#
* Changed resource translation sanitization to be looser to support a wider range of formatting options ({SERVER_COMMIT_BASE}4278e5823[`4278e5823`]).

.[#{PATCH_V}-fixed]#<<{PATCH_V}-fixed,Fixed:>>#
* Fixed missing role references for namespace export where the User module field defined role prefilters ({SERVER_COMMIT_BASE}cb44b6591[`cb44b6591`]).
* Fixed improper namespace import resource re-identification due to resources being ignored ({SERVER_COMMIT_BASE}3b235e330[`3b235e330`]).
* Fixed workflow trace parameter ({SERVER_COMMIT_BASE}3e068026[`3e068026`]).
* Fixed improper resource translation content sanitization for RTE contents ({SERVER_COMMIT_BASE}50671180d[`50671180d`]), link attributes ({SERVER_COMMIT_BASE}f699d4b1e[`f699d4b1e`]).
* Fixed actionlog codegen lapsus ({SERVER_COMMIT_BASE}d44d396b3[`d44d396b3`])
* Fixed missing roles in the impersonated user -- roles were not included in the generated JWT ({SERVER_COMMIT_BASE}e4ba223da[`e4ba223da`])
* Fixed improper resource iterator data chunking which caused the database to error out for large datasets ({SERVER_COMMIT_BASE}69c95a5a3[`69c95a5a3`])
* Fixed record list not working when duplicate fields reside on same page ({WEBAPP_COMPOSE_COMMIT_BASE}c13dd1e81[`c13dd1e81`]).

.[#{PATCH_V}-security]#<<{PATCH_V}-security,Security:>>#
* Added additional link tags to make them more secure ({WEBAPP_COMPOSE_COMMIT_BASE}889e2485f[`889e2485f`]).


# src/modules/ROOT/pages/changelog/202109/10.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.10`

*Released on*: `2022-04-20`

.[#2021_9_10-changed]#<<2021_9_10-changed,Changed:>>#
* Changed the profiler endpoints (when enabled) to be under `/debug` instead of `/__profiler` to conform to pprof requirements ({SERVER_COMMIT_BASE}2653c3894[`2653c3894`]).

.[#2021_9_10-fixed]#<<2021_9_10-fixed,Fixed:>>#
* Fixed improper static translation loading for custom languages ({SERVER_COMMIT_BASE}964b71a56[`964b71a56`]).
* Fixed memory leaks and general performance optimizations for content sanitization ({SERVER_COMMIT_BASE}2711b0211[`2711b0211`]), workflow loading ({SERVER_COMMIT_BASE}35c1c0892[`35c1c0892`]), and expression processing ({SERVER_COMMIT_BASE}4eccaa826[`4eccaa826`]).
* Fixed workflow attachment uploading for all supported types (`Reader`, `Bytes`, and `String`) ({SERVER_COMMIT_BASE}7448a2d7b[`7448a2d7b`]).
* Fixed prompt duplication by preventing prompts from being resent over web sockets ({SERVER_COMMIT_BASE})f8a089a15[`f8a089a15`].


# src/modules/ROOT/pages/changelog/202109/11.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.11`

*Released on*: `2022-05-31`

.[#2021_9_11-fixed]#<<2021_9_11-fixed,Fixed:>>#
* Fixed improper PostgreSQL formatting for ISO timestamp templates by adding an edge-case exception ({SERVER_COMMIT_BASE}034a7f9[`#034a7f9`]).
* Fixed improper number and text setting value decoding by covering edge-cases ({SERVER_COMMIT_BASE}ced2daf[`#ced2daf`]).
* Fixed improper module field resource translation encoding, decoding, and store persistance causing the field description and hint field to get mixed up by fixing invalid value mapping and removing translations from the DB ({SERVER_COMMIT_BASE}0422e5f[`#0422e5f`], {SERVER_COMMIT_BASE}e7ea299[`#e7ea299`], {SERVER_COMMIT_BASE}6c2dd28[`#6c2dd28`]).
* Fixed improper workflow prompt handling when user has multiple {PRODUCT_NAME} instances (tabs) open at the same time.
{PRODUCT_NAME} web applications improved communication on what prompts are already resolved and where the prompts should be shown ({WEBAPP_VUE_COMMIT_BASE}ef238df[`#ef238df`]).
* Fixed broken module field value expressions where the `old` record reference was used.
The issue occurred because the value was never provided ({SERVER_COMMIT_BASE}993cd22[`#993cd22`]).


# src/modules/ROOT/pages/changelog/202109/12.adoc

include::ROOT:partial$variables.adoc[]

= `2021.9.12`

*Released on*: `2022-06-15`

.[#2021_9_12-fixed]#<<2021_9_12-fixed,Fixed:>>#
* Fixed improper credential validation on user registration causing the user to be created even when invalid credentials (mainly the password) was provided.
The fix moves the password validation step to the earlier stage of the sign up flow ({SERVER_COMMIT_BASE}ff13912[`#ff13912`]).
* Fixed improper record count for grouped reports where multi-value fields are involved.
The fix, for some cases, omits duplicate values ({SERVER_COMMIT_BASE}7546dbb[`7546dbb`]).


# src/modules/ROOT/pages/changelog/202109/index.adoc

include::ROOT:partial$variables.adoc[]

[#2021-9-x]
= `2021.9`

With {PRODUCT_NAME} `2021.9`, we continue to improve accessibility by introducing internationalization for the user interface as well as user-defined configurations.
In addition, we've improved the overall design and user experience, improved the authentication and access control facilities, expanded on the existing feature set, and introduced a few new additions.

*Internationalization*

With xref:2021.9@integrator-guide:personalization/i18n.adoc[internationalization], we add support for the translation of user interfaces, as well as locale specific date-time and number formatting.
{PRODUCT_NAME} allows you to modify the built-in translations entirely as well as define translations for additional languages you might need or any custom web application modifications you might have performed.
You can also translate most of the user-provided configurations (such as namespaces and module fields), allowing you to configure your {APP_NAME_COMPOSE} applications to be accessible.

[IMPORTANT]
====
To enable translations for custom configuration, you will need to set the `LOCALE_RESOURCE_TRANSLATIONS_ENABLED=true` `.env` variable.
====

*UI/UX*

Building on the `2021.3` release, we continue to improve the user interface design as well as the overall experience when interacting with {PRODUCT_NAME} web applications.
Most notably, we've reworked page navigation, improved consistency between different web applications, and added a more granular record list filter.

*Access control*

The xref:2021.9@integrator-guide:access-control.adoc[access control facility] received an upgrade, providing more fine-grained control over the access to your data, such as specific records or modules of particular namespaces.
xref:2021.9@integrator-guide:access-control.adoc#role-type-ctx[Contextual roles] allow you to determine role membership and thus access to resources based on the xref:2021.9@integrator-guide:access-control.adoc#role-type-ctx[state the system is in] (such as what record we are editing).

[TIP]
====
With contextual roles, you can cover cases where a user is only allowed to access or manage data created or owned by them.
====

*Authentication and security*


The authentication flow is now more flexible by introducing support for xref:2021.9@administrator-guide:authentication/authentication-providers/index.adoc#saml[SAML] and split credential flow.
Further improvements to the authentication token generator and handler help increase the stability and security of the system.

*Integration gateway*

Responding to the needs of defining custom API endpoints, we've expanded the sink route facility and introduced the xref:2021.9@integrator-guide:api-gw/index.adoc[Integration gateway].
The improved facility simplifies the process of defining and managing custom API endpoints and defining processing for HTTP requests either via the built-in functions, workflows, or xref:2021.9@integrator-guide:api-gw/index.adoc#js-processing[custom code].

[NOTE]
====
The legacy sink route facility is still present and works as it did before, but we aim to replace the sink routes.
====

*Reporter*

xref:2021.9@integrator-guide:reporting/index.adoc[The reporter] provides a dedicated facility to define and view reports based on the data your {PRODUCT_NAME} {APP_NAME_COMPOSE} defines.

.[#2021_3-important]#<<2021_3-important,Important upgrade notes:>>#
[cols="1s,5a"]
|===
| [#2021_3-important-rbac]#<<2021_3-important-rbac,Access control>>#
|

{PRODUCT_NAME} 2021.9 reworks the internals of our RBAC facility.
From the access evaluation flow, to how rules are encoded.

.When upgrading to `2021.9`:
* {PRODUCT_NAME} will automatically scan all existing RBAC rules, remove any obsolete rules like messaging, sanitize existing (federation module renaming) and properly change change resource IDs.
* {PRODUCT_NAME} will automatically upgrade, add, remove, and rename roles as needed based on the reworked system:
** authenticated, anonymous, super admin roles are added,
** `everyone` role is *removed*
** all RBAC rules owned by the now deprecated `everyone` role are migrated to the role `authenticated`
** static role IDs (1 for everyone and 2 for admin) are replaced by sequential IDs.
All memberships and RBAC rules are transferred to the updated role IDs.
* {PRODUCT_NAME} will automatically add the following system users:
** Corteza Provisioner (`provision@corteza.local`, `corteza-provisioner`); member of super admin account, used for all provisioning actions.
** Corteza Service Account  (`service@corteza.local`, `corteza-service`); member of super admin account, used for all service activities, CLI interface.
** Corteza Federation (`federation@corteza.local`, `corteza-federation`); member of super admin account, used for all federation activities.

|===

:leveloffset: +1

include::12.adoc[]

include::11.adoc[]

include::10.adoc[]

include::09.adoc[]

include::08.adoc[]

include::07.adoc[]

include::06.adoc[]

include::05.adoc[]

include::04.adoc[]

include::03.adoc[]

include::02.adoc[]

include::01.adoc[]

include::00.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/202203/00.adoc

include::ROOT:partial$variables.adoc[]

= `2022.3.0`

*Released on*: 2022-03-30

.[#2022_3_0-added]#<<2022_3_0-added,Added:>>#
* Added additional development tools for nicer user experience; step configuration preview on hover ({WEBAPP_WORKFLOW_COMMIT_BASE}b017702[`b017702`] {WEBAPP_WORKFLOW_COMMIT_BASE}6e2a4be[`6e2a4be`] {WEBAPP_WORKFLOW_COMMIT_BASE}51d1f9e[`51d1f9e`]), additional help labels ({WEBAPP_WORKFLOW_COMMIT_BASE}214c973[`214c973`]), and a predefined HTTP method select ({SERVER_COMMIT_BASE}5e59bbab2[`5e59bbab2`]).
* Added additional workflow prompts to redirect to a record create page ({WEBAPP_VUE_COMMIT_BASE}a021552[`a021552`] {WEBAPP_VUE_COMMIT_BASE}c1fe4ff[`c1fe4ff`]) and to allow record selection ({WEBAPP_VUE_COMMIT_BASE}aba32e6[`aba32e6`]).
* Added additional support in workflows for paging over {APP_NAME_COMPOSE} records (https://github.com/cortezaproject/corteza-server/pull/336[`#336`]).
* Added default workflow step labels when no custom label is provided ({WEBAPP_WORKFLOW_COMMIT_BASE}3854ddd[`3854ddd`]).
* Added xref:2022.3@devops-guide:troubleshooting/web-console.adoc[web console] -- a user interface for inspecting and troubleshooting server-side issues (https://github.com/cortezaproject/corteza-server/pull/327[`#327`], {SERVER_COMMIT_BASE}7fa5e43d0[`7fa5e43d0`], {SERVER_COMMIT_BASE}f66ab4550[`f66ab4550`], {SERVER_COMMIT_BASE}9eca65595[`9eca65595`], {SERVER_COMMIT_BASE}f291cde93[`f291cde93`]).
* Added API endpoints with a landing page and 404 pages ({SERVER_COMMIT_BASE}a81f35d5a[`a81f35d5a`]).
* Added additional configuration for page configuration ({SERVER_COMMIT_BASE}b478b3777[`b478b3777`]) and general UI, sidebar, and top bar settings ({SERVER_COMMIT_BASE}f69751190[`f69751190`], {WEBAPP_COMPOSE_COMMIT_BASE}a2dd9fe5[`a2dd9fe5`], {SERVER_COMMIT_BASE}eb583a339[`eb583a339`], {SERVER_COMMIT_BASE}c558ece3b[`c558ece3b`], {SERVER_COMMIT_BASE}2b6026182[`2b6026182`], {WEBAPP_ADMIN_COMMIT_BASE}bed4f1b[`bed4f1b`], {WEBAPP_WORKFLOW_COMMIT_BASE}6134d9b[`6134d9b`], {WEBAPP_REPORTER_COMMIT_BASE}314d1d1[`314d1d1`], {WEBAPP_VUE_COMMIT_BASE}2659085[`2659085`], {WEBAPP_VUE_COMMIT_BASE}97dea83[`97dea83`], {WEBAPP_VUE_COMMIT_BASE}e4f2977[`e4f2977`]).
* Added support for record page editing the same way as list pages can be edited ({WEBAPP_COMPOSE_COMMIT_BASE}8bb77988[`8bb77988`]).
* Added an "open in new tab" option for links defined in the rich text editors ({WEBAPP_VUE_COMMIT_BASE}e4fddb3[`e4fddb3`]).
* Added additional import export capabilities by adding a user import and export to the {PRODUCT_NAME} {APP_NAME_ADMIN} ({SERVER_COMMIT_BASE}9142c7b5a[`9142c7b5a`], {WEBAPP_ADMIN_COMMIT_BASE}84f86bb[`84f86bb`], {WEBAPP_ADMIN_COMMIT_BASE}89f4aab[`89f4aab`], {WEBAPP_JS_COMMIT_BASE}2b04d79[`2b04d79`]); as well as including access control and resource translations to the existing namespace export ({SERVER_COMMIT_BASE}8e679bf97[`8e679bf97`]).
* Added xref:2022.3@integrator-guide:discovery/index.adoc[{PRODUCT_NAME} {APP_NAME_DISCOVERY}] -- a search engine for your data ({SERVER_COMMIT_BASE}7bde98697[`7bde98697`], {SERVER_COMMIT_BASE}84f918a1d[`84f918a1d`], {SERVER_COMMIT_BASE}d384db951[`d384db951`], {SERVER_COMMIT_BASE}4e3d5dd00[`4e3d5dd00`], {SERVER_COMMIT_BASE}b6ff0f921[`b6ff0f921`], {WEBAPP_COMPOSE_COMMIT_BASE}ed1122d6[`ed1122d6`]).
* Added delete strategy for {APP_NAME_COMPOSE} pages when the page has nested child pages ({SERVER_COMMIT_BASE}691481424[`691481424`], {WEBAPP_COMPOSE_COMMIT_BASE}efb45ff8[`efb45ff8`]).
* Added improvements to resource searching and filtering by adding support for date/time only fields ({SERVER_COMMIT_BASE}640a90c20[`640a90c20`]) as well as introducing fuzzy searching to some resources ({WEBAPP_VUE_COMMIT_BASE}03a6f7c[`03a6f7c`], {WEBAPP_COMPOSE_COMMIT_BASE}4f28578e[`4f28578e`], {WEBAPP_WORKFLOW_COMMIT_BASE}29b71da[`29b71da`], {WEBAPP_VUE_COMMIT_BASE}8500f61[`8500f61`]).
* Added support for `Record` fields to query based on a nested `Record` field, limited to *1 level* ({WEBAPP_COMPOSE_COMMIT_BASE}155e6b12[`155e6b12`], {WEBAPP_JS_COMMIT_BASE}eb4c911[`eb4c911`]).
* Added support for multiple presort definitions on record lists ({WEBAPP_COMPOSE_COMMIT_BASE}80f3ad47[`80f3ad47`]).
* Added support to define custom clientID and scope when generating JWT tokens from the CLI ({SERVER_COMMIT_BASE}957e70056[`957e70056`]).
* Added integration between {APP_NAME_REPORTER} and {APP_NAME_COMPOSE} by introducing the xref:2022.3@integrator-guide:compose-configuration/page-blocks.adoc#page-block-report[reporter page block] to show report data on {APP_NAME_COMPOSE} pages ({WEBAPP_COMPOSE_COMMIT_BASE}89664b8a[`89664b8a`], {WEBAPP_REPORTER_COMMIT_BASE}7201f70[`7201f70`], {WEBAPP_JS_COMMIT_BASE}b4667c5[`b4667c5`], {WEBAPP_VUE_COMMIT_BASE}a0b8913[`a0b8913`]).
* Added a new xref:2022.3@integrator-guide:compose-configuration/field-types.adoc#field-type-geometry[`Geometry` field] to store geo location, primarily for use with {APP_NAME_DISCOVERY} ({WEBAPP_COMPOSE_COMMIT_BASE}cb3ac6c2[`cb3ac6c2`], {WEBAPP_JS_COMMIT_BASE}3f56b79[`3f56b79`], {WEBAPP_JS_COMMIT_BASE}2a12fc0[`2a12fc0`]).
* Added support to hide selected roles from the permission list ({WEBAPP_ADMIN_COMMIT_BASE}5bdc3e9[`5bdc3e9`]).
* Added additional media styling for nicer PDF output ({WEBAPP_COMPOSE_COMMIT_BASE}908ba673[`908ba673`]).
* Added Integration gateway profiler ({SERVER_COMMIT_BASE}9a7f6f90[`9a7f6f90`], {WEBAPP_ADMIN_COMMIT_BASE}cbd7ab45[`cbd7ab45`]).

//
//

.[#2022_3_0-changed]#<<2022_3_0-changed,Changed:>>#
* Changed auth templates to use general assets ({SERVER_COMMIT_BASE}43ddaf1e5[`43ddaf1e5`]).
* Changed packages to use the more recent versions, more notably `jwx goth`, and `jwt` ({SERVER_COMMIT_BASE}6eda39f3a[`6eda39f3a`]) as well as switching to `go 1.17` ({SERVER_COMMIT_BASE}2d90fe4e9[`2d90fe4e9`]).
* Changed `onTimestamp` workflow triggers to use the new date time component ({WEBAPP_WORKFLOW_COMMIT_BASE}e18230b[`e18230b`]).
* Changed the expression workflow step to show the add button on the bottom of the list rather then on top ({WEBAPP_WORKFLOW_COMMIT_BASE}b16cb39[`b16cb39`]).
* Changed the workflow step configurator sidebar to use faster transitions for nicer user experience ({WEBAPP_WORKFLOW_COMMIT_BASE}642d3e2[`642d3e2`]).
* Changed the workflow error and delay steps to use expressions instead of constant values ({WEBAPP_WORKFLOW_COMMIT_BASE}5754544[`5754544`], {WEBAPP_WORKFLOW_COMMIT_BASE}9ad29f7[`9ad29f7`]).
* Changed the reports to display users with a user-friendly identifier (name, email, ...) instead of the system user ID ({SERVER_COMMIT_BASE}506a92d2c[`506a92d2c`], {SERVER_COMMIT_BASE}ac6e7332a[`ac6e7332a`]).
* Changed the stack trace log level to "dpanic" ({SERVER_COMMIT_BASE}3f7755cd0[`3f7755cd0`]).
* Changed PageBuilder positioning to avoid toolbar with icons appearing below the Block's title and description ({WEBAPP_COMPOSE_COMMIT_BASE}667a9b0[`667a9b0`]).
* Changed the {APP_NAME_COMPOSE} record list by defining a default limit and a maximum limit to prevent the server from getting overwhelmed ({SERVER_COMMIT_BASE}9e5fd42d4[`9e5fd42d4`]).
* Changed the {APP_NAME_COMPOSE} admin panel side navigation to show the resources in a tree representation for easier overview and access ({WEBAPP_COMPOSE_COMMIT_BASE}14968080[`14968080`], {WEBAPP_COMPOSE_COMMIT_BASE}81e1c340[`81e1c340`], {WEBAPP_VUE_COMMIT_BASE}8262db5[`8262db5`]).
* Changed user display to fall back to user handle before the user ID ({WEBAPP_JS_COMMIT_BASE}d1238b1[`d1238b1`]).
* Changed {APP_NAME_COMPOSE} expression reference to redirect to the documentation ({WEBAPP_COMPOSE_COMMIT_BASE}67834a52[`67834a52`]).
* Changed inline record list editing to work on list pages instead of only record pages ({WEBAPP_COMPOSE_COMMIT_BASE}6d070b62[`6d070b62`]).
* Changed the Integration Gateway request processing using automation workflows by defining more flexible interfaces to access the data (https://github.com/cortezaproject/corteza-server/pull/324[`#324`], {SERVER_COMMIT_BASE}460646d45[`460646d45`]).
* General UI changes ({WEBAPP_COMPOSE_COMMIT_BASE}1b33bad3[`1b33bad3`], {WEBAPP_COMPOSE_COMMIT_BASE}c6bf400b[`c6bf400b`], {WEBAPP_COMPOSE_COMMIT_BASE}31d33048[`31d33048`], {WEBAPP_COMPOSE_COMMIT_BASE}1c0ec5ae[`1c0ec5ae`], {WEBAPP_COMPOSE_COMMIT_BASE}ab987f3d[`ab987f3d`], {WEBAPP_ADMIN_COMMIT_BASE}feed8f0[`feed8f0`], {WEBAPP_ADMIN_COMMIT_BASE}4f0e67b[`4f0e67b`]), tweaked responsive design ({WEBAPP_COMPOSE_COMMIT_BASE}e7cfa97c[`e7cfa97c`]), hiding/disabling buttons when they shouldn't be available ({WEBAPP_COMPOSE_COMMIT_BASE}36195451[`36195451`], {WEBAPP_COMPOSE_COMMIT_BASE}59c797b8[`59c797b8`]), changed visual assets ({WEBAPP_COMPOSE_COMMIT_BASE}f5b09bf5[`f5b09bf5`], {WEBAPP_WORKFLOW_COMMIT_BASE}5c72c30[`5c72c30`]).
* Changed the action log layout to match other log lists ({WEBAPP_ADMIN_COMMIT_BASE}f96062e[`f96062e`]).
* Changed funnel charts to be more configurable ({WEBAPP_COMPOSE_COMMIT_BASE}dd28baec[`dd28baec`], {WEBAPP_JS_COMMIT_BASE}4d0eafb[`4d0eafb`]).

//
//

.[#2022_3_0-removed]#<<2022_3_0-removed,Removed:>>#

//
//

.[#2022_3_0-fixed]#<<2022_3_0-fixed,Fixed:>>#
* Fixed SQLite data loss caused by mid-use session disconnect ({SERVER_COMMIT_BASE}23c7f357f[`23c7f357f`]).
* Fixed invalid session lifetime when a user signs up; was set to zero ({SERVER_COMMIT_BASE}f53463a32[`f53463a32`]).
* Fixed external authentication provider removal issues ({SERVER_COMMIT_BASE}74b3ddf94[`74b3ddf94`]).
* Fixed improper user-id claim parsing ({SERVER_COMMIT_BASE}6c7d89a92[`6c7d89a92`]).
* Fixed exported auth asset serving for non-development modes ({SERVER_COMMIT_BASE}dfe19c4c3[`dfe19c4c3`]).
* Fixed overflowing workflow step labels ({WEBAPP_WORKFLOW_COMMIT_BASE}e424627[`e424627`]).
* Fixed premature workflow execution termination caused by parallel delay steps ({SERVER_COMMIT_BASE}4fd0ddfaa[`4fd0ddfaa`]).
* Fixed improper workflow event management by manually removing event listeners ({WEBAPP_WORKFLOW_COMMIT_BASE}deb301f[`deb301f`]), properly destroying instances ({WEBAPP_WORKFLOW_COMMIT_BASE}a192b4a[`a192b4a`]), and making the `ctrl+s` key binding work more reliably ({WEBAPP_WORKFLOW_COMMIT_BASE}faa25d1[`faa25d1`]).
* Fixed workflow configurator side panel not allowing to open paths ({WEBAPP_WORKFLOW_COMMIT_BASE}8e0148f[`8e0148f`]).
* Fixed improper actionlog metadata type encoding/decoding ({SERVER_COMMIT_BASE}e833796aa[`e833796aa`]).
* Fixed invalid system configuration procedure where default settings potentially got omitted ({SERVER_COMMIT_BASE}7fd719364[`7fd719364`]).
* Fixed system panic caused by websockets ({SERVER_COMMIT_BASE}f76b94e74[`f76b94e74`]).
* Fixed report name conflicts with system values ({SERVER_COMMIT_BASE}ab8668955[`ab8668955`]) and missing values on the PostgreSQL database ({SERVER_COMMIT_BASE}cd15f3eaf[`cd15f3eaf`]).
* Fixed reporter including deleted namespaces in report output ({SERVER_COMMIT_BASE}908008eba[`908008eba`]).
* Fixed display elements not rendering when switching between different reports ({WEBAPP_REPORTER_COMMIT_BASE}24d163a[`24d163a`]).
* Fixed missing locale HTTP headers when making requests from the reporter web application ({WEBAPP_REPORTER_COMMIT_BASE}8215602[`8215602`]).
* Fixed reporter table display element raising errors if no data is available ({WEBAPP_VUE_COMMIT_BASE}d2b0ad0[`d2b0ad0`]).
* Fixed missing module field resource translations ({SERVER_COMMIT_BASE}e9dfe8254[`e9dfe8254`]).
* Fixed improper empty resource translation handling by soft-deleting the value instead of omitting the change ({SERVER_COMMIT_BASE}631811929[`631811929`]).
* Fixed improper resource translation updating and handling for {APP_NAME_COMPOSE} pages and modules ({WEBAPP_COMPOSE_COMMIT_BASE}c24d7160[`c24d7160`]).
* Fix the number of records to be exported in ExporterModal ({WEBAPP_COMPOSE_COMMIT_BASE}8f5f2c3[`8f5f2c3`]).
* Fixed Right-To-Left detection to work based on current user language ({WEBAPP_COMPOSE_COMMIT_BASE}30cc4eb7[`30cc4eb7`], {WEBAPP_ADMIN_COMMIT_BASE}c882464[`c882464`]).
* Fixed filtering for time and date only `DateTime` fields ({WEBAPP_COMPOSE_COMMIT_BASE}a755b984[`a755b984`], {WEBAPP_COMPOSE_COMMIT_BASE}6ab98c52[`6ab98c52`], {WEBAPP_COMPOSE_COMMIT_BASE}a755b984[`a755b984`]).
* Fixed automation button removal for unconfigured buttons in the record list page block configurator ({WEBAPP_COMPOSE_COMMIT_BASE}7a7307b6[`7a7307b6`]).
* Fixed record organizer, changed prefilter evaluation ({WEBAPP_COMPOSE_COMMIT_BASE}74b047de[`74b047de`], {WEBAPP_COMPOSE_COMMIT_BASE}2ea20d86[`2ea20d86`]) and added additional record source evaluation ({WEBAPP_COMPOSE_COMMIT_BASE}5cbefcb8[`5cbefcb8`]).
* Fixed record list filtering by properly handling `Boolean` values ({WEBAPP_COMPOSE_COMMIT_BASE}43a1d3cf[`43a1d3cf`]), added missing system fields ({WEBAPP_COMPOSE_COMMIT_BASE}67e7f4fa[`67e7f4fa`], {WEBAPP_COMPOSE_COMMIT_BASE}7cae2b0b[`7cae2b0b`]), tweaked internal logic ({WEBAPP_COMPOSE_COMMIT_BASE}f11def50[`f11def50`], {WEBAPP_COMPOSE_COMMIT_BASE}751c589b[`751c589b`]), fixing improper field kind handling ({WEBAPP_COMPOSE_COMMIT_BASE}1082cf73[`1082cf73`]), and adding a fallback to the equality operator ({WEBAPP_COMPOSE_COMMIT_BASE}b5ee8752[`b5ee8752`]).
* Fixed settings not applying when they are updated and saved ({WEBAPP_ADMIN_COMMIT_BASE}7f5eebe[`7f5eebe`]).
* Fixed timeout issues in http request workflow function ({SERVER_COMMIT_BASE}6620b6ea[`6620b6ea`]).
* Fixed queue name matching on workflow onMessage event ({SERVER_COMMIT_BASE}465e8ffe[`465e8ffe`]).

.[#2022_3_0-security]#<<2022_3_0-security,Security:>>#
* Replaced `dgrijalva/jwt-go` with `lestrrat-go/jwx`, refactored the JWT handling implementation ({SERVER_COMMIT_BASE}59ec77e20[`59ec77e20`], {SERVER_COMMIT_BASE}46675080f[`46675080f`]), token issuer ({SERVER_COMMIT_BASE}6c3bef075[`6c3bef075`]), and moved token validation to earlier stages ({SERVER_COMMIT_BASE}53dd7cc29[`53dd7cc29`]) for a safer, more robust and configurable implementation.
* Added token validation and identity decoding for websockets ({SERVER_COMMIT_BASE}f9c8066e2[`f9c8066e2`]).
* Added missing roles to impersonated user JWT tokens ({SERVER_COMMIT_BASE}ab805f007[`ab805f007`]).
* Tweaked CORS settings ({SERVER_COMMIT_BASE}9fe21dd8c[`9fe21dd8c`]).
* Added sanitization for workflow labels to avoid potential XSS ({WEBAPP_WORKFLOW_COMMIT_BASE}82d8f23[`82d8f23`]).

//
//

.[#2022_3_0-development]#<<2022_3_0-development,Development:>>#
* Refactored and improved the code generator by introducing cuelang ({SERVER_COMMIT_BASE}725f7e9e2[`725f7e9e2`]), refactored old codegeneration to the new facility ({SERVER_COMMIT_BASE}a035e6106[`a035e6106`], {SERVER_COMMIT_BASE}3bddce4d3[`3bddce4d3`], {SERVER_COMMIT_BASE}d103d60a3[`d103d60a3`], {SERVER_COMMIT_BASE}d09b037e8[`d09b037e8`]).
* Added `.env.example` generator ({SERVER_COMMIT_BASE}80d9b466a[`80d9b466a`]).
* Fixed `pinio` version mismatch between `corteza-js` and `corteza-vue` ({WEBAPP_JS_COMMIT_BASE}a8c46b9[`a8c46b9`], {WEBAPP_VUE_COMMIT_BASE}a8f5e24[`a8f5e24`]).
* Tweaked Envoy to properly handle user email lookups ({SERVER_COMMIT_BASE}d841aad13[`d841aad13`]), expanded resource definition for easier state access ({SERVER_COMMIT_BASE}da1828642[`da1828642`]), and removed potential import cycles ({SERVER_COMMIT_BASE}bc1550938[`bc1550938`]), and general improvements ({WEBAPP_COMPOSE_COMMIT_BASE}f5a93caa[`f5a93caa`], {WEBAPP_COMPOSE_COMMIT_BASE}7bb22d96[`7bb22d96`]).
* Improved HTTP server startup ({SERVER_COMMIT_BASE}d74239c73[`d74239c73`]).
* Cleaned up the store interface ({SERVER_COMMIT_BASE}1949782cc[`1949782cc`]).
* Added additional identifiers for report resources ({SERVER_COMMIT_BASE}330a332fd[`330a332fd`]).
* Defined a general component to be used with item selection such as module fields and chart columns ({WEBAPP_COMPOSE_COMMIT_BASE}c3c2d5d6[`c3c2d5d6`], {WEBAPP_COMPOSE_COMMIT_BASE}e4a93e78[`e4a93e78`], {WEBAPP_COMPOSE_COMMIT_BASE}0b39fcc8[`0b39fcc8`], {WEBAPP_REPORTER_COMMIT_BASE}02b7cb9[`02b7cb9`], {WEBAPP_VUE_COMMIT_BASE}bd02931[`bd02931`]).
* Define a generic reusable chart container ({WEBAPP_VUE_COMMIT_BASE}afc6d15[`afc6d15`]).
* Update date fields with the `CDateInput` component ({WEBAPP_COMPOSE_COMMIT_BASE}d65b2c41[`d65b2c41`], {WEBAPP_COMPOSE_COMMIT_BASE}594b6ea5[`594b6ea5`], {WEBAPP_COMPOSE_COMMIT_BASE}f5690fa6[`f5690fa6`]).
* Updated workflow prompt definition structure for more flexibility ({WEBAPP_VUE_COMMIT_BASE}fe8645c[`fe8645c`], {WEBAPP_VUE_COMMIT_BASE}180271f[`180271f`]).


# src/modules/ROOT/pages/changelog/202203/01.adoc

include::ROOT:partial$variables.adoc[]

= `2022.3.1`

*Released on*: `2022-04-20`

.[#2022_3_1-added]#<<2022_3_1-added,Added:>>#
* Added deleted resources to Discovery indexing and searching ({SERVER_DISCOVERY_COMMIT_BASE}09d69f124[`09d69f124`])
* Added JWT token duration option to the CLI command ({SERVER_COMMIT_BASE}679af2f55[`679af2f55`]).
* Added additional `Geometry` field configuration options such as default zoom-level ({WEBAPP_VUE_COMMIT_BASE}a8534ed[`a8534ed`], {WEBAPP_COMPOSE_COMMIT_BASE}b7ab3e47[`b7ab3e47`], {WEBAPP_COMPOSE_COMMIT_BASE}97d1aed3[`97d1aed3`], {WEBAPP_COMPOSE_COMMIT_BASE}98cf01b8[`98cf01b8`]).
* Added processing indicator to record organizer for improved UX ({WEBAPP_COMPOSE_COMMIT_BASE}0e85fbca[`0e85fbca`]).
* Added support for translating system {APP_NAME_COMPOSE} module fields ({WEBAPP_COMPOSE_COMMIT_BASE}623adaf3[`623adaf3`]).
* Added persistent storage to record list filters allowing you to reuse previously used filters ({WEBAPP_COMPOSE_COMMIT_BASE}e18267fd[`e18267fd`]).
* Added Discovery web application to the `make webapp` make command
* Added pagination to search responses improving web application performance for large responses ({SERVER_DISCOVERY_COMMIT_BASE}e046f12[`e046f12`], {WEBAPP_DISCOVERY_COMMIT_BASE}7cb2d64[`7cb2d64`])

.[#2022_3_1-changed]#<<2022_3_1-changed,Changed:>>#
* General UI/UX improvements on {PRODUCT_NAME} {APP_NAME_COMPOSE}, {PRODUCT_NAME} {APP_NAME_ADMIN}, {PRODUCT_NAME} {APP_NAME_SHELL}, and {PRODUCT_NAME} {APP_NAME_WORKFLOW}.
* Changed {APP_NAME_COMPOSE} deletion to also remove the related record page {WEBAPP_COMPOSE_COMMIT_BASE}0ceade66[`0ceade66`]

.[#2022_3_1-fixed]#<<2022_3_1-fixed,Fixed:>>#
* Fixed File upload for CSV files where the server incorrectly detected the MimeType {SERVER_COMMIT_BASE}195c2bb13[`195c2bb13`]
* Fixed invalid workflow resource iterator management where larger datasets crashed execution due to improper resource limitation implementation ({SERVER_COMMIT_BASE}0792c0a17[`0792c0a17`]).
* Fixed improper workflow execution tracing where the workflow execution logic ignored the workflow trace parameter ({SERVER_COMMIT_BASE}41667a7da[`41667a7da`]).
* Fixed data race errors for pkg/locale ({SERVER_COMMIT_BASE}345050990[`345050990`]), pkg/corredor healthcheck ({SERVER_COMMIT_BASE}a797c847b[`a797c847b`]), pkg/healtcheck ({SERVER_COMMIT_BASE}662f5155b[`662f5155b`]), WebSockets ({SERVER_COMMIT_BASE}e8cd7d37d[`e8cd7d37d`]), and pkg/scheduler ({SERVER_COMMIT_BASE}4a75778c1[`4a75778c1`]).
* Fixed time transformation expression functions erroring out when valid string encoded time values were used ({SERVER_COMMIT_BASE}5b40f7875[`5b40f7875`]).
* Fixed memory leak errors causing performance degradation on WebSockets ({SERVER_COMMIT_BASE}c64116fc8[`c64116fc8`]), content sanitization ({SERVER_COMMIT_BASE}9346b5702[`9346b5702`]), Workflow loading ({SERVER_COMMIT_BASE}fa614c7ac[`fa614c7ac`]), and expression processing ({SERVER_COMMIT_BASE}adee67f6b[`adee67f6b`]).
* Fixed workflow attachment uploading for all supported types (`Reader`, `Bytes`, and `String`) ({SERVER_COMMIT_BASE}6fd2288df[`6fd2288df`]).
* Fixed prompt duplication by preventing prompts from being resent over web sockets (SERVER_COMMIT_BASE)9c0026462[`9c0026462`].
* Fixed Workflow HTTP request function basic authentication header preparation {SERVER_COMMIT_BASE}2898e1b8c[`2898e1b8c`]
* Fixed `CInputDateTime` responsiveness ({WEBAPP_VUE_COMMIT_BASE}b0c6422[`b0c6422`]).
* Fixed CSidebarNavItems behavior ({WEBAPP_VUE_COMMIT_BASE}7c7b708[`7c7b708`]).
* Fixed missing report page block display elements ({WEBAPP_COMPOSE_COMMIT_BASE}1625d1fc[`1625d1fc`])
* Fix {APP_NAME_COMPOSE} failing to load due to read-only parameter assignment ({WEBAPP_COMPOSE_COMMIT_BASE}ce5cd504[`ce5cd504`]).
* Fixed system field translations in record page blocks ({WEBAPP_COMPOSE_COMMIT_BASE}fa7e6808[`fa7e6808`]).
* Fixed overflowing record list notification indicating there are no records to show ({WEBAPP_COMPOSE_COMMIT_BASE}12b9fc7f[`12b9fc7f`]).
* Fixed inline record list saving ({WEBAPP_COMPOSE_COMMIT_BASE}f54452c7[`f54452c7`]).
* Fixed system fields not appearing in record page blocks ({WEBAPP_COMPOSE_COMMIT_BASE}de874a8b[`de874a8b`]).
* Fixed record list footer overflowing page block ({WEBAPP_COMPOSE_COMMIT_BASE}9cb2d923[`9cb2d923`])
* Fixed field expression documentation link ({WEBAPP_COMPOSE_COMMIT_BASE}301a1de8[`301a1de8`]).
* Fixed dropdown selects overflowing the screen ({WEBAPP_COMPOSE_COMMIT_BASE}8e37e2b8[`8e37e2b8`]).
* Fixed feed indexing for deleted resources ({SERVER_DISCOVERY_COMMIT_BASE}f5cfb6c[`f5cfb6c`]).

.[#2022_3_1-development]#<<2022_3_1-development,Development:>>#
* Improved E2E testing by adding `data-test-id` tags to specific UI components ({SERVER_COMMIT_BASE}56af630c0[`56af630c0`], {WEBAPP_COMPOSE_COMMIT_BASE}3bb8fe59[`3bb8fe59`]).


# src/modules/ROOT/pages/changelog/202203/02.adoc

include::ROOT:partial$variables.adoc[]

= `2022.3.2`

*Released on*: `2022-05-18`

.[#2022_3_2-added]#<<2022_3_2-added,Added:>>#
* Added an empty check for module field name validation ({WEBAPP_COMPOSE_COMMIT_BASE}d3c33a6[`d3c33a6`]).
* Added more descriptive tab titles based on what page the user is currently on ({LOCALE_COMMIT_BASE}d6bb352[`d6bb352`], {WEBAPP_COMPOSE_COMMIT_BASE}a7f36e5[`a7f36e5`]).
* Added record list filter preservation in the local browser storage ({WEBAPP_COMPOSE_COMMIT_BASE}52ff728[`52ff728`], {LOCALE_COMMIT_BASE}bc2dd98[`bc2dd98`]).
Note that the saved filters are only available on the browser they were saved in.

.[#2022_3_2-changed]#<<2022_3_2-changed,Changed:>>#
* Changed static translations for {APP_NAME_COMPOSE} modules ({LOCALE_COMMIT_BASE}5efb7c9[`5efb7c9`]) and integration gateway filters ({LOCALE_COMMIT_BASE}98f8e4b[`98f8e4b`]).
* Changed resource configuration input states to be more consistent ({WEBAPP_COMPOSE_COMMIT_BASE}2ef02c5[`2ef02c5`]).
* Changed date-time record filter format template to ignore seconds ({WEBAPP_COMPOSE_COMMIT_BASE}fc2eab1[`fc2eab1`], {SERVER_COMMIT_BASE}07c409e[`07c409e`]).
* Changed resource activity log store definitions to be more restrictive and less flexible ({SERVER_COMMIT_BASE}e7ed1d8[`e7ed1d8`]).
* Changed record module fields to show a user-friendly label of the nested user field instead of the user ID ({WEBAPP_COMPOSE_COMMIT_BASE}0d4d74b[`0d4d74b`]).
* Changed chart configuration by hiding the "add metric" button when no module is selected ({WEBAPP_COMPOSE_COMMIT_BASE}a3177bc[`a3177bc`]).

.[#2022_3_2-fixed]#<<2022_3_2-fixed,Fixed:>>#
* Fixed queue search on the {APP_NAME_ADMIN} web application ({WEBAPP_ADMIN_COMMIT_BASE}98a5d95[`98a5d95`], {SERVER_COMMIT_BASE}e6a0b0f[`e6a0b0f`]).
* Fixed integration gateway route search on the {APP_NAME_ADMIN} web application ({WEBAPP_ADMIN_COMMIT_BASE}f821dd8[`f821dd8`], {SERVER_COMMIT_BASE}5ddddf8[`5ddddf8`]).
* Fixed broken resource translation migration when the related resource was deleted ({SERVER_COMMIT_BASE}1786eda[`1786eda`]).
* Fixed chart configuration's improper error handling ({WEBAPP_COMPOSE_COMMIT_BASE}d4bf472[`d4bf472`]) and improper state handling when a new chart was created ({WEBAPP_COMPOSE_COMMIT_BASE}41b0a15[`41b0a15`]).
* Fixed improper resource translation handling for {APP_NAME_COMPOSE} module field's hint and description properties.
The two properties were flipped ({SERVER_COMMIT_BASE}q7fbaf94[`q7fbaf94`], {SERVER_COMMIT_BASE}1c6b793[`1c6b793`]), incorrectly removed from resource translations when removed in the field configuration popup ({SERVER_COMMIT_BASE}d4c9243[`d4c9243`]), and not reflected on the web application ({WEBAPP_COMPOSE_COMMIT_BASE}18de72f[`18de72f`]).
* Fixed charts failing to load in cases of incorrect state management ({WEBAPP_COMPOSE_COMMIT_BASE}629d306[`629d306`]).
* Fixed record list filter not resetting when deleting filter rows ({WEBAPP_COMPOSE_COMMIT_BASE}00b491d[`00b491d`]).
* Fixed improper authentication scenarios loading when running the in development mode ({SERVER_COMMIT_BASE}d280fc7[`d280fc7`]).
* Fixed improper refresh token expiration.
When new refresh tokens got issued they did not adjust the expiration timestamps ({SERVER_COMMIT_BASE}e7d3df1[`e7d3df1`]).
* Fixed new {APP_NAME_COMPOSE} record pages failing to load due to missing button definitions ({SERVER_COMMIT_BASE}b135287[`b135287`]).
* Fixed item selection lists (primarily module fields) where the item would get duplicated ({WEBAPP_VUE_COMMIT_BASE}9a33368[`9a33368`]).
* Fixed the system crashing once user attempts to exchange invalid credentials by redirecting them to the login page ({SERVER_COMMIT_BASE}0c49832e[`0c49832e`]).
* Fixed improper `peer-closed` connection error handling which needlessly spammed error tracking systems ({SERVER_COMMIT_BASE}ab248fe1[`ab248fe1`]).


# src/modules/ROOT/pages/changelog/202203/03.adoc

include::ROOT:partial$variables.adoc[]

= `2022.3.3`

*Released on*: `2022-06-15`

.[#2022_3_3-added]#<<2022_3_3-added,Added:>>#
* Added support for workflow prompts to {PRODUCT_NAME} {APP_NAME_SHELL} and {APP_NAME_ADMIN} web applications ({APP_NAME_COMPOSE} already supports prompts).
Some web applications don't show certain prompt types such as "redirect to record page" ({WEBAPP_VUE_COMMIT_BASE}76e4410[`#76e4410`], {WEBAPP_VUE_COMMIT_BASE}c74fe70[`#c74fe70`], {WEBAPP_JS_COMMIT_BASE}f95d26f[`#f95d26f`], {WEBAPP_ONE_COMMIT_BASE}6e835bc[`6e835bc`], {WEBAPP_COMPOSE_COMMIT_BASE}c62f9fe[`#c62f9fe`], {WEBAPP_ADMIN_COMMIT_BASE}2909ca3[`#2909ca3`]).
* Added a print layout to assist with print to PDF browser features.
This feature helps produce nicer output PDF document without the unneeded UI navigation and other resource management elements ({WEBAPP_COMPOSE_COMMIT_BASE}ed8ee8b[`#ed8ee8b`], {WEBAPP_ADMIN_COMMIT_BASE}d980c0b[`#d980c0b`], {WEBAPP_REPORTER_COMMIT_BASE}c71e1f0[`#c71e1f0`], {WEBAPP_WORKFLOW_COMMIT_BASE}f005b62[`#f005b62`], {WEBAPP_ONE_COMMIT_BASE}d582560[`d582560`]).
* Added support for provisioning JSON system setting values when running the provisioning step.
The support was added to allow provision YAML files configure record toolbar button visibility ({SERVER_COMMIT_BASE}05b97ee[`#05b97ee`]).
An example of this would be `compose.ui.record-toolbar: { "hideBack": true }`.

.[#2022_3_3-changed]#<<2022_3_3-changed,Changed:>>#
* Changed {APP_NAME_COMPOSE} user interface UX by adding spinners to indicate data loading ({WEBAPP_COMPOSE_COMMIT_BASE}11c7cf8[`#11c7cf8`]), changing calendar event cursor to pointer ({WEBAPP_COMPOSE_COMMIT_BASE}75cc346[`#75cc346`]), added additional exceptions for record list sorting and filtering to avoid strange behavior ({WEBAPP_JS_COMMIT_BASE}70c6277[`#70c6277`], {WEBAPP_COMPOSE_COMMIT_BASE}6826d19[`#6826d19`]), added a small delay when processing Record fields ({WEBAPP_COMPOSE_COMMIT_BASE}b6e722d[`#b6e722d`]).
* Changed chart font family to Poppins-Regular to make them consistent with the rest of the {PRODUCT_NAME} design ({WEBAPP_JS_COMMIT_BASE}0349363[`#0349363`]).
* Changed user authentication session and access token logic as well as updating corresponding `.env` variables and their descriptions ({SERVER_COMMIT_BASE}7f84994[`#7f84994`]).
Changed the authentication session and corresponding cookie to expire on session end when using "log in", and after the specified lifetime when using "login and remember me" ({SERVER_COMMIT_BASE}5fd5b93[`#5fd5b93`]).
Changed the "login and remember me" button to not show if the `AUTH_SESSION_PERM_LIFETIME` `.env` variable is set to 0 (disabling the feature) ({SERVER_COMMIT_BASE}ad53ea9[`#ad53ea9`]).
* Changed the {PRODUCT_NAME} {APP_NAME_COMPOSE} sidebar to show the link to all namespaces at the top of the dropdown.
This change allows the link to be visible even with many namespaces present ({WEBAPP_COMPOSE_COMMIT_BASE}15ca4000[`#15ca4000`]).
* Changed and standardized name and handle input value validation across all web apps.
The change was made to provide a more consistent user experience across {PRODUCT_NAME} web applications.
The inputs now properly display if the provided value is a valid name/handle or not ({WEBAPP_REPORTER_COMMIT_BASE}e3bbec7[`#e3bbec7`], {WEBAPP_WORKFLOW_COMMIT_BASE}cae73df[`#cae73df`], {WEBAPP_ADMIN_COMMIT_BASE}1b1d165[`#1b1d165`]).
* Changed the module field kinds to be sorted alphabetically when editing the module.
The change was made to provide a more consistent user experience when configuring {APP_NAME_COMPOSE} modules ({WEBAPP_COMPOSE_COMMIT_BASE}8378e73[`#8378e73`]).

.[#2022_3_3-removed]#<<2022_3_3-removed,Removed:>>#
* Removed the `AUTH_JWT_EXPIRY` `.env` variable because it is replaced by the `AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME` `.env` variable ({SERVER_COMMIT_BASE}e626bcd[`#e626bcd`]).

.[#2022_3_3-fixed]#<<2022_3_3-fixed,Fixed:>>#
* Fixed broken {APP_NAME_COMPOSE} module export which caused `Record` fields to become unconfigurable after the module was imported ({WEBAPP_COMPOSE_COMMIT_BASE}1219112[`#1219112`]).
* Fixed invalid RBAC rule migration where a rule could use wildcards between resource IDs (invalid state).
A new migration step attempts to correct the broken RBAC rules ({SERVER_COMMIT_BASE}563a73c6[`563a73c6`]).
* Fixed improper workflow prompt handling when user has multiple {PRODUCT_NAME} instances (tabs) open at the same time.
{PRODUCT_NAME} web applications improved communication on what prompts are already resolved and where the prompts should be shown ({WEBAPP_VUE_COMMIT_BASE}40e5416[`#40e5416`]).
* Fixed improper number and text setting value decoding by covering edge-cases ({SERVER_COMMIT_BASE}ced2daf[`#ced2daf`]).
* Fixed invalid valid JSONL files being rejected when importing records by adding additional fallback content-type checks to the preprocessing logic ({SERVER_COMMIT_BASE}f726d3f[`#f726d3f`]).
* Fixed improper record access control rule migration due to invalid paging ({SERVER_COMMIT_BASE}b6d13d9[`#b6d13d9`]).
* Fixed infinite loop webconsole alerts when offline ({SERVER_COMMIT_BASE}d8e57b1[`#d8e57b1`]).
* Fixed improper Federation URI node generation by including the API base URL ({SERVER_COMMIT_BASE}798c31e[`#798c31e`]).
* Fixed system healthcheck panic when {APP_AUTOMATION} connection is not available ({SERVER_COMMIT_BASE}2ff1108[`#2ff1108`]).
* Fixed broken module field value expressions where the `old` record reference was used.
The issue occurred because the value was never provided ({SERVER_COMMIT_BASE}7135903[`#7135903`]).
* Fixed improper credential validation on user registration causing the user to be created even when invalid credentials (mainly the password) was provided.
The fix moves the password validation step to the earlier stage of the sign up flow ({SERVER_COMMIT_BASE}c1500df[`#c1500df`]).
* Fixed improper record count for grouped reports where multi-value fields are involved.
The fix, for some cases, omits duplicate values ({SERVER_COMMIT_BASE}416a7ec[`#416a7ec`]).
* Fixed page blocks resetting to their default positions when the changes are saved ({WEBAPP_COMPOSE_COMMIT_BASE}efe24c3[`#efe24c3`]).
* Fixed improper resource translation user interface content parsing which caused some of the paste events to clear out the contents or block the editor ({WEBAPP_COMPOSE_COMMIT_BASE}6a195df[`#6a195df`])
* Fixed and assured that multi-value delimiters are properly displayed when viewing the record value ({WEBAPP_COMPOSE_COMMIT_BASE}a211af6[`#a211af6`])
* Fixed duplicate resource translations when exporting the {APP_NAME_COMPOSE} namespace.
The fix applies extra pre-processing and validations before the resource translations are outputted to the archive ({WEBAPP_COMPOSE_COMMIT_BASE}dcef397[`#dcef397`]).
* Fixed custom field validation error messages not showing based on the user's language.
The value validator now utilizes i18n capabilities to provide appropriate error messages ({SERVER_COMMIT_BASE}f9e9433[`#f9e9433`]).
* Fixed improper RBAC rule correction migration procedure caused by an unrestricted data fetch overloading the database.
The procedure now gradually fetches the required data thus avoiding the issue ({SERVER_COMMIT_BASE}f310442[`#f310442`]).
* Fixed failed workflow prompts from not being dismissible ({WEBAPP_VUE_COMMIT_BASE}ff3d0e6[`#ff3d0e6`]).

.[#2022_3_3-development]#<<2022_3_3-development,Development:>>#
* Including the web console bundle into the built corteza-server ({SERVER_COMMIT_BASE}54fffd0[`#54fffd0`]).
* Defined a new resource utility structure which helps improve operation performance by performing smarter indexing strategies.
The structure was applied to current RBAC access control service, the RBAC rule export and resource translations export services ({SERVER_COMMIT_BASE}0466ffe[`#0466ffe`], {SERVER_COMMIT_BASE}e7c1fe1[`#e7c1fe1`], {SERVER_COMMIT_BASE}a68ddf1[`#a68ddf1`], {SERVER_COMMIT_BASE}aef3171[`#aef3171`]).


# src/modules/ROOT/pages/changelog/202203/04.adoc

include::ROOT:partial$variables.adoc[]

= `2022.3.4`

*Released on*: `2022-07-27`

.[#2022_3_4-added]#<<2022_3_4-added,Added:>>#
* Added a new option to the record list which forces the viewed records to be opened in a new tab instead of the current window.
The feature was added to remove the need to navigate back and forth, re-apply filters when users are working on multiple records from a record list ({LOCALE_COMMIT_BASE}25e7090[`25e7090`], {WEBAPP_COMPOSE_COMMIT_BASE}f7191e5[`f7191e5`], {WEBAPP_JS_COMMIT_BASE}98fc48e[`98fc48e`]).
* Added a new link to parent option to the `Record` module field which dictates wether the input value will be pre-filled with the parent's record ID.
The feature was added to allow some cases from not pre-populating the input, such as a module with a record field which points to itself ({LOCALE_COMMIT_BASE}059ebf8[`059ebf8`], {WEBAPP_COMPOSE_COMMIT_BASE}a79a852[`a79a852`], {WEBAPP_JS_COMMIT_BASE}0e9de63[`0e9de63`]).
* Added support for resource translations on {APP_NAME_COMPOSE} funnel and gauge charts.
The feature allows the user to translate funnel and gauge chart step labels ({WEBAPP_COMPOSE_COMMIT_BASE}9f61346[`9f61346`]).
* Added `Content-Type: text/javascript` header to the `config.js` file served by {PRODUCT_NAME} server.
The headers were added because when https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#mime_sniffing[MIME sniffing] was prevented, the web applications would stop working ({SERVER_COMMIT_BASE}1bdf2b5[`1bdf2b5`]).
* Added new `.env` `AUTH_JWT_ALGORITHM` option allowing you to configure what algorithm to use with your JWT tokens ({SERVER_COMMIT_BASE}480e70e[`480e70e`], {SERVER_COMMIT_BASE}8e42126[`8e42126`]).

.[#2022_3_4-changed]#<<2022_3_4-changed,Changed:>>#
* The record list now waits for the filtering to finish before allowing further filtering.
The change was made due to unexpected cases where filter A resulted after filter B so the record list showed data from filter A instead of B.
The record list now waits for you to finish typing the query before fetching the data and locking the input ({WEBAPP_COMPOSE_COMMIT_BASE}dea2d99[`dea2d99`]).
* Changed module field expressions to clear out the record value when the expression returns the value `null`.
Previously, the field would show the zero-value for that type, such as `0` for `Number` field.
The change was made to allow field expressions to clear out their values, useful for some specific cases ({SERVER_COMMIT_BASE}0bef905[`0bef905`]).
* Changed the password reset policy to prevent users from re-using their old passwords.
Previously, users could reset their current password to the same one as they've previously used, but now such a change is no linger allowed and caused the password reset to fail ({SERVER_COMMIT_BASE}b44024f[`b44024f`])
* General UI/UX changes; tweaked chart resource translation button sizes ({WEBAPP_COMPOSE_COMMIT_BASE}255317a[`255317a`]), remove console error about undefined module when creating a chart ({WEBAPP_COMPOSE_COMMIT_BASE}482d971[`482d971`]), fix record field multi delimiter ({WEBAPP_COMPOSE_COMMIT_BASE}e7249fb[`e7249fb`])

.[#2022_3_4-removed]#<<2022_3_4-removed,Removed:>>#
* Removed `Boolean` and `Record` fields when searching {PRODUCT_NAME} {APP_NAME_COMPOSE} records using the search input box.
The `Boolean` field was removed because the truthy/faulty evaluation produced too loose filters causing unexpected results.
The `Record` field was removed because the values are searched using identifiers which caused confusion in some cases.
You can use the field-specific filters to cover these two cases ({WEBAPP_COMPOSE_COMMIT_BASE}dea2d99[`dea2d99`]).

[IMPORTANT]
====
The API filtering still supports the same set of fields as it did previously.
The exclusion was specific to {APP_NAME_COMPOSE} record lists.
====

* Removed the btn:[delete] button on the create template user interface on the {APP_NAME_ADMIN} web application.
The button was removed because there is no need for it to be there since you can't delete a not yet created template ({WEBAPP_ADMIN_COMMIT_BASE}b72bdd0[`b72bdd0`]).


.[#2022_3_4-fixed]#<<2022_3_4-fixed,Fixed:>>#
* Fixed the workflow expression editor modal discarding the changes when saving using the kbd:[cmd+s] shortcut.
The kbd:[cmd+s] shortcut is now disabled when an expression editor modal window is opened ({WEBAPP_WORKFLOW_COMMIT_BASE}0803d25[`0803d25`]).
* Fixed the trigger path change notification not disappearing when reverting using the kbd:[cmd+z] shortcut.
The trigger path change logic now properly evaluates the kbd:[cmd+z] and kbd:[cmd+y] shortcuts ({WEBAPP_WORKFLOW_COMMIT_BASE}a43e106[`a43e106`]).
* Fixed improper multi-value module field handling in {PRODUCT_NAME} {APP_NAME_REPORTER} tables.
Previously, the multi-value field would cause the row to duplicate, but now it is shown as one where the values use the same multi-value delimiter as configured in the module field ({SERVER_COMMIT_BASE}d65a767[`d65a767`]).
* Fixed RBAC rule provisioning issue where the rule migration attempted to create a duplicated RBAC rule entry.
The migration step now skips any RBAC rules which would cause a duplicate error when migrated ({SERVER_COMMIT_BASE}1f657b3[`1f657b3`]).
* Fixed broken backwards compatibility for the workflow compose record delete function.
A prior bug-fix introduced additional lookup parameters which were set as required, causing the old scenario where an actual Compose Record was provided to no longer work.
The compose record delete function's namespace and module arguments are no longer required but are enforced in the background logic ({SERVER_COMMIT_BASE}378d0f2[`378d0f2`]).
* Fixed improper password constraint validation where the input boxes didn't properly validate some edge cases.
The minimum password length is now limited to minimum of 8 characters and the other properties no longer allow negative values ({WEBAPP_ADMIN_COMMIT_BASE}192bc08[`192bc08`], {LOCALE_COMMIT_BASE}e0f912b[`e0f912b`], {SERVER_COMMIT_BASE}9b424a6[`9b424a6`]).
* Fixed improper calendar {APP_NAME_COMPOSE} page block responsiveness which caused it to appear cropped when it was added.
The bug was fixed by manually tweaking the calendar's elements for layout changes ({WEBAPP_COMPOSE_COMMIT_BASE}cf66f22[`cf66f22`]).
* Fixed {APP_NAME_COMPOSE} charts not showing any data when the `${record}` or `${recordID}` pre-filter variables were used.
The issue was caused because records were incorrectly resolved and not available in time ({WEBAPP_COMPOSE_COMMIT_BASE}ec33de1[`ec33de1`]).
* Fixed `Record` field's options when using a nested `Record` field where data is duplicated.
The fix now correctly resolves duplicated records and correctly displays option labels ({WEBAPP_COMPOSE_COMMIT_BASE}b954f59[`b954f59`]).
* Fixed record list's display where only one column is shown.
The issue was resolved by adjusting the columns for the "metadata" (the checkbox and the action buttons) ({WEBAPP_COMPOSE_COMMIT_BASE}2671c5d[`2671c5d`])
* Fixed record page preview when accessing without a record.
The page no longer infinitely loads and generally prevents access if there is no record ({WEBAPP_COMPOSE_COMMIT_BASE}21c4f04[`21c4f04`], {WEBAPP_COMPOSE_COMMIT_BASE}924934e[`924934e`]).
* Fixed a visual bug with multi-value `Record` fields where the last selected record would be shown as the placeholder even if removed from the list of selected records.
The fix now opts out of using the last selected record as the placeholder but falls back to a generic label ({WEBAPP_COMPOSE_COMMIT_BASE}491bc19[`491bc19`]).
* Fixed a display error for report tables when a joined data source provided no data.
The table column now properly handles this edge-cases and constructs the table appropriately ({WEBAPP_REPORTER_COMMIT_BASE}953556a[`953556a`])
* Fixed an error when trying to mark a role as contextual.
The error was caused by an invalid internal state and is now resolved ({WEBAPP_ADMIN_COMMIT_BASE}b14e4e7[`b14e4e7`])
* Fixed failing index creation for {PRODUCT_NAME} {APP_NAME_DISCOVERY} caused by an unsupported data type.
The fix changes the used data type for the cases which caused the index to fail.
The error was caused by identifier indexes such as module ID, namespace ID, and record ID ({SERVER_COMMIT_BASE}25ebf75[`25ebf75`])
* Fixed invalid time produced by the `Date Time` field when time, past/future, and relative output options were selected.
The date-time logic now properly handles this option combination and properly handles the value ({WEBAPP_JS_COMMIT_BASE}a4bbbab[`a4bbbab`]).
* Fix improper resource translations for {APP_NAME_COMPOSE} charts when looking up specific charts ({SERVER_COMMIT_BASE}b8ad97e[`b8ad97e`]), module fields when looking up specific modules ({SERVER_COMMIT_BASE}5ccd682[`5ccd682`])
* Fixed improper record list and chart pre-filter evaluation which caused a pre-filter with `${recordID}` to display no data when creating new records ({WEBAPP_COMPOSE_COMMIT_BASE}6da48a0[`6da48a0`])
* Fixed invalid counter when exporting records from a record list ({WEBAPP_COMPOSE_COMMIT_BASE}d837e9e[`d837e9e`]).

.[#2022_3_4-development]#<<2022_3_4-development,Development:>>#
* Added SonarQube GitHub build action to {PRODUCT_NAME} server ({SERVER_COMMIT_BASE}5999c70[`5999c70`]).


# src/modules/ROOT/pages/changelog/202203/06.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.3.6`

*Released on*: `2022.11.08`

.[#2022_03_06-changed]#<<2022_03_06-changed,Changed:>>#
* Changed password constraints which saved their values as strings to save them as numbers.
Additionally, the labels of the two fields were reworded to match the style of the other inputs in the password constraints section.
The change was made because the password constraints were saved as strings; with this change, the constraints will be saved as numbers.
The change was made 'number' was appended to the password constraint's input model
({LOCALE_COMMIT_BASE}1b8e02c[`1b8e02c`], {LOCALE_COMMIT_BASE}1d8eb4b[`1d8eb4b`], {WEBAPP_ADMIN_COMMIT_BASE}9fd49e1[`9fd49e1`], {WEBAPP_ADMIN_COMMIT_BASE}53d8619[`53d8619`], {SERVER_COMMIT_BASE}651993b[`651993b`], {SERVER_COMMIT_BASE}4c4f1df[`4c4f1df`]).

.[#2022_03_06-fixed]#<<2022_03_06-fixed,Fixed:>>#
* Fixed geometry values not being saved when changed manually in inputs.
The fix was made by correctly detecting changes on the geometry value since it uses a more complex structure then the rest of the inputs
({WEBAPP_COMPOSE_COMMIT_BASE}1c220ec[`1c220ec`]).
* Fixed record export filter not interpolating placeholders such as `${userID}` which lead to non functional exports.
The fix was made by adding evaluation to the record export filter to correctly evaluate and interpolate placeholders
({WEBAPP_COMPOSE_COMMIT_BASE}ee123ea[`ee123ea`]).
* Fixed file uploads being rejected when specifying what MIME types are allowed or not.
The issue occurred due to additional meta tags provided by the files or the underlying libraries.
The fix was made by reworking how MIME types are validated by switching from comparing MIME type labels to a more robust library which was already used for detecting MIME types
({SERVER_COMMIT_BASE}84e2ff1[`84e2ff1`]).
* Fixed corredor server was crashing on startup due to nil pointer error.
The fix was made by adding nil check for Vars methods so it does not cause any unexpected error, if nil value is used
({SERVER_COMMIT_BASE}9ad5b36[`9ad5b36`]).
* Fixed getting stuck on sign up page on error.
The fix was made by redirecting back to sign up page with respective error message
({SERVER_COMMIT_BASE}be1e035[`be1e035`]).
* Fixed automation button resource translations not preserving between page refreshes.
The issue was caused due to improper indexing as well as missing code to apply resource translations to record list selection buttons.
The fix was made correcting resource translation indexing to start with `0` instead of `1` as well as adding missing code to correctly apply resource translations to record list selection buttons
({WEBAPP_COMPOSE_COMMIT_BASE}34827c5[`34827c5`], {SERVER_COMMIT_BASE}04eb3cd[`04eb3cd`]).


# src/modules/ROOT/pages/changelog/202203/index.adoc

include::ROOT:partial$variables.adoc[]

[#2022-3-x]
= `2022.3`

With {PRODUCT_NAME} `2022.3`, we continue to improve system stability, security, performance, as well as introducing new setup and development quality-of-life improvements.
In addition we introduce the new {PRODUCT_NAME} {APP_NAME_DISCOVERY} and Integration gateway profiler.

xref:2022.3@integrator-guide:discovery/index.adoc[*{PRODUCT_NAME} {APP_NAME_DISCOVERY}*]

xref:2022.3@integrator-guide:discovery/index.adoc[] provides a powerful search engine to interact with your data with an intuitive user interface to search and, for some cases, visualize the data such as geographical metadata.

[IMPORTANT]
====
In order to enable {PRODUCT_NAME} {APP_NAME_DISCOVERY} you will need to configure your instance.
Refer to the xref:2022.3@devops-guide:discovery/index.adoc[setup documentation] for instructions
====

*{PRODUCT_NAME} configuration UX improvements*

To make {PRODUCT_NAME} {APP_NAME_COMPOSE} app configuration process simpler, we introduce a few quality of life tweaks such as workflow step configuration preview tooltips, additional workflow help tooltips and labels, workflow step label suggestions, and delete strategy for pages with sub-pages.

In addition, we introduce the integration gateway xref:2022.3@integrator-guide:api-gw/profiler.adoc[route profiler] to help you benchmark the system and help with automation troubleshooting and optimization.

*{PRODUCT_NAME} deployment UX improvements*

To simplify initial {PRODUCT_NAME} deployment troubleshooting steps, we introduce xref:2022.3@devops-guide:troubleshooting/web-console.adoc[].
The web console allows you to quickly access system logs, health checks, and other parameters you may need to debug a faulty instance.

[TIP]
====
The web console is most useful for scenarios where you may not have (or want to give) direct access to your servers.
====

:leveloffset: +1

include::06.gen.adoc[]

include::05.adoc[]

include::04.adoc[]

include::03.adoc[]

include::02.adoc[]

include::01.adoc[]

include::00.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/202209/01.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.1`

*Released on*: `2022-10-13`

.[#2022_3_1-added]#<<2022_3_1-added,Added:>>#
* Added support for DAL aggregation on the RDBMS level to improve performance on larder datasets by utilizing existing technology ({SERVER_COMMIT_BASE}1215511e2[`1215511e2`]).

.[#2022_3_1-changed]#<<2022_3_1-changed,Changed:>>#
* Changed privacy request comment loading indicator by introducing a spinner ({WEBAPP_PRIVACY_COMMIT_BASE}46da70e[`46da70e`]).
* Changed {APP_AUTOMATION} server to use a newer Pino version to the same version as elsewhere to avoid interface collisions ({SERVER_CORREDOR_COMMIT_BASE}8893f33[`8893f33`]).
* Changed {APP_AUTOMATION} server to no longer start if the provided configuration is invalid.
The {APP_AUTOMATION} server now checks for validity and errors out if invalid ({SERVER_CORREDOR_COMMIT_BASE}8893f33[`8893f33`]).
* Changed JSON handling within the {PRODUCT_NAME}'s DAL package.
We made the change to improve performance when processing a lot of JSON objects by switching to the valyala/fastjson package ({SERVER_COMMIT_BASE}ce6d7d02e[`ce6d7d02e`]).
* Changed multi-value geometry field editor and viewer ({WEBAPP_COMPOSE_COMMIT_BASE}32703e4[`32703e4`], {WEBAPP_JS_COMMIT_BASE}46378d8[`46378d8`]).
* Changed the API docs to be up to date and include automation endpoints ({SERVER_COMMIT_BASE}b03a09812[`b03a09812`]).

.[#2021_3_1-removed]#<<2021_3_1-removed,Removed:>>#
* Removed the color scheme dependency because it was unneeded and it was causing build errors ({WEBAPP_VUE_COMMIT_BASE}a76323e[`a76323e`], {WEBAPP_ONE_COMMIT_BASE}e10a353[`e10a353`], {WEBAPP_DISCOVERY_COMMIT_BASE}e86cf2e[`e86cf2e`], {WEBAPP_PRIVACY_COMMIT_BASE}bfc910a[`bfc910a`], {WEBAPP_WORKFLOW_COMMIT_BASE}1e8842d[`1e8842d`], {WEBAPP_ADMIN_COMMIT_BASE}42bef4a[`42bef4a`]).

.[#2022_3_1-fixed]#<<2022_3_1-fixed,Fixed:>>#
* Fixed memory leaks caused by DAL when running reports.
The reporting logic didn't close the open data sources ({SERVER_COMMIT_BASE}5d476dcfa[`5d476dcfa`]).
* Fixed invalid resource retrieval, which led to missing logos and fav icons on instances where the server and webapp are split.
We resolved the issue by properly determining the URL for this scenario ({WEBAPP_VUE_COMMIT_BASE}1079236[`1079236`]).
* Fixed UI/UX issues in regards to the report builder's tooltip and button sizes ({WEBAPP_REPORTER_COMMIT_BASE}bcf2b36[`bcf2b36`]), properly displaying page block headers and footers on plain page blocks ({WEBAPP_COMPOSE_COMMIT_BASE}7e8fb2f[`7e8fb2f`]).
* Fixed duplicated result argument display on workflow function configuration.
The issue occurred due to improper rendering condition ({WEBAPP_WORKFLOW_COMMIT_BASE}945f287[`945f287`]).
* Fixed expression values not being visible in the configuration sidebar when configuring workflows.
* Fixed expression values not showing in the sidebar ({WEBAPP_WORKFLOW_COMMIT_BASE}2bae1bd[`2bae1bd`]).
* Fixed failing namespace export when using namespace with characters such as `/` and `.`.
The names are encoded before being sent over to avoid these issues ({WEBAPP_COMPOSE_COMMIT_BASE}1d2fe47[`1d2fe47`]).
* Fixed record edit/clone button not appearing on all records if no record page is present ({WEBAPP_COMPOSE_COMMIT_BASE}71af271[`71af271`]).
* Fixed using `${ownerID}` in filters, now properly uses the `ownedBy` value instead of the currently logged in user (like userID for its value does) ({WEBAPP_COMPOSE_COMMIT_BASE}93f7ebc[`93f7ebc`]).
* Fixed the process of undeleting auth clients ({WEBAPP_ADMIN_COMMIT_BASE}e69b0ef[`e69b0ef`], {LOCALE_COMMIT_BASE}9ccdcae[`9ccdcae`], {WEBAPP_ADMIN_COMMIT_BASE}38626bd[`38626bd`]).
* Fixed record export when the record count was 0 by preventing the export ({WEBAPP_COMPOSE_COMMIT_BASE}2d7a1f6[`2d7a1f6`]).
* Fixed performance issues on integration gateway route reloading caused by re-registering all of the endpoints when one was updated ({SERVER_COMMIT_BASE}269cdb1ba[`269cdb1ba`], {SERVER_COMMIT_BASE}955c4d9b9[`955c4d9b9`]).
* Fixed data corruption which was caused by an improper {APP_NAME_COMPOSE} record value migration ({SERVER_COMMIT_BASE}7e4e4d3b5[`7e4e4d3b5`]).
* Fixed exporting records to a specific timezone by encoding the URI params ({WEBAPP_COMPOSE_COMMIT_BASE}362ddca[`362ddca`]).
* Fix workflow function errors caused by fetching an array of resources.
The error was caused by a change in how expression types are determined and is temporarily patched with an _edge-case_ exception ({SERVER_COMMIT_BASE}b581fe86a[`b581fe86a`]).
* Improved error reporting on new user sign-up ({SERVER_COMMIT_BASE}57721291b[`57721291b`]).

.[#2022_3_1-security]#<<2022_3_1-security,Security:>>#
* Prevented stored XSS attacks in the logout back link by implying additional sanitation steps to the value ({SERVER_COMMIT_BASE}f1f4f4bd1[`f1f4f4bd1`]).


# src/modules/ROOT/pages/changelog/202209/02.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.2`

*Released on*: `2022.11.08`

[IMPORTANT]
====
.[#2022_09_02-important]#<<2022_09_02-important,Important upgrade notes:>>#
* There is a known bug where multi-value fields crash the server or produce unexpected results in reports.
If your configuration uses reports which utilize multi-value fields, skip this patch version..
====

.[#2022_09_02-changed]#<<2022_09_02-changed,Changed:>>#
* Changed the workflow step configuration results section when no results are present for execute workflow, function, prompt, and iterator steps.
The change was made because the results section was present even if no results were listed for the specified workflow steps
The change was made by hiding the results section if no results are present
({WEBAPP_WORKFLOW_COMMIT_BASE}2b4619a[`2b4619a`]).
* Changed the uninformative RBAC rule import error messages reported by the provisioning system.
The error was uninformative because RBAC rules, in this context, don't use identifiers.
The change was made because the error in question was uninformative and looked like this: `failed to complete transaction: store encoder encode rbac-rule []: unsupported resource type '' for RBAC store encode`.
The change was made by allowing custom error reporting logic for specific resources such as RBAC rules
({SERVER_COMMIT_BASE}e2ac9c4[`e2ac9c4`]).
* Changed password constraints which saved their values as strings to save them as numbers.
Additionally, the labels of the two fields were reworded to match the style of the other inputs in the password constraints section.
The change was made because the password constraints were saved as strings; with this change, the constraints will be saved as numbers
({WEBAPP_ADMIN_COMMIT_BASE}aad919f[`aad919f`], {LOCALE_COMMIT_BASE}703516c[`703516c`], {WEBAPP_ADMIN_COMMIT_BASE}a248000[`a248000`]).
* Changed the documentation about sanitizers and fixed the example links in module field validation tab to now point to the correct anchors.
The change was made because the documentation was lacking information about field value sanitization.
The change was made by updating the documentation with a new important section describing this behavior and changing the documentation links in the module field configuration to point to validators/sanitizers
({WEBAPP_COMPOSE_COMMIT_BASE}9af28f2[`9af28f2`]).
* Changed record pages to reflect the operation (creating, editing, viewing) in the title of the public page.
The change was made because the previous titles didn't match the consistency of the other page titles.
When you were editing a record instead of saying `Editing a record page` the title was saying `Viewing record page`, which was wrong.
The change was made by changing the translation message of a record in the create, view and edit components
({WEBAPP_COMPOSE_COMMIT_BASE}b3ded1b[`b3ded1b`], {LOCALE_COMMIT_BASE}f7a520f[`f7a520f`]).

.[#2022_09_02-fixed]#<<2022_09_02-fixed,Fixed:>>#
* Fixed incorrect user count from the system metrics report due to system-defined users.
The fix was made by excluding system users from the metric report
We didn't exclude them from the total, but they were excluded from the per-day aggregation
({SERVER_COMMIT_BASE}fd6465d[`fd6465d`]).
* Fixed the timestamp in the details of an action log being different as the one in search results.
The fix was made by applying a custom formatting to the timestamp
({WEBAPP_ADMIN_COMMIT_BASE}a4596fb[`a4596fb`]).
* Fixed strict record value duplicate detection, which was preventing record creation with same values for fields for strict duplicate detection validation.
The fix was made by validating duplication only for selected field
({SERVER_COMMIT_BASE}eac2f07[`eac2f07`]).
* Fixed sub workflows being unavailable in the workflow execution step after the server was restarted.
The issue was caused by the initialization logic excluding sub-workflows from the filter.
The fix was made by including the sub-workflows in the initial load, thus resolving the issue
({SERVER_COMMIT_BASE}d64b732[`d64b732`]).
* Fixed action log search results not showing the correct outputs.
The fix was made by fixing the lapsus where the `from` timestamp was used for both the from and to date range which resulted in no matches
({SERVER_COMMIT_BASE}1fa5f39[`1fa5f39`], {WEBAPP_ADMIN_COMMIT_BASE}c63df82[`c63df82`]).
* Fixed {APP_NAME_COMPOSE} namespace export where the name contained characters like `/`, `.` broke the export because they broke the URL.
The same issue was addressed for record export but with module name.
The fix was made by URI encoding the filename and replacing dots with `-` as that caused the URL to be broken
({WEBAPP_COMPOSE_COMMIT_BASE}1f0ea56[`1f0ea56`], {WEBAPP_COMPOSE_COMMIT_BASE}920cc5a[`920cc5a`]).
* Fixed JSON codecs ident getting set to the field's name instead of `values`, when editing a module/configuring field mapping.
The JSON codec requires you to specify where the JSON object is located, not the name of the value.
Since values are stored in values, the value has to be `values` (where the JSON is).
The bug told {PRODUCT_NAME} to look for the column with the field name which probably never existed.
The fix was made By correctly defaulting the values
({WEBAPP_COMPOSE_COMMIT_BASE}580db32[`580db32`]).
* Fixed DAL connection configuration displaying the default DSN connection parameters instead of the configured one.
The fix was made by properly merging the default values and user-provided configurations, as well as fixing edge-cases where the configuration was made available after the page had loaded
In the later case, the user-provided configuration was never displayed instead of the default values
({WEBAPP_ADMIN_COMMIT_BASE}0b41074[`0b41074`], {JS_COMMIT_BASE}f9f7e92[`f9f7e92`]).
* Fixed using `workflowID` parameter in workflowList not working because the returning value was getting corrupted in JavaScript due to unsupported `uint64`.
The fix was made by replacing `[]uint64` with `[]string` for `filterworkflowID` that corrupted the input value for JavaScript (`uint64` vs `int64`)
In addition, the filtering was moved to the store level
({SERVER_COMMIT_BASE}ca7d4b0[`ca7d4b0`]).
* Fixed DAL code ignoring module ID when doing record lookup.
If you wanted to select a record you were receiving the error message: `Could not create record: check error messages on the form`, and on the form it was saying: `record not found`
This fix ensures proper module ID is used (one from the module field options)when doing lookup.
The fix was made By using module-id from module field options and not field's module ID
({SERVER_COMMIT_BASE}a8d2fef[`a8d2fef`]).
* Fixed broken filter and codegen definition for workflow filters which resulted in generating broken filter functionality.
Filtering subworkflows with subWorkflow `2 flag` in workflowList was not returning any subworkflows.
The fix was made by properly applying conditions when sub-workflow filter was used
({SERVER_COMMIT_BASE}5b2ba54[`5b2ba54`]).
* Fixed missing dal connection translation by converting its error meta key reference to kebab-case.
The fix was made by adding missing credentials translations to the locale under system/credentials
({SERVER_PULL_BASE}434[`434`], {LOCALE_COMMIT_BASE}9021d1b[`9021d1b`], {LOCALE_COMMIT_BASE}baff7b7[`baff7b7`]).
* Fixed broken translation due to incompatible fileName case in locale.
The fix was made by renaming the file name for resources as per expected format (kebab-case)
({LOCALE_COMMIT_BASE}b2ad8c2[`b2ad8c2`]).
* Fixed record search endpoints needlessly degrading performance by computing totals and paging cursors even when not required.
The performance hit was noticeable on larger datasets.
The fix was made by short-circuiting processing sooner when totals and page cursor navigation was not required
This doesn't change external behavior as those parameters were not included even tho they were computed
({SERVER_COMMIT_BASE}24b5d7c[`24b5d7c`]).
* Fixed data aggregation `count` function crashing the server when no arguments were provided (`count()`).
The old version allowed this format while the new one did not and it crashed the server.
The fix was made by adjusting validations and adding additional exceptions for this specific case
({SERVER_COMMIT_BASE}fd3552e[`fd3552e`]).
* Fixed action log search results did not change if you reset the filter parameters.
The filter parameters are reflected in the URL.
The fix was made by properly updating the search parameters in the URL
({WEBAPP_ADMIN_COMMIT_BASE}ca14671[`ca14671`]).
* Fixed geometry values not being saved when changed manually in inputs.
The fix was made by correctly detecting changes on the geometry value since it uses a more complex structure then the rest of the inputs
({WEBAPP_COMPOSE_COMMIT_BASE}893e644[`893e644`]).
* Fixed record export filter not interpolating placeholders such as `${userID}` which lead to non functional exports.
The fix was made by adding evaluation to the record export filter to correctly evaluate and interpolate placeholders
({WEBAPP_COMPOSE_COMMIT_BASE}9e9898b[`9e9898b`]).
* Fixed privacy web apps not being enabled in the default {PRODUCT_NAME} configuration.
The fix was made by adding the privacy web applications to the `HTTP_WEBAPP_LIST` `env` variable
({SERVER_COMMIT_BASE}c8508f4[`c8508f4`]).
* Fixed Data Privacy Officer role unable to see or review requests in the privacy web application due to invalid permission configuration.
The fix was made by updating provision YAML files with search and read on `corteza::compose`, `corteza::compose:namespace`, `corteza::compose:module` and `corteza::system` resources
Additionally, Data privacy officer permissions were changed to be able to view and edit a privacy request
({SERVER_COMMIT_BASE}1d390f9[`1d390f9`], {SERVER_COMMIT_BASE}69f33fa[`69f33fa`], {WEBAPP_PRIVACY_COMMIT_BASE}2b35b98[`2b35b98`], {SERVER_COMMIT_BASE}a5e192f[`a5e192f`], {SERVER_COMMIT_BASE}18a687a[`18a687a`]).
* Fixed missing translations for gateway, auth, dal sensitivity, and data privacy.
The fix was made by adding the missing translations to corteza-locale
({LOCALE_COMMIT_BASE}bb29fe2[`bb29fe2`], {WEBAPP_COMPOSE_COMMIT_BASE}56046e9[`56046e9`], {WEBAPP_PRIVACY_COMMIT_BASE}e64befa[`e64befa`]).
* Fixed errors on reports not being captured.
The fix was made by properly capturing and displaying errors
({SERVER_COMMIT_BASE}8926c04[`8926c04`]).
* Fixed required module field flag is not reflected on the corresponding model attribute on the *nullable* flag.
The fix was made by explicitly setting the nullable flag on all attributes when generating models where fields set the *required* flag
({SERVER_COMMIT_BASE}eb89992[`eb89992`]).
* Fixed incorrect type encoding for {APP_NAME_COMPOSE} charts where numbers were represented as strings and references (IDs) as numbers instead of strings.
The fix was made by adding a hotfix to assure that these exceptions are properly encoded and presented to {APP_NAME_COMPOSE} charts
The initial issue is on the database level but the exact solution is still up for debate and will be addressed later
({SERVER_COMMIT_BASE}55702ec[`55702ec`]).
* Fixed `Email`, `File`, `Number`, `String`, and `URL` fields not showing validation errors.
The error under the field now also indicates the duplicated value.
You still need the field on the record itself in order to see the validation error.
The fix was made by adding the missing errors component to field viewers that didn't have it (that is shown for expression fields on record edit)
({WEBAPP_COMPOSE_COMMIT_BASE}1cf316c[`1cf316c`], {LOCALE_COMMIT_BASE}6bebd21[`6bebd21`]).
* Fixed the suspended and revoke access buttons being shown even when creating a new user.
The fix was made by only showing those buttons when editing a user
({WEBAPP_ADMIN_COMMIT_BASE}2c35552[`2c35552`]).
* Fixed users unable to press the submit button when trying to edit a user and the submit button remaining enabled even if an invalid (or missing) email was provided.
The fix was made by properly applying the permissions obtained from the API user object in the webapp User class and correctly updating the form's state based on the email validation
({JS_COMMIT_BASE}d585399[`d585399`], {WEBAPP_ADMIN_COMMIT_BASE}99775e1[`99775e1`]).
* Fixed external auth providers not being re-fetched after updating user password.
The fix was made by refetching the external auth providers after updating
({WEBAPP_ADMIN_COMMIT_BASE}07de6a6[`07de6a6`]).
* Fixed gauge chart step name not displaying when value was larger than the largest step.
The fix was made by setting the default step name to the largest, since if we find another step where the value currently is, we will use that one instead
({JS_COMMIT_BASE}808e438[`808e438`]).
* Fixed extra whitespace disappearing when using a rich text editor for the String field.
The fix was made by tweaking the configuration for the viewer (adding `'white-space': 'pre-wrap'`) and the editor (adding `preserveWhitespace: 'full'` to CRichTextInput parse options)
({VUE_COMMIT_BASE}854e6c8[`854e6c8`], {WEBAPP_COMPOSE_COMMIT_BASE}db1ace1[`db1ace1`]).
* Fixed being able to submit a federation node form even if URL and name were not defined.
The fix was made by correctly validating the form and disabling the buttons as needed
({WEBAPP_ADMIN_COMMIT_BASE}0f5170d[`0f5170d`], {WEBAPP_ADMIN_COMMIT_BASE}b8a49fd[`b8a49fd`]).
* Fixed ownership information not being displayed on the connection.
The fix was made by using the correct value for the field ownership (by switching the value from `connectionownership` to `connectionmetaownership`)
({JS_COMMIT_BASE}d585399[`d585399`], {WEBAPP_ADMIN_COMMIT_BASE}6e2e2b2[`6e2e2b2`]).
* Fixed unable to save auth clients when setting either the valid from or expires at.
The fix was made correctly parsing date-time values we get from the API
({WEBAPP_ADMIN_COMMIT_BASE}04c8c4e[`04c8c4e`]).
* Fixed incorrectly displayed error message when un-deleting messaging queue; it was displaying the error message `Queue deleted` instead of `Queue restored`.
The fix was made Translations were added in locale and applied in admin
({WEBAPP_ADMIN_COMMIT_BASE}7af6c9e[`7af6c9e`], {LOCALE_COMMIT_BASE}e00a3da[`e00a3da`]).
* Fixed deleted messaging queues being un-deleted if they were edited.
The fix was made by correctly preserving the deleted state when updating the messaging queue
({SERVER_COMMIT_BASE}90b5414[`90b5414`]).
* Fixed incorrectly passed translations to Results/Namespace, Record and User.
The fix was made by correctly passing translations via props and interpolation
Previously, part of the translations were passed without using interpolation and the other translations were passed as attributes causing the texts to not be properly translated
({WEBAPP_DISCOVERY_COMMIT_BASE}bed2dfa[`bed2dfa`]).
* Fixed the {PRODUCT_NAME} crashing when adding additional DAL connections.
The issue was caused by improperly handled initial and empty states for the DAL connection resource.
The fix was made adding exceptions to reject default configuration options (no connection params) and properly handling the default state on the web application's connection editor
({WEBAPP_ADMIN_COMMIT_BASE}55636d9[`55636d9`], {SERVER_COMMIT_BASE}f5297d3[`f5297d3`]).
* Fixed file uploads being rejected when specifying what MIME types are allowed or not.
The issue occurred due to additional meta tags provided by the files or the underlying libraries.
The fix was made by reworking how MIME types are validated by switching from comparing MIME type labels to a more robust library which was already used for detecting MIME types
({SERVER_COMMIT_BASE}ab987cc[`ab987cc`]).
* Fixed disappearing white spaces when using a rich text editor in the String field.
The fix was made by adding 'white-space': 'pre-wrap' to String viewer and preserveWhitespace: 'full' to CRichTextInput parse options
({WEBAPP_COMPOSE_COMMIT_BASE}a89208f[`a89208f`], {VUE_COMMIT_BASE}854e6c8[`854e6c8`]).
* Fixed automation button resource translations not preserving between page refreshes.
The issue was caused due to improper indexing as well as missing code to apply resource translations to record list selection buttons.
The fix was made correcting resource translation indexing to start with `0` instead of `1` as well as adding missing code to correctly apply resource translations to record list selection buttons
({WEBAPP_COMPOSE_COMMIT_BASE}7a5e839[`7a5e839`], {SERVER_COMMIT_BASE}6d58bf4[`6d58bf4`]).
* Fixed record page navigation and sorting issue.
The fix was made by improving record iterator implementation for page navigation and sorting and also fixing store drivers to be consistent respective to their query language for dateTime, number, boolean data types
({SERVER_COMMIT_BASE}6f04666[`6f04666`]).
* Fixed simple equality operator `=` in the filter query that checks for all values in multi-value fields but only the first one due to the changed encoding of record values.
The fix was made by introducing new operators `IN` and `NOT IN` and should be used when filtering records containing value inside multi value field
({SERVER_COMMIT_BASE}f6e3035[`f6e3035`]).


# src/modules/ROOT/pages/changelog/202209/03.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.3`

*Released on*: `2022.11.25`

.[#2022_09_03-added]#<<2022_09_03-added,Added:>>#
* Added a new label position option for charts with y-axis.
It enables you to position the label at the bottom, middle or top of the y-axis.
The change was added because the y-axis label was overlapping with the values if they were bigger
({CORTEZA_COMMIT_BASE}18248a2[`18248a2`]).
* Added new multi value filter operators (`IN` and `NOT IN`) to the pre-filter in the reporter UI.
This why users have the ability to filter records using multi value fields.
The change was added to bring back the support to filter records using their multi value fields inside reports
({CORTEZA_PULL_BASE}560[`560`]).
* Added additional configuration for pie, bar, line, and doughnut charts.
Three new sections were added - tooltip, legend and offset as well as the options to rotate x and y axis labels (only for bar and line charts).
The change was added to give the users more freedom to customize charts
({CORTEZA_COMMIT_BASE}a8d3b83[`a8d3b83`], {CORTEZA_COMMIT_BASE}b2c9de5[`b2c9de5`]).
* Added support to set the minimum value and default value (value, min, and max) for progress bar module fields and page blocks.
The change was added to provide the user with more customization and easier use of the progress bar in {PRODUCT_NAME}
({CORTEZA_COMMIT_BASE}f367836[`f367836`]).

.[#2022_09_03-changed]#<<2022_09_03-changed,Changed:>>#
* Changed the resource list now uses the same component, item count and pagination and it is also enabled for resource lists that support it.
Now almost on every resource we show the total item count and we have the ability to go to the next page if there are items.
The change was made because the look and feel of lists across {PRODUCT_NAME} needed to be unified.
Also for better user experience and to always know the correct number of how many records/items we have.
The change was made by updating and using the reusable CResourceList component in corteza-vue
That means we can control the look of all lists from one place
({VUE_COMMIT_BASE}030109b[`030109b`], {WEBAPP_ADMIN_COMMIT_BASE}229bf12[`229bf12`], {WEBAPP_COMPOSE_COMMIT_BASE}c67daa7[`c67daa7`], {WEBAPP_REPORTER_COMMIT_BASE}06c07d8[`06c07d8`], {WEBAPP_WORKFLOW_COMMIT_BASE}6033433[`6033433`]).
* Changed the requirement to provide a handle when creating a resource is removed and handles are now optional.
The change is applied in compose, admin, reporter, and workflow.
The change was made because providing a handle shouldn't be a necessity and resources should have the option to omit it.
The change was made by removing the strict handle existence validation
({WEBAPP_COMPOSE_COMMIT_BASE}cd86e85[`cd86e85`], {WEBAPP_REPORTER_COMMIT_BASE}cf21c47[`cf21c47`], {WEBAPP_ADMIN_COMMIT_BASE}456c896[`456c896`], {WEBAPP_WORKFLOW_COMMIT_BASE}9b88af0[`9b88af0`], {LOCALE_COMMIT_BASE}24b0dda[`24b0dda`], {VUE_COMMIT_BASE}34f261a[`34f261a`], {JS_COMMIT_BASE}3a90a10[`3a90a10`]).
* Changed the color of the button for confirming the action to accept a privacy request.
The change was made to match the colors with the ones when confirming/denying the action to reject a privacy request.
The change was made by changing the color to dark blue
({CORTEZA_COMMIT_BASE}d4ed9ff[`d4ed9ff`]).

.[#2022_09_03-fixed]#<<2022_09_03-fixed,Fixed:>>#
* Fixed the avatar not being clickable on the auth screens on mobile devices due to the login form overlapping the top bar.
The fix was made by adjusting the styling of the auth screens and the {PRODUCT_NAME} top bar
({CORTEZA_PULL_BASE}541[`541`], {CORTEZA_PULL_BASE}541[`541`], {CORTEZA_PULL_BASE}541[`541`]).


# src/modules/ROOT/pages/changelog/202209/04.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.4`

*Released on*: `2022.12.08`

.[#2022_09_04-added]#<<2022_09_04-added,Added:>>#
* Added support for coalesce sorting on all supported store driver.
The change was added to allow sorting of first non-NULL value among given columns into one column
({CORTEZA_PULL_BASE}547[`547`]).
* Added test SMTP server button for the admin email settings.
The change was added to let administrators test SMTP configuration validity before deploying changes
({CORTEZA_PULL_BASE}539[`539`]).
* Added nylas integration which allows you to easily connect {PRODUCT_NAME} with email, calendar, and contacts provider.
A new page block on compose called Nylas was added, that can display Nylas components defined in the Nylas dashboard.
The Nylas external provider was also added to the list in the Admin panel under System settings.
The change was added to enable the integration with Nylas and support the use of its components inside {APP_NAME_COMPOSE}
({CORTEZA_PULL_BASE}539[`539`]).

.[#2022_09_04-changed]#<<2022_09_04-changed,Changed:>>#
* Changed the labels being displayed in metric page block instead of names.
The change was made because we were incorrectly displaying the field names instead of its labels.
The change was made by changing the metric page block fields to show labels instead of names
({CORTEZA_PULL_BASE}586[`586`]).

.[#2022_09_04-fixed]#<<2022_09_04-fixed,Fixed:>>#
* Fixed the namespace, module, page, workflow, and reporter lists to properly sort the last change column.
Previously the sorting was done on the updatedAt value and the value was shown as updatedAt or createdAt if the resource wasn't updated yet.
The fix was made by using the coalesce (`deletedAt`, `updatedAt`, `createdAt`) to sort based on all three columns, so that the value displayed matches the value that is being used to sort
({CORTEZA_PULL_BASE}547[`547`]).
* Fixed invalid data ordering on {APP_NAME_COMPOSE} charts caused by improperly ordered data on the record report endpoint.
The fix was made by adding an explicit sorting by the specified dimension field
({CORTEZA_COMMIT_BASE}956e30e[`956e30e`]).
* Fixed users not being able to go to the previous page on reporter tables.
The fix was made by updating the page cursor only if it exists while creating a report paging filter to preserve the valid cursor for the next page
({CORTEZA_PULL_BASE}588[`588`]).
* Fixed not being able to close the workflow modal once you press `New Workflow`.
The fix was made by adding a back button that simulates the back button behavior of the browser
({CORTEZA_PULL_BASE}585[`585`]).
* Fixed reporter chart display element configuration not being properly saved on creation if the chart type was changed.
The fix was made by properly updating the chart display element options when the chart type is changed
({CORTEZA_COMMIT_BASE}074b2fd[`074b2fd`]).

# src/modules/ROOT/pages/changelog/202209/05.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.5`

*Released on*: `2022.12.22`

.[#2022_09_05-added]#<<2022_09_05-added,Added:>>#
* Added missing configuration options that were in compose charts but not in reporter charts, e.g. Legend, Tooltip, Offset, label rotation for X and Y axis.
The change was added to provide the same set of features on both chart configurators
({CORTEZA_COMMIT_BASE}d8fa5be[`d8fa5be`]).
* Added function INSTR that can be used in the compose pre-filters, used like INSTR('foobar', 'foo').
It returns the position of the first occurrence of the second parameter in the first, starting with 1.
Returns 0 if no match was found and the matching is case insensitive.
The change was added to providing more flexibility for the compose pre-filters
({CORTEZA_COMMIT_BASE}36d8fc6[`36d8fc6`]).

.[#2022_09_05-changed]#<<2022_09_05-changed,Changed:>>#
* Changed disabled the field picker drag and drop while searching for a field when configuring module, chart and page fields.
The change was made because reordering of fields while searching was causing issues.
The change was made by adding a computed property that tracks if a query parameter is added and if dragging is disabled
({CORTEZA_COMMIT_BASE}a0a7031[`a0a7031`]).
* Changed the column selectors in reporter (pre-filter, label/primary/secondary column) now all show the label and name of the column, they can also now be searched except for the presort.
The change was made to make it easier to differentiate between the different fields that have the same label, for example after using a Join.
The change was made by replacing the default bootstrap select with the vue-select component
({CORTEZA_COMMIT_BASE}e61cfde[`e61cfde`]).
* Changed greater than and less than filter operators, they are now only available on number and date fields.
Contains and Not contains filter operators are now only available for multi value fields.
The change was made to prevent users from using filter operators that are not supported for specific field types.
The change was made by updating the operators list configuration in the record list filter
({CORTEZA_PULL_BASE}713[`713`], {CORTEZA_PULL_BASE}713[`713`]).

.[#2022_09_05-fixed]#<<2022_09_05-fixed,Fixed:>>#
* Fixed filtering for bool type for equal and not equal operator.
The fix was made by adding custom val handler for bool type to convert it properly while parsing the query according to supported drivers
({CORTEZA_COMMIT_BASE}8e5d63c[`8e5d63c`]).
* Fixed sensitivity level un-delete prompting a not found error due to an invalid HTTP request.
The fix was made by properly handling the different sensitivity level states to call the correct endpoint
({CORTEZA_COMMIT_BASE}7eb26e6[`7eb26e6`]).
* Fixed RBAC rules not applying when assigning them via workflows when providing the role via the Role type.
The workflow didn't raise any errors, but the saved RBAC rule was invalid (the roleID was set to 0 -- invalid).
The fix was made by updating the automation handler code to check all of the supported types and not just the roleID
The handler logic was only using the roleID parameter and omitting the others
({CORTEZA_COMMIT_BASE}6a14808[`6a14808`]).
* Fixed page list not displaying in busy state while pages are being fetched.
The fix was made by adding a spinner with `Loading` text
({CORTEZA_PULL_BASE}671[`671`]).
* Fixed resource list not being updated after a new resource was imported.
The fix was made by adding an updating function that re-fetches the list of resources
({CORTEZA_COMMIT_BASE}f2f9032[`f2f9032`]).
* Fixed the chart overflowing the block if a reporter chart was used inside a compose page block and the block had a title.
The fix was made by using the same layout as on regular compose charts
({CORTEZA_COMMIT_BASE}c09e0f5[`c09e0f5`]).
* Fixed permissions modal title being incorrect if the resource didn't have a title or handle defined.
The fix was made by making sure the resourceID will show in the permissions modal title if no other identifiable information exists
({CORTEZA_COMMIT_BASE}fd76c8f[`fd76c8f`]).

# src/modules/ROOT/pages/changelog/202209/06.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.6`

*Released on*: `2023.01.18`

.[#2022_09_06-changed]#<<2022_09_06-changed,Changed:>>#
* Changed workflow iterators to iterate all entries when the limit is set to 0.
The change was made to make workflow iterators more consistent with other resource searching operations.
The change was made by changing the internal logic to rely on parameter presence rather then value
({CORTEZA_COMMIT_BASE}fc259ca[`fc259ca`]).
* Changed error message when trying to delete a sensitivity level that's in use to be more informative on what is wrong.
The change was made to make error messages more consistent and user friendly.
The change was made by adding additional validation before the sensitivity level is deleted
({CORTEZA_COMMIT_BASE}56e5543[`56e5543`]).
* Changed the requirement to provide a handle when creating a role is now removed and the handle is now optional.
The change was made because providing a handle shouldn't be a necessity and resources can be created without it
({CORTEZA_COMMIT_BASE}fd55cce[`fd55cce`]).

.[#2022_09_06-fixed]#<<2022_09_06-fixed,Fixed:>>#
* Fixed invalid record revision history for multi value fields.
The first value appeared duplicated, the last value was omitted, and when a value was removed the value was no longer visible in the old version.
The fix was made by converting the delta into a table correctly
({CORTEZA_COMMIT_BASE}b203224[`b203224`]).
* Fixed the attachment modal not being visible in the admin area of compose.
The fix was made by moving the attachment modal from Public/Pages/View to Namespace/View
({CORTEZA_COMMIT_BASE}ea1c1fa[`ea1c1fa`]).
* Fixed missing error exception for change password handler.
The fix was made by properly handling and serving the error message
({CORTEZA_COMMIT_BASE}82c70b3[`82c70b3`]).
* Fixed being unable to export an user that had a suspended or deleted role assigned to it.
The fix was made the export logic was resolving unresolved resources on the fly and it was not excluded and this edge case caused the server to panic
({CORTEZA_COMMIT_BASE}1432671[`1432671`]).
* Fixed missing support for filtering, sorting, and paging over federation nodes.
The fix was made by enabling filtering, sorting, and paging for federation nodes
({CORTEZA_COMMIT_BASE}22f49b0[`22f49b0`]).
* Fixed hiding of calendar in calendar block when switching from page builder to view page and vice versa.
When we had couple calendars with records or events configured, the event configured calendars were hidden and no info was displayed.
The fix was made by replacing throttle with async/await in the CalendarBase component
({CORTEZA_COMMIT_BASE}4124f8f[`4124f8f`]).
* Fixed querying record list not showing any result if the record list does not have any fields selected in the block configuration.
The fix was made by making sure a record list with default fields uses those instead of the selected ones to search from
({CORTEZA_COMMIT_BASE}0f03f9c[`0f03f9c`]).
* Fixed filtering for multi-value number field with contains or not contains criteria which was not retuning any values back.
The fix was made by making sure to convert numbers into string format while building a query for the selected filter
({CORTEZA_COMMIT_BASE}7185611[`7185611`]).
* Fixed when record list records per page was set to 0, the pagination information was not displayed properly.
The fix was made by adding a check for this case where the pagination information is generated
({CORTEZA_COMMIT_BASE}045da2e[`045da2e`]).
* Fixed not being able to filter checkbox module fields from the record list filter interface.
The fix was made by adding custom val handler for bool type to convert it properly while parsing the query to MySQL driver
({CORTEZA_COMMIT_BASE}1febba3[`1febba3`]).
* Fixed the import modal not being properly closed once an item was imported.
The fix was made by making sure that the modal is closed as soon as an import is finished
({CORTEZA_PULL_BASE}735[`735`]).


# src/modules/ROOT/pages/changelog/202209/07.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.7`

*Released on*: `2023.02.10`

.[#2022_09_07-added]#<<2022_09_07-added,Added:>>#
* Added support for casting numbers to float inside workflow expressions via the `float` function.
The change was added to simplify type casting by using a function instead of an intermediate workflow expression variable
({CORTEZA_COMMIT_BASE}38b6cb3[`38b6cb3`]).
* Added ability to toggle block border.
The change was added to make better distinction between blocks when they are not shown as a cards
({CORTEZA_PULL_BASE}860[`860`]).
* Added general UI/UX improvements.
The change was added to make some invalid configurations impossible, better overview of some resources and prepare styles and layouts for future releases
({CORTEZA_COMMIT_BASE}80117c0[`80117c0`], {CORTEZA_COMMIT_BASE}ef7e864[`ef7e864`], {CORTEZA_COMMIT_BASE}9acc109[`9acc109`]).

.[#2022_09_07-changed]#<<2022_09_07-changed,Changed:>>#
* Changed making the name property required when creating templates, dal connections, workflows, auth clients, and sensitivity levels.
The change was made because we were able to create a resource without any data entered, and with this change now we have a requirement and you cannot create a resource without data entered.
The change was made by adding validations to prevent creating one of the listed resources without adding a name
({CORTEZA_COMMIT_BASE}38a02d5[`38a02d5`]).
* Changed the usage of chart.js on admin dashboard with e-charts.
The change was made to remove all places where we used to use chart.js since we transitioned to apache e-charts.
The change was made by replacing the chart on admin dashboard with e-charts
({CORTEZA_COMMIT_BASE}7daafa1[`7daafa1`]).

.[#2022_09_07-fixed]#<<2022_09_07-fixed,Fixed:>>#
* Fixed not being able to use a record organizer on a record page.
The fix was made by properly fetching once the record object becomes available and providing the reference record so values can be prefilled
({CORTEZA_COMMIT_BASE}2398499[`2398499`]).
* Fixed PSQL ID column datatype from `BIGINT` to numeric to enable support for {PRODUCT_NAME} ID  uint64 data type.
The fix was made by changing the datatype for {PRODUCT_NAME}ID in the PostgreSQL database from bigint to numeric
({CORTEZA_PULL_BASE}830[`830`]).
* Fixed authenticated role being overwritten on server restart if the role was being modified.
The fix was made by adding a check in the provision logic to skip base roles & RBAC rules if they were already provisioned
({CORTEZA_COMMIT_BASE}88204f7[`88204f7`]).
* Fixed integration gateway filter table not showing all the available data when fetched.
The fix was made by adding a processing flag to integration gateway filter table so it properly triggered the refresh when filters change
({CORTEZA_COMMIT_BASE}cfe7e50[`cfe7e50`]).
* Fixed discovery settings field picker not parsing saved values.
The fix was made by migrating discovery settings to support multi-language, and updated module discovery config struct to support multi lang result
({CORTEZA_COMMIT_BASE}724804c[`724804c`], {CORTEZA_COMMIT_BASE}e020f74[`e020f74`]).
* Fixed record list filter for date not showing any records if you have date only field, and you set the filter to be equal to the correct day.
Also, when configuring time only and past values filer, the configuration was only taking the hour in consideration, because even if the minutes were set in the past it was saying invalid form as long as the hour was not changed too.
Fixed the error `Could not load record list: pq: cannot cast type time with time zone to timestamp with time zone` when having time only value and when you tried to filter with a time filter.
The fix was made by updating the record list filter builder with the correct query entry for time only and date only
({CORTEZA_PULL_BASE}847[`847`]).
* Fixed the record revision date-time type being shown as kind.datetime.label.
The fix was made by updating the type section translation on the record revision configurator to display the fields as camel case, which is the case for the date-time on the translation itself
({CORTEZA_PULL_BASE}863[`863`]).
* Fixed exporting a workflow without a handle resulting in having a name json.json
The fix was made by falling back to workflow name and sanitizing the file name for any illegal characters before saving it
({CORTEZA_COMMIT_BASE}96f8bc5[`96f8bc5`]).


# src/modules/ROOT/pages/changelog/202209/08.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.8`

*Released on*: `2023.03.01`

.[#2022_09_08-added]#<<2022_09_08-added,Added:>>#
* Added configuration option that hides record list filtering.
The change was added to enable configurators to hide filtering on record lists
({CORTEZA_COMMIT_BASE}8ebd25c[`8ebd25c`]).
* Added the link to the reminder record, it was added in the reminder sidebar list/edit.
Enabled the ability to un-dismiss reminders.
Added a date input field to set the date and time of the reminder.
General UI/UX improvements for reminders.
The change was added to make reminders more user friendly and easier to use by having the option to set reminder in more than 24h and to have the option to link a record to a reminder and also to un-dismiss a reminder if needed
({CORTEZA_COMMIT_BASE}abc8ad4[`abc8ad4`], {CORTEZA_PULL_BASE}899[`899`], {CORTEZA_PULL_BASE}899[`899`], {CORTEZA_PULL_BASE}885[`885`], {CORTEZA_PULL_BASE}885[`885`], {CORTEZA_PULL_BASE}885[`885`]).

.[#2022_09_08-fixed]#<<2022_09_08-fixed,Fixed:>>#
* Fixed multi-value date time filtering using contains and not contains
({CORTEZA_PULL_BASE}903[`903`]).
* Fixed select field translations not being shown unless the module is saved.
The fix was made by configuring the initial state to show select field translations even when the module is not saved
({CORTEZA_COMMIT_BASE}1706e52[`1706e52`]).
* Fixed gauge charts not showing correct results when metrics functions were used.
The fix was made by setting the dimension field to deletedBy which produces at most one dataset, since the gauge only shows one value
({CORTEZA_PULL_BASE}883[`883`]).
* Fixed the permissions on system pages showing invalid roles.
If you selected one or more roles, then dropped your database and re-provisioned it, the previous selection was still active (because it's in local storage), but it was showing deny for all.
The fix was made by filtering out the invalid role IDs from the local storage
({CORTEZA_PULL_BASE}886[`886`]).
* Fixed datasources not being saved when pressing the save datasources button in the datasources modal.
The fix was made by applying the save when the save button is pressed on the datasource modal
({CORTEZA_PULL_BASE}889[`889`]).
* Fixed the record list filter not working when field name was having hyphen in the field name.
The fix was made by adding hyphen to allowed list while parsing the query
({CORTEZA_PULL_BASE}897[`897`]).


.[#2022_09_08-important]#<<2022_09_08-important,Known bugs:>>#
* Filtering records using date multi-value fields with a combination of "AND" and "Contains/Not contains" will produce an empty record list.

# src/modules/ROOT/pages/changelog/202209/08.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.8`

*Released on*: `2023.03.01`

.[#2022_09_08-added]#<<2022_09_08-added,Added:>>#
* Added configuration option that hides record list filtering.
The change was added to enable configurators to hide filtering on record lists
({CORTEZA_COMMIT_BASE}8ebd25c[`8ebd25c`]).
* Added the link to the reminder record, it was added in the reminder sidebar list/edit.
Enabled the ability to un-dismiss reminders.
Added a date input field to set the date and time of the reminder.
General UI/UX improvements for reminders.
The change was added to make reminders more user friendly and easier to use by having the option to set reminder in more than 24h and to have the option to link a record to a reminder and also to un-dismiss a reminder if needed
({CORTEZA_COMMIT_BASE}abc8ad4[`abc8ad4`], {CORTEZA_PULL_BASE}899[`899`], {CORTEZA_PULL_BASE}899[`899`], {CORTEZA_PULL_BASE}885[`885`], {CORTEZA_PULL_BASE}885[`885`], {CORTEZA_PULL_BASE}885[`885`]).

.[#2022_09_08-fixed]#<<2022_09_08-fixed,Fixed:>>#
* Fixed multi-value date time filtering using contains and not contains
({CORTEZA_PULL_BASE}903[`903`]).
* Fixed select field translations not being shown unless the module is saved.
The fix was made by configuring the initial state to show select field translations even when the module is not saved
({CORTEZA_COMMIT_BASE}1706e52[`1706e52`]).
* Fixed gauge charts not showing correct results when metrics functions were used.
The fix was made by setting the dimension field to deletedBy which produces at most one dataset, since the gauge only shows one value
({CORTEZA_PULL_BASE}883[`883`]).
* Fixed the permissions on system pages showing invalid roles.
If you selected one or more roles, then dropped your database and re-provisioned it, the previous selection was still active (because it's in local storage), but it was showing deny for all.
The fix was made by filtering out the invalid role IDs from the local storage
({CORTEZA_PULL_BASE}886[`886`]).
* Fixed datasources not being saved when pressing the save datasources button in the datasources modal.
The fix was made by applying the save when the save button is pressed on the datasource modal
({CORTEZA_PULL_BASE}889[`889`]).
* Fixed the record list filter not working when field name was having hyphen in the field name.
The fix was made by adding hyphen to allowed list while parsing the query
({CORTEZA_PULL_BASE}897[`897`]).


# src/modules/ROOT/pages/changelog/202209/09.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2022.9.9`

*Released on*: `2023.04.05`

.[#2022_09_09-added]#<<2022_09_09-added,Added:>>#
* Added pagination on inline record lists when in view mode.
The change was added to have consistency and better user experience when using inline record editing
({CORTEZA_COMMIT_BASE}e0ae508[`e0ae508`]).

.[#2022_09_09-changed]#<<2022_09_09-changed,Changed:>>#
* Changed record import modal to allow users to map values to record and user fields.
The change was made to allow users to map values to record and user fields when importing records.
The change was made by removing the code that was preventing the users from mapping values to record and user fields
({CORTEZA_COMMIT_BASE}0cf81dc[`0cf81dc`]).
* Changed workflow triggers to not automatically add constraints after an event type is selected.
The change was made to prevent users from getting a console error when fetching workflow triggers without provided constraints
({CORTEZA_COMMIT_BASE}7a9802a[`7a9802a`]).

.[#2022_09_09-fixed]#<<2022_09_09-fixed,Fixed:>>#
* Fixed `Cannot read properties of undefined` error when trying to fetch workflow triggers without providing constraints.
The fix was made by adding a check to determine if a constant has a name
Also, the automatic addition of constraints after an event type was selected is now removed
({CORTEZA_COMMIT_BASE}7a9802a[`7a9802a`]).
* Fixed missing support for the STD aggregation function on MySQL databases.
The STD function was present in past versions.
The fix was made by adding an expression handler for the function and only allowing it for MySQL databases
({CORTEZA_COMMIT_BASE}3ec7d19[`3ec7d19`]).
* Fixed record lists raising `Could not load record list: can not change module on a record` when interacting with an imported namespace.
The issue was caused because the import logic didn't define any model constraints.
The fix was made by making the import logic apply model constraints when defining the model, as well as defining the record revisions model
({CORTEZA_COMMIT_BASE}a554e28[`a554e28`]).
* Fixed future/past values not being selectable if DateTime field has future/past only values option applied.
The fix was made by disabling the future/past only option on record list filter
({CORTEZA_COMMIT_BASE}24a3197[`24a3197`], {CORTEZA_COMMIT_BASE}ffbaba2[`ffbaba2`]).
* Fixed {APP_NAME_ADMIN} user view not showing any data when 'Confirm email address' was clicked.
The fix was made by refetching the user again on {APP_NAME_ADMIN} when the user is confirming the email address
({CORTEZA_COMMIT_BASE}e76fb09[`e76fb09`]).
* Fixed field kind not being updated in modules after being selected.
The fix was made by updating the module field kind after it is selected
({CORTEZA_PULL_BASE}1018[`1018`], {CORTEZA_PULL_BASE}1018[`1018`]).
* Fixed users not being able to update their records due to the “Could not update record: failed to complete transaction: Error 1366: Incorrect decimal value: `updated` for column `operation` at row 1” error.
The fix was made by changing the datatype and also by doing a rearrange of the columns of the record revisions table for consistency
({CORTEZA_COMMIT_BASE}b585dfb[`b585dfb`]).


# src/modules/ROOT/pages/changelog/202209/index.adoc

include::ROOT:partial$variables.adoc[]

[#2022-9-x]
= `2022.9`

With {PRODUCT_NAME} `2022.9`, we continue to improve system stability, security, performance, as well as focusing on features to help organizations conform to *data* privacy *policies and regulations*.

*{PRODUCT_NAME} Privacy*

*{PRODUCT_NAME} privacy* provides features to help organizations conform to data privacy policies and regulations.
With {PRODUCT_NAME} privacy, we aim to streamline the process of handling different data privacy regulations for low-code applications built with {PRODUCT_NAME}.

We introduce *sensitivity levels* which allow the administrators to classify *what data is sensitive* and on what *level it should be treated as*.
We also introduced two new web applications; the *privacy console*, which allows the users to *overview* their data and *request modifications* and the *data officer privacy console*, which allows the *data privacy officers* to manage user-submitted privacy requests.

*Redefined record storage*

{PRODUCT_NAME} `2022.9` redefines how data is stored internally to improve *performance, scalability, and flexibility*.
{PRODUCT_NAME} now supports the administrators to define *external databases* and configure *dedicated, stand-alone* data *storage locations* for modules.

*Duplicate detection*

Along the redefined *record storage*, we introduce tools to help *prevent duplicate data*.
{PRODUCT_NAME} now allows administrators to specify rules to determine if a record entry exists and how the system should handle the duplicate.
Currently, the system can either warn about the duplicate record or reject the record creation altogether.

*Record revisions*

{PRODUCT_NAME} now supports the administrators configuring {APP_NAME_COMPOSE} modules to *keep track of the changes* in their records.
The changes are tracked by introducing a revision number and providing a complete history of modifications for each record.

[NOTE]
====
Only changes done from the `2022.9.0` version onwards are tracked.
The pre-defined records are considered to be the first revision.
====
 
*Permission debugging*

To simplify the access control configuration process for different user roles, we introduced a new *permission debugger*, which allows the administrators to check if the resulting access control equals the expected one.
The permission debugger is available in all of the permission configuration modal windows, and the {PRODUCT_NAME} {APP_NAME_ADMIN}'s general component permissions.

.[#2022_9-important]#<<2022_9-important,Important upgrade notes:>>#
* The {PRODUCT_NAME} {APP_NAME_REPORTER}'s `Group` step changed to `Aggregate`, the old `Join` step changed to `Link` and a new `Join` step was added.
* The {PRODUCT_NAME} {APP_NAME_REPORTER}'s `date()` expression function changed to return the entire *date without time* (the previous version returned the day number), and added a new `day()` function to retrieve the day number.

:leveloffset: +1

include::09.gen.adoc[]

include::08.gen.adoc[]

include::07.gen.adoc[]

include::06.gen.adoc[]

include::05.gen.adoc[]

include::04.gen.adoc[]

include::03.gen.adoc[]

include::02.gen.adoc[]

include::01.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/202303/00.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.0`

*Released on*: `2023.04.20`

[IMPORTANT]
====
.[#2023_03_00-important]#<<2023_03_00-important,Important upgrade notes:>>#
* Namespace import/export has some edge cases which prevent it from being exported.
Namely, when you reference a deleted module from a page and try to export the namespace..
====

.[#2023_03_00-added]#<<2023_03_00-added,Added:>>#
* Added support for page duplication in edit mode and page builder view.
The change was added because this speeds up the development process of the project and allows users to copy/share content from one page to another
({WEBAPP_COMPOSE_PULL_BASE}450[`450`], {LOCALE_COMMIT_BASE}47e06eb[`47e06eb`]).
* Added support for personalized auth screen.
The change was added to simplify styles of the auth pages without the need to alter the source templates
Uploading the image will update the Auth background image, and the styles will supplement Auth screen's styles
({CORTEZA_PULL_BASE}446[`446`]).
* Added support for opening a record in a new tab or in a modal.
The change was added to make editing of the records a bit more intuitive, since the user will remain on the record list page while doing the changes
({CORTEZA_PULL_BASE}524[`524`], {CORTEZA_PULL_BASE}524[`524`]).
* Added support for cloning and coping page blocks in page builders.
The change was added to allow users to duplicate and re-use page blocks more easily
({CORTEZA_PULL_BASE}582[`582`]).
* Added support for viewing and undeleting a deleted single or multiple records in a record list.
The change was added to allow users to view and restore deleted records
({CORTEZA_PULL_BASE}740[`740`]).
* Added support for a fully customizable navigation page block with multiple navigation item type and customizable options for the navigation list items.
The change was added to have the ability to show one or two level of dynamic and static navigation
({CORTEZA_COMMIT_BASE}41f1283[`41f1283`]).
* Added support for conditional fields.
The change was added to give users more control on how records are displayed
({CORTEZA_PULL_BASE}770[`770`]).
* Added support for navigating to the next or previous record when inside a record page for easier and faster toggling between the records.
The change was added to allow users go over all their leads one by one without leaving the record page
({CORTEZA_PULL_BASE}836[`836`]).
* Added support for bulk record updates.
The change was added to allow the users to update multiple records in a record list
({CORTEZA_PULL_BASE}906[`906`], {CORTEZA_PULL_BASE}906[`906`], {CORTEZA_PULL_BASE}906[`906`], {CORTEZA_PULL_BASE}906[`906`], {CORTEZA_PULL_BASE}906[`906`]).
* Added support for a new page block in {APP_NAME_COMPOSE} called tabs block where each tab is a different block.
The change was added to make page block organizing much easier for users
({CORTEZA_PULL_BASE}670[`670`], {CORTEZA_PULL_BASE}670[`670`]).
* Added support for administrators to pre-define record list filters which can be applied to their record list if they are part of a specific role.
The filters are grouped by roles, allowing more flexibility as to who sees what.
The change was added to allow users to quickly apply filter to the record list
({CORTEZA_PULL_BASE}921[`921`], {CORTEZA_PULL_BASE}921[`921`], {CORTEZA_PULL_BASE}921[`921`]).
* Added support for geo location capture and ability to set or prefill current location while on a map.
The change was added to improve the user experience and the location accuracy of the users
Now instead of manually entering their coordinates, they can just use the `find me` button and the coordinates will be updated
({CORTEZA_PULL_BASE}955[`955`], {CORTEZA_PULL_BASE}955[`955`], {CORTEZA_PULL_BASE}955[`955`], {CORTEZA_PULL_BASE}955[`955`]).
* Added support for uploading an icon for specific page for the sidebar.
The change was added to allow the user to further customize a page
({CORTEZA_COMMIT_BASE}72d4471[`72d4471`]).
* Added support for geo address search functionality on the geometry module field editor/viewer.
The change was added to give users access to address search functionality when on the geometry module field editor/viewer
({CORTEZA_PULL_BASE}968[`968`], {CORTEZA_PULL_BASE}968[`968`], {CORTEZA_PULL_BASE}968[`968`], {CORTEZA_PULL_BASE}968[`968`]).
* Added support to open record selector fields in a modal.
The change was added to make viewing of records a bit more intuitive, since the user will remain on the record list page while opening a record selector pointing to another module
({CORTEZA_PULL_BASE}997[`997`]).
* Added support to reference a record from a record selector field pointing out to another module.
The change was added to give the user an ability to view the referenced record selector on the initial record page
({CORTEZA_COMMIT_BASE}d5cb466[`d5cb466`]).
* Added support for opening a calendar event source in a modal, new tab or in the same tab according to the user configuration.
The change was added to allow the user to open the event source records without going away from the calendar block
({CORTEZA_PULL_BASE}1104[`1104`]).
* Added support for radar and scatter type charts.
The change was added to give users more options when displaying data with charts
({CORTEZA_PULL_BASE}1148[`1148`], {CORTEZA_PULL_BASE}1148[`1148`], {CORTEZA_PULL_BASE}1148[`1148`]).
* Added support for uploading ico files in record lists and file page blocks
({CORTEZA_PULL_BASE}1072[`1072`]).
* Added the ability for users to disable the navigation sidebar within {APP_NAME_COMPOSE} namespace public pages.
The option is available under the `hide sidebar on namespace public pages` checkbox in the namespace edit screen.
The change was added because we wanted to provide the option of disabling built-in navigation in favour of re-defining it with the new navigation page block
({CORTEZA_COMMIT_BASE}41ed9ed[`41ed9ed`]).
* Added auto-refreshing and manual refreshing feature to page blocks excluding, Content, Record and File Blocks.
An icon now appears on blocks when you enable the refresh feature.
That icon is clickable even though refresh will happen automatically based on the duration you have set.
The change was added because users do not have to refresh the entire page to see new content on blocks and to give users more control over refreshing when auto-refreshing is not needed
({JS_PULL_BASE}73[`73`], {CORTEZA_PULL_BASE}760[`760`]).
* Added geometry page block to render a map with data points collected from record sources.
The geometry page block can show either points, lines or polygons based on the configured record feed sources.
The change was added to enable the users with better visual representation of their data
({CORTEZA_PULL_BASE}538[`538`]).
* Added new style configuration for the file page block and file record field.
Users can now change the height, width, borders, margins and the background color of their file attachment.
The change was added to provide users with more customization and styling option on viewing images
({CORTEZA_PULL_BASE}533[`533`]).
* Added an option to magnify certain page blocks when viewing a public {APP_NAME_COMPOSE} page.
A select dropdown has been added in the general tab of page block configuration modal for calendar, chart, content, comments, file, iframe, record list, report, and record revisions page blocks.
The user can select between Fullwidth or Modal select option, and when enabled, the user will see a magnify icon at the top of the block.
The change was added to help users finding the info they are looking for much faster and easier with the option to magnify certain page blocks
({CORTEZA_PULL_BASE}576[`576`]).
* Added a spinner to indicate when an action in template editor is submitted.
The change was added to have an UI consistency, because it was difficult to tell when your changes were being submitted
({CORTEZA_PULL_BASE}708[`708`]).
* Added a module field description when configuring a record list page block to inform the users that if no fields are selected, the default values will be shown
({CORTEZA_PULL_BASE}751[`751`]).
* Added ability to serve data as response in an integration gateway route by adding a route description field.
The change was added to give an endpoint response greater extensibility to integration gateway as different data can be returned
({CORTEZA_PULL_BASE}775[`775`], {CORTEZA_PULL_BASE}775[`775`], {CORTEZA_PULL_BASE}775[`775`], {CORTEZA_PULL_BASE}775[`775`], {CORTEZA_PULL_BASE}775[`775`]).
* Added Route description field, Filters sorting, Profiler hits purging and Integration gateway settings
({CORTEZA_PULL_BASE}775[`775`], {CORTEZA_PULL_BASE}775[`775`]).
* Added `BETWEEN` and `NOT BETWEEN` operator support for single value fields (number and date-time module fields).
The change was added to extend record filtering support for range filtering of numeric and date-time for single value field
({CORTEZA_PULL_BASE}813[`813`]).
* Added ability to drill down charts, by clicking on a data entry inside the chart.
Based on the configuration it can either filter an existing record list on the page that is showing the records from the same module as the chart or open a new record list in a modal.
The change was added to make it easier for users to filter record lists based on chart data, in order to view the details of said data
({CORTEZA_PULL_BASE}877[`877`]).
* Added functionality to generate user avatars and enable users to upload and manage their profile photos.
The change was added to provide users with greater flexibility and customization options for their profile avatars, while also allowing admins to manage avatars on behalf of users
({CORTEZA_PULL_BASE}887[`887`]).
* Added drag-and-drop expression sorting in workflows expression step.
The change was added to allow the user the ability to sort the existing expressions for a more intuitive and faster workflow implementation
({CORTEZA_PULL_BASE}1081[`1081`]).
* Added `Auto` grouping and timeline to radar and scatter type charts.
The change was added to give users more options when displaying data with charts
({CORTEZA_PULL_BASE}1148[`1148`]).
* Added extended record duplicate detection configuration to support multi value matching criteria and value checking algorithms.
The change was added to extend support for record duplicate detection with multiple fields in single rule with various detection algorithm and muli-value matching criteria
({CORTEZA_PULL_BASE}617[`617`], {CORTEZA_PULL_BASE}617[`617`]).
* Added new file configurator option to preview image in modal and option to download.
Images on the file base are centered now by default.
The change was added to center the images on the filebase for better user experience
({CORTEZA_PULL_BASE}937[`937`], {CORTEZA_PULL_BASE}937[`937`]).

.[#2023_03_00-changed]#<<2023_03_00-changed,Changed:>>#
* Changed the requirement to provide a handle when creating a resource is now optional.
The change is applied in {APP_NAME_COMPOSE}, {APP_NAME_ADMIN}, {APP_NAME_REPORTER}, and {APP_NAME_WORKFLOW}
The change was made because providing a handle shouldn't be a necessity.
The resource can be created without it.
The change was made by removing the requirement for the handle to be provided
({WEBAPP_COMPOSE_COMMIT_BASE}cd86e85[`cd86e85`], {WEBAPP_REPORTER_COMMIT_BASE}cf21c47[`cf21c47`], {WEBAPP_ADMIN_COMMIT_BASE}456c896[`456c896`], {WEBAPP_WORKFLOW_COMMIT_BASE}9b88af0[`9b88af0`], {LOCALE_COMMIT_BASE}24b0dda[`24b0dda`], {VUE_COMMIT_BASE}34f261a[`34f261a`], {JS_COMMIT_BASE}3a90a10[`3a90a10`]).
* Changed the record revision table text to be saying `No record revisions found` when no revisions are present.
The change was made to have a better user experience when there are no record revisions present.
The change was made by adding an empty table with `No record revisions found` message in the record page builder
({CORTEZA_PULL_BASE}758[`758`]).
* Changed the Record ID field in module connection settings being able to be disabled.
The change was made to prevent users from disabling Record ID field on system field mapping and to not show system fields that are not available.
Also to allow users to easily enable or disable system fields based on their configuration.
The change was made by updating system view configurator and system field mapping logic to prevent Record ID from being disabled
({CORTEZA_PULL_BASE}523[`523`]).
* Changed the name of a page when was copied multiply times was changed to show the copy and after that the name of the page and a counter in brackets.
The change was made to improve user experience.
If we copy a page 3-4 or more times, the naming gets confusing and too long.
The change was made by filtering how many times a certain page with same name already exists and including 'copy of' prefix and number suffix
Depending on the number of pages that match the same name, a counter is adjusted
({CORTEZA_PULL_BASE}644[`644`]).
* Changed workflow iterators to treat limit 0 parameter as no limit set.
The change was made to make workflow iterators consistent with other searching/filtering interactions.
The change was made by changing the limit in the code
({CORTEZA_COMMIT_BASE}cc24e62[`cc24e62`]).
* Changed the geometry multivalue map opening the default map location regardless which record location you press.
Now the opened map changes according to the record's geo location.
The change was made to prevent a confusion when different markers in multivalue fields were being opened on the map.
This change aims to improve ux and usability of the geometry field.
The change was made Leaflet map instance and zoom level was updated
({CORTEZA_PULL_BASE}940[`940`]).
* Changed the rotate and metric label field configuration for pie and doughnut charts by hiding the configuration since it was not needed.
The change was made to have consistency since they were shown but not needed.
Now they are hidden since we don't need them.
The change was made updating the chart configurations to adjust existing rotate logic for the above-mentioned charts
({CORTEZA_PULL_BASE}992[`992`]).
* Changed the output format to become hidden if output relative value is selected in date field.
The change was made to prevent confusion since when you have relative value, the output format is not taken into account.
The change was made by updating the date and time configuration
({CORTEZA_PULL_BASE}1019[`1019`]).
* Changed the record toolbar back button to always bring you back to the page where you came from.
The change was made to prevent users getting stuck in a loop and to allow them to go back to the previous page that they were onto
({CORTEZA_PULL_BASE}1155[`1155`]).
* Changed general ui/ux improvements:
** A configuration option on charts to disable or enable animation in order to allow users more control over chart configuration options
** The warning message for unsaved changes before navigating to another page in order to prevent losing unsaved changes by unintentionally navigating to another page
** Support for inline editing in record lists in order to allow user to easily edit a record by just hovering on the field and pressing on the edit button
** Option to allow duplicate values for single and multi value user, record and select fields, so that users can have more control over their selections and whether they will be allowing duplicate values or not
** Support for managing namespace button on compose sidebar in order to allow the users the ability to go in namespace settings directly from the compose sidebar
** The color of the button for confirming the action to accept a privacy request in order to match the same color pattern as the colors when confirming/denying the action to reject a privacy request
** Long page titles being cut off
** The location of the attachment modal in order to enable previewing of attachments in private pages
** The overlapping between zoom button on the geometry page block with the page block edit group buttons so that the page block edit group button is clickable on geometry page blocks
** Uninformative internal error error message on the user profile change password interface so that users can understand better of what and why the error was caused
** The usage of chartjs on admin dashboard with e-charts so that all places where we used to use chartjs since we transitioned to apache e-charts can be removed
** The description of handle/namespace slug so that we can have consistency across our system and to be more user friendly
** The `NaN items` with `0 items` when no resources are present so that we can have consistency, since on every other place when there are no items, we display them as zero
({CORTEZA_PULL_BASE}806[`806`], {CORTEZA_PULL_BASE}780[`780`], {CORTEZA_PULL_BASE}956[`956`], {CORTEZA_PULL_BASE}1136[`1136`], {CORTEZA_PULL_BASE}1129[`1129`], {CORTEZA_COMMIT_BASE}8379518[`8379518`], {CORTEZA_PULL_BASE}1069[`1069`], {CORTEZA_COMMIT_BASE}6ade044[`6ade044`], {CORTEZA_PULL_BASE}821[`821`], {CORTEZA_COMMIT_BASE}73a29b6[`73a29b6`], {CORTEZA_COMMIT_BASE}390a14e[`390a14e`], {CORTEZA_PULL_BASE}993[`993`], {CORTEZA_PULL_BASE}999[`999`]).

.[#2023_03_00-fixed]#<<2023_03_00-fixed,Fixed:>>#
* Fixed discovery not displaying any search result when namespace with module filters was selected.
The fix was made by adding minimum string match criteria to match exact string match for search results
({CORTEZA_COMMIT_BASE}e2c374c[`e2c374c`]).
* Fixed {APP_NAME_COMPOSE} Gauge chart not displaying the correct results when post processing function was used because the post processing function was not taken into consideration.
The fix was made by adding a post processing method to Gauge Chart {APP_NAME_COMPOSE} type
({CORTEZA_PULL_BASE}865[`865`]).
* Fixed the integration gateway route search filtering in administration area not returning any result if the whole name was not entered.
The fix was made by fixing the way filtering works on integration routes search
({SERVER_COMMIT_BASE}e551b73[`e551b73`]).
* Fixed the deleted status on application programming interface gateway route update getting preserved.
Previously if you edited a deleted route, the route got restored, now this is improved.
The fix was made by changing the part of application programming interface gateway service that handles route updates
({CORTEZA_COMMIT_BASE}16257e9[`16257e9`]).


# src/modules/ROOT/pages/changelog/202303/01.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.1`

*Released on*: `2023.05.18`

.[#2023_03_01-added]#<<2023_03_01-added,Added:>>#
* Added ability to drill down metrics, by clicking on a data entry inside the metrics block.
Based on the configuration it can either filter an existing record list on the page, that is showing the records from the same module as the metric, or open a new record list in a modal.
The change was added to make it easier for users to filter record lists based on metrics data, in order to view the details of said data
({CORTEZA_PULL_BASE}1184[`1184`]).
* Added support for opening geometry and record organizer page block records in a modal.
The change was added to give users the ability to open records in a modal without leaving the page that they are on
({CORTEZA_PULL_BASE}1177[`1177`]).
* Added support for error handling message inside workflows by letting configurators access the context of the error message.
The change was added to give user more freedom in defining error handling and to know where and on which step the error occurred
({CORTEZA_PULL_BASE}1088[`1088`]).
* Added http prefixes to all URL input values across {PRODUCT_NAME} if it is not provided by the user.
The change was added to make it easier for users to define URLs with leaving out the http:// part
({CORTEZA_PULL_BASE}1188[`1188`]).

.[#2023_03_01-changed]#<<2023_03_01-changed,Changed:>>#
* Changed record selector value resolution fetching per page block instead of per field so no redundant fetches are done.
The change was made to improve performance on slower connections/systems.
The change was made by moving it to per page block instead of per field as it was previously
({CORTEZA_PULL_BASE}1176[`1176`]).
* Changed the sidebar of {APP_NAME_COMPOSE} and {APP_NAME_REPORTER} to be scrollable just on items and the search bar and public/admin page button to be always on top.
The change was made to improve the accessibility of the the search bar and the buttons for public and admin page.
The change was made by making the sidebar components stick to top
({CORTEZA_PULL_BASE}1189[`1189`]).

.[#2023_03_01-fixed]#<<2023_03_01-fixed,Fixed:>>#
* Fixed charts and reporter elements utilizing aggregation erroring out.
The issue was caused because the sqlserver driver does not yet support offloading of aggregation steps.
The fix was made by keeping aggregation on the application level until a few blockers are resolved
({CORTEZA_COMMIT_BASE}f931275[`f931275`]).
* Fixed failing provision step reporting a malformed SQL statement.
The issue was caused by the provision function which utilized raw SQL with is not compatible with the sqlserver.
The fix was made by skipping that provision on sqlserver because it does not need to exist for that driver
The driver was introduced with the structure change so it is unneeded
({CORTEZA_COMMIT_BASE}1d4ab0b[`1d4ab0b`]).
* Fixed failing a fresh provision on an sqlserver database driver with an SQL typecasting error.
The fix was made by correctly handling and defaulting setting timestamp values
({CORTEZA_COMMIT_BASE}7675e5d[`7675e5d`]).
* Fixed tabs block titles getting erased once you add a new block to the list.
The fix was made by not updating the title when creating a block
({CORTEZA_PULL_BASE}1170[`1170`]).
* Fixed data and time input boxes not being responsive and resulting in being cut off on smaller screens.
The fix was made by updating the date and time module field responsiveness
({CORTEZA_PULL_BASE}1156[`1156`]).
* Fixed hash and query URL trim on URL input record field trimming the part before the hash and query instead of after it.
The fix was made by changing the order of trimming methods to match their corresponding labels
({CORTEZA_PULL_BASE}1173[`1173`]).
* Fixed hovering on record event on calendar agenda not showing the cursor as pointer.
The fix was made by changing the cursor from text selector to pointer
({CORTEZA_PULL_BASE}1179[`1179`]).
* Fixed workflow dry run process not stopping on server timeout/error.
The fix was made by resetting the state and refreshing the trigger label so the spinner disappears
({CORTEZA_PULL_BASE}1195[`1195`]).
* Fixed webapp page titles not shown on small screens
({CORTEZA_PULL_BASE}1175[`1175`]).
* Fixed not being able to cancel more than one privacy request consecutively in {APP_NAME_PRIVACY}
({CORTEZA_COMMIT_BASE}a559569[`a559569`]).
* Fixed record organizer not showing any data for a multi value fields.
The fix was made by removing sort on label and description field
({CORTEZA_PULL_BASE}1176[`1176`]).
* Fixed record selector of a record selector showing the record field as an ID instead of text.
The fix was made by properly resolving multiple record values
({CORTEZA_PULL_BASE}1176[`1176`]).
* Fixed metrics block data not being consistent in page builder mode when configurator is updated.
The fix was made by updating the metric base component with a listener that refreshes the metric base when the configurator is updated
({CORTEZA_PULL_BASE}1207[`1207`]).


# src/modules/ROOT/pages/changelog/202303/02.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.2`

*Released on*: `2023.06.08`

.[#2023_03_02-added]#<<2023_03_02-added,Added:>>#
* Added option for transparent color in the color picker used in {APP_NAME_ADMIN}, and {APP_NAME_REPORTER}.
The change was added to give users more configuration options when selecting color or background color for an element
({CORTEZA_PULL_BASE}1211[`1211`]).
* Added the option to set a record list filter as a preset filter for a user.
The filter can be applied using the 'Filters' dropdown menu.
The change was added to give the user the ability to pick a pre-configured filter
({CORTEZA_PULL_BASE}1227[`1227`]).
* Added menu with 'more' options (delete, un-delete, and permissions) to resource lists in {APP_NAME_COMPOSE}, {APP_NAME_ADMIN}, {APP_NAME_REPORTER}, and {APP_NAME_WORKFLOW}.
The change was added so the user doesn't have to scroll horizontally to access all resource options
({CORTEZA_COMMIT_BASE}46f5455[`46f5455`]).
* Added a stale data error in case resources like workflows are updated whilst a different user is editing the same resource.
The change was added to help reduce configuration errors due to multiple people editing the same resource at the same time
({CORTEZA_COMMIT_BASE}2529cf3[`2529cf3`]).
* Added button to select all records in a record list and preform the actions edit, delete, un-delete as well as executing workflows.
The change was added to provide the user with an easier way to edit, delete, un-delete, and execute workflows on records across multiple pages
({CORTEZA_COMMIT_BASE}89f621c[`89f621c`]).

.[#2023_03_02-changed]#<<2023_03_02-changed,Changed:>>#
* Changed the way reminders in {APP_NAME_COMPOSE} look and behave which provides an easier way for the user to work with.
The change was made to be consistent with the rest of the {PRODUCT_NAME} UI and improve the UX
({CORTEZA_PULL_BASE}1239[`1239`]).
* Changed the feedback email domain in the page header of every {PRODUCT_NAME} web application from `crusttech` to `cortezaprojectorg`
({CORTEZA_COMMIT_BASE}0072a4b[`0072a4b`]).
* Changed reminders to clear out the snooze count after editing and modifying when the reminder should prompt
({CORTEZA_COMMIT_BASE}256dd59[`256dd59`]).
* Changed the format of displaying the total number of record list items - if N is number of records, then the new format would be N items to N records
({CORTEZA_COMMIT_BASE}0fcbec0[`0fcbec0`]).
* Changed the block magnify query param that keeps track of which block is magnified (zoomed in).
The change was made to ensure that any future code implementations don't collide with the block magnify query param
({CORTEZA_COMMIT_BASE}5fde4c9[`5fde4c9`]).
* Changed the value of the `SMTP_FROM` variable in the server `.env` variables.
Previously if a value was set in the `.env` file, it wasn't respected.
The change was made to give developers the option to configure SMTP setting not only from the UI but also though the `env` file
({CORTEZA_COMMIT_BASE}d2b389b[`d2b389b`]).
* Changed default workflow and trigger action severity to `notice` to keep it consistent with other resources in {APP_NAME_ADMIN}.
The change was made to make create, update, delete, and undelete actions visible in the default production ruleset of the actionlog
({CORTEZA_COMMIT_BASE}31f7e14[`31f7e14`]).

.[#2023_03_02-fixed]#<<2023_03_02-fixed,Fixed:>>#
* Fixed multiline privacy request comments displaying as inline comments.
The fix was made by adding support for multiline comments in privacy requests
({CORTEZA_PULL_BASE}1214[`1214`]).
* Fixed {APP_NAME_COMPOSE} broken public icon url for page, namespace, and custom app icons after changing the Auth JWT secret.
The fix was made by adding an exception for the namespace icons, page, and icon attachments
({CORTEZA_PULL_BASE}1219[`1219`]).
* Fixed available and selected fields not scrollable in safari due to set max height in the item picker component
This issue was present in {APP_NAME_COMPOSE} and {APP_NAME_PRIVACY}
({CORTEZA_PULL_BASE}1221[`1221`]).
* Fixed funnel chart labels being hidden after hovering over them
({CORTEZA_PULL_BASE}1222[`1222`]).
* Fixed the functionality to expand text in the description field used in {APP_NAME_WORKFLOW}'s error step
({CORTEZA_COMMIT_BASE}84215c0[`84215c0`]).
* Fixed automation sessions list sorting parameter in {APP_NAME_ADMIN}
The parameter was excepting the incorrect type of value
({CORTEZA_PULL_BASE}1141[`1141`]).
* Fixed copy of page layout in {APP_NAME_COMPOSE}
A page with layout couldn't be copied because of duplicate page handle value
({CORTEZA_PULL_BASE}1230[`1230`]).
* Fixed page blocks disappearing from the page builder after being removed from tabs configuration
({CORTEZA_COMMIT_BASE}c939015[`c939015`]).
* Fixed connection map not showing in {APP_NAME_PRIVACY} on mobile devices
({CORTEZA_COMMIT_BASE}ca12cc9[`ca12cc9`]).
* Fixed overflowing text in the Record Organizer component
({CORTEZA_COMMIT_BASE}f09f1fa[`f09f1fa`]).
* Fixed known concurrent map read/write issues for Integration Gateway profiler and workflow pre-processing
({CORTEZA_COMMIT_BASE}3703598[`3703598`]).
* Fixed missing `sessionID` parameter in automation session search
The sessionID value wasn't taken into consideration when filtering an automation session list
({CORTEZA_COMMIT_BASE}3703598[`3703598`]).
* Fixed compose page not being accessible unless the sub pages option is enabled
({CORTEZA_COMMIT_BASE}ed0ac43[`ed0ac43`]).
* Fixed error for not included page layout resources when exporting namespace configuration.
The fix was made by including page layouts to the namespace export logic
({CORTEZA_COMMIT_BASE}4ad1217[`4ad1217`]).
* Fixed error preventing user from being able to add a non numeric value to gauge chart dimension labels in {APP_NAME_COMPOSE}
({CORTEZA_COMMIT_BASE}f9b9661[`f9b9661`]).
* Fixed the setting of workflow and trigger IDs after creating action log events
({CORTEZA_COMMIT_BASE}03806a2[`03806a2`]).


# src/modules/ROOT/pages/changelog/202303/03.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.3`

*Released on*: `2023.06.28`

.[#2023_03_03-added]#<<2023_03_03-added,Added:>>#
* Added a warning message that notifies the user if they try to leave a page with unsaved changes on it.
The change was added to prevent losing changes that haven't been saved yet
({CORTEZA_PULL_BASE}1051[`1051`]).
* Added the option to add custom styles to all of the web applications.
The styles can be added via the user settings in {APP_NAME_ADMIN}.
The change was added to provide the user with more freedom to style the applications as they see fit
({CORTEZA_PULL_BASE}1262[`1262`]).

.[#2023_03_03-changed]#<<2023_03_03-changed,Changed:>>#
* Changed general UI/UX improvements:
** Hid the button for editing a namespace from the public view in the sidebar when the option to show that namespace isn't visible
** Highlighted the row of a translation when viewing subtitle/description namespace translations as it's done everywhere
** The styles in file page block so when a gallery of images is viewed, the positioning of each image won't be on top of the previous image's name
** The color of the sidebar text items and the functionality to show the text item on hover
** Overlapping of the 'more' menu in a record list in {APP_NAME_COMPOSE}
({CORTEZA_PULL_BASE}1254[`1254`], {CORTEZA_PULL_BASE}1255[`1255`], {CORTEZA_PULL_BASE}1244[`1244`], {CORTEZA_PULL_BASE}1274[`1274`], {CORTEZA_COMMIT_BASE}5fa587f[`5fa587f`]).

.[#2023_03_03-fixed]#<<2023_03_03-fixed,Fixed:>>#
* Fixed not being able to view a map if the value for latitude or longitude isn't provided in the map configuration
({CORTEZA_PULL_BASE}1032[`1032`]).
* Fixed error in console when trying to add a module constraint without providing a value
({CORTEZA_PULL_BASE}1281[`1281`]).
* Fixed unsaved changes warning triggered after a namespace has been saved and you want to visit it
({CORTEZA_COMMIT_BASE}aa7cdf2[`aa7cdf2`]).
* Fixed the labels updated at and deleted at not showing after an {APP_NAME_ADMIN} application was updated or deleted
The labels provide additional information as to what types of changes have happened to a resource
({CORTEZA_COMMIT_BASE}ce541cd[`ce541cd`]).


# src/modules/ROOT/pages/changelog/202303/04.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.4`

*Released on*: `2023.07.20`

.[#2023_03_04-added]#<<2023_03_04-added,Added:>>#
* Added a button that allows the user to edit record values in a record block without having to open the record in edit mode.
The change was added to give the user the ability to easily edit a single field when viewing a record
({CORTEZA_PULL_BASE}1282[`1282`]).
* Added options to zoom in and download a file from a record.
The change was added to give the user the flexibility to preview and download files when viewing a record
({CORTEZA_PULL_BASE}1310[`1310`]).
* Added new ways of displaying Select module fields allowing you to show configured options as check boxes or radio buttons.
The change was added to provide the user with an additional ways to view for the Select field value/values
({CORTEZA_PULL_BASE}1301[`1301`]).
* Added the ability to use a record value in a record page title.
The change was added to give the user the freedom to customize a record page title using record values
({CORTEZA_PULL_BASE}1332[`1332`]).
* Added the option to display a checkbox as a toggle switch.
The change was added to give the user another way of interacting with the checkbox field
({CORTEZA_PULL_BASE}1286[`1286`]).

.[#2023_03_04-changed]#<<2023_03_04-changed,Changed:>>#
* Changed role un-delete operation to dispatch role update events on the event bus.
The change was made to keep it consistent with other resource operations
({CORTEZA_COMMIT_BASE}6558efc[`6558efc`]).
* Changed the {PRODUCT_NAME} authentication flow to skip unneeded screens and get the user directly to the requested web application as soon as possible.
The change was made to improve the authentication user interface and experience
({CORTEZA_PULL_BASE}1284[`1284`]).

.[#2023_03_04-fixed]#<<2023_03_04-fixed,Fixed:>>#
* Fixed input parameter handling for the integration gateway proxy filter
Now, the entire integration gateway pipeline scope can be used in the proxy filter
({CORTEZA_COMMIT_BASE}1e82fc0[`1e82fc0`]).
* Fixed wrong condition priority when filtering the record list with the `Not equal` operator
({CORTEZA_PULL_BASE}1300[`1300`]).
* Fixed the {APP_NAME_COMPOSE} namespace changed alert prompt only when we're leaving the page and unsaved changes are present
Before, it the alert would prompt after saving changes when creating or updating a namespace
({CORTEZA_PULL_BASE}1298[`1298`]).
* Fixed role members not showing when viewing or editing a role
({CORTEZA_PULL_BASE}1296[`1296`]).
* Fixed an error preventing users from navigating back to the role list after viewing/editing a contextual role
({CORTEZA_PULL_BASE}1307[`1307`]).
* Fixed record list export not including all of the active filters which resulted in inconsistent output
({CORTEZA_PULL_BASE}1318[`1318`]).
* Fixed not being able to magnify unsaved page blocks
({CORTEZA_PULL_BASE}1289[`1289`], {CORTEZA_PULL_BASE}1291[`1291`]).
* Fixed module field select translations not being saved when configuring the field
({CORTEZA_COMMIT_BASE}311c879[`311c879`]).
* Fixed module field validations for unique values not being saved when configuring the field
({CORTEZA_COMMIT_BASE}295defc[`295defc`]).
* Fixed date and time value not being saved when creating an auth client
({CORTEZA_PULL_BASE}1337[`1337`], {CORTEZA_COMMIT_BASE}3ed432e[`3ed432e`], {CORTEZA_COMMIT_BASE}bd0a941[`bd0a941`]).
* Fixed the position of the actions menu (three dots) in compose chart, module, and namespace list to be always visible on hover even if the list column isn't visible
({CORTEZA_PULL_BASE}1331[`1331`]).


# src/modules/ROOT/pages/changelog/202303/05.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.5`

*Released on*: `2023.08.24`

.[#2023_03_05-added]#<<2023_03_05-added,Added:>>#
* Added the option to configure whether module field value is on the same row as its label in the page block.
The change was added to provide the user with the option to set the position of a field value
({CORTEZA_PULL_BASE}1339[`1339`]).
* Added case insensitive search in a record list if MySQL database is used.
The change was added to make searching of records easier by returning similar results to the searching criteria
({CORTEZA_PULL_BASE}1355[`1355`]).

.[#2023_03_05-changed]#<<2023_03_05-changed,Changed:>>#
* Changed page navigation to stop loading previous resources in case we've navigated to a new page.
The change was made to reduce the amount of needless processing since the old resources would be discarded right away
({CORTEZA_COMMIT_BASE}638ba17[`638ba17`]).
* Changed general ui/ux improvements:
** Adjust the element styles in the topbar of all web applications to improve the UI for current and older browser versions
({CORTEZA_COMMIT_BASE}db740f7[`db740f7`]).

.[#2023_03_05-fixed]#<<2023_03_05-fixed,Fixed:>>#
* Fixed long texts to no longer overflow in {APP_NAME_COMPOSE}
({CORTEZA_COMMIT_BASE}895796a[`895796a`]).
* Fixed compose sub-pages not being shown when configuring a navigation page block
({CORTEZA_PULL_BASE}1359[`1359`]).
* Fixed module field labels shown underneath delete button when bulk editing a value
({CORTEZA_COMMIT_BASE}6f6df66[`6f6df66`]).
* Fixed drill-down option in the metric page block not working if the metric label wasn't provided
({CORTEZA_COMMIT_BASE}95ae09e[`95ae09e`]).
* Fixed memory leak issue for {APP_NAME_COMPOSE} when switching between different pages
({CORTEZA_COMMIT_BASE}95cf245[`95cf245`]).
* Fixed not being able to save a page after removing a page block from a tabs page block
({CORTEZA_COMMIT_BASE}5addb87[`5addb87`]).
* Fixed conditional fields being displayed when viewing records even though their condition evaluates to `false`
({CORTEZA_COMMIT_BASE}e081faa[`e081faa`]).
* Fixed not being able to create a record in a modal because the view opens behind the modal
Now, the view opens in the modal and a record can be created in it
({CORTEZA_COMMIT_BASE}ac9bc74[`ac9bc74`]).
* Fixed namespace sidebar not being hidden/show correctly when creating a new namespace because it was pinned
({CORTEZA_COMMIT_BASE}ac9bc74[`ac9bc74`]).
* Fixed error for stale data showing if a report data source is misconfigured in {APP_NAME_REPORTER}
({CORTEZA_COMMIT_BASE}773beaf[`773beaf`]).
* Fixed not being able to search for a record by record id in a record list using 'Like', 'Not like', and 'Not equal' conditions
({CORTEZA_PULL_BASE}1354[`1354`]).
* Fixed not being able to edit a workflow expression after clicking on a browser tab/window
({CORTEZA_COMMIT_BASE}56264e1[`56264e1`]).
* Fixed the visibility of the inline record editor option in a record list to hidden if a module isn't provided
({CORTEZA_COMMIT_BASE}b96ea0e[`b96ea0e`]).


# src/modules/ROOT/pages/changelog/202303/06.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.6`

*Released on*: `2023.09.13`

.[#2023_03_06-added]#<<2023_03_06-added,Added:>>#
* Added splice function in workflows that can change the contents of an `array` by removing or replacing existing elements of different types like `strings`, `numbers`, `booleans`, `objects`, `arrays` and/or adding new elements in place.
The change was added to provide the option to easily add or remove elements from an `array`
({CORTEZA_COMMIT_BASE}7bc36eb[`7bc36eb`]).
* Added the option to fetch data for a geometry page block when clicking on the refresh button in the page block or after a set by the user amount of time.
The change was added to provide the option to easily fetch data for the page block
({CORTEZA_COMMIT_BASE}f189c43[`f189c43`]).
* Added a dropdown to look up the permissions of a concrete module, page or page layout.
The change was added to provide the option of viewing permissions of a resource without having to visit it
({CORTEZA_COMMIT_BASE}7fdc854[`7fdc854`]).

.[#2023_03_06-changed]#<<2023_03_06-changed,Changed:>>#
* Changed general ui/ux improvements:
** Fixated the save button in {APP_NAME_ADMIN}'s permissions list so user doesn't have to scroll to the bottom to save their changes
** Removed additional padding on the top of a record page block field when it is being edited and not aligned horizontally
** Hide the option to show time values in a generic chart if such value aren't used in the chart
({CORTEZA_COMMIT_BASE}d924903[`d924903`], {CORTEZA_COMMIT_BASE}65b6db3[`65b6db3`], {CORTEZA_COMMIT_BASE}fd5afbb[`fd5afbb`]).

.[#2023_03_06-fixed]#<<2023_03_06-fixed,Fixed:>>#
* Fixed invalid username and password combination error on sign up caused when trying to create a user with a handle that already exists
({CORTEZA_PULL_BASE}1413[`1413`]).
* Fixed prefilter in progress bar page block not returning any data if records are filtered by `recordID`
({CORTEZA_PULL_BASE}1414[`1414`]).
* Fixed being redirected to list of namespace/pages/modules instead of the previous page after clicking on the btn:[Save and close] button when creating or editing a namespace/page/module
({CORTEZA_PULL_BASE}1387[`1387`], {CORTEZA_COMMIT_BASE}abe1eb6[`abe1eb6`]).
* Fixed side menu with reports not opening in {APP_NAME_REPORTER} when hovering over its 'opening' bars icon
({CORTEZA_PULL_BASE}1425[`1425`]).
* Fixed incorrect number of pages shown when the full page navigation and show total number of records options are enabled in a record list
({CORTEZA_PULL_BASE}1417[`1417`]).
* Fixed triggering of unsaved changes message when trying to leave the {APP_NAME_COMPOSE} settings page in {APP_NAME_ADMIN} after saving the changes to the user interface settings
({CORTEZA_PULL_BASE}1429[`1429`]).
* Fixed missing page layout permissions for authenticated and administrator roles.
The fix was made by adding the permissions to the roles
({CORTEZA_COMMIT_BASE}2c7e972[`2c7e972`]).


# src/modules/ROOT/pages/changelog/202303/07.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.7`

*Released on*: `2023.10.04`

.[#2023_03_07-added]#<<2023_03_07-added,Added:>>#
* Added the option to delete a preset filter from filter preset dropdown in a record list for administrator roles.
The change was added to provide all administrator role users with the option to permanently delete a preset filter
({CORTEZA_PULL_BASE}1449[`1449`]).
* Added the option to sort the system fields (`ownedBy`, `createdBy`, `updatedBy`, and `deletedBy`) as well as user and record fields and in record lists.
The change was added to make sorting/viewing data easier for the user
({CORTEZA_PULL_BASE}1449[`1449`]).

.[#2023_03_07-changed]#<<2023_03_07-changed,Changed:>>#
* Changed option to clone a page layout by adding two sub options - for cloning a page with page block reference and for cloning a page without page block reference.
When cloning by reference, configuration changes that are made to the original page's blocks are also reflected to the copied page's page blocks.
And when cloning without reference, the changes made to the original page's blocks are not reflected to the copied page's page blocks.
The change was made to provide the user with the option to choose whether the copied page's block configuration should be shared among pages
({CORTEZA_PULL_BASE}1444[`1444`]).
* Changed the UI for uploading a namespace by showing a spinner while data is being processed and hiding the name and handle field of the namespace instead of showing the spinner and fields at the same time.
The change was made to be consistent with the UI in {PRODUCT_NAME}
({CORTEZA_COMMIT_BASE}c997655[`c997655`]).
* Changed the handle field for a user to not be required when updating the resource in {APP_NAME_ADMIN}
({CORTEZA_COMMIT_BASE}ed377a7[`ed377a7`]).
* Changed general ui/ux improvements:
** Added additional information on how to write conditions for hiding or showing for a page layout in the page layout configurator
** Updated the edit icon in page tree to match the same edit icon used everywhere in {PRODUCT_NAME}
** Standardize permissions button in {APP_NAME_ADMIN} and {APP_NAME_COMPOSE}
({CORTEZA_COMMIT_BASE}d2cc2c8[`d2cc2c8`], {CORTEZA_COMMIT_BASE}d5f8faa[`d5f8faa`], {CORTEZA_COMMIT_BASE}86c12cc[`86c12cc`]).

.[#2023_03_07-fixed]#<<2023_03_07-fixed,Fixed:>>#
* Fixed non-record page blocks not being refreshed in a modal after a record has been added or edited
({CORTEZA_PULL_BASE}1444[`1444`]).
* Fixed the `refresh all record values` prompt in workflows not updating record values when workflow is executed
({CORTEZA_PULL_BASE}1445[`1445`]).
* Fixed page content not being shown when creating record in magnified modal
({CORTEZA_COMMIT_BASE}55dfcb8[`55dfcb8`]).
* Fixed page blocks not being refreshed with the correct data after a record has been updated
({CORTEZA_COMMIT_BASE}8c6c3b8[`8c6c3b8`]).
* Fixed record fetching not returning all available pages in case RBAC rules would filter out a larger chunk.
The fix was made by tracking both included and excluded records and adjusting termination logic accordingly
({CORTEZA_COMMIT_BASE}8e03ea5[`8e03ea5`]).


# src/modules/ROOT/pages/changelog/202303/08.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.3.8`

*Released on*: `2023.10.18`

.[#2023_03_08-changed]#<<2023_03_08-changed,Changed:>>#
* Changed the record import subsystem by upgrading it with the new data transformation framework.
The change was made to optimize the process of importing records by making it more stable, efficient, and capable of handling large amounts of record imports
({CORTEZA_COMMIT_BASE}399f9a7[`399f9a7`]).

.[#2023_03_08-fixed]#<<2023_03_08-fixed,Fixed:>>#
* Fixed record import not importing anything with no reported errors.
The fix was made by fixing the file management to correctly report rows and counts
The issue was caused because the state wasn't reset correctly after performing a _preflight_ to analyze and count records
({CORTEZA_COMMIT_BASE}532e1ac[`532e1ac`]).
* Fixed undefined property error in the developer console when removing a page block
({CORTEZA_PULL_BASE}1476[`1476`]).
* Fixed duplicate identification keys error in the developer console when configuring automation buttons
({CORTEZA_COMMIT_BASE}28d4d0d[`28d4d0d`]).
* Fixed metric element not respecting its format configuration and displaying as default integer in {APP_NAME_REPORTER}
({CORTEZA_PULL_BASE}1421[`1421`]).
* Fixed page layout expressions not being evaluated when switching from editing to viewing a record
This fix also addressed the issue of record object not being present on initial load
({CORTEZA_PULL_BASE}1475[`1475`]).


# src/modules/ROOT/pages/changelog/202303/index.adoc

include::ROOT:partial$variables.adoc[]

[#2023-3-x]
= `2023.3`

With {PRODUCT_NAME} `2023.3`, we continue to improve system stability, security, performance, as well as focusing on improving our user interfaces to make {PRODUCT_NAME} more enjoyable to both use and configure.

*Page Layouts*

*Page layouts* enable you to dynamically change the contents based on who is viewing what from where.

You can define an arbitrary number and sequence of page layouts, providing more flexibility to customize the experience of your end-users.
In addition to changing the layout when the user visits the page, you can also define their relation and allow users to navigate between them.

*Conditional Fields*

*Conditional fields* enable you to dynamically hide bits of information based on the contents of the page.
This enables you to simplify your user interfaces and hide irrelevant information.

*New Page Blocks*

* *Navigation* page block allows you to define custom navigation inside your {APP_NAME_COMPOSE} applications.
The navigation can be an addition to the pre-defined one or a complete replacement.
* *Tabbed* page block allows you to _pack_ multiple page blocks into a single one, _hidden_ behind tabs.
The tabbed page block enables you to condense user interfaces by _hiding_ common bits of information behind the same page block.

*UI Touchups*

User interfaces were a big focus for the `2023.3` release; improving user experience when configuring and interacting with your application, as well as laying the groundwork for future releases.

.Administration:
* Redesigned record list page block configuration modal to look nicer and more in line with our style guidelines.
* Added support to attach icons to pages, enabling you to improve the look of your navigation.
* Added support for copying, pasting, and cloning pages and page blocks to speedup dashboard designing.
* Added a simplified way of re-designing authentication screens without the need to fiddle with the source templates.
The admin webapp now allows you to inject custom CSS as well as change the background image.

.End-User UI Touchups:
* Added a basic chart drill-down option allowing you to filter record lists based on your interaction with the chart.
* Added the ability to open records inside modal windows to better suite power users.
* Added the ability for users open specific page blocks in a modal or as full screen.
* Added support for users to navigate between records while inspecting a record.
* Added support to bulk update specific record values.

:leveloffset: +1

include::08.gen.adoc[]

include::07.gen.adoc[]

include::06.gen.adoc[]

include::05.gen.adoc[]

include::04.gen.adoc[]

include::03.gen.adoc[]

include::02.gen.adoc[]

include::01.gen.adoc[]

include::00.gen.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/202309/00.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.0`

*Released on*: `2023.11.08`

.[#2023_09_00-added]#<<2023_09_00-added,Added:>>#
* Added a btn:[Back] button to navigate to previous page block modal when viewing or editing a tabbed page block.
The change was added to provide the user with an easier way to go back in a modal
({CORTEZA_PULL_BASE}1448[`1448`]).
* Added an option in the record list configurator for admins to enable end users to pick the number of records to be shown in a record list.
After the option is enabled, the user can select a number from the record list dropdown.
The change was added to allow end users to configure how many records per page are to be shown
({CORTEZA_PULL_BASE}1450[`1450`]).
* Added a delete button in the page icon configurator modal with which a user can remove an uploaded icon.
The change was added to provide the option to remove an uploaded icon
({CORTEZA_PULL_BASE}1379[`1379`]).
* Added a btn:[Save as copy] button to create a copy of a module or chart.
The change was added to allow users to easily copy the functionality of a module or chart
({CORTEZA_PULL_BASE}1468[`1468`]).
* Added an option to create a custom color scheme in the chart color scheme dropdown.
The change was added to give the user the freedom to make a custom color scheme
({CORTEZA_PULL_BASE}1467[`1467`]).
* Added buttons for removing and modifying a tabbed page block next to the block name.
The change was added to provide an easier way of editing or deleting a tabbed page block
({CORTEZA_PULL_BASE}1416[`1416`]).
* Added unsaved changes warning message when modifying a record and trying to navigate to a different page.
The change was added to prevent losing changes that haven't been saved yet
({CORTEZA_PULL_BASE}1367[`1367`]).
* Added support for {PRODUCT_NAME} to automatically manage and change the underlying database when storing records.
The change was added to simplify the process of using dedicated and customized storage locations for your records since manual intervention, for most cases, is no longer needed
({CORTEZA_COMMIT_BASE}bc92320[`bc92320`], {CORTEZA_COMMIT_BASE}0695eb7[`0695eb7`], {CORTEZA_COMMIT_BASE}4224ba9[`4224ba9`], {CORTEZA_COMMIT_BASE}b86f67c[`b86f67c`], {CORTEZA_COMMIT_BASE}1eb360f[`1eb360f`], {CORTEZA_COMMIT_BASE}2bcf86e[`2bcf86e`]).
* Added an option to create a custom button for a record page in its page layout configurator that will be present when viewing the page layout.
The change was added to provide the user with the option to create a custom button
({CORTEZA_PULL_BASE}1484[`1484`]).
* Added an icon containing an exclamation mark to a page block toolbar indicating that the concrete page block is used in another page layout.
The change was added to mark a page block that is already used in another page layout
({CORTEZA_PULL_BASE}1495[`1495`]).
* Added the option to change the default colors of {PRODUCT_NAME} applications in {APP_NAME_ADMIN}.
The change was added to provide the user with more freedom to style {PRODUCT_NAME}
({CORTEZA_PULL_BASE}1469[`1469`]).
* Added a rounded circle icon that marks a configuration option as performance impacting.
The change was added to mark which features would impact the performance of an application
({CORTEZA_PULL_BASE}1490[`1490`]).
* Added a spinner to delete and un-delete buttons while a resource is being deleted or un-deleted.
The change was added to show the user the current state of the delete or un-delete process
({CORTEZA_PULL_BASE}1464[`1464`]).

.[#2023_09_00-changed]#<<2023_09_00-changed,Changed:>>#
* Changed the {PRODUCT_NAME} {APP_NAME_COMPOSE} admin page navigation to keep the user on the page builder or page edit whenever switching pages as well as keeping the user on show all records when switching modules.
The change was made to provide a more intuitive way to navigate between {APP_NAME_COMPOSE} resources
({CORTEZA_PULL_BASE}1457[`1457`]).
* Changed the form structure to better support mobile users in {APP_NAME_ADMIN}.
The change was made to provide a better UI and UX for mobile users
({CORTEZA_PULL_BASE}1253[`1253`]).
* Changed page blocks to refresh in case the underlying data was modified by a different page block on the same page.
The change was made to keep all page blocks showing related data in sync
({CORTEZA_PULL_BASE}1435[`1435`]).
* Changed general ui/ux improvements:
** Improved header button layout for topbar navigation and resource list items
** Adjusted position of btn:[x] button in search bar to always appear on the right side
** Added a standardized submit button across all web applications to make UI consistent and code maintaining easier
** Unnecessary vertical and horizontal scrolling of resource list parent component in {APP_NAME_ADMIN}
** Header buttons in resource editing view were partially/completely hidden if more than two were displayed in {APP_NAME_ADMIN}
** Longer labels in resource editing view appeared under their input fields in {APP_NAME_ADMIN}
({CORTEZA_PULL_BASE}1489[`1489`], {CORTEZA_COMMIT_BASE}dcc541d[`dcc541d`], {CORTEZA_PULL_BASE}1451[`1451`], {CORTEZA_PULL_BASE}1253[`1253`]).

.[#2023_09_00-fixed]#<<2023_09_00-fixed,Fixed:>>#
* Fixed namespace export erroring out with an invalid reference error whenever we're referring to deleted resources.
The fix was made by ignoring missing references and exporting/importing regardless of missing references
This should be expanded and improved upon in a future release
({CORTEZA_COMMIT_BASE}dc54b55[`dc54b55`]).
* Fixed nothing happening when trying to copy a page block
({CORTEZA_COMMIT_BASE}a7331b0[`a7331b0`]).
* Fixed triggering of unsaved changes message after user wants to delete a modified resource like a page, namespace, module or chart
({CORTEZA_PULL_BASE}1466[`1466`]).


# src/modules/ROOT/pages/changelog/202309/01.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.1`

*Released on*: `2023.12.01`

.[#2023_09_01-added]#<<2023_09_01-added,Added:>>#
* Added the options to clone and copy a page block within a tabbed page block.
The change was added to provide an easier way to clone and copy tabbed page blocks
({CORTEZA_PULL_BASE}1527[`1527`]).
* Added a dropdown to select the number of items to be displayed per page in a list of resources.
The change was added to provide the user with the option to select how many resources can be displayed per page
({CORTEZA_PULL_BASE}1534[`1534`]).

.[#2023_09_01-changed]#<<2023_09_01-changed,Changed:>>#
* Changed the error message to be more verbose when user includes invalid or missing record input required values in a workflow function.
The change was made to provide a clearer message on what and where the issue is
({CORTEZA_PULL_BASE}1571[`1571`]).

.[#2023_09_01-fixed]#<<2023_09_01-fixed,Fixed:>>#
* Fixed misconfigured tabs page block broke how the tabs block was shown
({CORTEZA_PULL_BASE}1569[`1569`]).
* Fixed triggering of unsaved changes message after user adds an additional metric to generic chart and saves the chart
({CORTEZA_PULL_BASE}1572[`1572`]).
* Fixed module field label and description shown on the same line when viewing a record on a public page
({CORTEZA_PULL_BASE}1576[`1576`]).
* Fixed module fields hint and description toggled on for edit modes when updating field translations
({CORTEZA_PULL_BASE}1578[`1578`]).
* Fixed adding of a new value when trying to edit an existing geometry value via map in a record
({CORTEZA_PULL_BASE}1577[`1577`]).


# src/modules/ROOT/pages/changelog/202309/02.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.2`

*Released on*: `2023.12.22`

.[#2023_09_02-added]#<<2023_09_02-added,Added:>>#
* Added the options to `export`, `enable`, `disable`, a workflow using the actions menu in {APP_NAME_WORKFLOW}.
The change was added to provide the user with an easier way to interact with a workflow without having to open it
({CORTEZA_PULL_BASE}1583[`1583`]).
* Added interpolation to block titles and descriptions, IFrame block url, Automation block button labels, Content block body and metric block transformation functions.
The change was added to allow the user to use record and other variables in relevant places
({CORTEZA_PULL_BASE}1590[`1590`]).

.[#2023_09_02-changed]#<<2023_09_02-changed,Changed:>>#
* Changed error message when saving a record with a workflow to include meta data about the issue.
The change was made to provide the user with more information about the issue and how to resolve it
({CORTEZA_PULL_BASE}1571[`1571`]).
* Changed default module duplication detection rules to be empty instead of populated with an empty constraint.
The change was made to improve performance for all modules and improve UX readability
({CORTEZA_PULL_BASE}1586[`1586`]).

.[#2023_09_02-fixed]#<<2023_09_02-fixed,Fixed:>>#
* Fixed charts breaking when `y-axis` or `both` timeline chart options are selected while minimum and/or maximum y-axis values are set
({CORTEZA_PULL_BASE}1584[`1584`]).
* Fixed not able to export a namespace because it contains reference of deleted resource translations
({CORTEZA_COMMIT_BASE}1d54026[`1d54026`]).
* Fixed DAL schema alterations generating incorrect attribute identifiers when attempting to alter to column.
The fix was made taking attribute store codec into account when generating DDL queries
({CORTEZA_COMMIT_BASE}3e1d7bd[`3e1d7bd`]).
* Fixed record revisions not saving after resolving DAL schema alterations involving the corresponding record revision schema.
The fix was made by properly presenting, processing, and reloading all relevant models
({CORTEZA_COMMIT_BASE}33821dd[`33821dd`]).
* Fixed changing module field store encoding type breaking the module from storing or presenting any data
({CORTEZA_COMMIT_BASE}33821dd[`33821dd`]).
* Fixed drill down filter linked to a record list not being overwritten when a new drill down filter is added
({CORTEZA_COMMIT_BASE}33821dd[`33821dd`]).


# src/modules/ROOT/pages/changelog/202309/03.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.3`

*Released on*: `2024.02.14`

.[#2023_09_03-added]#<<2023_09_03-added,Added:>>#
* Added the ability to export record fields.
The change was added to allow users to easily export record fields
({CORTEZA_COMMIT_BASE}3ed3b1e[`3ed3b1e`]).
* Added light and dark themes as well as the ability to set custom colors for theming variables.
Added the option to set a branding color when configuring a page block, record field or reporter metric.
The change was added to provide the user with more freedom to customize {PRODUCT_NAME}
({CORTEZA_PULL_BASE}1579[`1579`], {CORTEZA_PULL_BASE}1671[`1671`]).
* Added missing `Manage schema alterations` translations in {APP_NAME_ADMIN}'s System component permissions
({CORTEZA_COMMIT_BASE}82f21b7[`82f21b7`]).
* Added generic optimisations to the workflow execution engine, ID generation, and access control evaluation
({CORTEZA_COMMIT_BASE}49e72cb[`49e72cb`]).

.[#2023_09_03-changed]#<<2023_09_03-changed,Changed:>>#
* Changed the color of the alert for deleting a record from turquaz to yellow.
The change was made to better fit the {PRODUCT_NAME} UI
({CORTEZA_PULL_BASE}1634[`1634`]).
* Changed delimiter class for multi value fields to show values into new lines instead of spaces.
The change was made to be consistent with the rest of {PRODUCT_NAME} UI
({CORTEZA_COMMIT_BASE}d82c5e6[`d82c5e6`]).
* Changed how sorting looks across webapps to match the UI in {APP_NAME_COMPOSE}.
The change was made to standardize how sorting looks in all webapps
({CORTEZA_PULL_BASE}1634[`1634`]).

.[#2023_09_03-removed]#<<2023_09_03-removed,Removed:>>#
* Removed social feed block from {APP_NAME_COMPOSE} block selector
({CORTEZA_COMMIT_BASE}e9bf3d0[`e9bf3d0`]).
* Removed deprecated code from messagebus
({CORTEZA_COMMIT_BASE}0346f90[`0346f90`]).

.[#2023_09_03-fixed]#<<2023_09_03-fixed,Fixed:>>#
* Fixed mapObject undefined error in the developer console in {APP_NAME_REPORTER} when navigating to another page
({CORTEZA_COMMIT_BASE}db2bdf3[`db2bdf3`]).
* Fixed hardcoded year value on server
({CORTEZA_COMMIT_BASE}3bb5dd9[`3bb5dd9`]).
* Fixed search bar changing its width while it's being used
({CORTEZA_COMMIT_BASE}9629b83[`9629b83`]).
* Fixed not being abel to create records that have a single digit record selector field
({CORTEZA_COMMIT_BASE}c11165e[`c11165e`]).
* Fixed newly added sub-workflows failing to execute with a not found error.
The fix was made by properly updating internal indexes
({CORTEZA_COMMIT_BASE}405ab13[`405ab13`]).
* Fixed undefined namespaceID when viewing list of namespaces
({CORTEZA_PULL_BASE}1603[`1603`]).
* Fixed permissions modal not properly evaluating already selected roles/users
({CORTEZA_PULL_BASE}1603[`1603`]).
* Fixed incorrect evaluation of {APP_NAME_COMPOSE} permissions
({CORTEZA_PULL_BASE}1603[`1603`]).
* Fixed unnecessary triggering of unsaved changes when a field is empty and hasn't been edited
({CORTEZA_COMMIT_BASE}d614a00[`d614a00`]).
* Fixed not being able to switch aggregation operation when defining new metric
({CORTEZA_COMMIT_BASE}f6d3702[`f6d3702`]).
* Fixed page layout switching to default configuration after preforming toolbar actions for a record
({CORTEZA_PULL_BASE}1655[`1655`]).
* Fixed unable to save a record if it's present in multiple layouts and inline editing of record list is enabled
({CORTEZA_PULL_BASE}1655[`1655`]).
* Fixed {APP_NAME_COMPOSE} permissions set in {APP_NAME_ADMIN} not displayed correctly in the {APP_NAME_COMPOSE} app
({CORTEZA_PULL_BASE}1633[`1633`]).
* Fixed invalid prop console error when editing a user or record field
({CORTEZA_PULL_BASE}1675[`1675`]).
* Fixed `created at` field showing `0` instead of user id in {APP_NAME_ADMIN} for `federation node`, `workflows`, `message queues`, and `auth clients` resources
({CORTEZA_COMMIT_BASE}96f7da8[`96f7da8`]).


# src/modules/ROOT/pages/changelog/202309/04.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.4`

*Released on*: `2024.02.26`

.[#2023_09_04-added]#<<2023_09_04-added,Added:>>#
* Added the close button to all workflow prompts.
The change was added to allow users to cancel workflows/prompts
({CORTEZA_COMMIT_BASE}3708ca9[`3708ca9`]).

.[#2023_09_04-fixed]#<<2023_09_04-fixed,Fixed:>>#
* Fixed workflow record selector prompt dropdown appearing behind the prompt, rendering it unusable
({CORTEZA_COMMIT_BASE}27e142c[`27e142c`]).
* Fixed required fields asterisk not being displayed next to the label of the field in record blocks
({CORTEZA_COMMIT_BASE}65832b4[`65832b4`]).
* Fixed incorrect value applying to date and time record field when trying to remove an already set value
({CORTEZA_COMMIT_BASE}6fe0b8a[`6fe0b8a`]).
* Fixed unnecessary showing of stale data warning in {APP_NAME_COMPOSE} while editing and loading a record
({CORTEZA_COMMIT_BASE}070e751[`070e751`]).
* Fixed {PRODUCT_NAME} refusing to start when upgrading with alterations to the default {APP_NAME_COMPOSE} records schema.
The fix was made by allowing alterations to be logged for the default schema but continue blocking them from being applied
({CORTEZA_COMMIT_BASE}b389d50[`b389d50`]).
* Fixed warning message for no matching layout after saving a record that conflicts with visibility condition of that layout
In some cases, the user wasn't able to access any layout or was redirected to the list of namespaces
({CORTEZA_COMMIT_BASE}57a307e[`57a307e`]).
* Fixed select inputs that were using the api for search (User, Workflow) did't work properly
({CORTEZA_COMMIT_BASE}01bd594[`01bd594`]).
* Fixed user list endpoint with empty userID parameter throwing an error on PostgreSQL
({CORTEZA_COMMIT_BASE}566ff41[`566ff41`]).

.[#2023_09_04-security]#<<2023_09_04-security,Security:>>#
* Addressed security vulnerabilities caused by dependencies across all web applications.
This was done by upgrading packages to a more stable versions and removing unused dependencies causing vulnerabilities
({CORTEZA_COMMIT_BASE}5f890d9[`5f890d9`]).


# src/modules/ROOT/pages/changelog/202309/05.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.5`

*Released on*: `2024.03.21`

.[#2023_09_05-added]#<<2023_09_05-added,Added:>>#
* Added the option to access user information from xref:integrator-guide:expressions/type-reference.adoc#objref-user[User values] in pages, charts, and record fields.
The change was added to provide an easier way for the user to access their user data
({CORTEZA_PULL_BASE}1735[`1735`]).
* Added support for User and Record fields to be exported/imported on the record list page block
({CORTEZA_COMMIT_BASE}7fc4ca9[`7fc4ca9`]).
* Added the option to open a link/route/record page in a new tab using {APP_NAME_WORKFLOW} prompts
({CORTEZA_PULL_BASE}1726[`1726`]).

.[#2023_09_05-changed]#<<2023_09_05-changed,Changed:>>#
* Changed the flow of updating values in fields and page blocks to fetch the latest values after an update.
The change was made to ensure fields and blocks are always up to date
({CORTEZA_PULL_BASE}1634[`1634`]).

.[#2023_09_05-removed]#<<2023_09_05-removed,Removed:>>#
* Removed Nylass page block.
The removal was made because Nylass stopped using the functionality implemented in {PRODUCT_NAME}
({CORTEZA_COMMIT_BASE}77169cf[`77169cf`]).

.[#2023_09_05-fixed]#<<2023_09_05-fixed,Fixed:>>#
* Fixed not being able to upload `png` file to an application in {APP_NAME_ADMIN}
({CORTEZA_COMMIT_BASE}0456fe4[`0456fe4`]).
* Fixed not being able to make a copy of predefined CRM namespace
({CORTEZA_COMMIT_BASE}55a827a[`55a827a`], {CORTEZA_PULL_BASE}1729[`1729`]).
* Fixed not being able to add a record in a duplicated CRM namespace because page layout wasn't created when the namespace was cloned
({CORTEZA_PULL_BASE}1717[`1717`]).
* Fixed workflow session list throwing internal errors when using postgres database.
The fix was made properly omitting invalid/blank slices in filters
({CORTEZA_COMMIT_BASE}74031ca[`74031ca`]).
* Fixed prompt submissions always being treated as `Untyped` by running a type resolution step before applying to the scope
({CORTEZA_COMMIT_BASE}772d03e[`772d03e`]).


# src/modules/ROOT/pages/changelog/202309/06.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.6`

*Released on*: `2024.04.25`

.[#2023_09_06-added]#<<2023_09_06-added,Added:>>#
* Added `id` system field to user information in {APP_NAME_ADMIN}
({CORTEZA_COMMIT_BASE}d81809c[`d81809c`], {CORTEZA_COMMIT_BASE}14b704f[`14b704f`]).
* Added `cancel` status filter to automation session list in {APP_NAME_ADMIN}
({CORTEZA_COMMIT_BASE}c0d43df[`c0d43df`]).

.[#2023_09_06-changed]#<<2023_09_06-changed,Changed:>>#
* Changed the updating mechanism of charts to trigger when the user creates and updates a chart.
The change was made to keep chart up to date with its latest configuration
({CORTEZA_COMMIT_BASE}ad95e6a[`ad95e6a`]).
* Changed chart tooltip structure to be consistent in {APP_NAME_COMPOSE} and {APP_NAME_REPORTER}.
The change was made to implement a standard across all web applications that use charts
({CORTEZA_COMMIT_BASE}91a7a59[`91a7a59`]).

.[#2023_09_06-fixed]#<<2023_09_06-fixed,Fixed:>>#
* Fixed not being able to filter data by `userID` when viewing a record in a record list using the drill down option
({CORTEZA_COMMIT_BASE}8d2ccea[`8d2ccea`]).
* Fixed not being able to see all users assigned to a role in {APP_NAME_ADMIN}
({CORTEZA_COMMIT_BASE}9cc3a9c[`9cc3a9c`]).
* Fixed record page not loading when navigating to a new record from the create record view
({CORTEZA_COMMIT_BASE}9c07c90[`9c07c90`]).
* Fixed not being able to set the SMTP password in {APP_NAME_ADMIN} because it was removed mistakenly
({CORTEZA_COMMIT_BASE}96a7fd6[`96a7fd6`]).
* Fixed not being able to use drill down on `select`, `record`, and `user` fields
({CORTEZA_COMMIT_BASE}cf8de0f[`cf8de0f`]).
* Fixed double fetching of record list configuration after drill down data is updated
({CORTEZA_COMMIT_BASE}5a4f934[`5a4f934`]).
* Fixed multi-line option not working for module text fields
({CORTEZA_PULL_BASE}1770[`1770`]).
* Fixed duplicate field name causing module configuration issues
({CORTEZA_PULL_BASE}1773[`1773`]).
* Fixed workflow not redirecting the user to the next record after saving the current record
({CORTEZA_PULL_BASE}1775[`1775`]).
* Fixed record id shown instead of label by default
({CORTEZA_PULL_BASE}1776[`1776`]).
* Fixed incorrect boolean labels and value shown in charts
Fixed metric label in tooltips to show the field `title` instead of the field `name`
({CORTEZA_COMMIT_BASE}447e6fa[`447e6fa`]).
* Fixed incorrect record shown when workflow function for fetching the first or the last record is used
({CORTEZA_COMMIT_BASE}7b29b80[`7b29b80`]).
* Fixed incorrect redirecting to record view when a workflow prompt is used
({CORTEZA_COMMIT_BASE}e766b4b[`e766b4b`]).
* Fixed redirecting between record view and record edit mode in {APP_NAME_COMPOSE}
({CORTEZA_COMMIT_BASE}60376b7[`60376b7`]).


# src/modules/ROOT/pages/changelog/202309/07.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.7`

*Released on*: `2024.06.14`

.[#2023_09_07-added]#<<2023_09_07-added,Added:>>#
* Added the option to stack values of multiple number fields in {APP_NAME_REPORTER} chart
({CORTEZA_PULL_BASE}1780[`1780`]).
* Added the option to clone a report in {APP_NAME_REPORTER}
({CORTEZA_PULL_BASE}1748[`1748`]).
* Added the option to provide an `id` and `class` attributes to a page block in {APP_NAME_COMPOSE}.
These can be referenced in {PRODUCT_NAME} Studio for styling
The change was added to provide more ways for selecting and customizing a page block
({CORTEZA_PULL_BASE}1811[`1811`]).
* Added the option to link a record page module field and record list module field in record configurator.
The change was added to automatically populate fields when adding a related record
({CORTEZA_PULL_BASE}1811[`1811`]).
* Added the option to provide prefix, suffix, digit formatting, and accounting number format in charts and number module fields
({CORTEZA_PULL_BASE}1820[`1820`], {CORTEZA_COMMIT_BASE}c73b843[`c73b843`]).

.[#2023_09_07-changed]#<<2023_09_07-changed,Changed:>>#
* Changed the topbar icon for redirecting the user to the list of applications to a button with text `Menu`
({CORTEZA_COMMIT_BASE}ad95e6a[`ad95e6a`]).

.[#2023_09_07-removed]#<<2023_09_07-removed,Removed:>>#
* Removed welcome tour in {APP_NAME_SHELL}
({CORTEZA_PULL_BASE}1811[`1811`]).

.[#2023_09_07-fixed]#<<2023_09_07-fixed,Fixed:>>#
* Fixed list of filters partially hidden behind the left navigation when no buttons are shown in a record list
({CORTEZA_COMMIT_BASE}719b421[`719b421`]).
* Fixed not able to login via multi factor authentication because of an internal error in the multi factor authentication code
({CORTEZA_PULL_BASE}1802[`1802`]).
* Fixed record list filter closing after deleting its last item
({CORTEZA_PULL_BASE}1811[`1811`]).
* Fixed chart tooltip not hiding after cursor is moved away from the chart
({CORTEZA_PULL_BASE}1811[`1811`]).
* Fixed module field unique value constraints not being respected when adding/modifying a record
({CORTEZA_PULL_BASE}1434[`1434`]).
* Fixed false fetching of the value 20 from a record when using a workflow to retrieve an empty date time field
({CORTEZA_COMMIT_BASE}fd7b018[`fd7b018`]).
* Fixed record toolbar buttons being disabled after the user tries to create a record without adding value to a required field
({CORTEZA_PULL_BASE}1811[`1811`]).
* Fixed bottom part of page being cut off for iOS devices on all applications
({CORTEZA_PULL_BASE}1520[`1520`]).


# src/modules/ROOT/pages/changelog/202309/08.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2023.9.8`

*Released on*: `2024.08.30`

.[#2023_09_08-added]#<<2023_09_08-added,Added:>>#
* Added the option to write custom javascript code in {APP_NAME_ADMIN}.
The change was added to provide the user with the ability to add custom javascript code
({CORTEZA_PULL_BASE}1887[`1887`]).

.[#2023_09_08-fixed]#<<2023_09_08-fixed,Fixed:>>#
* Fixed page blocks not respecting current position after being moved
({CORTEZA_PULL_BASE}1896[`1896`]).
* Fixed importing an existing record as 'csv' creates a new record instead of updating the existing one
({CORTEZA_PULL_BASE}1886[`1886`]).
* Fixed user field values shown as 'undefined' instead of their original value
({CORTEZA_COMMIT_BASE}7c17708[`7c17708`]).
* Fixed allowing duplicate values for 'user' and 'record' multi value fields not working
({CORTEZA_PULL_BASE}1882[`1882`]).
* Fixed not being able to sort date time fields due to Postgres database limitation
({CORTEZA_PULL_BASE}1843[`1843`]).
* Fixed showing of empty options in select field if that field doesn't have a label set
({CORTEZA_PULL_BASE}1866[`1866`]).
* Fixed not being able to access user data in {APP_NAME_COMPOSE} added from a workflow
({CORTEZA_PULL_BASE}1883[`1883`]).
* Fixed multiple value fields not shown in charts
({CORTEZA_PULL_BASE}1895[`1895`]).
* Fixed incorrect updating of date and time only field values when editing a record
({CORTEZA_COMMIT_BASE}3b2d5b6[`3b2d5b6`]).
* Fixed not being able to update a required field if the user doesn't have read permissions for the field
({CORTEZA_PULL_BASE}1892[`1892`]).


# src/modules/ROOT/pages/changelog/202309/index.adoc

include::ROOT:partial$variables.adoc[]

[#2023-9-x]
= `2023.9`

With {PRODUCT_NAME} `2023.9`, we focus primarily on user interface and customization -- both the user interface and data storage flexibility making {PRODUCT_NAME} easier to configure for a wide range of applications.

*{PRODUCT_NAME} Studio*

*{PRODUCT_NAME} studio* enables you to style user interfaces for all of our applications.
It enables simple tweaks like changing the colorscheme or large modifications like swapping out the entire stylesheet.
*{PRODUCT_NAME} studio* enables you to modify {PRODUCT_NAME} applications to better fit your brand guidelines.

*DAL Schema Alterations*

*DAL schema alterations* simplify the process of configuring custom storage solutions for your data.
When we reworked our storage layer, we made it possible to store your records in dedicated tables or even databases.
With `2023.9` we introduce an automated mechanism to alter the storage location for it to support the module definition.

*UI Touchups*

User interfaces were a big focus for the `2023.9` release; improving user experience when configuring and interacting with your application, as well as laying the groundwork for future releases.

.Administration:
* Added tooltips to hint how to improve performance.

:leveloffset: +1

include::08.gen.adoc[]

include::07.gen.adoc[]

include::06.gen.adoc[]

include::05.gen.adoc[]

include::04.gen.adoc[]

include::03.gen.adoc[]

include::02.gen.adoc[]

include::01.gen.adoc[]

include::00.gen.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/202409/00.gen.adoc

include::ROOT:partial$variables.adoc[]

= `2024.9.0`

*Released on*: `2024.12.02`

.[#2024_09_00-added]#<<2024_09_00-added,Added:>>#
* Added the ability to open records directly in edit mode.
The change was added to streamline record editing by bypassing the view mode
({CORTEZA_COMMIT_BASE}18243a4[`18243a4`]).
* Added multiple methods for adding new records.
The change was added to enhance flexibility by supporting addition in the same tab, a new tab, or a modal
({CORTEZA_COMMIT_BASE}c0fd421[`c0fd421`]).
* Added the option to specify text field wrapping in record lists.
The change was added to provide better control over text display in record lists
({CORTEZA_COMMIT_BASE}005f698[`005f698`]).
* Added visibility conditions for page blocks.
The change was added to allow dynamic control over when page blocks are displayed
({CORTEZA_COMMIT_BASE}77c1838[`77c1838`]).
* Added autocompletion in expression editors, workflow text editors, and the branding CSS editor.
The change was added to simplify editing by providing suggestions during input
({CORTEZA_COMMIT_BASE}5e2f280[`5e2f280`]).
* Added the ability to add new records from Record Selector editor fields.
The change was added to improve efficiency by enabling direct record creation from the Record Selector
({CORTEZA_COMMIT_BASE}5f94d59[`5f94d59`]).
* Added the ability to configure record list filters using the record filter UI.
The change was added to provide a more intuitive method for setting up record list filters
({CORTEZA_COMMIT_BASE}3ebb8ac[`3ebb8ac`]).
* Added the ability to configure field wrapping in record blocks.
The change was added to allow users to control whether fields in record blocks wrap or remain on a single line
({CORTEZA_COMMIT_BASE}a1e1b2d[`a1e1b2d`]).
* Added tables in the rich text editor.
The change was added to enable the use of tables for structured content in rich text
({CORTEZA_COMMIT_BASE}0322717[`0322717`]).
* Added the ability to disable save notifications on record pages.
The change was added to provide a cleaner user experience by hiding save notifications when saving records
({CORTEZA_COMMIT_BASE}b744202[`b744202`]).
* Added inline filtering for record list blocks based on record values.
The change was added to simplify filtering by allowing users to filter lists without manually typing values
({CORTEZA_COMMIT_BASE}a3b9b9a[`a3b9b9a`]).
* Added live filters for chart blocks.
The change was added to allow users to filter charts directly without needing to edit them
({CORTEZA_COMMIT_BASE}bd28b34[`bd28b34`]).
* Added permissions for exporting namespaces, modules, and charts.
The change was added to control who has the ability to export data.
NOTE: Review and adjust permissions after upgrading..

.[#2024_09_00-changed]#<<2024_09_00-changed,Changed:>>#
* Changed the user experience for record list filters
({CORTEZA_COMMIT_BASE}73b12d6[`73b12d6`]).
* Changed general UI/UX enhancements:
** Updated styles for simple lists (eg, module fields, select options)
** Standardized cancel buttons in modals
** Standardized restore and suspend button styles
** Unified confirmation button components
({CORTEZA_COMMIT_BASE}38c145d[`38c145d`], {CORTEZA_COMMIT_BASE}57c2cd5[`57c2cd5`], {CORTEZA_COMMIT_BASE}a1d116b[`a1d116b`], {CORTEZA_COMMIT_BASE}97b966e[`97b966e`]).

.[#2024_09_00-removed]#<<2024_09_00-removed,Removed:>>#
* Removed CRM and Service Solution apps from the default deployment
({CORTEZA_COMMIT_BASE}a036786[`a036786`]).


# src/modules/ROOT/pages/changelog/202409/index.adoc

include::ROOT:partial$variables.adoc[]

[#2024-9-x]
= `2024.9`

With {PRODUCT_NAME} `2024.9`, we’ve focused on enhancing the core functionality of {PRODUCT_NAME} by introducing new options for greater customization.

We’ve also streamlined low-code development with the addition of intelligent code suggestions for expression inputs, available in both Compose and Workflows.

Looking ahead, we plan to expand these features with even more robust suggestions.

:leveloffset: +1

include::00.gen.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/archive/202006.adoc

include::partial$variables.adoc[]

= 2020.6

== {PRODUCT_NAME} Server

.Changes:
* Refactored how application (server, cli tools) is started to allow more modular service initialization.
* Improved security when using {PRODUCT_NAME} CLI.
* Improved input handling when managing settings from CLI.
* Improved automation script triggering with eventbus package.
* Improved scheduled & deferred automation with scheduler package.
* Upgraded all internal automation logic.
* Added code generator for events.
* Implemented event triggering (through eventbus) on, before and after all core points (resource creation, update, delete, login etc).
* More robust automation script triggering through REST API endpoints.
* Cleanup, refactor application options.
* Added tools that allow exporting of old automation scripts.
* Added ability to serve frontend code bundles.
* Routed sink & mail events via new eventbus.
* Added client/server certificates for gRPC (experimental).
* Allowed automation scripts to return full response objects (body, headers) on sink requests.
* Supported bulk record removal.
* Used `cortezaproject/corteza-ext` instead of `cortezaproject/corteza-config` for initial provisioning.
* Full implementation of record value sanitization and filtering for all field types.
* Enabled (previously experimental) private data (user's email & name) masking.
* Record exporting now includes system fields.
* Improve stability (db, concurrent processes).
* Better support for timezones.
* Action (audit) log.
* Support signature-in-path for sink endpoint.
* Upgrade to go 1.14.

.Contributors:
. Denis Arh
. Tomaž Jerman

== {PRODUCT_NAME} {APP_AUTOMATION} Automation Server

.Changes:
* Ported to TypeScript.
* Added ability to bundle (via webpack) frontend scripts on the fly.
* Scripts (code) is no longer transferd over the wire but stored on filesystem accessible by {PRODUCT_NAME}.
* Restructured scripts (wraped in a method) to allow (unit) testing.
* Added ability to install dependencies (through yarn) on the fly.
* Improved ability to capture log output from scripts.
* Added ability to load (3rd party) scripts as extensions and overload them if needed.
* Improved input/output data encode/decode procedures.

.Contributors:
. Denis Arh
. Peter Grlica
. Tomaž Jerman

== {PRODUCT_NAME} Web applications (clients)

.General changes:
* Split `corteza-webapp-common` to `corteza-vue` and `corteza-js` and port most of the code to TypeScript.
* Various minor UI improvements on all frontend clients.
* Added support for new automation scripts on clients.
* Added support for UI hooks (placeholders for buttons, generated from manual automation scripts).

.{APP_NAME_COMPOSE} changes:
* Added ability to clone records.
* Refactored page blocks & module field components.
* Improved page grid rendering and UI.
* Improved client-side record value validation.
* Improved record-list block, add support for (multi) selection.
* Improve page-block selector on page builder.
* Mayor performance improvements (through Object.freeze).
* Chart improvements, support for funnel and gauge types.
* More powerful record list block.
* Added Metric page block.
* Added record browser tool for admins.

.Contributors:
. Denis Arh
. Tomaž Jerman
. Jože Fortun
. Peter Grlica
. Mia Arh


# src/modules/ROOT/pages/changelog/archive/202009.adoc

include::partial$variables.adoc[]

= 2020.9

== {PRODUCT_NAME} Server

.Changes:
* Add `SMTP_TSL_INSECURE` and `SMTP_TSL_SERVER_NAME` for better SMTP TSL control.
* Replace `PROVISION_MIGRATE_DATABASE` and `PROVISION_CONFIGURATION` with `UPGRADE_ALWAYS`.
* Mail/smtp improvements: default sender, TSL, healthcheck).
* External authentication fixed (due to initialization order).
* Improve setting value decoding & conversion that caused crashes on startup.
* Use gin for server reloading (dev-env, replacement for realize tool).
* First step in migration to OpenAPI, server API docs under /docs.
* Improve buildtime/version information.
* Add support for user impersonation.
* Allow in-path signature for sink.
* Severity on actions & errors (actionlog definitions) tweaked.
* Various importer fixes and improvements.
* Various record input sanitization fixes.
* Optimize database transaction settings and use.
* Add health check service & API endpoints.
* Compose config importer/exporter fixed & improved (fields, charts, moduel resolving).
* More flexible actionlog configuration, added logging policies.
* Fix page reordering on the root node.
* Upgrade all provisioned config, "Service Cloud" renamed to "Case Management".
* All *after events are no longer async; service waits for results.

.Contributors:
. Denis Arh
. Tomaž Jerman
. Jože Fortun

== {PRODUCT_NAME} Web applications (clients)

.{APP_NAME_COMPOSE} changes:
* Add missing error fields.
* File upload/preview component fixes.
* Number field formatter fixes.
* Pagination for user & record fields.


.{APP_NAME_ADMIN} changes:
* Fixes for auditlog, application editor.
* Improve automation script listing.

.Contributors:
. Denis Arh
. Tomaž Jerman
. Jože Fortun

== {PRODUCT_NAME} extensions

.{PRODUCT_NAME} Service Cloud:
* Rename to Case Management.

.{PRODUCT_NAME} CRM:
* Improve campaigns to keep track of related leads, contacts, accounts, all opportunities, won opportunities and the aggregated opportunity amount.
* Update lead and account conversion buttons to keep track of the associated campaigns.
* Improve account - create new contact button to redirect to the created contact in edit mode.
* Improve account - create new case button to redirect to the created case in edit mode.
* Remove quote - submit for approval and quote - approve buttons.

.Contributors:
. Lenny Horstink
. Jože Fortun
. Tomaž Jerman
. Denis Arh


# src/modules/ROOT/pages/changelog/archive/202012.adoc

include::partial$variables.adoc[]

[#2020-12-x]
= 2020.12

== {PRODUCT_NAME} Server

.Changes:
* Central importing and exporting subsystem "Envoy" with capabilities to resolve conflicts, dependencies and tak in various data formats.
* Provisioning (based on Envoy) now allows full customization of content to be provisioned.
* Field value expressions (formula fields, custom validators).
* Resource labels (key-value meta data for filtering and tagging resource with arbitraty strings).
* Frontend web applications can now be served directly from server (reduces number of containers).
* API documentation (now as OpenAPI 3) is now served directly from server.
* Upgrade to go v1.15.
* Simplified architecture and internal cross-service comm (no more support for spearated builds for system, messaging and compose).
* Error creation and handling now allows more verbosity and detail in dev and production mode.
* Cleanup codegen tools and unified all codegen under one package and single strategy.
* Replaced rebuild-on-change dev tool (`realize`) with gin (`github.com/codegangsta/gin`).
* Replace internal node.js dev tools for reloading (where not gin) with fswatch.
* Moved and refactored RBAC package (was "permissions").
* Rewritten store ([.line-through]#repository#) layer for flexibility.
* Add support for PostgreSQL and MySQL.
* SQLite3 in-memory replaces MySQL as a default database Corteza.
* Removed organizations data structures, references and (db) tables.
* Ported `pkg/rh` to  `pkg/filters`, removed obsolete "repository-handler" code.
* Moved from SQL based database migrations to code-based migrations.
* Replace offset with key-based pagination.
* Experimental support for federated compose records.
* Experimental support for SCIM protocol.

[WARNING]
====
Database tables (`\*\_settings`, `*_permissions`, `sys_*`) are renamed, merged and/or removed.
Database schema upgrade is irreversible.
Make sure you backup your data before doing an upgrade.
====

.Contributors:
. Denis Arh
. Tomaž Jerman
. Jože Fortun
. Peter Grlica
. Urban Klinc

== Patches

[cols="1s,5a,2a"]
|===
|Version |Description |Contributors

| [#2020-12-1]#<<2020-12-1,2020.12.1>>#
| Stability and performance update.
|
. Jože Fortun
. Denis Arh
. Peter Grlica


|===


# src/modules/ROOT/pages/changelog/archive/index.adoc

include::partial$variables.adoc[]

= Release archive

:leveloffset: +1

include::202012.adoc[]

include::202009.adoc[]

include::202006.adoc[]

:leveloffset: -1


# src/modules/ROOT/pages/changelog/index.adoc

include::partial$variables.adoc[]

= Changelog

The format is based on https://keepachangelog.com/en/1.0.0/[Keep a Changelog], and this project adheres to https://calver.org/[Calendar Versioning].

:leveloffset: +1

include::202309/index.adoc[]

:leveloffset: -1

== Older releases

Refer to the xref:changelog/archive/index.adoc[archive] for older {PRODUCT_NAME} releases.


# src/modules/ROOT/pages/index.adoc

include::partial$variables.adoc[]

= {PRODUCT_NAME}
:description: {PRODUCT_NAME} is an open-source, self-hosted Low-Code Development Platform.
:keywords: {PRODUCT_NAME}, documentation, open-source, self-hosted, low-code platform

{PRODUCT_NAME} is an open-source, self-hosted Low-Code Development Platform built upon modern technologies.
{PRODUCT_NAME} is secure with a powerful access control system, allowing fine-grained permission definition.

{PRODUCT_NAME} aims to be *indisputably trustworthy* in its motivations and its approach to design, development and maintenance of the platform.
Organisations should feel that their chosen digital work platform is always *under their control*, always *protected* and continuously *developed in their best interests*.

[NOTE]
====
Questions?
Check out https://{DOMAIN}[our homepage] or https://forum.{DOMAIN}[get in touch with us].
====

== Installing {PRODUCT_NAME}

[WARNING]
====
include::devops-guide:partial$warnings/sqlite.adoc[]
====

The xref:devops-guide:index.adoc[] takes you through the installation process for xref:devops-guide:index.adoc#deploy-offline[demo/development environments] and xref:devops-guide:index.adoc#deploy-online[production-like environments].

The DevOps guide also provides some miscellaneous bits, such as xref:devops-guide:references/configuration/server.adoc[system] and xref:devops-guide:references/configuration/corredor.adoc[{APP_AUTOMATION}] configuration references, additional xref:devops-guide:examples/deploy-offline/index.adoc[offline deployment examples], xref:devops-guide:examples/deploy-online/index.adoc[online deployment examples], xref:devops-guide:maintenance/backups.adoc[data backups], and xref:devops-guide:troubleshooting/index.adoc[troubleshooting].

[NOTE]
====
Out of the box we support any system that can run Docker.
If you wish to deploy {PRODUCT_NAME} elsewhere (for example, bare metal) you will need to compile your own binaries.

*DevNote* add some documentation regarding source compiling.
====

// == Learning {PRODUCT_NAME}

// The xref:end-user-guide:index.adoc[] covers *all {PRODUCT_NAME} applications*, their *features*, and *how to use* them.
// We've designed the application end-user guide to be easily understandable by non-techy people, so you don't need to be a field expert.

// .Here are a few shortcuts:
// * xref:end-user-guide:crm/index.adoc[]
// * xref:end-user-guide:case-management/index.adoc[]
// * xref:end-user-guide:shell/index.adoc[]

== Create with {PRODUCT_NAME}

The xref:integrator-guide:index.adoc[] walks you *through the integration process*; from xref:integrator-guide:security-model/index.adoc[] system to xref:integrator-guide:compose-configuration/index.adoc[], xref:integrator-guide:automation/index.adoc[], xref:integrator-guide:reporting/index.adoc[], and xref:integrator-guide:api-gw/index.adoc[].

The Low-Code platform developer guide also covers xref:integrator-guide:authentication/index.adoc[] and xref:integrator-guide:security-model/index.adoc[]

There are also a bunch of copy-pastable examples, and miscellaneous bits such as xref:integrator-guide:automation/automation-scripts/deploying.adoc[], xref:integrator-guide:automation/automation-scripts/debugging.adoc[automation script debugging] and tips for xref:integrator-guide:accessing-corteza/index.adoc[].

// == Core developers

// Hi -- xref:developer-guide:index.adoc[]

// [NOTE]
// ====
// The platform developer guide should provide enough abstract overview to help you get started.
// The guide is fairly... !complete so feel free to get in touch with us if you're stuck.
// ====

// *DevNode* link the new messaging platform

== Upgrading {PRODUCT_NAME}

[IMPORTANT]
====
When upgrading, you should always firstly go over the xref:ROOT:changelog/index.adoc[] and the xref:upgrade-guide:index.adoc[].

Versions may *not be backwards compatible* and may need some additional work to get setup.
====

To upgrade from `2022.9`, you can use xref:ROOT:changelog/202303/index.adoc[this changelog] and xref:upgrade-guide:index.adoc[this upgrade guide].

You can find all of the changelogs xref:ROOT:changelog/index.adoc[here], and all of the upgrade guides xref:upgrade-guide:index.adoc[here].


# src/modules/ROOT/partials/icons.adoc

:ICON_WORKFLOW_BREAK: image:ROOT:workflows/break.svg[width=20px]
:ICON_WORKFLOW_COG: image:ROOT:workflows/cog.svg[width=20px]
:ICON_WORKFLOW_CONTINUE: image:ROOT:workflows/continue.svg[width=20px]
:ICON_WORKFLOW_DEBUG: image:ROOT:workflows/debug.svg[width=20px]
:ICON_WORKFLOW_DELAY: image:ROOT:workflows/delay.svg[width=20px]
:ICON_WORKFLOW_ERROR_HANDLER: image:ROOT:workflows/error-handler.svg[width=20px]
:ICON_WORKFLOW_ERROR: image:ROOT:workflows/error.svg[width=20px]
:ICON_WORKFLOW_EXPRESSIONS: image:ROOT:workflows/expressions.svg[width=20px]
:ICON_WORKFLOW_FUNCTION: image:ROOT:workflows/function.svg[width=20px]
:ICON_WORKFLOW_GATEWAYEXCLUSIVE: image:ROOT:workflows/gatewayExclusive.svg[width=20px]
:ICON_WORKFLOW_GATEWAYINCLUSIVE: image:ROOT:workflows/gatewayInclusive.svg[width=20px]
:ICON_WORKFLOW_GATEWAY_PARALLEL: image:ROOT:workflows/gateway_parallel.svg[width=20px]
:ICON_WORKFLOW_GATEWAYPARALLEL: image:ROOT:workflows/gatewayParallel.svg[width=20px]
:ICON_WORKFLOW_PLAY: image:ROOT:workflows/play.svg[width=20px]
:ICON_WORKFLOW_PROMPT: image:ROOT:workflows/prompt.svg[width=20px]
:ICON_WORKFLOW_SWIMLANE: image:ROOT:workflows/swimlane.svg[width=20px]
:ICON_WORKFLOW_TERMINATION: image:ROOT:workflows/termination.svg[width=20px]
:ICON_WORKFLOW_TRIGGER: image:ROOT:workflows/trigger.svg[width=20px]
:ICON_WORKFLOW_ITERATOR: image:ROOT:workflows/iterator.svg[width=20px]
:ICON_WORKFLOW_EXEC_WORKFLOW: image:ROOT:workflows/exec-workflow.svg[width=20px]

:ICON_I18N: image:ROOT:i18n/language-solid.svg[width=20px]

:ICON_DISCOVERY_MAP: image:ROOT:discovery/map-marked-alt-solid.svg[width=20px]
:ICON_DISCOVERY_ICON: image:ROOT:discovery/search-location-solid.svg[width=20px]


# src/modules/ROOT/partials/setup/containerized-db.adoc

[#container-db]
= Setup containerized database

== MySQL

We usually use the https://hub.docker.com/_/percona[Percona] fork of the MySQL database.

.Use the following commands to set up the environment variables; make sure to replace the values if needed:
[source,bash]
----
export DOCKER_NAME=percona;
export ROOT_PWD=root;
export MYSQL_PORT=3306;
----

.To setup the database, perform the following steps:
. `docker run --name $DOCKER_NAME -e MYSQL_ROOT_PASSWORD=$ROOT_PWD -d -p $MYSQL_PORT:3306 percona:8.0;`
. `docker exec -it $DOCKER_NAME mysql -uroot -p$ROOT_PWD;`
. `CREATE DATABASE corteza;`
. `CREATE USER 'corteza'@'172.17.0.1' IDENTIFIED BY 'corteza';`
. `GRANT ALL PRIVILEGES ON corteza.* TO 'corteza'@'172.17.0.1';`
. `FLUSH PRIVILEGES;`

.Use the following template to construct the xref:devops-guide:references/configuration/server.adoc#_db_dsn[`DB_DSN`] `.env` variable:
[source,.env]
----
DB_DSN="corteza:corteza@tcp(localhost:$MYSQL_PORT)/corteza?collation=utf8mb4_general_ci"
----

== PostgreSQL

We usually use the official https://hub.docker.com/_/postgres[PostgreSQL] image.

.Use the following commands to set up the environment variables; make sure to replace the values if needed:
[source,bash]
----
export DOCKER_NAME=pgsql2;
export ROOT_PWD=root;
export PGSQL_PORT=5432;
----

.To setup the database, perform the following steps:
. `docker run --name $DOCKER_NAME -e POSTGRES_PASSWORD=$ROOT_PWD -d -p $PGSQL_PORT:5432 postgres:13;`
. `docker exec -it $DOCKER_NAME psql -U postgres;`
. `CREATE DATABASE corteza;`
. `CREATE USER corteza WITH PASSWORD 'corteza';`
. `GRANT ALL PRIVILEGES ON DATABASE corteza TO corteza;`

.Use the following template to construct the xref:devops-guide:references/configuration/server.adoc#_db_dsn[`DB_DSN`] `.env` variable:
[source,.env]
----
DB_DSN="postgres://corteza:corteza@localhost:$PGSQL_PORT/corteza?sslmode=disable"
----

== SQLServer

[NOTE]
====
This is a draft so these instructions don't get lost; will refine at a later stage.
====

Use one of the following images:

* `SQLServer 2022`: mcr.microsoft.com/mssql/server:2022-latest
* `SQLServer 2017`: mcr.microsoft.com/mssql/server:2017-latest
* `SQLServer 2019`: mcr.microsoft.com/mssql/server:2019-CU10-ubuntu-20.04


.Example docker-compose for all three images:
[source,yaml]
----
  mssql_2022:
    image: mcr.microsoft.com/mssql/server:2022-latest
    restart: on-failure
    ports: [ "127.0.0.1:1433:1433" ]
    volumes:
      - "dbdata_mssql_2022:/var/opt/mssql"
    environment:
        - ACCEPT_EULA=Y
        - SA_PASSWORD=SUPERSECRET123

  mssql_2017:
    image: mcr.microsoft.com/mssql/server:2017-latest
    restart: on-failure
    ports: [ "127.0.0.1:1433:1433" ]
    volumes:
      - "dbdata_mssql_2017:/var/opt/mssql"
    environment:
        - ACCEPT_EULA=Y
        - SA_PASSWORD=SUPERSECRET123

  mssql_2019:
    image: mcr.microsoft.com/mssql/server:2019-CU10-ubuntu-20.04
    restart: on-failure
    ports: [ "127.0.0.1:1433:1433" ]
    volumes:
      - "dbdata_mssql_2019:/var/opt/mssql"
    environment:
        - ACCEPT_EULA=Y
        - SA_PASSWORD=SUPERSECRET123
----

.To setup the database, perform the following steps:
. `docker compose exec -it mssql_2022 sh`
. /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P "SUPERSECRET123"
. `CREATE DATABASE corteza;`
. `GO`

Example DB DSN: `sqlserver://sa:SUPERSECRET123@localhost:1433?database=corteza`


# src/modules/ROOT/partials/variables.adoc

:VERSION: {PAGE-VERSION}.x

:APP_NAME_SHELL: One
:APP_NAME_AUTH: Auth
:APP_NAME_ADMIN: Admin
:APP_NAME_COMPOSE: Low Code
:APP_NAME_REPORTER: Reporter
:APP_NAME_WORKFLOW: Workflow
:APP_NAME_FEDERATION: Federation
:APP_NAME_DISCOVERY: Discovery
:APP_AUTOMATION: Corredor
:PRODUCT_NAME: Corteza
:DOMAIN: cortezaproject.org
:APP_NAME_DISCOVERY: Discovery

:CLI_CMD_VIA_DOCKER: docker-compose exec server
:CLI_CMD_PREFIX:     {CLI_CMD_VIA_DOCKER} corteza-server
:CLI_CMD:            {CLI_CMD_PREFIX}
:CLI_CMD_SYSTEM:     {CLI_CMD_PREFIX} system
:CLI_CMD_COMPOSE:    {CLI_CMD_PREFIX} compose

:API_DOMAIN:                your-corteza-instance.tld
:API_SYSTEM_BASE_URL:       https://api.{API_DOMAIN}/system
:API_COMPOSE_BASE_URL:      https://api.{API_DOMAIN}/compose
:API_FEDERATION_BASE_URL:   https://api.{API_DOMAIN}/federation

:APP_DOMAIN:             your-corteza-instance.tld
:APP_MESSAGING_BASE_URL: https://{APP_DOMAIN}/messaging
:APP_COMPOSE_BASE_URL:   https://{APP_DOMAIN}/compose

:GIT_REPO_GROUP:                cortezaproject
:GIT_REPO_PREFIX:               corteza
:GIT_REPO_LINK_PREFIX:          https://github.com/{GIT_REPO_GROUP}/{GIT_REPO_PREFIX}
:GIT_MONOREPO_LINK:             {GIT_REPO_LINK_PREFIX}
:GIT_MONOREPO_ROOT_LINK_PREFIX: {GIT_MONOREPO_LINK}/tree/{VERSION}/


:LOCAL_HOSTNAME:        local.cortezaproject.org

:CORTEZA_PULL_BASE: https://github.com/cortezaproject/corteza/pull/
:CORTEZA_COMMIT_BASE: https://github.com/cortezaproject/corteza/commit/
:SERVER_COMMIT_BASE: https://github.com/cortezaproject/corteza-server/commit/
:SERVER_PULL_BASE: https://github.com/cortezaproject/corteza-server/pull/
:SERVER_DISCOVERY_COMMIT_BASE: https://github.com/cortezaproject/corteza-server-discovery/commit/
:SERVER_CORREDOR_COMMIT_BASE: https://github.com/cortezaproject/corteza-server-corredor/commit/
:LOCALE_COMMIT_BASE: https://github.com/cortezaproject/corteza-locale/commit/
:WEBAPP_COMPOSE_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-compose/commit/
:WEBAPP_COMPOSE_PULL_BASE: https://github.com/cortezaproject/corteza-webapp-compose/pull/
:WEBAPP_ONE_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-one/commit/
:WEBAPP_ADMIN_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-admin/commit/
:WEBAPP_WORKFLOW_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-workflow/commit/
:WEBAPP_REPORTER_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-reporter/commit/
:WEBAPP_DISCOVERY_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-discovery/commit/
:WEBAPP_PRIVACY_COMMIT_BASE: https://github.com/cortezaproject/corteza-webapp-privacy/commit/
:WEBAPP_JS_COMMIT_BASE: https://github.com/cortezaproject/corteza-js/commit/
:JS_COMMIT_BASE: https://github.com/cortezaproject/corteza-js/commit/
:JS_PULL_BASE: https://github.com/cortezaproject/corteza-js/pull/
:WEBAPP_VUE_COMMIT_BASE: https://github.com/cortezaproject/corteza-vue/commit/
:VUE_COMMIT_BASE: https://github.com/cortezaproject/corteza-vue/commit/
:LOCALE_COMMIT_BASE: https://github.com/cortezaproject/corteza-locale/commit/


# src/modules/developer-guide/nav.adoc

* xref:index.adoc[]

** xref:documentation/index.adoc[]
*** xref:documentation/codegen.adoc[]
*** xref:documentation/annotations.adoc[]
*** xref:documentation/examples/index.adoc[]
*** xref:documentation/changelog.adoc[]

** xref:release-cycle/index.adoc[]
*** xref:release-cycle/docs.adoc[]
*** xref:release-cycle/core-repos.adoc[]

** xref:corteza-server/index.adoc[]
*** xref:corteza-server/structure.adoc[]
*** xref:corteza-server/access-control/index.adoc[]
*** xref:corteza-server/i18n.adoc[]
*** xref:corteza-server/api.adoc[]
*** xref:corteza-server/auth.adoc[]
*** xref:corteza-server/codegen.adoc[]
*** xref:corteza-server/store.adoc[]
*** xref:corteza-server/workflows/index.adoc[]
*** xref:corteza-server/sink.adoc[]
*** xref:corteza-server/resource-labels.adoc[]
*** xref:corteza-server/messagebus.adoc[]
*** Expressions
**** xref:corteza-server/expressions/types.adoc[]
*** xref:corteza-server/federation/index.adoc[]
**** xref:corteza-server/federation/glossary.adoc[]
**** xref:corteza-server/federation/node-pair.adoc[]
**** xref:corteza-server/federation/node-sync.adoc[]
**** xref:corteza-server/federation/security-logging.adoc[]
**** xref:corteza-server/federation/dev-notes.adoc[]

** xref:web-applications/index.adoc[]
*** xref:web-applications/structure.adoc[]
*** xref:web-applications/i18n.adoc[]
*** xref:web-applications/c3.adoc[]
*** xref:web-applications/record-list-filtering.adoc[]

** xref:corteza-js/index.adoc[]
*** xref:corteza-js/structure.adoc[]

** xref:corteza-vue/index.adoc[]
*** xref:corteza-vue/structure.adoc[]
*** xref:corteza-vue/authentication.adoc[]


# src/modules/developer-guide/pages/corteza-js/index.adoc

include::ROOT:partial$variables.adoc[]

= Corteza JS

The http://github.com/cortezaproject/corteza-js[`corteza-js`] package provides the common logic that should be accessible by any web or Node.js application.

The most common use cases for the `corteza-js` package include type definitions and the generated API client code.

[NOTE]
====
Refer to the xref:release-cycle/core-repos.adoc[] for details regarding the release process.
====

== Development setup

=== Fork the `corteza-js` repository

[CAUTION]
====
Core contributors should skip this part.
====

. go to the {GIT_REPO_LINK_PREFIX}-js repository
. click on the btn:[Fork] button in the top right corner and follow the instructions on the screen.

=== Clone the repository

.Using the CLI:
. open the CLI
. navigate to your working folder
. run the `git clone git@github.com:$YOUR_USERNAME_HERE/corteza-js.git` command

[TIP]
====
Refer to the https://github.com/cortezaproject/corteza-js[repository] if you wish to use an alternative method.
====

=== Assure dependencies

Run the `yarn` command to assure that all of the packages are present and up to date.

See the `package.json` file for the supported Node.js versions.

=== Build the bundle

Run the `yarn build` command to build a fresh bundle.
The optional `-w` flag will automatically rebuild the bundle when changes occur.

== Linking the package

Run the `yarn link` command to make this package linkable.
The package can be linked by running `yarn link @cortezaproject/corteza-js` where needed.


# src/modules/developer-guide/pages/corteza-js/structure.adoc

include::ROOT:partial$variables.adoc[]

= Structure

== `/tools`

The `/tools` directory contains tools that automate some tasks, such as the API client code generator.
You should include a script to run the tool in the `/package.json` file.

== `/src/api-clients`

The `/src/api-clients` directory contains the generated REST API clients.
The API clients are generated by the `/tools/codegen` tool based on the definitions of the `corteza-server/***/rest.yaml` files.

Each API client should be provided as a separate class so that it can be on its own.

The codegen is run with the `yarn codegen:corteza-api-client` command.

== `/src/automation`

The `/src/automation` directory contains common code for the automation, such as type definitions.

== `/src/compose`

The `/src/compose` directory contains common code for compose, such as type definitions.

== `/src/corredor`

The `/src/corredor` directory contains common code for the Corredor, such as type definitions, script parsing utilities, and Corredor helper classes.

== `/src/corredor/helpers`

The `/src/corredor/helpers` directory contains the {APP_AUTOMATION} helper classes.
The helper classes implement common automation operations such as creating and updating records.

== `/src/eventbus`

The `/src/eventbus` directory contains the client-side implementation of the event bus.
The event bus handles and reacts to dispatched events.

== `/src/system`

The `/src/system` directory contains common code for the core system, such as type definitions.


# src/modules/developer-guide/pages/corteza-server/access-control/index.adoc

include::ROOT:partial$variables.adoc[]

= Access control

{PRODUCT_NAME} defines a https://en.wikipedia.org/wiki/Role-based_access_control[RBAC] access control facility.
RBAC uses the <<glossary-role,*roles*>> of the given <<glossary-user,*user*>> to determine if they have access to the given <<glossary-resource,*resource*>>.

The access control facility should be invoked whenever an identity is trying to access a protected resource.
The only exception are resources that are only accessed by the system itself, such as settings, configuration options, and other system metadata.

[NOTE]
====
*DevNote* some diagrams outlining the different flows
====

== Structure overview

=== `pkg/rbac`

[IMPORTANT]
====
RBAC rules are loaded into memory and accessed from there.
The store layer is only involved when loading, reloading, or updating RBAC rules.
====

`pkg/rbac` contains the core logic, later referenced by other components and their services.

.The important parts of the package:
* `rbac.service` (struct): encapsulates rule management and access control check logic.
Initialized with `rbac.NewService(...)`.
A singleton can be initialized with `rbac.SetGlobal(...)` and accessed with `rbac.Global()`.
* `rbac.Resource` (interface): a generic interface for a more structured resource handling
* `rbac.Session` (interface): a security session interface for a specific user-roles combinations.
Predefined structures can be initialized with `rbac.ContextToSession(...)` or `rbac.NewSession(...)`.

=== `<component>/service`

Each components' service defines an `accessControl` struct that is generated from `def/\*.yaml` files.
See the <<extending>> sub-sections for more details.

The `accessControl` struct defines all resources and operations relevant to the given component and serves as a proxy to the internal `pkg/rbac.Service`.
The `accessControl` struct also performs grant action logging, validation, and access control.

[#extending]
== Extending

=== Add a new resource

To add an entirely new resource, define a new file in the `/def` directory.

The file should follow the pattern of: `\{component\}(.\{resource\}).yaml`.
For example: `system.user.yaml`.

If you're defining component-level rules, omit the `(.\{resource\})` part.
For example: `system.yaml`.

.The content template
[source,yaml]
----
rbac:
  operations:
    {operation}:
      description: {optional notes here}
----

[NOTE]
====
This uses the new WIP codegen v3; run with `go run pkg/codegen-v3/*.go def`
====

=== Add new rules to existing resources

To add a new rule to an existing resource, navigate the file in the `/def` directory.

The file should follow the pattern of: `\{component\}(.\{resource\}).yaml`.
For example: `system.user.yaml`.

If you're defining component-level rules, omit the `(.\{resource\})` part.
For example: `system.yaml`.

If the file does not yet exist, create it.

Add entry under `rbac.operations`

.The content template
[source,yaml]
----
rbac:
  operations:
    {operation}:
      description: {optional notes here}
----

[NOTE]
====
This uses the new WIP codegen v3; run with `go run pkg/codegen-v3/*.go def`
====

== Role types

[IMPORTANT]
====
List of roles for the bypass, authenticated, and anonymous type can not be changed at runtime.
These roles can not be modified or renamed.

If a role is assigned as a bypass, it may *not* appear as any other role type (such as an authenticated or anonymous).
In the case where this is not the case, {PRODUCT_NAME} will refuse to start.
====

=== Bypass

Bypass roles allow their members unlimited access to {PRODUCT_NAME} with no permission checking.

The list of bypass roles is defined in the `RBAC_BYPASS_ROLES` `.env` variable and can not be changed during runtime.
The default role is `super-admin`.

=== Common

Common roles are any additional roles defined in the administration panel, such as a CRM admin and application builder.

=== Contextual

Contextual roles define a series of *expressions*, which determine when the role is assigned to the user based on the operations' context.

Each role can define an expression for each resource type.
Each role can only use a resource type once.

An example use case would allow us to assign roles to resource owners, which would give them permissions that they shouldn't have over other resources.

=== Authenticated

Authenticated roles are *implicit*, meaning that users can not explicitly be set as role members.

The list of authenticated roles is defined in the `RBAC_AUTHENTICATED_ROLES` `.env` variable and can not be changed during runtime.
The default role is `authenticated`.

=== Anonymous

Anonymous roles are *implicit*, meaning that users can not explicitly be set as role members.

The list of anonymous roles is defined in the `RBAC_ANONYMOUS_ROLES` `.env` variable and can not be changed during runtime.
The default role is `anonymous`.

[#role-importance]
== Role importance

Role importance specifies the order in which the provided roles and their corresponding rules are evaluated.

.Role importance for authenticated users:
. bypass roles
. context roles
. common roles
. authenticated roles

.Role importance for authenticated users:
. anonymous roles

== Resource identifiers

.The resource identifier structure follows the pattern of:
[source]
----
{rbac-ns}:: <1>
  {component}: <2>
  {service} <3>
  {path} <4>
----
<1> The RBAC namespace allows us to group RBAC rules based on the area, allowing us to support custom rules in the future.
The namespace must match te regex of `[a-z]*`
<2> The component must match te regex of `[a-z]*`
<3> The service must match te regex of `[a-zA-Z]+`
<4> The path must follow the pattern of `(/[\*,a-z,A-Z,0-9]\*)+`

When defining resource identifiers, the n-th path item must be more or equally specific to the (n+1)-th path item.
The following example is invalid, as the first item is less specific (wildcard `\*`) than the second one: `corteza::compose:record/\*/21/2`.

[#resource-specificity]
=== Resource specificity

Resource specificity defines the order in which rules for the corresponding resources are evaluated.
Resource specificity is defined based on "how specific is this rule to this resource".

As an example, a rule that allows users to create records on the account module in the CRM namespace is more specific than the rule just on the CRM namespace.

Under the hood, this is calculated based on the number of wildcard characters (`*`) in the resource definition.
If the resource has no wildcard characters, the level is 0.
If the resource has n wildcard characters, the level is n-1 (0-based).

=== Example resource identifiers

Compose component permissions::
  `corteza::compose/`

Permissions for any namespace (level=1)::
  `corteza::compose:namespace:/*`

Permissions for a specific namespace (level=0)::
  `corteza::compose:namespace:/42`

Permissions for all records on a specific namespace (level=2)::
  `corteza::compose:record/42/\*/*`

Permissions for all records on a any namespace or any module (level=3)::
  `corteza::compose:record/\*/*/*`

Permissions for a specific record (level=0)::
  `corteza::compose:record/42/21/2`

Permissions for record values on a specific module fields (level=0)::
  `corteza::compose:moduleField/42/21/12`

== Access evaluation flow

The access is evaluated based on the security context (namely the <<role-importance,*role importance*>> and <<resource-specificity,*resource specificity*>>) and the operation they are trying to perform.

.Access evaluation flow:
. If any rule defines an explicit *deny*, the evaluation results with *deny*.
. If at least one rule defines an explicit *allow*, the evaluation results with *allow*.
. If the current level has no explicit allow or deny, the evaluation continues to the next set of rules based on role importance.
. If the evaluation cannot find an explicit allow or deny, the evaluation results with *deny*.

****
.The original RBAC evaluation flow:
[%collapsible.example]
====
. can this combination of roles perform an operation on this specific resource
. can this combination of roles perform an operation on any resource of the type (wildcard)
. can anyone/everyone perform an operation on this specific resource
. can anyone/everyone perform an operation on any resource of the type (wildcard)
====
****

== Glossary

[cols="1s,5a"]
|===
| [#glossary-user]#<<glossary-user,A user>>#
|
A user is an entity that is accessing {PRODUCT_NAME}.
A user can be a member of security roles and cannot get permissions directly without an assigned role.

| [#glossary-role]#<<glossary-role,A role>>#
|
A role represents a set of users and a set of permissions over resources.

{PRODUCT_NAME}'s RBAC implementation defines a flat structure that removes role hierarchy (two roles can not explicitly specify a parent/child relationship).

| [#glossary-access]#<<glossary-access,Access>>#
|
Defines if the rule permits (`allow`) or denies (`deny`).

| [#glossary-resource]#<<glossary-resource,A resource>>#
|
A structured piece of information stored within {PRODUCT_NAME} that we may or may not control access to.
Each resource belongs to a component and has a unique type.

| [#glossary-resource-type]#<<glossary-resource-type,A resource type>>#
|
A resource type defines the structure of information within the {PRODUCT_NAME} component.

| [#glossary-operation]#<<glossary-operation,Operation>>#
|
Defines what operation the given RBAC rule defines access to.

| [#glossary-rbac-rule]#<<glossary-rbac-rule,RBAC rule>>#
|
A RBAC rule combines *operation*, *role*, *access*, and *resource*.
It defines what someone can (or can not) do on one or more resources inside {PRODUCT_NAME}.

| [#glossary-security-session]#<<glossary-security-session,Security session>>#
|
A security session is created when a user requests to access {PRODUCT_NAME}.

|===


# src/modules/developer-guide/pages/corteza-server/api.adoc

include::ROOT:partial$variables.adoc[]

= REST API

{PRODUCT_NAME} uses standard Go's HTTP servers and handlers with https://github.com/go-chi/chi[chi] to handle request routing.

== Request handling

.Request flow diagram:
[plantuml,api-request-life-cycle,svg]
----
@startuml
skinparam ParticipantPadding 20
skinparam BoxPadding 200
skinparam SequenceArrowThickness 2
skinparam RoundCorner 10

Server     -> Handler: HTTP Request
activate Handler
Handler    -> Controller: Request params
activate Controller
Controller -> Handler: Response payload
deactivate Controller
Handler    -> Server: HTTP Response
deactivate Handler

@enduml
----

.General outline of an HTTP request:
. request handlers convert the request into a proper structure,
. the service initializes the action parameters (used for the action log),
. requested resources are loaded and access permissions are checked,
. the appropriate operation is performed,
. the request handler prepares the response, most commonly in the JSON format.

== API endpoints

Endpoints are defined with `*/rest.yaml` files (`/(compose|system|federation|automation)/rest.yaml`).
The code generation tool uses these `rest.yaml` files to generate the boilerplate request and response handling logic.

The `rest.yaml` files are used to generate the boilerplate code to handle request and response formatting (`rest/request/*.go` and `rest/handlers/*.go`).
You can run the code generation tool with `make codegen` CLI command.

Handlers read and normalize request data into *request* structures and pass them on to controllers.
Controllers are functions that handle a request and route it forward to internal service, and format the final output.

[NOTE]
====
Controllers were initially developed to solve CRUD operations.
Further development of {PRODUCT_NAME} platform outgrew that, so you may notice some peculiar patterns (returning `http.HandlerFunc` functions from handlers, for instance)
====

== API documentation

API documentation is provided by Swagger using the open API.
The open API format is generated using the https://github.com/cortezaproject/openapi3-converter/tree/develop[openapi3-converter] tool.

The converter tool generates a series of `\{resource\}.yaml` files in the `/swagger` directory.
If `corteza-server` is in the same directory as the converter tool, the files are moved to the `corteza-server/docs` directory and the `/swagger` directory.

To generate the static HTML API documentation served by the `corteza-server`, run the `make docs` command within the `corteza-server` repository.
The static HTML files are generated in the `corteza-server/docs/` directory.

=== Extending the tool

The entirety of the converting process is done in the `openapi3-converter/tools/convert.js`.

=== Adding new definitions

Adding a new definition adds a new entry to the `const namespaces = [...]` array.
Rebuild the open API definitions using the `yarn convert:yaml` command.

.An example of a new resource foo:
[source,js]
----
const namespaces = [
  {
    path: `${path}/system/rest.yaml`,
    namespace: 'system',
    className: 'System',
  },
  {
    path: `${path}/compose/rest.yaml`,
    namespace: 'compose',
    className: 'Compose',
  },
  {
    path: `${path}/federation/rest.yaml`,
    namespace: 'federation',
    className: 'Federation',
  },
  {
    path: `${path}/foo/rest.yaml`,
    namespace: 'foo',
    className: 'Foo',
  },
]
----

=== Adding new endpoints

The tool uses `rest.yaml` files defined in the `corteza-server` repository.
Add a new endpoint in the corresponding `rest.yaml` file and run the `yarn convert:yaml` command to rebuild the definitions.

== Plans for the future

* Removing the home-brew API definitions and replacing them with OpenAPI 3.
* Better support for update and partial update requests (PUT/PATCH).


# src/modules/developer-guide/pages/corteza-server/auth.adoc

include::ROOT:partial$variables.adoc[]

= Authentication and authorization

{PRODUCT_NAME} implements the OAuth2 authentication protocol.
The {PRODUCT_NAME} server can act both as an OAuth2 server and as an OAuth2 client, allowing internal and external authentications.

Refer to the https://oauth.net/2[OAuth2 spec] for a complete reference to the protocol.

.Outline of the common authorization flow with {PRODUCT_NAME} Auth:
[plantuml,common-auth-flow,svg]
----
@startuml
|User|
:User starts authentication flow;
|Client application|
:Asks client application for link to \n**Corteza Auth** authorization server;
|Authorization server|
if (Verify redirect URI parameter) then
    |User|
    #darkred:Failed:\nInvalid redirect URI;
    stop
endif

|Authorization server|
:Present authentication\noptions for user;
|User|
:Authenticates by using local credentials\nor selecting one of the\nexternal identity provider;
|Authorization server|
if (Verify credentials) then
    |User|
    #darkred:Failed:\nInvalid credentials;
    stop
endif

|Authorization server|
if (Can user authorize this client) then
    |User|
    #darkred:Failed:\nNo permissions to authorize this client;
    stop
endif

|Authorization server|
if (Is user valid) then
    |User|
    #darkred:Failed:\nInvalid user\n(eg: unverified email);
    stop
endif

|Authorization server|
if (Is client trusted) then
    |User|
    :Prompt user\nto authorize this client;
endif

|Authorization server|
:Generate authorization code;
|Client application|
:Receive authorization code;
->exchange code for token;
|Authorization server|
:Generate access\nand refresh tokens;
|Client application|
#green:Store tokens;
stop;
@enduml
----

== Why OAuth2 rework?

* OAuth2 is a proven and well-accepted authentication standard.
* {PRODUCT_NAME} becomes more open and easier to integrate with different applications.
* It fits well into the existing RBAC security model.
* Personalized authentication page lets users feel safe when entering their credentials.
* Trivial {PRODUCT_NAME} authentication user interface modification.

== Terminology

[cols="2s,5a"]
|===
| [#auth-term-user]#<<auth-term-user,The user>>#
|
_In OAuth2 terminology, this is a **resource owner**_
The user authenticates themselves and authorize the <<,auth-client,client>> on the authorization server.

| [#auth-term-auth]#<<auth-term-auth,{PRODUCT_NAME} auth server>>#
|
_In OAuth2 terminology, this is an *authorization server*_
The {PRODUCT_NAME} Auth authenticates users, authorizes clients, and issues access tokens.

More details can be found <<auth-server,here>>.

[NOTE]
====
{PRODUCT_NAME} Auth currently runs side-by-side with {PRODUCT_NAME} API server.
====

| [#auth-term-api]#<<auth-term-api,{PRODUCT_NAME} API>>#
|
_In OAuth2 terminology, this is a *resource server*_
A client must obtain an access token in order to access the resources on the {PRODUCT_NAME} API.

[NOTE]
====
{PRODUCT_NAME} Auth currently runs side-by-side with {PRODUCT_NAME} API server.
====

| [#auth-term-client]#<<auth-term-client,Client, Auth Client, Third-Party Application>>#
|
A client is any application that is being used to interact with the {PRODUCT_NAME} API.

| [#auth-term-local-credentials]#<<auth-term-local-credentials,Local credentials>>#
|
Local credentials are the email and the password that the user can use to authenticate.

| [#auth-term-external-providers]#<<auth-term-external-providers,External identity providers>>#
|
An external identity provider is any provider that supports the OpenID Connect (OIDC) protocol, such as Google, LinkedIn, and GitHub.

| [#auth-term-security-ctx]#<<auth-term-security-ctx,Security context>>#
|
The security context is a set of roles assigned to the user when accessing the {PRODUCT_NAME} API.

More in the <<auth-scope,auth scope>> section.
|===

[#auth-server]
== {PRODUCT_NAME} Auth server

Enables users to allow applications access to the {PRODUCT_NAME} API resources without sharing their actual credentials.
This happens through the secure exchange of credentials, codes, secrets and tokens following the OAuth2 protocol.

After a successful authorization with local credentials or an external provider, an *access token* along with a *refresh token* is issues.
This should be done automatically by the client.

The session on the {PRODUCT_NAME} Auth is different from the one on the client application.
This separation allows the {PRODUCT_NAME} Auth session to be used when authorizing additional clients.

[CAUTION]
====
Since the authentication sessions between different clients are different, you must revoke each session for the user to be "truly signed-out".
====

[#auth-scope]
== Authorization scope

The scope is defined as a series of role memberships that are either *permitted*, *prohibited*, or *forced* on the user when using a specific {PRODUCT_NAME} Auth server.

[cols="2s,5a"]
|===
| [#auth-scope-permitted]#<<auth-scope-permitted,Permitted roles>>#
Permitted roles allow you to specify what roles the user is *allowed to have* when accessing the {PRODUCT_NAME} API resources from a specific client.

| [#auth-scope-prohibited]#<<auth-scope-prohibited,Prohibited roles>>#
Prohibited roles allow you to specify what roles the user is *not allowed to have* when accessing the {PRODUCT_NAME} API resources from a specific client.

| [#auth-scope-forced]#<<auth-scope-forced,Forced roles>>#
Forced roles allow you to specify what roles the user *must have* when accessing the {PRODUCT_NAME} API resources from a specific client.
If the user does not have a forced role, it will be automatically added.
|===

== {PRODUCT_NAME} Auth security features

Authentication forms and endpoints are protected against brute-force and cross-site request attacks.
You can also set your secrets for JWT, CSRF and cookie value encryption.

Different expiration durations can be set on sessions temporary and permanent sessions to support your organization's security policies.


== Future improvements

* more fine-grain scopes
* per-client allow/deny list of IP addresses
* per-client access and refresh token expiration control
* per-client refresh token use
* per-client credentials use (only local-login, require 2fa, the only login via specific provider)


# src/modules/developer-guide/pages/corteza-server/codegen.adoc

include::ROOT:partial$variables.adoc[]

= Generating Code

As GO is "a bit stiff" when it comes to generic things, we utilize code generation when possible.
The core logic regarding code generation resides within the `pkg/codegen` package.

The definitions are provided using YAML files throughout the source; the templates are defined under the `pkg/codegen/assets` folder.

== Running codegen

[CAUTION]
====
You need to <<codegen-bin-remove,remove the old codegen binary>> whenever the source code changes.
The codegen commands will compile the binary if it's not there.
====

.Run the codegen by running:
[source,bash]
----
make codegen
----

.Run the codegen on change by running:
[source,bash]
----
make watch.codegen
----

[#codegen-bin-remove]
.Remove the old codegen binary by running:
[source,bash]
----
make clean.codegen
----

== Extending existing codegen

=== Rest API

The codegen generates REST API request handlers and request parsing.

[CAUTION]
====
The documentation is generated using the https://github.com/cortezaproject/openapi3-converter/tree/develop[openapi3-converter] tool, not codegen.
====

.YAML defintions:
* `*/rest.yaml`

.Template files:
* `rest_handler.go.tpl`
* `rest_request.go.tpl`

=== Types

The codegen generates common type set receivers and generic boilerplate logic for features such as resource labels.

.YAML defintions:
* `\*/*/types.yaml`

.Template files:
* `type_labels.gen.go.tpl`
* `type_set.gen.go.tpl`
* `type_set.gen_test.go.tpl`

=== Actions

The codegen generates the available service actions along with the properties and errors.
These actions are primarily used for the action log.

.YAML defintions:
* `*/services/*_actions.yaml`

.Template files:
* `actions.gen.go.tpl`

=== Events

The codegen generates the available events that the system can emit from different services.
These events are primarily used by the event bus for automation.

.YAML defintions:
* `*/service/event/events.yaml`

.Template files:
* `events.gen.adoc.tpl`
* `events.gen.go.tpl`
* `events.go.tpl`

=== Store interface and implementations

The codegen generates the entire store interface.
In the case of RDBMS, the implementation is also generated.

.YAML defintions:
* `store/*.yaml`

.Template files:
* `store_base.gen.go.tpl`
* `store_interfaces_joined.gen.go.tpl`
* `store_partials.go.tpl`
* `store_rdbms.gen.go.tpl`
* `store_test_all.gen.go.tpl`

=== Options

The codegen generates all of the defined options accessible from the `.env` file variables.
The options may define defaults as well as any preprocessing.

.YAML defintions:
* `pkg/options/*.yaml`

.Template files:
* `options.gen.adoc.tpl`
* `options.gen.go.tpl`

=== Automation function handlers

The codegen generates the definitions and wrappers for function handlers.
You must still define the core logic of the handler manually.

.YAML defintions:
* `*/automation/*_handler.yaml`

.Template files:
* `afunc.gen.go.tpl`

=== Expression types

The codegen generates the expression types and casting rules.
The more complex types (such as `ComposeRecord`) custom casting and operations may be defined manually.

.YAML defintions:
* `\*/*/expr_types.yaml`

.Template files:
* `expr_types.gen.go.tpl`

== Defining new codegen

Use one of the existing implementations as a base and tweak it to your needs.
The general outline is that you *define a template*, *yaml files* and * code that combines the two*.

== Plans for the future

Define `*/type.yaml` files that outline the structure of each known type.
The same type definition should be used to extract expression types and other bits, like events.


# src/modules/developer-guide/pages/corteza-server/expressions/types.adoc

include::ROOT:partial$variables.adoc[]

[#expr-data-type-reference]
= Data type reference

.Underlying types for core expression types:
[cols="2m,2m,5a"]
|===
| Type | Golang type | Notes

| Vars
| map[string]TypedValue{}
| For complex key-value structures.

| Any
| interface{}
|

| Integer
| int64
| 64-bit integer; range `-9223372036854775808` through `9223372036854775807`.

| UnsignedInteger
| uint64
| 64-bit unsigned integer; range `0` through `18446744073709551615`.

| ID
| uint64
| 64-bit unsigned integer; range `0` through `18446744073709551615`.

| Float
| float64
| IEEE-754 64-bit floating-point numbers.

| Array
| []TypedValue
| Can hold zero or more typed values.

| Boolean
| bool
| `true` or `false`.

| DateTime
| *time.Time
| Date time type.

| Duration
| time.Duration
| Duration type.

| Handle
| string
| Expects valid handle; empty string or match for `/^[A-Za-z][0-9A-Za-z_\-.]*[A-Za-z0-9]$/`.

| KV
| map[string]string
| Simple key-value structure.

| KVV
| map[string][]string
| Simple key-values structure, used for url query params, headers.

| Reader
| io.Reader
| When dealing with files or streams of data.

| String
| string
|
|===


# src/modules/developer-guide/pages/corteza-server/federation/api/data_sync__exposed_records.adoc

[NOTE]
====
$TOKEN_B is the token that was generated during the handshake and is used to authenticate the user on the Origin node (the one who shares the data) by the Destination node.
====

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node (?exposed) or the origin node (?shared)
$NODE_ID

# Federation module id
$MODULE_ID

# Node B auth token
$TOKEN_B
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID/records?lastSync=$AFTER_TIMESTAMP" \
  -H "Authorization: Bearer $TOKEN_B";
----

.Example response
[source,bash]
----
{
    "response": {
        "filter": {
            "moduleID": "132954639472525355",
            "query": "",
            "sort": "createdAt DESC",
            "page": 1,
            "perPage": 20,
            "count": 97,
            "deleted": 0
        },
        "set": [
            {
                "recordID": "$COMPOSE_RECORD_ID",
                "moduleID": "$FEDERATION_MODULE_ID",
                "values": [
                    {
                        "name": "name",
                        "value": "John"
                    },
                    {
                        "name": "surname",
                        "value": "Doe"
                    }
                ],
                "createdAt": "2020-09-08T19:56:14Z",
                "updatedAt": "2020-09-09T18:05:33Z"
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/index.adoc

= API

== Node pairing

=== Create a federated node from a series of parameters

include::node_create_a.adoc[]

=== Create a federated node from a node URI

include::node_create_b.adoc[]

=== Initialize the handshake

include::node_handshake_init.adoc[]

=== Request the handshake with node A

include::node_handshake_request.adoc[]

=== Confirm the requested handshake

include::node_handshake_confirm.adoc[]

=== Complete the handshake

include::node_handshake_complete.adoc[]

== Origin structures

=== Add module to federation

include::structure_sync__add_module_to_federation.adoc[]

=== Change sharing fields

include::structure_sync__change_sharing_fields.adoc[]

=== Info about exposed federated module

include::structure_sync__list_exposed_module.adoc[]

=== Remove module from federation

include::structure_sync__remove_module_federation.adoc[]

== Destination structures

=== Info about shared federated module

include::structure_sync__list_shared_module.adoc[]

=== List shared modules

include::structure_sync__list_shared_modules.adoc[]

=== Set module mapping for a module

include::structure_sync__set_module_federation_mapping.adoc[]

=== Get module mapping for a module

include::structure_sync__get_module_federation_mapping.adoc[]

=== Remove module mapping from federation

include::structure_sync__remove_module_federation_mapping.adoc[]

== Structure sync

=== Get origin changes

include::structure_sync__origin_changes.adoc[]

=== Sync shared module structure

include::structure_sync__sync_shared_module.adoc[]

== Fetch exposed data

include::data_sync__exposed_records.adoc[]


# src/modules/developer-guide/pages/corteza-server/federation/api/node_create_a.adoc

.Used variables
[source,bash]
----
# Base URL of node A api
$API_A_BASE

# Main administrator JWT for node A
$MAIN_JWT_A

# Node A domain
$DOMAIN_A

# Node B domain
$DOMAIN_B

# Node name
$NODE_NAME

# Node A nodeID
$NODE_ID_A

# Node B nodeID
$NODE_ID_B

# Node URI
$NODE_URI
----

.Example request
[source,bash]
----
curl -X POST "$API_A_BASE/federation/nodes/" \
  -H "authorization: Bearer $MAIN_JWT_A" \
  --header "Content-Type: application/json" \
  --data "{
    \"baseURL\": \"$DOMAIN_A_BASE_URL\",
    \"name\": \"$DOMAIN_A_NAME\"
}";
----

.Example response
[source,bash]
----
{
  "response": {
    "nodeID": "$NODE_ID_A",
    "name": "$DOMAIN_A_NAME",
    "status": "pending",
    "baseURL": "$DOMAIN_A_BASE_URL",
    "sharedNodeID": "$NODE_ID_A",
    "createdAt": "2020-12-01T14:24:47.246145938Z",
    "createdBy": "0"
  }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/node_create_b.adoc

.Used variables
[source,bash]
----
# Base URL of node B api
$API_B_BASE

# Main administrator JWT for node B
$MAIN_JWT_B

# Node B domain
$DOMAIN_B

# Node A domain
$DOMAIN_A

# Node name
$NODE_NAME

# Node B nodeID
$NODE_ID_B

# Node A nodeID
$NODE_ID_A

# Node URI
$NODE_URI
----

.Example request
[source,bash]
----
curl -X POST "$API_B_BASE/federation/nodes" \
  -H "authorization: Bearer $MAIN_JWT_B" \
  --header "Content-Type: application/json" \
  --data "{
    \"baseURL\": \"$DOMAIN_B_BASE_URL\",
    \"name\": \"$DOMAIN_B_NAME\"
}";
----

.Example response
[source,bash]
----
{
  "response": {
    "nodeID": "$NODE_ID_B",
    "name": "$DOMAIN_B_NAME",
    "status": "pending",
    "baseURL": "$DOMAIN_B_BASE_URL",
    "sharedNodeID": "$NODE_ID_A",
    "createdAt": "2020-12-01T14:24:47.246145938Z",
    "createdBy": "0"
  }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/node_handshake_complete.adoc

.Used variables
[source,bash]
----
# Base URL of node B api
$API_B_BASE

# Node B nodeID
$NODE_ID_B

# Node B auth token
$TOKEN_B

# Node A auth token
$TOKEN_A
----

.Example request
[source,bash]
----
curl -X POST "$API_B_BASE/federation/nodes/$NODE_ID_B/handshake-complete" \
  -H "authorization: Bearer $TOKEN_B" \
  --header "Content-Type: application/json" \
  --data "{
    \"token\": \"$TOKEN_A\"
  }";
----

.Example response
[source,bash]
----
{}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/node_handshake_confirm.adoc

.Used variables
[source,bash]
----
# Base URL of node A api
$API_A_BASE

# Node A nodeID
$NODE_ID_A

# Main administrator JWT for node A
$MAIN_JWT_A
----

.Example request
[source,bash]
----
curl -X POST "$API_A_BASE/federation/nodes/$NODE_ID_A/handshake-confirm" \
  -H "authorization: Bearer $MAIN_JWT_A" \
  --header "Content-Type: application/json";
----

.Example response
[source,bash]
----
{}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/node_handshake_init.adoc

.Used variables
[source,bash]
----
# Base URL of node B api
$API_B_BASE

# Main administrator JWT for node B
$MAIN_JWT_B

# Node B nodeID
$NODE_ID_B
----

.Example request
[source,bash]
----
curl -X POST "$API_B_BASE/federation/nodes/$NODE_ID_B/pair" \
  -H "authorization: Bearer $MAIN_JWT_B" \
  --header "Content-Type: application/json";
----

.Example response
[source,bash]
----
{}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/node_handshake_request.adoc

.Used variables
[source,bash]
----
# Base URL of node A api
$API_A_BASE

# Node A nodeID
$NODE_ID_A

# Node URI
$NODE_URI

# Node B auth token
$TOKEN_B

# Node B nodeID
$NODE_ID_B
----

.Example request
[source,bash]
----
curl -X POST "$API_A_BASE/federation/nodes/$NODE_ID_A/handshake" \
  --header "Content-Type: application/json" \
  --data "{
    \"nodeURI\": \"$NODE_URI\",
    \"token\": \"$TOKEN_B\",
    \"nodeIDB\": \"$NODE_ID_B\"
  }";
----

.Example response
[source,bash]
----
{}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__add_module_to_federation.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node
$NODE_ID

# Federation module id
$MODULE_ID
----

.Example request
[source,bash]
----
curl -X PUT "$BASE_URL/federation/nodes/$NODE_ID/modules/" \
  -H "Authorization: Bearer $JWT" \
  -H "Content-Type: application/json" \
  --data "{
    \"composeModuleID\": \"$COMPOSE_MODULE_ID\",
    \"composeNamespaceID\": \"$COMPOSE_NAMESPACE_ID\",
    \"name\": \"Account\",
    \"handle\": \"Account\",
    \"fields\": [
        {
            \"kind\": \"String\",
            \"name\": \"AccountName\",
            \"label\": \"Account Name\",
            \"isMulti\": false,
            \"value\": true,
            \"map\": null
        },
        {
            \"kind\": \"User\",
            \"name\": \"OwnerId\",
            \"label\": \"Account Owner\",
            \"isMulti\": false,
            \"value\": true,
            \"map\": null
        }
    ]
}";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "$MODULE_ID",
        "nodeID": "$NODE_ID",
        "composeModuleID": "$COMPOSE_MODULE_ID",
        "composeNamespaceID": "$COMPOSE_NAMESPACE_ID",
        "handle": "Account",
        "name": "Account",
        "fields": [
            {
                "kind": "String",
                "name": "AccountName",
                "label": "Account Name",
                "isMulti": false
            },
            {
                "kind": "User",
                "name": "OwnerId",
                "label": "Account Owner",
                "isMulti": false
            }
        ],
        "createdAt": "2020-12-01T14:33:14.010034106Z",
        "createdBy": "204158548916043781"
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__change_sharing_fields.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node
$NODE_ID

# Federation module id
$MODULE_ID
----

.Example request
[source,bash]
----
curl -X PUT "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID/exposed" \
  -H "Authorization: Bearer $JWT"
  -H "Content-Type: application/json" \
  --data "{
    \"composeModuleID\": \"$COMPOSE_MODULE_ID\",
    \"composeNamespaceID\": \"$COMPOSE_NAMESPACE_ID\",
    \"name\": \"Account\",
    \"handle\": \"Account\",
    \"fields\": [
        {
            \"kind\": \"String\",
            \"name\": \"AccountName\",
            \"label\": \"Account Name\",
            \"isMulti\": false,
            \"value\": true,
            \"map\": null
        },
        {
            \"kind\": \"User\",
            \"name\": \"OwnerId\",
            \"label\": \"Account Owner\",
            \"isMulti\": false,
            \"value\": true,
            \"map\": null
        }
    ]}";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "$MODULE_ID",
        "nodeID": "$NODE_ID",
        "composeModuleID": "$COMPOSE_MODULE_ID",
        "composeNamespaceID": "$COMPOSE_NAMESPACE_ID",
        "handle": "Account",
        "name": "Account",
        "fields": [
            {
                "kind": "String",
                "name": "AccountName",
                "label": "Account Name",
                "isMulti": false
            },
            {
                "kind": "User",
                "name": "OwnerId",
                "label": "Account Owner",
                "isMulti": false
            }
        ],
        "createdAt": "2020-12-01T14:33:14.010034106Z",
        "createdBy": "204158548916043781",
        "updatedAt": "2020-12-01T14:34:12.972692192Z",
        "updatedBy": "204158548916043781"
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__get_module_federation_mapping.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node
$NODE_ID

# Federation module id
$MODULE_ID
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID/mapped" \
  -H "Authorization: Bearer $JWT";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "122709113267335170",
        "handle": "Account",
        "name": "Account",
        "createdAt": "2019-12-18T17:45:15Z",
        "updatedAt": "2020-05-26T13:29:36Z",
        "mapping": [
            {
                "origin": {
                    "name": "LinkedIn",
                    "kind": "Url",
                    "is_multi": 0
                },
                "destination": {
                    "name": "Social",
                    "kind": "String",
                    "is_multi": 0
                }
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__list_exposed_module.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node
$NODE_ID
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID/exposed" \
  -H "Authorization: Bearer $JWT";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "$MODULE_ID",
        "nodeID": "$NODE_ID",
        "composeModuleID": "$COMPOSE_MODULE_ID",
        "composeNamespaceID": "$COMPOSE_NAMESPACE_ID",
        "handle": "Account",
        "name": "Account",
        "fields": [
            {
                "kind": "String",
                "name": "AccountName",
                "label": "Account Name",
                "isMulti": false
            },
            {
                "kind": "User",
                "name": "OwnerId",
                "label": "Account Owner",
                "isMulti": false
            }
        ],
        "createdAt": "2020-12-01T14:33:14.010034106Z",
        "createdBy": "204158548916043781",
        "updatedAt": "2020-12-01T14:34:13Z",
        "updatedBy": "204158548916043781"

    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__list_shared_module.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the origin node
$NODE_ID
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID/shared" \
  -H "Authorization: Bearer $JWT";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "122709113267335170",
        "handle": "Account",
        "name": "Account",
        "createdAt": "2019-12-18T17:45:15Z",
        "updatedAt": "2020-05-26T13:29:36Z",
        "fields": [
            {
                "kind": "Url",
                "name": "LinkedIn",
                "label": "LinkedIn",
                "isMulti": false,
            },
            {
                "kind": "String",
                "name": "Phone",
                "label": "Phone",
                "isMulti": false,
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__list_shared_modules.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node (?exposed) or the origin node (?shared)
$NODE_ID
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/nodes/$NODE_ID/modules" \
  -H "Authorization: Bearer $JWT";
----

.Example response
[source,bash]
----
{
    "response": {
        "filter": {
            "query": "",
            "handle": "",
            "name": "",
            "sort": "name ASC",
            "count": 1
        },
        "set": [
            {
                "moduleID": "122709113267335170",
                "handle": "Account",
                "name": "Account",
                "createdAt": "2019-12-18T17:45:15Z",
                "updatedAt": "2020-05-26T13:29:36Z",
                "fields": [
                    {
                        "kind": "Url",
                        "name": "LinkedIn",
                        "label": "LinkedIn",
                        "isMulti": false,
                    },
                    {
                        "kind": "String",
                        "name": "Phone",
                        "label": "Phone",
                        "isMulti": false,
                    }
                ]
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__origin_changes.adoc

[NOTE]
$TOKEN_B is the token that was generated during the handshake and is used to authenticate the user on the Origin node (the one who shares the data) by the Destination node.

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node
$NODE_ID

# Node B auth token
$TOKEN_B
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/exposed/modules" \
  -H "Authorization: Bearer $TOKEN_B";
----

.Example response
[source,bash]
----
{
    "response": {
        "filter": {
            "query": "after=1600109447",
            "page": 1,
            "perPage": 20,
            "count": 97,
        },
        "set": [
            {
                "type": "GET",
                "rel": "Account",
                "href": "$BASE_URL/federation/exposed/modules/$MODULE_ID?after=1600109447"
            },
            {
                "type": "GET",
                "rel": "Contact",
                "href": "$BASE_URL/federation/exposed/modules/$MODULE_ID?after=1600109447"
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__remove_module_federation.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node (?exposed) or the origin node (?shared)
$NODE_ID

# Federation module id
$MODULE_ID
----

.Example request
[source,bash]
----
curl -X DELETE "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID" \
  -H "authorization: Bearer $JWT";
----

.Example response
[source,bash]
----
{}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__remove_module_federation_mapping.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node (?exposed) or the origin node (?shared)
$NODE_ID

# Federation module id
$MODULE_ID
----

.Example request
[source,bash]
----
curl -X DELETE "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID" \
  -H "authorization: Bearer $JWT";
----

.Example response
[source,bash]
----
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__set_module_federation_mapping.adoc

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the destination node
$NODE_ID

# Federation module id
$MODULE_ID
----

.Example request
[source,bash]
----
curl -X PUT "$BASE_URL/federation/nodes/$NODE_ID/modules/$MODULE_ID/mapped" \
  -H "Authorization: Bearer $JWT"
  -H "Content-Type: application/json" \
  --data "[{
      \"origin\":{
          \"name\":\"LinkedIn\",
          \"kind\":\"Url\",
          \"is_multi\":0
        },
        \"destination\":{
            \"name\":\"Social\",
            \"kind\":\"String\",
            \"is_multi\":0
        }
    }]";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "122709113267335170",
        "handle": "Account",
        "name": "Account",
        "createdAt": "2019-12-18T17:45:15Z",
        "updatedAt": "2020-05-26T13:29:36Z",
        "mapping": [
            {
                "origin": {
                    "name": "LinkedIn",
                    "kind": "Url",
                    "is_multi": 0
                },
                "destination": {
                    "name": "Social",
                    "kind": "String",
                    "is_multi": 0
                }
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/api/structure_sync__sync_shared_module.adoc

[NOTE]
$TOKEN_B is the token that was generated during the handshake and is used to authenticate the user on the Origin node (the one who shares the data) by the Destination node.

.Used variables
[source,bash]
----
# Base url for the federation api
$BASE_URL

# JWT of the user
$JWT

# Node id of the origin node
$NODE_ID

# Node B auth token
$TOKEN_B
----

.Example request
[source,bash]
----
curl -X GET "$BASE_URL/federation/exposed/modules/$MODULE_ID" \
  -H "Authorization: Bearer $TOKEN_B";
----

.Example response
[source,bash]
----
{
    "response": {
        "moduleID": "122709113267335170",
        "handle": "Account",
        "name": "Account",
        "createdAt": "2019-12-18T17:45:15Z",
        "updatedAt": "2020-05-26T13:29:36Z",
        "fields": [
            {
                "kind": "Url",
                "name": "LinkedIn",
                "label": "LinkedIn",
                "isMulti": false,
            },
            {
                "kind": "String",
                "name": "Phone",
                "label": "Phone",
                "isMulti": false,
            }
        ]
    }
}
----


# src/modules/developer-guide/pages/corteza-server/federation/dev-notes.adoc

include::ROOT:partial$variables.adoc[]

= Local development

Use the following instructions to setup two federated {PRODUCT_NAME} instances.

== Create a data directory

.CLI command to create the directory with permissions:
[source,bash]
----
mkdir data && chmod 755 data/ -R
----

== Create the docker compose file

.`docker-compose.yaml` files for the two instances:
[source,yaml]
----
version: "3"
services:
  db_origin:
    image: percona:8.0
    container_name: db_origin
    restart: always
    cap_add:
      - SYS_NICE  # mbind warning fix
    environment:
      MYSQL_DATABASE:      corteza
      MYSQL_USER:          corteza
      MYSQL_PASSWORD:      rootcorteza
      MYSQL_ROOT_PASSWORD: rootcorteza
    volumes:
      - "../../data/db_origin:/var/lib/mysql"
    ports:
      - 3306:3306

  db_destination:
    image: percona:8.0
    container_name: db_destination
    restart: always
    cap_add:
      - SYS_NICE  # mbind warning fix
    environment:
      MYSQL_DATABASE:      corteza
      MYSQL_USER:          corteza
      MYSQL_PASSWORD:      rootcorteza
      MYSQL_ROOT_PASSWORD: rootcorteza
    volumes:
      - "../../data/db_destination:/var/lib/mysql"
    ports:
      - 3307:3306

  node_origin:
    image: golang
    container_name: node_origin
    entrypoint: [ make, watch ]
    depends_on: [ db_origin ]
    volumes:
      - "../../:/app"
      - "./.env.orig:/app/.env"
    working_dir: /app
    restart: always
    ports:
      - 8084:8084

  node_destination:
    image: golang
    container_name: node_destination
    entrypoint: [ make, watch ]
    depends_on: [ db_destination ]
    volumes:
      - "../../:/app"
      - "./.env.dest:/app/.env"
    working_dir: /app
    restart: always
    ports:
      - 8085:8084
----

This docker compose file creates two {PRODUCT_NAME} instances with their corresponding databases.
Binary uploads are stored in the `data` directory created above.

== Create the environment files

.\.env.orig:
[source,env]
----
PROVISION_ALWAYS=false
HTTP_ADDR=:8084

LOG_LEVEL=info

DB_DSN=corteza:rootcorteza@tcp(db_origin:3306)/corteza?collation=utf8mb4_general_ci
LOG_DEBUG=true
CORREDOR_ADDR=localhost:50051
CORREDOR_ENABLED=false
CORREDOR_CLIENT_CERTIFICATES_ENABLED=false

GRPC_SERVER_ADDR=localhost:50052

CORTEZA_PROTOBUF_PATH=/home/wrk/Projects/corteza/corteza-protobuf

FEDERATION_ENABLED=true
FEDERATION_HOST=node_origin:8084
FEDERATION_LABEL=Federation origin host

# Sync settings
FEDERATION_SYNC_STRUCTURE_MONITOR_INTERVAL=60s
FEDERATION_SYNC_STRUCTURE_PAGE_SIZE=1
FEDERATION_SYNC_DATA_MONITOR_INTERVAL=20s
FEDERATION_SYNC_DATA_PAGE_SIZE=100
----

.\.env.dest:
[source,env]
----
PROVISION_ALWAYS=false
HTTP_ADDR=:8084

LOG_LEVEL=info

DB_DSN=corteza:rootcorteza@tcp(db_destination:3306)/corteza?collation=utf8mb4_general_ci
LOG_DEBUG=true
CORREDOR_ADDR=localhost:50051
CORREDOR_ENABLED=false
CORREDOR_CLIENT_CERTIFICATES_ENABLED=false

GRPC_SERVER_ADDR=localhost:50052

CORTEZA_PROTOBUF_PATH=/home/wrk/Projects/corteza/corteza-protobuf

FEDERATION_ENABLED=true
FEDERATION_HOST=node_destination:8084
FEDERATION_LABEL=Federation destination host

# Sync settings
FEDERATION_SYNC_STRUCTURE_MONITOR_INTERVAL=60s
FEDERATION_SYNC_STRUCTURE_PAGE_SIZE=1
FEDERATION_SYNC_DATA_MONITOR_INTERVAL=20s
FEDERATION_SYNC_DATA_PAGE_SIZE=100
----

== Run the instances

[source,bash]
----
$ docker-compose up -d node_origin
$ docker-compose up -d node_destination
----

Once the instances are up, you can follow the docker-compose logs by running:

.Logs for the origin {PRODUCT_NAME} instance:
[source,bash]
----
$ docker-compose logs -f node_origin
----

.Logs for the destination {PRODUCT_NAME} instance:
[source,bash]
----
$ docker-compose logs -f node_destination
----

== Port mappings

[cols="m,a,a"]
|===
|Instance |Local connectivity |Docker connectivity

| node_origin
| `localhost:8084`
| `node_origin:8084` (from *node_destination*)

| node_destination
| `localhost:8085`
| `node_destination:8084` (from *node_origin*)

| db_origin
| `localhost:3306`
| `db_origin:3306` (from any of the nodes)

| db_destination
| `localhost:3307`
| `db_destination:3306` (from any of the nodes)
|===


# src/modules/developer-guide/pages/corteza-server/federation/diagrams/data-sync-destination.adoc

.The diagram outlines the entire data syncing process from the API request to field mapping and storage from the destination node perspective.
[plantuml,data-sync-destination,svg,role=sequence]
----
@startuml
skinparam responseMessageBelowArrow true
actor "Origin Node" as NodeOrigin

box "Destination Node" #f7f7f7

participant "Federation Service" as FederationService
participant "Compose Record Service" as ComposeRS
database Store
participant "Federation Data Service" as FDataService
participant Decoder

activate FederationService

NodeOrigin <-> FederationService: Get federated records.

Store <-> FederationService: Get module M properties and field mapping definitions.

note over Decoder
The decoder converts federated records
from a specific format into the internal
format used by Corteza.
end note
Decoder <-> FederationService: Decode federated records into the internal structure.

FDataService <-> FederationService: Apply field mapping to obtain the final set of records to create or update.

FederationService -> ComposeRS: Create or update records
activate ComposeRS
ComposeRS -> Store: Write data to the store layer.

ComposeRS -> FederationService: status
deactivate ComposeRS

FederationService -> Store: Update data sync status
deactivate FederationService
end box
@enduml
----


# src/modules/developer-guide/pages/corteza-server/federation/diagrams/data-sync-origin.adoc

.The diagram outlines the entire data syncing process from the API request to field mapping and storage from the origin node perspective.
[plantuml,data-sync-origin,svg,role=sequence]
----
@startuml
skinparam responseMessageBelowArrow true
actor "Destination Node" as NodeDestination

box "Origin Node" #f7f7f7

participant "Federation Rest Controller" as FRestController
participant "Federation Service" as FederationService
participant "Compose Record Service" as ComposeRS
database Store
participant "Federation Data Service" as FDataService
participant Encoder

activate NodeDestination
NodeDestination -> FRestController: Get federated records.
note over NodeDestination
This will only provide the data
that was updated after the last
successful data sync.
end note
activate FRestController

FRestController -> FederationService: Get federated records.
activate FederationService

FederationService <-> Store: Get module M properties and mapped fields.

FederationService -> ComposeRS: Get filtered Compose records.

activate ComposeRS
ComposeRS <-> Store: Get filtered Compose records.

ComposeRS -> FederationService: List of filtered Compose records.
deactivate ComposeRS

FederationService <-> FDataService: Prepare final list of records to share.
note over FDataService
This step removes fields
we do not wish to share.
end note


note over Encoder
The encoder converts records
from a specific format into the
requested format.
end note
FederationService <-> Encoder: Encode records into the requested format.


FederationService -> FRestController: Final list of federated records.
deactivate FederationService

FRestController -> NodeDestination: Final list of federated records.
deactivate FRestController
deactivate NodeDestination

end box
@enduml
----


# src/modules/developer-guide/pages/corteza-server/federation/diagrams/node-pairing-full.adoc

.The diagram outlines the entire node pairing process. This is later broken down into node identification and node handshake and described in detail.
[plantuml,node-pair,svg,role=sequence]
----
@startuml
skinparam responseMessageBelowArrow true

actor "Administrator A" as AdministratorA
participant "Node A" as NodeA
participant "Node B" as NodeB
actor "Administrator B" as AdministratorB

== Node identification ==
AdministratorA->NodeA: Register federated node B.
AdministratorA-->AdministratorB: Send node URI.
note right of AdministratorA
Administrator A sends the node URI
to administrator B via a secure channel.
end note
...
AdministratorB->NodeB: Register federated node A.
note left of AdministratorB
Administrator B registers node A
using the node URI.
end note


== Node handshake ==
AdministratorB->NodeB: Initialize the handshake.
note over NodeB #FFAAAA
Initialize node B for the federated network.
Create a system user, generate authentication
token, and configure the system.
end note

NodeB->NodeA: Request the handshake.
NodeA-->AdministratorA: Notify administrator A.
note right of AdministratorA #ffffff
Administrator A must manually
approve the handshake request.
end note
...
AdministratorA->NodeA: Approve the handshake request.
note over NodeA #FFAAAA
Initialize node A for the federated network.
Create a system user, generate authentication
token, and configure the system.
end note
NodeA->NodeB: Complete the handshake.
@enduml
----


# src/modules/developer-guide/pages/corteza-server/federation/diagrams/node-pairing-handshake.adoc

.The diagram outlines the node handshake step which exchanges the authentication tokens used to access protected resources.
[plantuml,node-pair,svg,role=sequence]
----
@startuml
skinparam responseMessageBelowArrow true

actor "Administrator A" as AdministratorA
participant "Node A" as NodeA
participant "Node B" as NodeB
actor "Administrator B" as AdministratorB

AdministratorB->NodeB: Initialize the handshake.
note over NodeB #FFAAAA
Initialize node B for the federated network.
Create a system user, generate authentication
token, and configure the system.
end note

NodeB->NodeA: Request the handshake.
NodeA-->AdministratorA: Notify administrator A.
note right of AdministratorA #ffffff
Administrator A must manually
approve the handshake request.
end note
...
AdministratorA->NodeA: Approve the handshake request.
note over NodeA #FFAAAA
Initialize node A for the federated network.
Create a system user, generate authentication
token, and configure the system.
end note
NodeA->NodeB: Complete the handshake.
@enduml
----


# src/modules/developer-guide/pages/corteza-server/federation/diagrams/node-pairing-identification.adoc

.The diagram outlines the node identification step which exchanges the information that are required to establish a connection.
[plantuml,node-pair,svg,role=sequence]
----
@startuml
skinparam responseMessageBelowArrow true

actor "Administrator A" as AdministratorA
participant "Node A" as NodeA
participant "Node B" as NodeB
actor "Administrator B" as AdministratorB

AdministratorA->NodeA: Register federated node B.
AdministratorA-->AdministratorB: Send node URI.
note right of AdministratorA
Administrator A sends the node URI
to administrator B via a secure channel.
end note
...
AdministratorB->NodeB: Register federated node A.
note left of AdministratorB
Administrator B registers node A
using the node URI.
end note
@enduml
----


# src/modules/developer-guide/pages/corteza-server/federation/glossary.adoc

= Glossary

== Node pairing

[IMPORTANT]
====
Before we pair the two nodes, we are unable to determine what node is the source and what node is the destination.
To avoid confusion, we use _node A_ and _node B_ when referring to the two nodes.
====

Node URI::
    The URI that identifies a federation node.

Node A::
    Node A is the node that initializes the process of creating a federated network with another node (node B).

Node B::
    Node B is the node that wishes to join a federated network, initialized by node A.

NodeID A::
    NodeID A is the node A identifier.

NodeID B::
    NodeID B is the node B identifier.

Token A::
    Token A is the authentication token used to access protected resources on node A.

Token B::
    Token B is the authentication token used to access protected resources on node B.

== Node sync

Origin node::
    The *origin node* is the node that *shares the data* to the other node.
    If node A requests data from node B, node B is the origin, as it contains the data.

Destination node::
    The *destination node* is the node that *receives the data* from the origin node.
    If node A requests data from node B, node A is the destination as it receives the data.

== Federated node

Node status::
    Node status defines the current status of the federated node.
    Can be one of the following:

    * *pairing*: the node is in the pairing process,
    * *paired*: the nodes were successfully paired,
    * *failed*: the node was unable to pair.

Structure sync status::
    Structure sync status defines the current status of the federation node structure syncing.
    Can be one of the following:

    * *syncing*: the node is currently syncing structures from the origin node,
    * *synced*: the node has successfully finished syncing,
    * *failed*: there was an error while syncing.

Data sync status::
    Data sync status defines the current status of the federated node data syncing.
    Can be one of the following:

    * *syncing*: the node is currently syncing data from the origin node,
    * *synced*: the node has successfully finished syncing,
    * *failed*: there was an error while syncing.


# src/modules/developer-guide/pages/corteza-server/federation/index.adoc

include::ROOT:partial$variables.adoc[]

[#federation]
= {APP_NAME_FEDERATION}

[CAUTION]
====
{PRODUCT_NAME} {APP_NAME_FEDERATION} is currently in experimental mode and disabled by default,
Set the `FEDERATION_ENABLED` `.env` variable to `true` if you wish to enable it.
====

{PRODUCT_NAME} {APP_NAME_FEDERATION} enables different *{PRODUCT_NAME} instances* to establish a *federated network* to *freely and securely* exchange information.

A federated network consists of *origin* and *destination* nodes, where each node can fulfil both roles.
Take a look at the xref:corteza-server/federation/glossary.adoc[glossary] for a reference on our terminology.

.The diagram provides an abstract overview of the entire {PRODUCT_NAME} {APP_NAME_FEDERATION} system. It consists of three major parts -- node pairing (the nodes establish a federated network), structure syncing (the nodes agree on what will be shared), and data syncing (the destination node accesses the data on the origin node).
[plantuml,federation-overview,svg,role=sequence]
----
@startuml
skinparam ParticipantPadding 50
participant "Node A\n(Origin Node)" as NodeA
participant "Node B\n(Destination Node)" as NodeB

== Node pairing ==
NodeA <-> NodeB: Pair nodes.
note over NodeA, NodeB: The two nodes identify and exchange authentication credentials via a node handshake.
...
== Structure syncing ==
NodeA -> NodeA: Expose structures.
note over NodeA
The origin node determines what structures
it wishes to expose to the destination node.
end note
NodeA -> NodeB: Structure sync.

NodeB -> NodeB: Module mapping.
note over NodeB
The destination node determines what fields
from the origin structure it wishes to consume.
The destination node also specifies where
the data should be stored (field mapping).
end note
...
== Data syncing ==
NodeA -> NodeB: Data sync.

@enduml
----

== Glossary

We recommend you firstly go over xref:corteza-server/federation/glossary.adoc[*the glossary*] so you will understand our terminology.
It will help you follow along and understand what we're talking about.

== Security & logging

xref:corteza-server/federation/security-logging.adoc[*The security & logging*] covers how {PRODUCT_NAME} {APP_NAME_FEDERATION} handles *node authentication and protected resource access*, *RBAC access control* facility integration and the *action log* logging integration.

== Node pairing

xref:corteza-server/federation/node-pair.adoc[*Node pairing*] is the process of *establishing a federated network* between two {PRODUCT_NAME} instances (nodes).

{PRODUCT_NAME} {APP_NAME_FEDERATION} defines a *node pairing handshake* which enables the two nodes to exchange authentication credentials securely.

== Node syncing

xref:corteza-server/federation/node-sync.adoc[*Node syncing*] is the process of determining what *data the origin node wishes to share*, and the actual *data syncing between the two nodes*.

.Node syncing consists of two parts:
* xref:corteza-server/federation/node-sync.adoc#structure-sync[*structure sync*] determines the structures that the destination node can access,
* xref:corteza-server/federation/node-sync.adoc#data-sync[*data sync*] syncs the data from the origin node onto the destination node.

== API reference

xref:corteza-server/federation/api/index.adoc[*The API reference*] provides a complete list of *available API endpoints* with working *cURL examples*.

== Local development

xref:corteza-server/federation/dev-notes.adoc[*Development notes*] walk you through how to setup an origin and a destination federated {PRODUCT_NAME} instance.


# src/modules/developer-guide/pages/corteza-server/federation/node-pair.adoc

include::ROOT:partial$variables.adoc[]

= Node pairing

*Node pairing* is the process of *establishing a federated network* between two {PRODUCT_NAME} instances (nodes).

Node pairing consists of <<node-identification,*node identification*>> which *identifies the two nodes* -- enables communication; and <<node-handshake,*node handshake*>> which *exchanges authentication credentials* for secure communication.

include::diagrams/node-pairing-full.adoc[]

[#node-identification]
== Node identification

The node identification step *exchanges information* about the nodes required to *establish a connection* (*URL address*, *node name*, and some other *metadata*).

[NOTE]
====
The node identification step *doesn't exchange any authentication tokens* apart from the OTT token.
====

include::diagrams/node-pairing-identification.adoc[]

Node A administrator registers node B and generates a node URI::
    Node registration step *lets node A know about node B*.
    The generated node URI *identifies node A* and looks like this: `corteza://$NODE_ID_A:$OTT@$DOMAIN_A?name=$NAME`.

[NOTE]
====
`$OTT` lets us perform initial authentication when performing <<node-handshake,the handshake below>>.
====

Node A administrator sends the node URI to the node B administrator::
    The transferred *node URI* lets node B administrator quickly *register node A*.

[NOTE]
====
This step is *performed manually* by the node administrators.
The two administrators *should use a secure channel* to exchange this information.
====

Node B administrator registers node A using the node URI::
    Node registration step *lets node B know about node A*.
    Both nodes have been identified and are prepared to perform the <<node-handshake,*node handshake*>>.

[#node-handshake]
== Node handshake

The node handshake step *configures the nodes* and *exchanges authentication tokens* that the nodes use to access protected resources.

{PRODUCT_NAME} {APP_NAME_FEDERATION} leverages {PRODUCT_NAME}'s already established authentication facility, using *system users and JWT tokens* (later referred as a token).

This enables us to *reduce potential security holes* and *leverage our RBAC access control facility*.

[NOTE]
====
All *authentication tokens are unique*, even the ones in the same node pair.
====

include::diagrams/node-pairing-handshake.adoc[]

Node B administrator initializes the handshake with node A::
    Node B initializes the state and generates a `$TOKEN_B` that can be used by node A when accessing protected resources.

Node B sends a handshake request to node A::
    Node A administrator is notified (via email) that node B wishes to establish a federated network.
    The handshake request *must be manually confirmed* by the node A administrator.

[IMPORTANT]
====
This request is authenticated by the `$OTT` token (generated in the <<node-identification,node identification>> step), *outside* of the standard *authentication facility*.

The actual authentication tokens authenticate all following requests.
====

Node A administrator confirms the handshake request::
    Node A initializes the state and generates a `$TOKEN_A` that can be used by node B when accessing protected resources.

Node A completes the handshake step::
    Node A sends the generated `$TOKEN_A` to node B with a confirmation that the handshake was successful.


# src/modules/developer-guide/pages/corteza-server/federation/node-sync.adoc

include::ROOT:partial$variables.adoc[]

= Node syncing

*Node syncing* is the process of determining what *data the origin node wishes to share*, and the actual *data syncing between the two nodes*.

.Node syncing consists of two parts:
* <<structure-sync,*structure sync*>> determines the structures that the destination node can access,
* <<data-sync,*data sync*>> syncs the data from the origin node onto the destination node.

[NOTE]
====
The two nodes must go through xref:corteza-server/federation/node-pair.adoc[node pairing] before they can perform any syncing.
====

[#structure-sync]
== Structure sync

*Structure sync* is the process of determining *what structures* the destination node is *allowed to access*.
In our case, we specify *modules and module fields*.

The origin node has *full control over what data* the destination node is *allowed to access*.
This can be as simple as allowing access to specific modules and as complex as allowing access to only specific module fields (configured in the xref:integrator-guide:federation/index.adoc#expose-module[{PRODUCT_NAME} {APP_NAME_COMPOSE} administration panel], or via the API).

The origin node defines exposed structures::
    The origin node specifies what structures the destination node is allowed to access (modules and module fields).
    The origin node can also change or remove these structures after the initial configuration.

The destination node consumes shared structures::
    The destination node fetches available structures (modules and fields) from the origin node and defines a set of mappings to determine how (if at all) the data is stored.
    The destination node can also change or remove these mappings after the initial configuration.

[#data-sync]
== Data sync

*Data sync* is the process of syncing the data *from the origin node onto the destination node*.
In our case, we sync records.

The destination node has *full control* over *how the data is stored* (if at all) via field mappings.

[IMPORTANT]
====
The data syncing uses {APP_NAME_COMPOSE} services and storage layer, which simplifies the overall architecture.

The system design allows {APP_NAME_FEDERATION} to be decoupled and moved elsewhere.
====

This part of the node sync is lengthy and complicated, so we provide two diagrams to help you visualize it.

include::diagrams/data-sync-destination.adoc[]

include::diagrams/data-sync-origin.adoc[]

The destination node requests changed data::
    The destination node requests any *origin node data changes* that have occurred *since the last successful* data sync.
    The changes are fetched for each structure (module) on a fixed endpoint.

The origin node provides changed data::
    The origin node determines what data (records) changed since the last successful data sync.
    The data is passed through *access control* where we remove any values we do not wish to share.
    Lastly, the *data is encoded* into the requested format and provided to the destination node.

The destination node stores the data::
    The destination node firstly *decodes the data*, then *converts the data based on field mapping definition*, and lastly *creates or updates store entries*.

The destination node updates the syncing status::
    The destination node updates the status of the data sync, *taking note of the timestamps* to enable future data syncing.


# src/modules/developer-guide/pages/corteza-server/federation/security-logging.adoc

include::ROOT:partial$variables.adoc[]

= Security & Logging

== Security

{PRODUCT_NAME} {APP_NAME_FEDERATION} leverages {PRODUCT_NAME}'s already established authentication facility, using *system users and JWT tokens* (later referred as a token).

This enables us to *reduce potential security holes* and *leverage our RBAC access control facility*.

During the xref:corteza-server/federation/node-pair.adoc[*node pairing*], each node creates a *system user* with an *authentication token* that can be used to access the node's protected resources.

[NOTE]
====
The two tokens in a node pair are not the same.
====

*After the nodes are paired* and the system users are created, we can *assign roles to the federated user*, further restricting what data the destination node *is allowed to access* using the RBAC access control facility

[NOTE]
====
Each requested operation in the federated network goes through the access control facility.
====

== Logging

{PRODUCT_NAME} {APP_NAME_FEDERATION} logs events (actions) that occurred in the federated network in the {PRODUCT_NAME}'s action log facility.

This *enables administration* and *simplifies the debugging* of any potential configuration issues.

=== Node pairing events

Pairing started::
    The event is logged when the nodes initiate the node pairing step.

Pairing failed::
    The event is logged when an error occurs during the pairing step.

Pairing finished::
    The event is logged when the nodes have been paired successfully.

=== Structure syncing events

Structure syncing started::
    The event is logged when the nodes initiate the structure syncing step.

Structure syncing failed::
    The event is logged when an error occurs during the structure syncing step.

Structure syncing finished::
    The event is logged when the nodes have successfully performed the structure syncing step.

=== Data syncing events

Data syncing started::
    The event is logged when the nodes initiate the data sync step.

Data syncing failed::
    The event is logged when an error occurs during the data sync step.

Data syncing finished::
    The event is logged when the nodes have successfully performed the data sync step.


# src/modules/developer-guide/pages/corteza-server/i18n.adoc

include::ROOT:partial$variables.adoc[]

= Internationalization

[NOTE]
====
*DevNote* do webapps as well; need to sync regarding where the components are and such.
====

{PRODUCT_NAME} allows you to fully translate most aspect of the system.
From the user interface to custom {APP_NAME_COMPOSE} configurations such as modules, fields, and pages.

Back-end defines a home-brew facility to handle static and configurable content.
Front-end applications use https://www.i18next.com/[i18next] and https://github.com/panter/vue-i18next[vue-i18next].

== Structure overview

=== `pkg/locale`

`pkg/locale` contains the core logic for loading, holding, and accessing translations.
The service interfaces should be referenced by component services to provide internationalization.

[IMPORTANT]
====
Locale resources are loaded into memory and accessed from there.
The store layer and the file system are only involved when loading, reloading, or updating.
====

The package loads resource translations from the store, and _static_ translations from the file system (the `LOCALE_PATH` `.env` variable).

.The important parts of the package:
* `locale.Language` (struct): encapsulates i18n resources for the given language; may provide references to parent languages.
* `locale.Locale` (interface): defines an interface to access locale resources based on the provided namespace and key.
* `locale.Resource` (interface): defines an interface for accessing resource translations.

=== `<component>/service/locale.gen.go`

A component may define a generated service (`ResourceTranslationsManagerService`), designed to provide and update translations for the component's resources that support it.

The service is generated from `def/\*.yaml` files.

=== `<component>/types/locale.gen.go`

A component may define a `locale.gen.go` file that defines the resource translation keys for the component's resources, as well as provide some boiler plate code for resource translations.

The service is generated from `def/\*.yaml` files.

[#extending]
== Extending

=== Add translations for a new resource

To add an entirely new resource, define a new file in the `/def` directory.

The file should follow the pattern of: `\{component\}(.\{resource\}).yaml`.
For example: `compose.module-field.yaml`.

.The content template
[source,yaml]
----
locale:
  resource:
    references: [ namespace, module, ID ]

  skipSvc: true
  keys:
    - label
    - { name: descriptionView, path: meta.description.view, custom: true, customHandler: descriptionView }
----

[NOTE]
====
This uses the new WIP codegen v3; run with `go run pkg/codegen-v3/*.go def`
====

=== Add translations for an existing resource

To add a translation to an existing resource, navigate the file in the `/def` directory.

The file should follow the pattern of: `\{component\}(.\{resource\}).yaml`.
For example: `compose.module-field.yaml`.

If the file does not yet exist, create it.

Add entry under `locale.keys`

.The content template
[source,yaml]
----
locale:
  resource:
    references: [ namespace, module, ID ]

  skipSvc: true
  keys:
    - label
    - { name: descriptionView, path: meta.description.view, custom: true, customHandler: descriptionView }
----

[NOTE]
====
This uses the new WIP codegen v3; run with `go run pkg/codegen-v3/*.go def`
====

== Endpoints for accessing resource translations

If a component defines resources that support translations, a locale service is generated.
You need to connect the REST endpoints with the generated service to provide functionalities to list and update those translations.

[IMPORTANT]
====
Each resource that supports translations must define its own REST endpoints.
For example, both namespaces and modules have their own endpoints.
====

.To connect it to a REST endpoint:
. update `<component>/rest.yaml` definition with the list/update translations endpoint (see `compose/rest.yaml`; namespace, module as an example)
. add the required REST handler methods and connect them to the generated service (see `compose/rest/namespace.go`)

== Translating resources

To provide backwards compatibility, the translation is applied to the requested resource (namespace, module) by the component's service.

For example, the `compose/namespace` service will translate the requested namespace with the language defined by the HTTP request's `Accept-Language` header.

Refer to the `compose/service/namespace.go@Find` function for an example.

Refer to the `compose/service/module.go@Find` function for a more complex example when the resource is extended.

== Updating translations based on resource

To provide backwards compatibility, when the resource is created/updated, the resource translations *may* also get updated.

For example, the `compose/namespace` service will collect the `name`, `subtitle`, and `description` parameters; take the HTTP request's `Content-Language` header to update the store.

Refer to the `compose/service/namespace.go@Update` function for an example.

Refer to the `compose/service/module.go@Update` function for a more complex example when the resource is extended.


# src/modules/developer-guide/pages/corteza-server/index.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} Server

https://github.com/cortezaproject/corteza-server[{PRODUCT_NAME} server] is the back-end of the {PRODUCT_NAME} ecosystem.
The core logic is written in GO, using https://pkg.go.dev/github.com/go-chi/chi@v3.3.4+incompatible?utm_source=gopls[go-chi] for the routing.

Communication between the {PRODUCT_NAME} server and web applications is done using the REST API and web sockets.
Communication between back-end services ({PRODUCT_NAME} server and {APP_AUTOMATION}) is done using gRPC.

Non-binary data is handled by the store layer and stored inside a database -- currently PostgreSQL and MySQL.
We will add support for additional databases in the future.

Binary data is handled using minIO and stored either locally or on a supported cloud provider.

== Development setup

[CAUTION]
====
{PRODUCT_NAME} server runs on GO 1.16.
This guide assumes that your GO development environment is already set up on the correct version.
====

=== Fork the {PRODUCT_NAME} server

[CAUTION]
====
Core contributors should skip this part.
====

. go to the {GIT_REPO_LINK_PREFIX}-server repository
. click on the btn:[Fork] button in the top right corner and follow the instructions on the screen.

=== Clone the repository

.Using the CLI:
. open the CLI
. navigate to your working folder
. run the `git clone git@github.com:$YOUR_USERNAME_HERE/corteza-server.git` command

[TIP]
====
Refer to the https://github.com/cortezaproject/corteza-server[repository] if you wish to use an alternative method.
====

=== Configure the environment

.Inside your `corteza-server` directory:
. run `cp .env.example .env`
. open the `.env` file using VIM, Nano, or any other editor and modify the configuration as you see fit

=== Setup data storage

If your work requires persistent storage, make sure that you've set up a supported database engine.
You can run the database either locally or inside a Docker container.
Make sure to change the `DB_DSN=` `.env` variable.

If your work does not require persistent storage (you will work solely using tests), you can skip this step, and the testing framework will use the in-memory SQLite server.
Make sure to remove the `DB_DSN=` `.env` variable.

=== Setup SMTP

For local development, you can use MailHog to log the emails sent from the server.
Run the `make mailhog.up` command to start MailHog.
Alternatively, you can use an actual SMTP provider like Gmail or MailGun.
Make sure to change the `SMTP_*=` `.env` variables.

You can skip this part of your workflow does not require emails.
Make sure to remove the `SMTP_*=` `.env` variables.

=== Serve the web applications

{PRODUCT_NAME} server allows you to serve all of the {PRODUCT_NAME} web applications for cases where you need to quickly test something on a user interface.
Refer to the `corteza-server/webapp/README.adoc` file for details on how to set it up.

[CAUTION]
====
Make sure you've properly set the `HTTP_ADDR` `.env` variable to match your local environment variable, for example `HTTP_ADDR=localhost:80`.
The default `HTTP_ADDR` value is `HTTP_ADDR=localhost:80`.

Port 80 is not available on Windows.
====

[CAUTION]
====
The authentication server uses the `HTTP_ADDR` and `DOMAIN` variables when generating cookies.
The authentication flow will hang if it's not defined.

If the login screen _doesn't do anything_ when you try to login, check if the cookie has the correct domain set.
====

=== Run the server

Run the `make watch` command to start the server.
The server will automatically restart when changes to the code are detected.

[CAUTION]
====
The watcher can be a bit wonky at times.
Manually restart the server if the changes are not getting picked up.
====

=== Run the tests

.There are a handful of commands to run your tests:
* `test.integration` to run integration tests (test files inside `/tests`)
* `test.store` to run store tests (test files inside `/store/tests`)
* `test.all` to run all tests
* `test.unit` to run unit tests
* `test.pkg` to run test files for the `/pkg` directory

[TIP]
====
All commands, but the `test.all` command, accept another `.$WHAT_TO_TEST`.
For example, to only run Compose integration tests, you would run the `make test.integration.compose` command
====

[CAUTION]
====
*Integration testing gotcha:*

To prevent your tests from interacting with your development database, you can define an integration test specific `.env` file inside the `/tests` directory.
There, you can configure a different database or remove it to use the SQLite in-memory database.

*Store testing gotcha:*

The same test suite runs over all supported databases.
If you wish to test for a particular database, you must define the corresponding `DSN` in the root `.env` file.
Refer to the `/store/tests/main_test.go` for details.

See the <<container-db,setup containerized database>> section if you wish to run your test databases in a container.
====

:leveloffset: +1
include::ROOT:partial$setup/containerized-db.adoc[]
:leveloffset: -1

== Setup procedure

The initial procedure is located in the root `app` package which defines orchestration structures to configure, initialize, and start different parts of the system.

[NOTE]
====
CLI commands run boot procedures from the first (setup) to the level required by the command.
====

=== Setup procedure levels

[cols="1s,5a"]
|===
| [#setup-level-setup]#<<setup-level-setup,Setup>>#
|
Configures and initializes low-level components, structures required through the entire lifecycle.

.More notable components:
* *Logging*: root logging facility which supports human (formatting, colors) or machine (JSON) readable formats,
* *health check*: scheduler, email, and {APP_AUTOMATION} checks,
* *sentry*: sentry can be used as an error reporting service (critical routines may use their own error/panic reporting functionalities),
* *email*: an SMTP service for relaying sent email messages,
* *monitoring*: a primitive resource usage logging,
* *scheduler*: a facility that controls interval automation execution,
* *{APP_AUTOMATION}*: a server client for the {APP_AUTOMATION} server.

[NOTE]
====
.When SMTP is disabled (no SMTP host is configured):
* User signup no longer requires email verification,
* password reset is disabled,
* email sending via automation is disabled.
====

| [#setup-level-db]#<<setup-level-db,Store initialization>>#
|
Establishes a connection to the configured database.
The post connection procedures run database migrations to conform the schema to the current version.

| [#setup-level-services]#<<setup-level-services,Service initialization>>#
|
Initializes all of the services as well as RBAC, resource translations, and (if enabled) federation.

| [#setup-level-provision]#<<setup-level-provision,Provision>>#
|
The provision step assures that the initial resources (users, roles, namespaces, ...) are imported from the provision files.

| [#setup-level-activate]#<<setup-level-activate,Activate>>#
|
All of the previously initialized and configured services are started/activated including their watchers.

|===


# src/modules/developer-guide/pages/corteza-server/messagebus.adoc

include::ROOT:partial$variables.adoc[]

= Messagebus

The messagebus feature allows the *producer* instance to offload some work to a *consumer* instance via message queues.
Message bus is primarily designed to be used with workflows, but it can be extended to work elsewhere.

[CAUTION]
====
*DevNote*: the following content is under construction and needs a lot more work from the low-level perspective.
====

== Terminology

[cols="1s,5a"]
|===
| [#messagebus-terminology-queue]#<<messagebus-terminology-queue,Queue>>#
|
A message queue is a combination of a *name*, a *consumer*, and the *metadata*.
The metadata is used to provide contextual information to the producer and the consumer.

| [#messagebus-terminology-queue_producer]#<<messagebus-terminology-queue_producer,Queue producer>>#
|
Producers source the messages into the message queue.
Out of the box the messagebus defines producers as workflow handlers that can be accessed by the *Queue message send* function.

| [#messagebus-terminology-queue_consumer]#<<messagebus-terminology-queue_consumer,Queue consumer>>#
|
Consumers are the adapters that consume the messages from the message queue.
Each consumer is implemented for a specific message destination.
Out of the box the messagebus defines consumers for the event bus and the store.
|===

== Queue message lifecycle

=== Write to consumer

.A workflow example:
* register the queue handler
* use the messagebus global service and `push()` payload to specific queue
* payload gets pushed to an internal messagebus channel
* specific consumer (store) that is specified for this queue is invoked
* the consumer adapter pushes the payload to the destination
** could be another queue in store
** could be eventbus which triggers another workflow

=== Read from producer

The producers are implementation specific; {PRODUCT_NAME} uses a specific one as a workflow queue handler, where the payload is being written via messagebus facility to the queue.

Polling delay metadata is the only metadata that is used in the store producer to poll the db data until a subscriber is implemented.
This way, we can get contextual data to the producer/consumer.

=== Internal {PRODUCT_NAME} messagebus to eventbus flow

{PRODUCT_NAME} {APP_NAME_WORKFLOW} currently has the possibility to incorporate messagebus capabilities via the eventbus mechanism.
The messagebus producer can in this case be an eventbus handler, in our case the already implemented queue trigger (refer to xref:integrator-guide:automation/workflows/index.adoc[automation/workflows documentation]).

The queue handler (producer in the diagram) needs to be triggered to write to messagebus queue, this is done via eventbus mechanism.
Once the payload reaches producer, the payload and the queue name are both pushed to messagebus service internal channel (via exposed method).

[CAUTION]
====
There is no validation on the payload, it is handled as a `[]byte` type and any marshaling or decoding needs to be done on the consumer side.
====

Once the messagebus service fetches the appropriate payload from the internal channel, it matches the already registered and instantiated consumer handler for that queue.
The payload is then processed in the consumer specific logic.

The message flow in our example is not yet finished, since we also have an eventbus consumer, so the payload is again transformed (in workflow) and a different payload is then being pushed in to some other queue.

An example would be a website registration page that pushes user github id on the queue (lets call it queue `users_github`).
Eventbus would then get the payload with the id, fetch the user metadata from github, write to store and on success, write via eventbus to another queue with the user avatar url (lets call it `users_avatars`).
The eventbus would trigger a new workflow on that queue that would fetch binary data from urls and write it to designated store.

[plantuml,msg-flow-1,svg,role=msg-flow-1]
----
@startuml
skinparam responseMessageBelowArrow true

participant "Eventbus" as eb
box "Messagebus" #f7f7f7
participant "Producer" as producer
participant "Service" as mb
participant "Consumer" as consumer

activate eb
eb -> producer: trigger in workflow

activate producer
producer -> mb: send payload from queue handler
deactivate producer
deactivate eb

mb -> mb: add to channel
mb -> mb: get payload from channel, consumer from payload
mb -> consumer: send payload
deactivate mb

activate consumer
consumer -> eb: push parsed payload event
deactivate consumer

end box
@enduml
----

=== Messagebus queues as a distributed pipeline

To continue from our previous example, once our website would grow and we would scale on our instances, so to would we be able to offload (should be choose so) any work from workflows to a designated service or our extended infrastructure on a service provider.

Similar to the previous scenario, on user registration, the messagebus consumer would need to know how to push the payloads to the queueing mechanism on the service provider (ie Amazon SQS / SNS).
The infrastructure that we set up would then process all the payloads and use our specific messagebus producer (ie a lambda handler written in python) to send the payload to another {PRODUCT_NAME} instance via API sink mechanism.

{PRODUCT_NAME} workflows include a trigger for the xref:devops-guide:sink-route[API sink] also, so the payload would then be processed in another workflow, according to the business logic of the whole flow.

A diagram showing capabilities with creating pipelines between different queueing mechanisms

[plantuml,msg-flow-1,svg,role=msg-flow-1]
----
@startuml
node "Domain" {
package "Corteza 1" {
  [Queue "users"]
}

package "Corteza 2" {
  [Queue "administrators"]
}

}

package "Corteza 3" {
  [Corteza API sink]
  [Queue "processed user data"]
}

cloud "Cloud service provider" {
  [Queueing mechanism]
  [Worker]
}

database "Store" {
    [Enriched user data]
}

[Queue "users"] --> [Queueing mechanism]
[Queue "administrators"] --> [Queueing mechanism]
[Queueing mechanism] --> [Worker]
[Worker] --> [Corteza API sink]
[Corteza API sink] --> [Queue "processed user data"]
[Queue "processed user data"] --> [Enriched user data]
@enduml
----


# src/modules/developer-guide/pages/corteza-server/resource-labels.adoc

include::ROOT:partial$variables.adoc[]

= Resource Labels

A *resource label* is a simple, arbitrary *key-value* structure that we can use to enrich resources.
You can use labels for things like categorization, resource grouping, and marking federated resources.

.Supported resources:
* Users
* Roles
* Compose namespace
* Compose page
* Compose chart
* Compose module
* Compose module field
* Compose record

== Core logic

Resource labels are flexible and compatible with any {PRODUCT_NAME} resource.
However, if we want a resource to use resource labels, it must conform to the `pkg/label.LabeledResource` interface.

The core logic that works with the centralized label store is implemented in a dedicated package (`pkg/label`).
Therefore, services can trivially include the package into the request cycle.

[TIP]
====
Use the system/user (`system/service/user.go`) service as a reference.
====

.Resource labels are defined by a simple key-value structure (`pkg/label/types.Label`):
[source,go]
----
Label struct {
  // Kind of the labelled resource
  Kind string

  // ID of the labelled resource
  ResourceID uint64

  // Other parameters
  // ...
}
----

[NOTE]
====
Resource labels define a simple key-value structure to simplify the underlying logic for label management.

The simple structure also helps us not to _abuse_ the feature.
====

== Resource label structure

.Resource labels define a simple `key: value` structure:
`key`::
    The label key is a simple `string` that is limited to 512 characters.
    Keys are unique per specific resources (a resource can have a single value for the given `key`).

[NOTE]
====
The `key` must pass this regular expression: `^[A-Za-z][0-9A-Za-z_\-.]\*[A-Za-z0-9]$`
====

`value`::
    The label values is a regular `string` value with no other constraints.

== Assigning labels

.When a `label` is provided, the resource must support the following cases:
* If the `label` parameter is *empty*, *remove all labels* from the given *resource*.
* If the `label` parameter is *not empty*, *remove missing* labels and *add new labels*.

If the `label` parameter is *not provided*, no modifications are performed.

== Retrieving resources

.The resource must support the following cases:
* *Existence filter*: collect the resources *where the key exists*.
* *!Existence filter*: collect the resources *where the key does not exist*.
* *Key-value filter*: collect the resources *where the key exists* and the *value matches*.

== Access control

Label access control is inherited from resource access control; resource labels do not put any additional access control.

.Access control:
* *Read access* inherits the resource's `read` operation.
* *Create access* inherits the resource's `create` operation.
* *Update access* inherits the resource's `update` operation.
* *Delete access* inherits the resource's `delete` operation.

== Note on deleting

In most cases, {PRODUCT_NAME} performs a soft-delete.
For simplicity on the implementation, labels *do not* support soft delete.

When a *resource is deleted*, related *labels remain unchanged* to cover cases where we restore it.


# src/modules/developer-guide/pages/corteza-server/sink.adoc

include::ROOT:partial$variables.adoc[]

= Sink Routes

A special resource type that {PRODUCT_NAME} supports is xref:integrator-guide:automation/automation-scripts/references/resource-events.adoc#_systemsink[system sink (`system:sink`)] that is used to *respond to API requests*.
You can use the sink route to *implement webhooks*; for example, the OAuth flow.

== Security model

=== Authentication with signature

Each sink URL *must be signed* for security purposes.
The signature is generated based on the parameters (*path* and *constraints*) and salted.

Refer to the xref:devops-guide:references/cli-reference.adoc#sink-signature[CLI command] for details.

=== Automation script security context

When an HTTP request triggers a script, we are *unable to determine* who is the *invoking user*.
Because of this, you *need to specify* the invoking user for the security context (the `runAs` parameter).

.The diagram outlines the complete event life cycle from it's invocation to script execution.
[plantuml,diagram-name-here,svg,role=sink-request]
----
@startuml
skinparam ParticipantPadding 20
skinparam BoxPadding 200
skinparam SequenceArrowThickness 2
skinparam RoundCorner 10

actor "External service" as Ext
participant "HTTP request handler" as HttpReqProc
participant "Sink processor" as SinkProc
participant "Eventbus"
participant "EventHandler"
participant "Corredor"

activate Ext
Ext -> HttpReqProc: HTTP request

group Internal
    activate HttpReqProc
    activate SinkProc
    HttpReqProc -> SinkProc: Resolved Sink request

    activate Eventbus
    SinkProc -> Eventbus: Event raised

    activate EventHandler
    Eventbus -> EventHandler: Trigger

    group Automation script
        EventHandler <-> Corredor: Script execution
    end

    Eventbus <- EventHandler: Response
    deactivate EventHandler

    SinkProc <- Eventbus: Response
    deactivate Eventbus

    HttpReqProc <- SinkProc: Response
    deactivate SinkProc
end


HttpReqProc -> Ext: Response
deactivate HttpReqProc
deactivate Ext

@enduml
----

== HTTP request handler

The HTTP request handler *validates the request* and *converts* it into a *sink request*.

.The flow outline:
. check if the signature is provided,
. check if the signature is valid,
. check if *enforced constraints* match the request parameters:
** HTTP method,
** content-type,
** expiration time,
** maximum body size, and so on.

If the above *validation passes*, the request *becomes a sink request* and is processed as any other event.

== Sink processor

The sink processor takes the HTTP request and converts it *into an event* that can trigger automation script on the {APP_AUTOMATION} server.

The most important thing to *note here*, is that there are *slight deviations* based on the *content-type of the request*.
When the request *indicates an email* (`message/rfc822`, `rfc822`, `email` or `mail` as the `Content-Type`), the `OnReceive` xref:integrator-guide:automation/automation-scripts/references/resource-events.adoc#_systemmail[system mail (`system:mail`)] event is raised.
Any other case, the `OnRequest` xref:integrator-guide:automation/automation-scripts/references/resource-events.adoc#_systemsink[system sink (`system:sink`)] event is raised.

The sink processor also *constructs the proper response* (headers and body) *based on the request*.


# src/modules/developer-guide/pages/corteza-server/store.adoc

include::ROOT:partial$variables.adoc[]

= The Store Layer

The store layer provides a flexible way of defining how and where we should store the data.

== RDBMS schema management

=== Define a new schema

You can define a new schema in the `store/rdbms/rdbms_schema.go` file.
The system goes over all definitions and assures that all of the tables are present in the connected database.

[IMPORTANT]
====
This step doesn't take into account any potential schema manipulations.
See <<store-update-schema>> for details.
====

.The following example defines a table for {PRODUCT_NAME} {APP_NAME_COMPOSE} modules:
[source,go]
----
// General bits regarding the package
// ...

func (s Schema) Tables() []*Table {
  return []*Table{
    // Other schema definitions
    // ...

    s.ComposeModule(),

    // Other schema definitions
    // ...
  }
}

// Other schema definitions
// ...

func (Schema) ComposeModule() *Table {
  return TableDef("compose_module",
    ID,
    ColumnDef("rel_namespace", ColumnTypeIdentifier),
    ColumnDef("handle", ColumnTypeVarchar, ColumnTypeLength(handleLength)),
    ColumnDef("name", ColumnTypeText),
    ColumnDef("meta", ColumnTypeJson),
    CUDTimestamps,

    AddIndex("namespace", IColumn("rel_namespace")),
    AddIndex("unique_handle", IColumn("rel_namespace"), IExpr("LOWER(handle)"), IWhere("LENGTH(handle) > 0 AND deleted_at IS NULL")),
  )
}

// Other schema definitions
// ...
----

[#store-update-schema]
=== Update existing schemas

[IMPORTANT]
====
When developing new features that require new store definitions, don't clutter the `generic_upgrades.go` file.
Either drop the original table and re-create it or manually apply the updates.

If you are working with others, make sure to also coordinate this with them.
====

You can define schema altering in the `store/rdbms/generic_upgrades.go` file.
The system will go over all of the definitions and ensure that everything is up-to-date.

[NOTE]
====
The system will only apply the changes that have not yet been applied.
The result is the same, no matter how many times you run it.
====

.The following example renames the actionlog table:
[source,go]
----
// General bits regarding the package
// ...

func (g genericUpgrades) Before(ctx context.Context) error {
  return g.all(ctx,
    g.RenameActionlog,

    // Other operations
    // ...
  )
}

// Other definitions
// ...

func (g genericUpgrades) RenameActionlog(ctx context.Context) error {
  return g.RenameTable(ctx, "sys_actionlog", "actionlog")
}

// Other definitions
// ...
----


# src/modules/developer-guide/pages/corteza-server/structure.adoc

include::ROOT:partial$variables.adoc[]

= Project Structure

== `/app`

The `app` package handles all of the initialization procedures, such as parsing the `.env`, configuring the store, initializing the services, and initializing the API.

== `/cmd`

The `cmd` package initializes the CLI commands that are provided by the `corteza-server`

== `/provision`

The `/provision` directory contains all of the core resources used when running the provision step.
This includes the base roles, access control, and built-in extensions (CRM and Case Management).

[CAUTION]
====
This is not a database migration.
The `store` package handles the database migration.
====

== `/webapp`

The `/webapp` directory is used to prepare and serve the web applications directly from the `corteza-server` binary.
This removes the need to have the web applications set up locally to access them.

Refer to the `/webapp/README.adoc` for details.

== `/auth`

The `auth` package handles the authentication functionality.
The package defines the services, API endpoints and any additional "utility packages" required by the authentication.

Besides the core logic, the package also defines the authentication UI templates and base assets.

== `/system`

The `system` package handles the core system functionality, such as user, role, and template management.
The package defines the services, API endpoints and any additional "utility packages" required by the core system.

== `/compose`

The `compose` package handles the compose functionality, such as namespace, module, and record management.
The package defines the services, API endpoints and any additional "utility packages" required by the Compose system.

== `/automation`

The `automation` package handles the automation functionality, such as workflow management and execution.
The package defines the services, API endpoints and any additional "utility packages" required by the automation system.

== `/federation`

The `federation` package handles the data federation functionality, configuring the shared data and syncing data changes.
The package defines the services, API endpoints and any additional "utility packages" required by the federation system.

[NOTE]
====
The federation package is coupled with the `compose` service as its data source.
====

== `/docs`

The `/docs` directory is used to store API documentation.
The documentation is generated using the https://github.com/cortezaproject/openapi3-converter/tree/develop[openapi3-converter] tool.

== `/pkg`

The `/pkg` directory contains generic packages that are used through the rest of the system.

The packages residing in the `/pkg` directory should not define any explicit dependencies between one another, nor to the services they may be used in.

== `/store`

The `store` package defines the store layer used by {PRODUCT_NAME}.
The store layer is a generic interface to any of the supported databases, such as PostgreSQL and MySQL.

Besides the core logic, the store package defines any database driver-specific logic (such as data encoding and datatype casting), as well as any schema migration procedures, such as `store/rdbms/rdbms_schema.go` and `store/rdbms/generic_upgrades.go` for relational databases.

== `/tests`

The `/tests` directory contains integration tests categorized by the service they are defined for (`compose`, `system`, ...).


# src/modules/developer-guide/pages/corteza-server/workflows/index.adoc

include::ROOT:partial$variables.adoc[]

= {APP_NAME_WORKFLOW}

{PRODUCT_NAME} workflow (further referred to as a workflow) allow you to implement custom business logic without the need for any programming knowledge.

[NOTE]
====
*DevNote* provide some diagrams regarding the packages and the flows.
====

== Package structure

The core workflow logic is implemented in the `automation` and `wfexec` packages.
Additionally, each main service provides its own `automation` sub-package, which defines type definitions and handler function definitions.

The `automation` package is responsible for CRUD operations over the resources that define the automation, such as the workflow and trigger.
In addition, it is responsible for setting up and manage the facility that prepares, executes and resumes workflows.

The `wfexec` package is responsible for executing the provided automation over the provided context.
The `wfexec` package unaware of the parent automation package and can execute any valid set of `wfexec.Step` interfaces represented as a graph.

=== `/automation`

.The key points of the `automation` package:
* *A workflow* encapsulates the logic and the metadata for the automation.
A workflow is not necessarily valid or executable.
* *A trigger* encapsulates the logic and the metadata that define when the workflow should be executed.
* *A session* encapsulates a workflow that is not not started (for example, started, suspended or completed).
A session may be flushed to the database and restarted at a later point in time.
* The *automation registry* contains type and handler definitions that the automation can use.

=== `/pkg/wfexec`

.The key points of the `automation` package:
* The *graph* encapsulates all of the steps defined for a specific workflow.
The graph needs to traverse through the nodes and execute them in order.
* The *step* is the graph node that executes the required operation.
* The *execution session* encapsulates some internal execution logic, separate from the automation session.

== Setup

The automation service setup initializes all of the sub-services, populates the automation registry, and prepares the facility to execute workflows and produce results.

.The automation service...
. initializes all of the sub-services, along with the automation registry,
. registers all known workflows and triggers on the event bus,
. initializes a session watcher, which will process execution requests.

When we register the workflow to the eventbus, its triggers are converted into a set of `eventbus.ConstraintMatcher` interfaces; the workflow itself is converted into a `wfexec.Graph` by the logic in the `automation/service/workflow_converter.go`.
The initial workflow validation (structure, relations) is performed when converting it to the `wfexec.Graph`.

[CAUTION]
====
A `wfexec.Step` corresponding to the `types.WorkflowStep` may be implemented outside of the `wfexec` package.
====

The core responsibility of the session watcher is to initialize `wfexec.Session` structs on the root `context.Context` when passed into the `spawnQueue` channel.

[CAUTION]
====
Workflows are executed on the root `context.Context` to avoid accidental context terminations by the requesting source (for example, the HTTP request that invoked the execution).
====

== Execution

Workflow execution is either invoked via the eventbus or directly by a service.

.The eventbus event...
. matches all of the handlers that match the provided event,
. invokes the workflow handler function (`automation/service/workflow.go@makeWorkflowHandler`) to prepare the execution context,
. creates and runs the automation session (`automation/service/session.go@.Start`).

The automation session service creates the `automation.Session` struct, which provides the core context of the execution, and wraps the `wfexec.Session`, which provides the execution specific context.

The `wfexec.Session` creation runs a `worker` (`pkg/wfexec/session.go@worker`), which executes the steps passed through the `qState` channel.

[CAUTION]
====
Each `wfexec.Session` runs its worker in a go routine.
====

When the `automation.Session` is executed, it executes the underlying `wfexec.Session`.
When a step is executed (`pkg/wfexec/session.go@.exec`), the result is used to determine the next step to execute.

== Handlers and types

Each service may define an `automation` module that defines the data types and handler functions for that service.

*Handlers* are defined in the `automation/*_handler.yaml` files (for example `automation/log_handler.yaml`) and are generated into `automation/*.gen.go` files (for example `automation/automation/log_handler.gen.go`).
The function step executes these handlers.

[CAUTION]
====
The generated files implement the boilerplate for the handler.
The main logic must still be implemented (for example `automation/automation/log_handler.go`).
====

*Types* are defined in the `automation/expr_types.yaml` files (for example `automation/automation/expr_types.yaml`) and are generated into `automation/expr_types.gen.go` files (for example `automation/automation/expr_types.gen.go`).
These types implement the `expr.TypedValue` interface and can be used within expressions.

[CAUTION]
====
The generated files implement the boilerplate for the type.
If the type requires additional complexity (such as gval selectors), you must implement those manually.
====

== Infinite execution

A workflow step may invoke itself or another workflow.
This may cause the workflow to run indefinitely.

To counter this, we've implemented a run-time validation using a `callStack` passed around through the `context.Context`.

.The flow:
. when a workflow is triggered, pull the current `callStack` from the context,
. if the `callStack` size exceeds the configured limit, error out,
. if the `callStack` size does not exceed the configured limit, pass the `callStack` into the `wfexec.Session`.


# src/modules/developer-guide/pages/corteza-vue/authentication.adoc

include::ROOT:partial$variables.adoc[]

= Authentication

The `/src/plugins/auth.ts` plugin handles the OAuth2 authentication logic.

.The plugin is responsible for:
* identifying the authentication server,
* obtaining the authentication token,
* refreshing the authentication token.

== Plugin registration

.The authentication plugin is registered as follows:
[source,js]
----
import { plugins } from '@cortezaproject/corteza-vue'
// ... other imports ...


// ... other plugin registrations ...

Vue.use(plugins.Auth(), { app: 'compose' })

// ... other plugin registrations ...
----

== Authentication server identification

You can define the authentication server either explicitly or implicitly.

The server is defined explicitly when the `window.CortezaAuth` parameter is provided.
This is normally provided in the `public/config.js` file.

The server is defined implicitly when the `window.CortezaAuth` parameter is *not* provided.
When the `window.CortezaAuth` parameter is not provided, the `window.CortezaAPI` parameter is used.
This is normally provided in the `public/config.js` file.

.The authentication server determination is as follows:
* `CortezaAPI` endpoint is explicitly set and ends with `/api`; the `/api` suffix is replaced with `/auth` and implicitly used as `CortezaAuth`.
* `CortezaAPI` endpoint is explicitly set and does not end with `/api`; the `/auth` suffix is appended to the `CortezaAPI` value and implicitly used as `CortezaAuth`.

.Configuration examples:
|===
| Description | CortezaAPI | CortezaAuth

| Setting both endpoints explicitly
| `window.CortezaAPI = '{API_DOMAIN}'`
| `window.CortezaAuth = '{API_DOMAIN}/auth'`

| Setting CortezaAPI only
| `window.CortezaAPI = '{API_DOMAIN}/custom'`
| `window.CortezaAuth = '{API_DOMAIN}/custom/auth'`

| Setting CortezaAPI with auto set
| `window.CortezaAPI = '{API_DOMAIN}/api'`
| `window.CortezaAuth = '{API_DOMAIN}/auth'`
|===


# src/modules/developer-guide/pages/corteza-vue/index.adoc

include::ROOT:partial$variables.adoc[]

= Corteza Vue

The http://github.com/cortezaproject/corteza-vue[`corteza-vue`] package provides the common Vue-specific logic that should be accessible by any Vue-based web application.

The most common use cases for the `corteza-vue` package include the authentication and the API client plugins.

[NOTE]
====
Refer to the xref:release-cycle/core-repos.adoc[] for details regarding the release process.
====

== Development setup

=== Fork the `corteza-vue` repository

[CAUTION]
====
Core contributors should skip this part.
====

. go to the {GIT_REPO_LINK_PREFIX}-vue repository
. click on the btn:[Fork] button in the top right corner and follow the instructions on the screen.

=== Clone the repository

.Using the CLI:
. open the CLI
. navigate to your working folder
. run the `git clone git@github.com:cortezaproject/corteza-vue.git` command

[TIP]
====
Refer to the https://github.com/cortezaproject/corteza-vue[repository] if you wish to use an alternative method.
====

=== Assure dependencies

[CAUTION]
====
When using modified versions of the `corteza-js`, make sure to link it using `yarn link @cortezaproject/corteza-js`.
====

Run the `yarn` command to assure that all of the packages are present and up to date.

See the `package.json` file for the supported Node.js versions.

=== Build the bundle

Run the `yarn build` command to build a fresh bundle.
The optional `-w` flag will automatically rebuild the bundle when changes occur.

== Linking the package

Run the `yarn link` command to make this package linkable.
The package can be linked by running `yarn link @cortezaproject/corteza-vue` where needed.



# src/modules/developer-guide/pages/corteza-vue/structure.adoc

include::ROOT:partial$variables.adoc[]

= Structure

== `/src/components`

The `/src/components` directory contains all of the generic Vue components accessible by any Vue-based web application.

.Example components:
* permissions modal used to manage permissions,
* file preview,
* custom inputs such as the DateTime and Confirmation,
* notification toasts.

== `/src/corredor`

The `/src/corredor` directory contains Corredor-specific logic, such as client-script processing and execution.

== `/src/libs`

The `/src/libs` directory contains generic libraries and utilities that you can use through the `corteza-vue` source.

== `/src/mixins`

The `/src/mixins` directory contains generic mixins accessible by any Vue-based web application.

== `/src/plugins`

The `/src/plugins` directory contains generic plugins accessible by any Vue-based web application.

== `/src/store`

The `/src/store` directory contains generic store definitions and handlers accessible by any Vue-based web application.


# src/modules/developer-guide/pages/documentation/annotations.adoc

include::ROOT:partial$variables.adoc[]

= Image annotations

Whenever possible, image annotations should be *done programmatically* to reduce the amount of effort needed to make images look consistent and conform to our brand guidelines.

[IMPORTANT]
====
These instructions should be used whenever possible, but exceptions may apply.
For cases where this is not feasible, you may use external programs as long as you follow the style guide and brand guidelines.
====

[NOTE]
====
*DevNote* add style guide and brand guideline references.
====

== Taking screenshots

Screenshots may be taken in any browser you prefer.
We suggest you either use Firefox or a Chromium-based browser.

[#setup]
=== Setting up

*Define a new device* for taking screenshots.
We can define the device with a specific screen parameters so that we can make our screenshots look as consistent as possible.

.In the developer tools:
. click on the btn:[toggle device toolbar] button,
. click on the dropdown containing the list of devices,
. click on the edit option, btn:[add custom device].

[cols="1s,5a"]
|===
| Name
|
The name does not matter; I (the writer) use "{PRODUCT_NAME} screenshots".

| Width
|
The width *must be* `1920` pixels.
Any resizing should be done by the annotation plugin.

| Height
|
The height *must be* `1080` pixels.
Any resizing should be done by the annotation plugin.

| Device pixel ratio
|
The device pixel ratio must be set to `1`.

| User agent type
|
The user agent type must be set do desktop.
*Firefox* users may use the following value.

[source]
----
Mozilla/5.0 (X11; Linux x86_64; rv:89.0) Gecko/20100101 Firefox/89.0
----

|===

*Add a ruler extension* to simplify the process of figuring out the pixel position of specific elements on the page.
I (the writer) use https://chrome.google.com/webstore/detail/smart-page-ruler/nmibbjghlmdiafjolcphdggihcbcedmg/related?hl=en[Smart Page Ruler] as I've found it to be the best and simplest to use from the offerings at the time of writing.

If you do not wish or can not find an appropriate extension for your browser, you may determine positions manually as long as you follow the brand guidelines and you are consistent.

=== Screenshots

.To take the screenshot:
. Prepare the page state to contain all of the information you wish to capture (for example, open modals and populate inputs).
. Open the developer tools and click on the btn:[toggle device toolbar] button.
. Click on the dropdown containing the list of devices and select the device you've prepared in the <<setup,setup section>>.

.The screenshot indicates the location of the capture screenshot button for Firefox.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/screenshot-firefox.png",
    "w": 977,
    "h": 557
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 335,
    "y": 25,
    "w": 0,
    "h": 0
  }]
}
----

.The screenshot indicates the location of the capture screenshot button for Chromium-based browser (Brave).
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/screenshot-brave.png",
    "w": 711,
    "h": 723
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 215,
    "y": 185,
    "w": 220,
    "h": 20
  }]
}
----

== Annotate

.An example annotation:
```
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "workflow/accessing-workflows-1.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 818,
    "y": 516,
    "w": 288,
    "h": 250
  }]
}
----
```

The `image` parameter describes the base image you would like to annotate.
The image *must* define the size of the source image (might be improved later).
The `rel` parameter follows the same rules as https://docs.antora.org/antora/2.0/asciidoc/insert-image/[the regular image path].

[CAUTION]
====
If you are planning on using the same image multiple times with different annotations, make sure that you define an `alias` parameter to the `image`.

.To examplify:
```
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/example-blank.png",
    "alias": "example-blank-box",
    "w": 516,
    "h": 353
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 50,
    "y": 50,
    "w": 403,
    "h": 240
  }]
}
----

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/example-blank.png",
    "alias": "example-blank-box-danger",
    "w": 516,
    "h": 353
  },
  "view": {},
  "annotations": [{
    "kind": "box-danger",
    "x": 50,
    "y": 50,
    "w": 403,
    "h": 240
  }]
}
----
```
====

The `view` parameter defines what portion of the source image should actually be shown.
This allows you to offset the view and crop the image.

The `annotations` parameter allows you to define an array of predefined annotation objects.

=== Box annotations

[NOTE]
====
*DevNote* will be added as requirements change and brand guidelines establish.
====

.A list of predefined box annotations:
[cols="2s,5a,5a"]
|===
| [#annotation-box-note]#<<annotation-box-note,Note>>#
|
```
include::partial$documentation/annotation-note.adoc[]
```
|
include::partial$documentation/annotation-note.adoc[]

| [#annotation-box-success]#<<annotation-box-success,Success>>#
|
```
include::partial$documentation/annotation-success.adoc[]
```
|
include::partial$documentation/annotation-success.adoc[]

| [#annotation-box-danger]#<<annotation-box-danger,Danger>>#
|
```
include::partial$documentation/annotation-danger.adoc[]
```
|
include::partial$documentation/annotation-danger.adoc[]

|===

=== Changing annotation padding

Use the `padding` property to change the padding of your annotation.
The available options are: `xs`, `sm`, `md`, and `lg`; where the `md` option is used by default.

```
include::partial$documentation/annotation-padding.adoc[]
```
|
include::partial$documentation/annotation-padding.adoc[]

=== Cropping images

To crop an image adjust the the `view` property.

.The `view` property has the following parameters:
[cols="2s,5a"]
|===
| x
| The horizontal offset from the top-left corner of the original image.

| y
| The vertical offset from the top-left corner of the original image.

| w
| The width of the resulting image (the area you wish to show).

| h
| The height of the resulting image (the area you wish to show).
|===

To examplify, lets remove the header and navigation from the following image.

image::documentation/example-crop-base.png[role="data-zoomable"]

.The following configuration performs the desired cropping:
```
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/example-crop-base.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 545,
    "y": 100,
    "w": 900,
    "h": 970
  },
  "annotations": []
}
----
```

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/example-crop-base.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 545,
    "y": 100,
    "w": 900,
    "h": 970
  },
  "annotations": []
}
----

=== Cropping and annotating images

To examplify, lets only include the second subject of the following image (the top-right square).

image::documentation/annotation-canvas.png[width=500px,role="data-zoomable"]

.The following configuration performs the desired cropping:
```
include::partial$documentation/annotation-cropped.adoc[]
```

include::partial$documentation/annotation-cropped.adoc[]

=== Focusing images

To define the focus on the image, adjust the `focus` property.

.The `focus` property has the following parameters:
[cols="2s,5a"]
|===
| x
| The horizontal offset from the top-left corner of the original image.

| y
| The vertical offset from the top-left corner of the original image.

| w
| The width of the focused area (the un blurred area).

| h
| The width of the focused area (the un blurred area).

| padding
| The un blurred buffer around the focused area.
|===

To examplify, lets focus on the Admin Area application on the app selector.

image::documentation/example-focus.png[role="data-zoomable"]

.The following configuration performs the desired focusing:
```
include::partial$documentation/focus.adoc[]
```

include::partial$documentation/focus.adoc[]

=== Focusing and annotating images

To examplify, lets focus on the Admin Area application on the app selector with an annotation.

image::documentation/example-focus.png[role="data-zoomable"]

.The following configuration performs the desired focusing:
```
include::partial$documentation/focus-annotation.adoc[]
```

include::partial$documentation/focus-annotation.adoc[]

== Tips and tricks

=== Determine element positions

You can use a ruler extension setup in the <<setup,setup section>> to have an easier time of determining element positions.

.The screenshot shows the use of a ruler extension to determine the position of elements on the screen.
image::documentation/ruler-extension-example.png[role="data-zoomable"]

=== Easier annotation placement

Placing annotations may be a tedious process if you need to do some finishing touches such as assuring alignment.

Annotations are rendered as SVG images which allows you to either use dedicated programs like https://inkscape.org/[Inkscape] or the browser developer console to adjust annotation positioning.

To use the *dedicated program* simply download the annotated SVG image and open it in the program.
You can then adjust the parameters of the annotation configuration based on the adjustments in your SVG editing program.

To use the *developer console* right-click the annotated image and select the *open image in new tab* option.
Inspect the SVG image and adjust the annotations as you see fit.
Use the adjusted parameters to update the annotation configuration.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/annotation-edit-browser.png",
    "w": 1920,
    "h": 987
  },
  "view": {
    "h": 500
  },
  "annotations": []
}
----


# src/modules/developer-guide/pages/documentation/changelog.adoc

include::ROOT:partial$variables.adoc[]

= Changelog

A changelog page is where we aggregate all the changes for the given release.
All releases reside on the same page in reverse chronological order (newer at the top).

The core structure is based on https://keepachangelog.com/en/1.0.0/[Keep a Changelog].

== Index File

The index file recaps major releases, which we were focusing on, such as DAL in the `2022.9` release.
The index file is located in the folder, which denotes the version such as `202209/index.adoc`.

.The index file is structured as follows:
[source,adoc]
----
\include::ROOT:partial$variables.adoc[]

[#yyyy-mm-x]
= `yyyy.mm`

// Release recap and introduction (sales pitch sort of a thing).

:leveloffset: +1

// Include patch releases ordered by patch number descending (05 -> 04 -> ... -> 00)

:leveloffset: -1

----

== Patch Versions

Patch versions outline the changes that were presented in the given version patch, such as additions, deprecations, and changes.

We now use a tool for the changelog to handle the heavy lifting.
Patch releases are described in `JSON` files inside the `src/modules/ROOT/pages/changelog` directory (inside the version folder).
To exemplify, the `02` patch for the `2022.9` version would be located in the `src/modules/ROOT/pages/changelog/202209/02.json` file.

.The patch release JSON file is structured as follows:
[source,json]
----
{
  "meta": {
    "releasedOn": "YYYY.MM.DD"
  },

  "added": [],
  "changed": [],
  "deprecated": [],
  "removed": [],
  "fixed": [],
  "security": [],
  "development": []
}
----

.A simple sample with a single changelog entry:
[source,json]
----
{
  "meta": {
    "releasedOn": "2022.10.20"
  },

  "added": [{
    "what": ["..."],
    "why": ["..."],
    "refs": ["..."]
  }],
  "changed": []
}
----

[NOTE]
====
You can freely omit unneeded bits from the JSON.
====

== Changelog Entries

=== `added`

`added` outlines additions to {PRODUCT_NAME} such as new features or added UI elements.

[cols="1s,5a"]
|===
| [#entry-added-what]#<<entry-added-what,what>>#
|
Describe what the new addition is.
To exemplify: `"what": "gauge, funnel, and pie charts to the {APP_NAME_COMPOSE} charts"`.

The `what` should provide enough information for the reader to know what was added and where it was added.

| [#entry-added-why]#<<entry-added-why,why _optional_>>#
|
Describe the reasoning behind the new addition.
To exemplify: `"why": "to cover use-cases which require these charts"`.

The `why` should provide some background for the addition.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "why": ["..."],
  "refs": []
}
----

=== `changed`

`changed` outlines changes to existing {PRODUCT_NAME} features.

[cols="1s,5a"]
|===
| [#entry-changed-what]#<<entry-changed-what,what>>#
|
Describe what was changed.
To exemplify: `"what": "workflow initialization and preprocessing pipeline"`.

The `what` should provide enough information for the reader to know what was changed.

| [#entry-changed-why]#<<entry-changed-why,why _optional_>>#
|
Describe the reasoning behind the change.
To exemplify: `"why": "to increase performance and optimize memory usage"`.

The `why` should provide some background for the addition.

| [#entry-changed-how]#<<entry-changed-how,how _optional_>>#
|
Describe how the _thing_ changed.
To exemplify: `"how": "by pre-processing workflows and initializing them in {PRODUCT_NAME} boot procedure"`.

The `how` should provide enough information for the reader to know the new state and potential implications.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "why": ["..."],
  "how": ["..."],
  "refs": []
}
----

=== `deprecated`

`deprecated` outlines things that are pending removal.
Deprecated bits can still be used but should no longer be relied on, as we can remove them in future releases.

[cols="1s,5a"]
|===
| [#entry-deprecated-what]#<<entry-deprecated-what,what>>#
|
Describe what was deprecated.
To exemplify: `"what": "automation scripts and the {APP_AUTOMATION} server"`.

The `what` should provide enough information for the reader to know what was deprecated.

| [#entry-deprecated-why]#<<entry-deprecated-why,why _optional_>>#
|
Describe the reasoning behind the deprecation.
To exemplify: `"why": "because it's a legacy system and the NG {APP_AUTOMATION} server will replace it"`.

The `why` should provide some background into the reasoning behind the deprecation.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "why": ["..."],
  "refs": []
}
----

=== `removed`

`removed` outlines things that are no longer available in {PRODUCT_NAME}.

[cols="1s,5a"]
|===
| [#entry-removed-what]#<<entry-removed-what,what>>#
|
Describe what was removed.
To exemplify: `"what": "automation scripts and the {APP_AUTOMATION} server"`.

The `what` should provide enough information for the reader to know what was removed.

| [#entry-removed-why]#<<entry-removed-why,why _optional_>>#
|
Describe the reasoning behind the removal.
To exemplify: `"why": "because the NG {APP_AUTOMATION} server replaced it"`.

The `why` should provide some background into the reasoning behind the deprecation.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "why": ["..."],
  "refs": []
}
----

=== `fixed`

`fixed` outlines changes to existing {PRODUCT_NAME} features.

[IMPORTANT]
====
If the bug fix changes the original flow of the feature, mention it under `changed` as well.
====

[cols="1s,5a"]
|===
| [#entry-fixed-what]#<<entry-fixed-what,what>>#
|
Describe what was fixed.
To exemplify: `"what": "funnel chart labels rendered over the page block when there were too many available options"`.

The `what` should provide enough information for the reader to know what was fixed.
Focus more on what the issue was from the UI perspective instead of the logic perspective.

| [#entry-fixed-how]#<<entry-fixed-how,how _optional_>>#
|
Describe how the _thing_ was fixed.
To exemplify: `"how": "by moving overflowing elements into /dev/null"`.

The `how` should provide enough information for the reader what the patch does.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "how": ["..."],
  "refs": []
}
----

=== `security`

`security` outlines security-related fixes.

[IMPORTANT]
====
If the bug fix changes the original flow of the feature, mention it under `changed` as well.
====

[cols="1s,5a"]
|===
| [#entry-security-what]#<<entry-security-what,what>>#
|
Describe what the security hole was.
To exemplify: `"what": "Fixed the stored XSS attack via xyz"`.

The `what` should provide enough information for the reader to know the issue and what caused it.
Focus more on what the issue was from the UI perspective instead of the logic perspective.

| [#entry-security-how]#<<entry-security-how,how _optional_>>#
|
Describe how the _thing_ was fixed.
To exemplify: `"how": "by removing xyz completely"`.

The `how` should provide enough information for the reader about what the patch does.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "how": ["..."],
  "refs": []
}
----

=== `development`

`development` outlines the development-related quality of life additions.

[cols="1s,5a"]
|===
| [#entry-development-what]#<<entry-development-what,what>>#
|
Describe what the development quality of life addition was.
To exemplify: `"what": "Added C3 to simplify component development in a containerized environment"`.

The `what` should provide enough information for the reader to know what was added and why it's good.

|===

.Template:
[source,json]
----
{
  "what": ["..."],
  "refs": []
}
----

== Adding References

=== GitHub Commits

To reference a GitHub commit, simply add the full URL into the `refs` array.

.An example of a GitHub commit reference:
[source,json]
----
{
  "refs": ["https://github.com/cortezaproject/corteza-server/commit/fd6465d0f95d78210401f0d0be9c16e1290341af"]
}
----

== Tips for Better Changelogs

* avoid ambiguous text, such as `Fixed {APP_NAME_COMPOSE} chart rendering` -- what was the issue? How was it fixed? Is this the one I was affected by?
* Try to phrase the changelog entries in a way that describes what the user was facing or what a user could do with it.
To exemplify, `"Fixed chart legend overflowing onto the chart when a lot of options are presented"` instead of `Fixed chart legend positioning"`.


# src/modules/developer-guide/pages/documentation/codegen.adoc

include::ROOT:partial$variables.adoc[]

= Generating Code

To generate documentation you need two commands (at some point we'll deprecate the legacy one):

```bash
DOCS_DIR=../path/to/docs/repo make codegen
```

```bash
make codegen-legacy && ~/go/bin/corteza-codegen -d ../path/to/docs/repo
```

[NOTE]
====
The second command is sub optimal, but at this point I'm not entirely sure how to do it in one go (how to pass the `-d` flag to the called command).
====


# src/modules/developer-guide/pages/documentation/conventions.adoc

include::ROOT:partial$variables.adoc[]

= Conventions

When writing, please use the following conventions as a reference, especially for when you wish to add some extra formatting to your documents.

The bellow list is aggregated from https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/[AsciiDoc], shortened and adjusted to our needs.

Please, do your best to *follow the conventions* listed below when contributing to the documentation.

We are quite strict in having *1 sentence per line* to have a nicer version history of the document in production.

== Composition, formation, layout

When composing any text it is important to pay attention its formation and layout, especially so when we talk about documents *viewed via electronic devices*.

It is essential to produce a document that is *easy to understand* and *stable* from both the perspective of contents and the visual perspective.
Consistency is crucial.

It may be good to:

.Visually group
* Make sure you group components that fit together, i.e., discussions of the same concept, concept and an example, sub-points and tips...

[NOTE]
====
If something is not relevant in a section, move it elsewhere.
It is better to add a section than to compromise on coherency and fluidity of the document. 
====

.Drawing attention to crucial points
* Use *bold*, *italic*, *links*, *inline code blocks*, and other formatting to point out any crucial points you make.
* *Do not go overboard*, as highlighting excessively results in the decrease of attentiveness to any highlighted sections.

== Lists

You can use lists to provide the document with *additional structure*, to *outline* the essential points, display a *sequence* etc.
Try to keep lists *short*, as they can make the document harder to read.

.Punctuation:
* If a list item is a *proper sentence*, start with a *capital letter*, and end with a *period*.
* If a list item is *not* a *proper sentence*, start with a *lowercase letter*, and (optionally) end with a *comma*.
In case you choose to use commas, start the first item with a capital letter and end the last one with a period. 
* If the entire list is one sentence broken down into clauses for each point, make sure to start the first list item with a capital letter, finish up the point with a comma, continue with a lowercase letter in the following point, finish it up with a comma and so on.
Wrap the list up with a period.
* Do not mix sentence patterns when producing a list.

.Example of a proper sentence; the outline of our documents:
* The *application end-user guide* talks about things relevant to the end-users.
* The *low-code platform developer guide* talks about creating new things based on the {PRODUCT_NAME}.
* The *platform developer guide* helps the core developers keep track on how to maintain different features.

=== Ordered lists

List items in an *ordered list* should *start with a dot* (`. ...content here...`) instead of an actual number (it gets assigned at compile-time).
Please, see the below example.

[source,adoc]
----
.Here we can see:
. list item 1,
. list item 2.
----

Multiple dots should be used when you are indenting the line item.
Please, see the below example.

----
. item (this becomes 1.)
.. sub item (this becomes a.)
... sub sub item (this becomes i.)
----

=== Unordered lists

List items in an *unordered list* should *start with a star* (`* ...content here...`).
Please, see the below example.

[source,adoc]
----
.Here we can see:
* list item 1,
* list item 2.
----

Multiple asterisks (`*` symbol) should be used when indenting the line item.

[TIP]
====
If your list items are long, try to restructure your section, or use multi-line description blocks.
====

=== Multi-line description blocks

Use description blocks when your *lists* start *getting long*.
They firstly present the *key point* of the block, followed by a more *detailed description* that is shifted to the right.

[source,adoc]
----
// Make the key point outline the full description.
// Use four spaces to indent the description.
[Key point here]::
    [Description here].
----

To examplify:
[source,adoc]
----
== Corteza documentation structure

DevOps guide::
    The DevOps guide covers all of the DevOps related bits, such as deploying and maintaining.
    ...

Application end-user guide::
    The application end-user guide serves as a reference for end-users that need help with using the Corteza's user interface.
    ...

Low-Code platform developer guide::
    The low-code platform developer guide serves as a reference for integrators -- people that want to build things with Corteza.
    ...

----

[IMPORTANT]
====
Try not to overuse this.
If your descriptions *get long*, it may be better to restructure and divide the text into several sub-sections instead.
====

== Including code snippets

=== Short one-liners

Use *short one-liners* when you wish to show specific *things inline*, such as *CLI commands*, object *properties*, and *variables*.

=== Longer code snippets

When working on examples or longer code snippets, use the source code syntax; `[source,{language here}]`; blocked with four dashes `----`.
Please, see the below example.

```
[source,adoc]
----
// Things go here
----
```

== Admonition

Use the *admonition block* syntax when wanting to create admonitions; where you want *extra attention* to be drawn to.

.You can use the following:
* NOTE
* TIP
* IMPORTANT
* WARNING
* CAUTION

These are pretty much self-explanatory.
Do not overuse.

== Diagrams

*Use the https://plantuml.com/[PlantUML]* framework for any diagrams (unless there is an explicit reason for not doing so).
This allows us to *keep things consistent*, *preserve version history* and *easy to maintain*.

[TIP]
====
Move *larger diagrams* into *separate files* to avoid clutter and unreadable source.
====

Provide a good caption to summarize the *entire* diagram. 
You shouldn't use more than one line for a diagram caption.

```
[plantuml,diagram-name-here,svg,role=diagram-name]
----
@startuml

' Diagram definition goes here

@enduml
----
```

[TIP]
====
Larger diagrams may be harder to understand. 
Do your best to *group elements together*, and use a nice *comment* to indicate it.
====

Diagram captions::
    A caption *must be enough* for the reader to get an idea about *what goes on* in a diagram.
    Make sure that the caption gives the reader enough insight to have an idea *what they can expect* to learn *from the diagram*.

Comments::
    A PlantUML comment starts with `'` (single line), or is enclosed between `/'`, and `'/`.
    Please, use the following notation for the sake of consistency;

[source,adoc]
----
' ---------------
' Define comments like so.
' Multiple lines are fine.
' ---------------
----

Diagram structure::
    You are free to use any diagram and any component defined by the diagram.
    *Avoid visual customization* using *Skinparam*.

== Referencing

Use referencing to *link different bits* of information.
We use *two different types* of references:

Page cross-references::
    *Page cross-references* allow us to link *between different documentations*, or even different versions.
    Use the `xref` macro (https://docs.antora.org/antora/2.2/asciidoc/page-to-page-xref/[The Antora documentation]):

[source,adoc]
----
// Template
xref:guide-goes-here:path-to-source.adoc[label-goes-here]

// For example:
xref:integrator-guide:workflows/index.adoc[Workflows]
----

[TIP]
====
You can also use *anchors* in your `xref`s.
====

Same page references::
    *Same page references* allow us to link in the same documentation section.
    Use the simple page ID reference syntax (https://docs.antora.org/antora/2.2/asciidoc/in-page-xref/[The Antora documentation]):

[source,adoc]
----
// Define a section ID (make sure that it starts with a #)
[#id-goes-here]

// Reference the section ID (there is no # here)
<<id-goes-here>>

// Reference the section ID with a custom label (no space after the comma)
<<id-goes-here,custom-label-goes-here>>
----

=== Important notes

Same page references are simple::
    Same page references can *only link* to things that are *on the current page*.
    In case you try to link to something that is *not on the screen*, the link *will not work*.
    Use *page cross-references*.

Keep section IDs simple::
    Section IDs are relevant *only for the given page*.
    They don't need to be *unique* across the entire documentation, just *for the current page*.
    To exemplify; `[#extension-deployment]`

Don't go overboard::
    If something is *required for the understanding* of the given section, add a *quick summary* and link to the complete document afterwards.


# src/modules/developer-guide/pages/documentation/dev.adoc

= Developer section
:page-key-section: Index Testing

== Lvl 1

Lvl 1 contents go here

=== Lvl 2

Lvl 2 contents go here

== Table

Lvl 1 placeholder for table sections.

.A table to structure contents:
[cols="1s,5a"]
|===
| [#dev-r1]#<<dev-r1,Row 1>>#
| Row 1 contents go here.

| [#dev-r2]#<<dev-r2,Row 2>>#
| Row 2 contents go here.

| [#dev-r3]#<<dev-r3,Row 3>>#
| Row 3 contents go here.
|===


# src/modules/developer-guide/pages/documentation/examples/getting-started.adoc

= Getting Started

== Sample Feature

For an easier representation, we use the following feature specification:

include::sample-feature.adoc[]

== Take note of the important bits

Specify a *set of bullets* (sections) that *outline the important parts* of the system -- the things you want the *readers to remember*.

For example:

[source,adoc]
----
* security
* front-end
* backend
* repository
----

== Expend on the main things

*Expand* the main sections.
Break them down into the *main components* that outline the section.

For example:

[source,adoc]
----
* security
** available permissions
** the scope of each permission
** guidelines

* front-end
** important libraries used
** browser compatibility
** used algorithms
** communication with the backend

* backend
** access control
** used algorithms
** limitations such as throttling

* repository
** tables, fields and their types
----

== Iterate over your bullets

*Iterate over your documents* and progressively *expand and refactor* your content.
Try to rewrite the same paragraph *multiple times* to see what fits best.
Add some *admonition blocks* and *text formatting*.

For example:

[source,adoc]
----
= Monitor

This feature implements a system that monitors the clients connected to the {PRODUCT_NAME} Monitor core system.

== Security

== Available permissions

Monitor log::
    The permission allows the role to create a log entry for the Monitor system.
    We should only grant this permission to the users that we want to know about,

Monitor list::
    The permission allows the role to access the stored Monitor data.
    Such users can analyse the data to create reports,

Monitor log delete::
    The permission allows the role to remove a log entry from the monitor system.
    Be careful with this one, as we don't want users to remove information needlessly.

...

----

[NOTE]
====
The above is just an example and an outline of how I get about doing documentation.
I find that this helps me define a better, more structured document as I go over the entire thing multiple times.
====


# src/modules/developer-guide/pages/documentation/examples/index.adoc

[#coredev-docs-examples]
= Examples

:leveloffset: +1

include::getting-started.adoc[]

include::no-jank.adoc[]

:leveloffset: -1


# src/modules/developer-guide/pages/documentation/examples/no-jank.adoc

= Removing Jank

For an easier representation, we use the following feature specification:

include::sample-feature.adoc[]

Lets now imagine the *following documentation*:

[source,adoc]
----
= Monitor

This section describes the {PRODUCT_NAME} Monitor feature.
The {PRODUCT_NAME} Monitor feature monitors the clients connected to the core {PRODUCT_NAME} system.

== Security

The security is one of the most critical areas that need to be addressed, as it allows us to restrict access to sensitive information.
The system checks if we can access a specific resource based on our user roles (RBAC).
The rest of the subsection outlines available permissions, their context and provides some guidelines and some notes.

Monitor log::
    The permission allows the role to create a log entry for the Monitor system.
    We should only grant this permission to the users that we want to know about,

Monitor list::
    The permission allows the role to access the stored Monitor data.
    Such users can analyse the data to create reports,

Monitor log delete::
    The permission allows the role to remove a log entry from the monitor system.
    Be careful with this one, as we don't want users to remove information needlessly.

----

Now, let's analyse and clean it up a bit.

[source,adoc]
----
This section describes the {PRODUCT_NAME} Monitor feature.
----

Yes, we know, since we can *read the title* of the section.

[source,adoc]
----
The security is one of the most critical areas that need to be addressed, as it allows us to restrict access to sensitive information.
The system checks if we can access a specific resource based on our user roles (RBAC).
----

We are just *stalling and repeating the same thing* that should be outlined in the security chapters.
Sometimes *it is a good idea* to repeat important bits of information, but *not here* as it should be *self intuitive* from the sub-sections title.

[source,adoc]
----
The rest of the subsection outlines available permissions, their context and provides some guidelines and some notes.
----

Again; we're just stalling and padding for longer content.

If we wish to provide an outline of the *important sections*, let's just define a *new section* so it's visible from the *navigation/table of content*.

If we take into consideration the above analysis, we can condense the documentation down to the following:

[source,adoc]
----
= Monitor

This feature implements a system that monitors the clients connected to the {PRODUCT_NAME} Monitor core system.
Reports statistics.

== Security

=== Available permissions

Monitor log::
    The permission allows the role to create a log entry for the Monitor system.
    We should only grant this permission to the users that we want to know about,

Monitor list::
    The permission allows the role to access the stored Monitor data.
    Such users can analyse the data to create reports,

Monitor log delete::
    The permission allows the role to remove a log entry from the monitor system.
    Be careful with this one, as we don't want users to remove information needlessly.

----

We can see that the content *is a bit shorter* and *straight to the point*.
We don't want to waste the readers time with needless content, so let's just keep it short and straightforward.


# src/modules/developer-guide/pages/documentation/examples/sample-feature.adoc

include::ROOT:partial$variables.adoc[]

The sample feature implements a brand new monitoring system for all devices connected to the core system; their availability and memory consumption.
The feature defines a new API, a new database schema and a modern web app.

The web app implements a pulling system, that periodically fetches the system information, sends it over the API and stores it in the database.
Besides storage, the API also allows fetching, updating and deleting the data.


# src/modules/developer-guide/pages/documentation/index.adoc

= Documentation

:leveloffset: +1

include::conventions.adoc[]

include::writing-guidelines.adoc[]

:leveloffset: -1


# src/modules/developer-guide/pages/documentation/writing-guidelines.adoc

include::ROOT:partial$variables.adoc[]

[#documentation-writing-guidelines]
= Writing Guidelines

Here, we outline the base guidelines that you should to follow when contributing to the documentation.

== Use active voice

Active voice *identifies the subject* that has performed the given action; for example:

> To configure external login providers go into the administration panel, authentication and configure ...

This style makes the *reader more involved* and therefore makes it friendlier and *more comfortable to read*.
It also makes the sentence a bit *shorter*.

There are *some exceptions* to using the active voice.

.Use the passive voice:
* When you *talk about errors*; the active voice can suggest blaming the user.
* When it *shortens* the message.
* When *the subject isn't and doesn't need to be recognised*.
This includes sentences in which you wish to identify the first person.
** This often overlaps with the use of tense.

To exemplify observe the difference in tone the below sentences;

_I/we have defined this feature that can be used to ..._

_This feature is defined in a way that allows you to ..._

[NOTE]
====
These points are guidelines, not rules.
Make sure the text also flows, is consistent and makes sense.
====

== Use the present simple tense

Users refer to the documentation to find out how they can achieve the desired.
The present simple tense ensures the feeling of *walking the user through this process*.
It also makes the text *shorter*, *more understandable* and *more comfortable to read* than any other tense does.

[NOTE]
====
When describing things where the present simple does not make sense, you are free to use the *appropriate tense*.
====

== Use the second person pronouns

This makes documents sound *more engaging* as it involves the user directly.

The use of the second person also *removes gender specifics*, and *credits other contributors* (most of the time, multiple people worked on the same thing).

Additionally, it removes you, the creator, from the text, which is something you should be going for.

[TIP]
====
Articles are a great substitute for personal pronouns.
====

== Keep in mind who you are writing for

Even before you sit down and start writing, make sure you are *aware of your audience*.
Does the average person from your target audience know what you are talking about?

If you are unsure, either provide a brief explanation of the concept you are talking about or direct the reader to previous documents.
It is better to repeat then to have your readers confused.

Another thing to keep in mind is that *you are not writing for a friend*; make sure the documents you write reflect that.
Avoid using stylistically marked expressions, emojis, etc.

== Follow the KISS principle!

How many times have we given up on reading documentation because it was all just filler text to produce more and more pages?
I bet you wouldn't read these introductory paragraphs if you weren't forced to read through them.
The next sentence is the only thing that I wanted to state in this sub-section, so some of your time has successfully been wasted :) (Oh, look, the present simple tense isn't used here - as it would make no sense. The point? Know why you are doing what you are.).

Get *straight to the point* and tell the readers *exactly what they want to know* without wasting their time.

== Keep things structured

When reading, people usually *skim through the content* or stop altogether when what they are *looking for* has been found.

If we *don't make any separation* between different parts it *all becomes one big blob* of text.
If we *split things too much* our readers *might miss* any essential bits.

Things that *make sense together* should *stay together*, something that does not make sense together should not stand together. 

A great example of a poorly structured text is the paragraph in the 'Follow the KISS principle' section; no separation, mixing topics...
Strive to produce a straightforward text the is *easy to navigate* and *logically continuous*.

== Use admonition

When we want our reader to *pay extra attention* to something or when we want to *provide some helpful tips*, don't hesitate to use *admonition blocks*.

The reader is more likely to *pay extra attention* to something *important* if it is in a lovely red box with the word "Important" next to it.

== Use images. Sparingly.

*Don't provide excessive visual material* by showing every single step of a process or, even worse, by just pasting a screenshot with no context of what we are looking at.

[NOTE]
====
Refer to xref:documentation/annotations.adoc[] for instructions on image annotations.
====

When including images, make sure to *indicate what the image represents* and to provide an *image caption* that outlines *what goes on* in the image.
An image may allow the reader to *quickly refresh their memory* if they are already familiar with something.

[IMPORTANT]
====
Keep in mind that *UI changes* will require these images to be *updated*.
====

== Use syntax checkers (and semantics checkers)

Typos happen.
There are a lot of great, free tools, as well as some paid ones, that provide you with various types of suggestions for change and greater grammaticality of the text in production.


# src/modules/developer-guide/pages/index.adoc

include::ROOT:partial$variables.adoc[]

= Platform Developer Guide

The platform developer guide covers the process of developing on the core {PRODUCT_NAME} platform components.

The guide is designed for the core {PRODUCT_NAME} maintainers as well as open source contributors.

In case you wish to learn more about low-code app development, refer to the xref:integrator-guide:index.adoc[]

== GitHub repositories

The core {PRODUCT_NAME} codebase is located in the {GIT_MONOREPO_LINK}[`corteza` monorepo].
The monorepo includes the server, the web applications, NPM packages, and Discovery.
{PRODUCT_NAME} {APP_AUTOMATION} can be found in it's own {GIT_REPO_LINK_PREFIX}corteza-server-corredor[repository]

== Component diagram

image::build-pipelines.png[{PRODUCT_NAME} component diagram]

== Contribution checklist

All contributors should follow the contribution checklist to help maintain consistency and order as the project grows.

.The below table outlines the contribution checklist items:
[cols="1s,5a"]
|===
| [#contribution-checklist-implement]#<<contribution-checklist-implement,Implement>>#
|
Implement the bug fix, feature, or general improvement based on the GitHub issue tracker or own observations.

.The implementation should be consistent with the rest of the component:
* xref:corteza-server/index.adoc[{PRODUCT_NAME} server]
* xref:web-applications/index.adoc[Web applications]
* xref:corteza-js/index.adoc[corteza-js]
* xref:corteza-vue/index.adoc[corteza-vue]
* xref:documentation/index.adoc[documentation]

[NOTE]
====
*DevNote* add reference to the indexer when it is available
====

*External contributors* must submit their addition as a pull request which must be reviewed by a core contributor.

*Core contributors* may provide their addition directly to the version branches, but should still request peer reviews for larger modifications.

| [#contribution-checklist-test]#<<contribution-checklist-test,Test>>#
|
Define all of the required tests; unit, integration, and manual testing.
Any addition to the project should define at least the basic unit and integration tests to help assure system stability and ease future development.

[NOTE]
====
*DevNote* add reference to testing guidelines
====

| [#contribution-checklist-document]#<<contribution-checklist-document,Document>>#
|
Document your work so other contributors, low-code platform developers, and end-users know about your addition.

Refer to the xref:documentation/index.adoc[documentation documentation] for details regarding producing documentation.

|===

== Where to next

To learn more on how to setup and develop for each component, refer to xref:corteza-server/index.adoc[{PRODUCT_NAME} server], xref:web-applications/index.adoc[Web applications], xref:corteza-js/index.adoc[corteza-js], or xref:corteza-vue/index.adoc[corteza-vue].

To learn more about our release cycle and how we release the product (how the code is compiled and how images are built), refer to the xref:release-cycle/index.adoc[release cycle] documentation.

To learn how to contribute to the documentation, refer to the xref:documentation/index.adoc[documentation documentation].


# src/modules/developer-guide/pages/release-cycle/core-repos.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} Core Repositories

.A diagram outlining the release pipeline:
image::build-pipelines.png[{PRODUCT_NAME} build pipelines]

== Dependency warnings

Go over each repository and (try to) assure that there aren't any warnings with any of the dependencies.
GitHub provides a friendly system for this, so that shouldn't be an issue.

.Repositories:
. {GIT_MONOREPO_LINK}[`corteza`]: The monorepo containing the codebase for core {PRODUCT_NAME} features.
. {GIT_REPO_LINK_PREFIX}-server-corredor[`corteza-server-corredor`]: {APP_AUTOMATION} automation runner.
. {GIT_REPO_LINK_PREFIX}-docs[`corteza-docs`]: {PRODUCT_NAME} documentation.

== Building infrastructure

All {PRODUCT_NAME} repositories utilize GitHub workflows and actions to release server binaries, web application bundles, docker images, or other output formats.

== Versioning

Bump the version of the NPM packages, following the https://calver.org/[CalVer] standard; for example, `2020.9-rc.1`.

Released versions should also be tagged.

.Use this Git command to get it done:
[source,bash]
----
# $V is the version; for example export V=2021.9.0;
git tag $V && git push origin $V;
----

== NPM packages

[CAUTION]
====
The rest of the repositories depend on these two, so you should handle them first.
====

.A list of predefined decoders:
[cols="1s,5a"]
|===
| [#release-npp-js]#<<release-npp-js,`corteza-js`>>#
|
.Steps to release:
* remove node_modules and run `yarn`
* bump the version
* commit the changes
* tag the version
* run `yarn build` to build the package
* run `npm publish --dry-run` to test the publish
* run `npm publish` to publish
* push the changes and the created tag to the Github repository

| [#release-npp-vue]#<<release-npp-vue,`corteza-vue`>>#
|
.Steps to release:
* remove node_modules and run `yarn`
* bump the version
* run `yarn cdeps` to update all required {PRODUCT_NAME} dependencies
* commit the changes
* tag the version
* run `yarn build` to build the package
* run `npm publish --dry-run` to test the publish
* run `npm publish` to publish
* push the changes and the created tag to the Github repository
|===

== Web applications and Corredor server

.Steps to release:
* bump the version
* run `yarn cdeps` to update all required {PRODUCT_NAME} dependencies
* commit the changes
* tag the version
* push the changes and the created tag to the Github repository

.The steps defined above should be used for all core repositories:
. {GIT_MONOREPO_LINK}[`corteza`]: The monorepo containing the codebase for core {PRODUCT_NAME} features.
. {GIT_REPO_LINK_PREFIX}-server-corredor[`corteza-server-corredor`]: {APP_AUTOMATION} automation runner.

== Server

.Steps to release:
* commit the changes
* tag the version
* push the changes and the created tag to the Github repository

== Binaries & Bundles

All of the outputs are stored on the https://releases.{DOMAIN}/files.
When building the Docker images, the sources are taken from the storage mentioned above.

The Docker images are placed on the https://hub.docker.com/u/cortezaproject[DockerHub].

Unofficially, you can use the released packages with a Vagrant box {GIT_REPO_LINK_PREFIX}-vagrant.

Alternatively, you can (build and) install these packages manually, either on the virtual machine or a regular machine.


# src/modules/developer-guide/pages/release-cycle/docs.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} Docs

== When preparing a prerelease

. create a new branch `yyyy-qq-x` (`$V`)
. include the branch in the `antora-playbook.yml`
. change the version in the `src/antora.yml`

[source]
----
version: '$V'
prerelease: -develop
display_version: '$V-develop'
----

== When releasing

. switch to the branch you wish to release (`$V`)
. change the version in the `src/antora.yml`
. change the `page-latest` asciidoc attribute in `antora-playbook.yaml`

[source]
----
version: '$V'
----


# src/modules/developer-guide/pages/release-cycle/index.adoc

include::ROOT:partial$variables.adoc[]

= Release cycle

== Terminology

[cols="3s,9a"]
|===
| [#rc-terminology-major_version]#<<rc-terminology-major_version,Major version>>#
|
The major versions (referred to as a release) occur twice per year: the last weeks of March and September (previously quaterly with an additional release in June and December).
The versions are prefixed with full year and quarter number (`YYYY.Q`; the https://calver.org/[CalVer] standard); for example, `2020.12` indicates the last release of 2020.

| [#rc-terminology-version_branch]#<<rc-terminology-version_branch,Version branch>>#
|
A version branch contains the code included in that release; for example, the `2021.3.x` branch contains all of the code released in the `2021.3` version.
A version branch has a `.x` suffix and is created as soon as we start working on that version.

| [#rc-terminology-feature_branch]#<<rc-terminology-feature_branch,Feature branch>>#
|
A feature branch contains all of the code of the specific version; for example, the `2021.3.x-feature-workflow` branch contains all of the code for the initial workflow implementation.
A feature branch has a `-feature-<description>` suffix and is created as soon as we start working on that feature.
Feature branches are short-lived and are removed when the feature is merged into the <<rc-terminology-version_branch,version branch>>.

| [#rc-terminology-release]#<<rc-terminology-release,Release>>#
|
A release is a git tag on the latest stable commit on a version branch.
The git tag follows the pattern of `YYYY.Q.R`, where `R` represents an incremental number (0-based) of that release.
For example, `2021.3.0` indicates the first `2021.3` release.

| [#rc-terminology-patch_release]#<<rc-terminology-patch_release,Patch release>>#
|
A patch release is a git tag on the latest stable commit on an already released version branch.
The git tag follows the pattern of `YYYY.Q.R`, where `R` represents an incremental number (1-based) of that patch release.
For example, `2021.3.1` indicates the first `2021.3` patch release.

[NOTE]
====
A patch release is usually referred to as a "release".
====

| [#rc-terminology-dev_release]#<<rc-terminology-dev_release,Development Release (dev)>>#
|
A development release is an **unstable** release of features currently in the development and planned for the upcoming release.
The git tag follows the pattern of `YYYY.Q.R-dev.D`, where `D` represents an incremental number (1-based) of that release.
For example, `2021.3.0-dev.3` indicates the third `2021.3.0` dev release.

| [#rc-terminology-release_candidate]#<<rc-terminology-release_candidate,Release Candidate (RC)>>#
|
A release candidate is a git tag on the latest commit on a version branch.
Release candidate indicates the branch stability is getting ready for a major release. 
The git tag follows the pattern of `YYYY.Q.R-rc.C`, where `C` represents an incremental number (0-based) of that release.
For example, `2021.3.0-rc.3` indicates the fourth `2021.3.0` release candidate.

| [#rc-terminology-version]#<<rc-terminology-version,Version>>#
|
The term version may refer to ether one of the <<release,release>>, <<feature,feature>>, <<version_branch,version branch>>, <<patch_release,patch release>>, or <<release_candidate,release candidate>> terms

|===

== Git(Hub)

All of the development on {PRODUCT_NAME} is powered by Git and GitHub (GH).
To make development consistent and easy to follow, we've put in place a few rules the contributors need to follow.

=== Cleanup and rebase feature branches

Before the feature branch is merged into the release branch, it needs to be rebased with the release branch to reduce the diff size.
We recommend that you rebase regularly to reduce the potential merge conflicts.

Additionally, use the interactive rebase to reconstruct the git history that your feature branch introduces to make it cleaner and shorter.
History should tell a story.
Sometimes it's easier to recreate the entire commit history once you've finished the first version of the feature.

=== Merging the branch

If the source branch is small (a handful of commits), use a fast-forward merge (the merge without the merge commit).
If the source branch introduces significant changes (it introduces new features), use a non fast-forward merge (the merge with the merge commit).

[IMPORTANT]
====
Remove the branch after it is merged.
Only the core contributors are sometimes allowed to forget to do so.
====

=== Rename delayed feature branches

If a feature is delayed to the next release, rename the branch to match that release branch.
For example, if the `2020.12.x-feature-foo` gets delayed to the `2021.3.x`, the feature branch needs to be renamed to `2021.3.x-feature-foo`.

=== Avoid committing directly to the version branch

Minor changes (such as a hotfix) can skip the entire pull request process.
Larger changes should always go through the pull request process.

=== Back-porting

Bug fixes or improvements that also apply to the already released versions cherry-pick the commits to those version branches.
When back-porting, condense the change to a single commit with a clear and descriptive commit message.

=== In-progress version branch

Whenever a release occurs and the next set of version branches is created, the default GitHub branch is moved to the newly created version branch.
This makes it easier for new contributors while letting us showcase the latest and greatest version.

The in-progress version branch is expected to be rebased with the current release branch to defer the branch diversion because of post-release patches.
The rebasing usually stops when new features are being applied.

== FAQ

=== Why not Git flow?

Git flow is an excellent idea that works well on paper.
It abandons rebasing and makes project (git) history completely unreadable after a couple of merges.

=== Where is the `main` branch?

Keeping the `main` branch would make it difficult to know what version we are working with.
The use of version branches makes things more straightforward.


# src/modules/developer-guide/pages/web-applications/c3.adoc

include::ROOT:partial$variables.adoc[]

= C3

{PRODUCT_NAME} Component Catalogue (C3) is a tool for building UI components in an insulated environment, making it easier to develope independent components.

C3 was inspired by Storybook with the main difference of "hooking into" components instead of defining stories to outline the functionality.

[NOTE]
====
*DevNot* the core logic is in corteza-vue; update those docs as well.
====

[IMPORTANT]
====
C3 is only used in development mode.
In order to use C3, run the following command:

[source,bash]
----
yarn dev-env
----
====

== Structure overview

=== `src/dev-env.js`

The `src/dev-env.js` file defines all of the configuration required by the C3 feature; essentially it defines an insulated Vue application.

Refer to the https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/admin/src/dev-env.js[client/web/admin; /src/dev-env.js] for an example configuration.

[#c3-registry]
=== `components/C3.js`

The `components/C3.js` file is the main registry that defines components usable by the C3 feature.

Refer to the https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/admin/src/components/C3.js[client/web/admin; /src/components/C3.js] for an example configuration

=== `*.c3.js`

The `*.c3.js` file defines the C3 configuration for the given component.
Both the configuration file and the component file should share the same name.

For example, `CSubmitButton.vue` should define the `CSubmitButton.c3.js` configuration file.

== Adding new components

.To register the component in C3, you need to:
* define the `.c3.js` config file
* define the `.vue` component file
* register the component in the C3 registry

If done correctly, the output should look something like the following screenshot.

.The screenshot provides an example of showing the configuration button component inside the C3.
image::web-applications/c3-example-submit-button.png[]

=== Define the config file

The `.c3.js` config file should be named after the component itself.
To examplify; the `Button.vue` component should define the `Button.c3.js` configuration file.

.The configuration file reference:
[source,js]
----
const props = { <1>
  processing: false,
  success: false,
  disabled: true,
  buttonClass: 'mt-2 pt-1',
  variant: 'outline-primary',
  iconVariant: '',
}

export default {
  name : 'Submit button', <2>
  group : ['Root components'], <3>
  component, <4>
  props,

  controls: [ <5>
    checkbox('Processing', 'processing'),
    checkbox('Success', 'success'),
    checkbox('Disabled', 'disabled'),
    input('Button class', 'buttonClass'),
  ],

  scenarios: [ <6>
    { label: 'Full form',
      props,
    },
    { label: 'Empty form',
      props: {
        ...props,
        disabled: false,
        buttonClass: '',
      },
    },
  ],
}
----
<1> An object containing all of the properties that should be passed into the component when it is being rendered.
Additional properties can be passed through scenarios to modify based on needs.
<2> The name for the component.
<3> The group allows you to group common or related components together.
<4> The component itself.
<5> Defines the set of controls that can be used to interact with the components' properties.
The available controls are: `generic`, `input`, `textarea`, `checkbox`, and `select`.
<6> Scenarios define a set of predefined... scenarios to display how the component looks like with different states.

=== Add an entry to the C3 registry

To make the component available, you need to register it in <<c3-registry,the registry>>.

.An example of adding the `CSubmitButton` component:
[source,js]
----
// ...
// additional component imports
// ...
import { default as CSubmitButton } from './CSubmitButton.c3'

export default {
  // ...
  // additional components
  // ...

  CSubmitButton,
}
----

== Learning the C3 UI

.The screenshot provides an example of showing the configuration button component inside the C3.
image::web-applications/c3-example-submit-button.png[]

Registered components are available in the left navigation, nested based on their groups.

When opened, the component and it's controls are displayed on the right side of the screen.

On the top we have the component.

Bottom-left, we have the controls which allow us to modify the properties of the given scenario

Bottom-right, we have the pre-defined scenarios to outline the more important states the component can be in.


# src/modules/developer-guide/pages/web-applications/i18n.adoc

include::ROOT:partial$variables.adoc[]

= Internationalization

{PRODUCT_NAME} allows you to fully translate most aspect of the system.
From the user interface to custom {APP_NAME_COMPOSE} configurations such as modules and their fields.

Additionally, {PRODUCT_NAME} adjusts value formatting based on the locale, such as custom temporal and numerical strings.
Value formatting uses the native ECMAScript internationalization API.

== Structure overview

=== `corteza-js/src/formatting/datetime.ts`

The `corteza-js/src/formatting/datetime.ts` file defines the functions which should be used when localizing temporal values such as dates and timestamps.

The current implementation defines three functions which should be used for different applications.

* `fullDateTime`: outputs locally formatted date and time, no seconds.
* `date`: outputs locally formatted date without time.
* `time`: outputs locally formatted time.

=== `corteza-js/src/formatting/number.ts`

The `corteza-js/src/formatting/number.ts` file defines the functions which should be used when localizing numeric values.

== Usage

.Example use case:
[source,js]
----
import { fmt } from '@cortezaproject/corteza-js'

// ...

fmt.fullDateTime(sampleDate, optionalDateTimeFormat)
fmt.date(sampleDate, optionalDateTimeFormat)
fmt.time(sampleTime, optionalDateTimeFormat)
----

If you wish to test the output for different locales, you will need to change the locale in your browser settings.
{PRODUCT_NAME} will respond to the change and use the newly assigned locale.

== Modify formatting

To modify the default formatting, pass in the https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat[`Intl.DateTimeFormat`] object as the last argument to the function call.

.An example of overwriting the default format:
[source,js]
----
fmt.fullDateTime(sampleDate, {
  day: "numeric",
  month: "numeric",
  year: "numeric",
  hour: "numeric",
  minute: "numeric",
})
----

[NOTE]
====
Refer to the https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat[`Intl.DateTimeFormat documentation`] for details.
====

=== Custom format reference

.`dateStyle`:
* `full`
* `long`
* `medium`
* `short`

.`timeStyle`:
* `full`
* `long`
* `medium`
* `short`

.`year`:
* `numeric` (example output: `2012`)
* `2-digit` (example output: `12`)

.`month`:
* `numeric` (example output: `2`)
* `2-digit` (example output: `02`)
* `long` (example output: `March`)
* `short` (example output: `Mar`)
* `narrow` (example output: `M`)

.`day`:
* `numeric` (example output: `1`)
* `2-digit` (example output: `01`)

.`minute`:
* `numeric`
* `2-digit`

.`second`:
* `numeric`
* `2-digit`

== RTL Support

{PRODUCT_NAME} provides right to left support with the following languages:

* Arabic
* Hebrew
* Pashto
* Persian
* Urdu
* Sindhi

# src/modules/developer-guide/pages/web-applications/index.adoc

include::ROOT:partial$variables.adoc[]

= Web Applications

The web applications are written in https://vuejs.org/[Vue.js] and provide the user interface to interact with the entire system.

The core web applications are located inside the {GIT_MONOREPO_LINK}[`corteza`] monorepo under `client/web`.

Communication between the {PRODUCT_NAME} server and web applications is done using the REST API and web sockets.

== Development setup

=== Fork the {PRODUCT_NAME} web application

[NOTE]
====
Core contributors should skip this part.
====

. go to the {GIT_MONOREPO_LINK} repository
. click on the btn:[Fork] button in the top right corner and follow the instructions on the screen.

=== Clone the repository

.Using the CLI:
. open the CLI
. navigate to your working folder
. run the `git clone git@github.com:cortezaproject/corteza.git` command

[TIP]
====
Refer to the repository if you wish to use an alternative method.
====

=== Configure the environment

.Inside your web application directory:
. run `cp public/config.example.js public/config.js` for _Linux_, or in `public` folder run `copy config.example.js config.js` for _Windows_
. open the `config.js` file using VIM, Nano, or any other editor and modify the configuration as you see fit

=== Set the API

.Define the API in the `public/config.js` by setting:
[source,js]
----
window.CortezaAPI = '$BASE_URL'
----

The `$BASE_URL` parameter is the location of your {PRODUCT_NAME} server.
If you are running the server on http://localhost:80, then the value should be `http://localhost:80/api`.

=== Set the authentication API

{PRODUCT_NAME} web applications authenticate the user using an OAuth2 flow.

This part can be skipped when using the same {PRODUCT_NAME} server for authentication and processing.
The web application will generate the authentication endpoints based on the `CortezaAPI` parameter.

.Define the authentication API in the `public/config.js` by setting:
[source,js]
----
window.CortezaAuth = '$BASE_URL/auth'
----

=== Assure dependencies

[CAUTION]
====
When using modified versions of `corteza-js` and `corteza-vue`, make sure to link them using `yarn link @cortezaproject/corteza-js` and `yarn link @cortezaproject/corteza-vue`.
====

Run the `yarn` command to assure that all of the packages are present and up to date.

See the `package.json` file for the supported Node.js versions.

=== Run the web application

Run the `yarn serve` command to start the web application.
You can use an optional `--port $POST` flag to specify what port it should run on.


# src/modules/developer-guide/pages/web-applications/record-list-filtering.adoc

include::ROOT:partial$variables.adoc[]

= Record list filter

The record list filter provides a set of components which allow you to provide flexible record filtering.

Refer to the https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/compose/src/components/PageBlocks/RecordListBase.vue[record list implementation] for an example usage.

[NOTE]
====
In future releases, the component may become generalized for different applications.
====

== Structure overview

=== `components/Common/RecordListFilter.vue`

The `components/Common/RecordListFilter.vue` file defines the core components of the record list filter feature.

.Example usage:
[source,js]
----
<record-list-filter
    :selectedField="field.moduleField" <1>
    :namespace="namespace" <2>
    :module="recordListModule" <3>
    :recordListFilter="recordListFilter" <4>
    @filter="onFilter"
/>
----
<1> the `selectedField` property defines the default field that should be used when defining filters.
<2> the `namespace` property defines the namespace object we are defining the filter based on.
<3> the `module` property defines the module object we are defining the filter based on.
<4> the `recordListFilter` property defines the filter you wish to show in the given component.

=== `/src/lib/record-filter.js`

The `/src/lib/record-filter.js` file defines the logic for converting the output of the `RecordListFilter` component into a query which can be used with the {PRODUCT_NAME} server.

.Example usage:
[source,js]
----
import { queryToFilter } from 'corteza-webapp-compose/src/lib/record-filter'
----


# src/modules/developer-guide/pages/web-applications/structure.adoc

include::ROOT:partial$variables.adoc[]

= Structure

== `/public`

The `/public` directory contains resources that should be accessible by the web application as is, such as the configuration file and the logo.

== `/src`

The `/src` directory contains the core logic of the web application.
The core initializes the Vue application, registers global components, plugins, mixins and the store.

== `/src/components`

The `/src/components` directory contains all of the components used throughout the entire web application or by a single view.

== `/src/i18n`

The `/src/i18n` directory contains internationalization assets used by i18next.

The `/src/i18n/index.js` must determine what locale to use and then load the appropriate set of i18n assets.
The assets should be grouped by the language and what part of the UI they exist for.

== `/src/mixins`

The `/src/mixins` directory contains the mixins used throughout the web application, either globally or locally.
The common mixins are imported from the `corteza-vue` repository.

== `/src/plugins`

The `/src/plugins` directory contains the plugins that are used throughout the web application.
The common plugins are imported from the `corteza-vue` repository.

== `/src/store`

The `/src/store` directory contains the Vuex store definition and management logic.
You should use the store to store data that needs to be available across different components, such as compose modules and system users.

== `/src/themes`

The `/src/themes` directory contains the assets that are used to style the web application.
You should place all of the styling code here instead of in components.

== `/src/views`

The `/src/views` directory contains all of the available views of the web application and their router definitions.


# src/modules/developer-guide/partials/documentation/annotation-cropped.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/annotation-canvas.png",
    "alias": "annotation-canvas_cropped-note",
    "w": 1000,
    "h": 1000
  },
  "view": {
    "x": 500,
    "y": 0,
    "w": 500,
    "h": 500
  },
  "annotations": [{
    "kind": "box-note",
    "x": 611,
    "y": 203,
    "w": 279,
    "h": 95
  }]
}
----


# src/modules/developer-guide/partials/documentation/annotation-danger.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/annotation-canvas.png",
    "alias": "annotation-canvas_danger",
    "w": 1000,
    "h": 1000
  },
  "view": {},
  "annotations": [{
    "kind": "box-danger",
    "x": 111,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-danger",
    "x": 611,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-danger",
    "x": 111,
    "y": 703,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-danger",
    "x": 611,
    "y": 703,
    "w": 279,
    "h": 95
  }]
}
----


# src/modules/developer-guide/partials/documentation/annotation-note.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/annotation-canvas.png",
    "alias": "annotation-canvas_note",
    "w": 1000,
    "h": 1000
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 111,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-note",
    "x": 611,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-note",
    "x": 111,
    "y": 703,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-note",
    "x": 611,
    "y": 703,
    "w": 279,
    "h": 95
  }]
}
----


# src/modules/developer-guide/partials/documentation/annotation-padding.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/annotation-canvas.png",
    "alias": "annotation-canvas_padding",
    "w": 1000,
    "h": 1000
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "padding": "xs",
    "x": 111,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-note",
    "padding": "sm",
    "x": 611,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-note",
    "padding": "md",
    "x": 111,
    "y": 703,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-note",
    "padding": "lg",
    "x": 611,
    "y": 703,
    "w": 279,
    "h": 95
  }]
}
----


# src/modules/developer-guide/partials/documentation/annotation-success.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/annotation-canvas.png",
    "alias": "annotation-canvas_success",
    "w": 1000,
    "h": 1000
  },
  "view": {},
  "annotations": [{
    "kind": "box-success",
    "x": 111,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-success",
    "x": 611,
    "y": 203,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-success",
    "x": 111,
    "y": 703,
    "w": 279,
    "h": 95
  }, {
    "kind": "box-success",
    "x": 611,
    "y": 703,
    "w": 279,
    "h": 95
  }]
}
----


# src/modules/developer-guide/partials/documentation/focus-annotation.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/example-focus.png",
    "alias": "focus-annotated",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "w": 267,
    "h": 253,
    "x": 542,
    "y": 515,
    "padding": 10
  },
  "annotations": [{
    "kind": "box-note",
    "x": 542,
    "y": 515,
    "w": 267,
    "h": 253
  }]
}
----


# src/modules/developer-guide/partials/documentation/focus.adoc

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "documentation/example-focus.png",
    "alias": "focus-base",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "w": 267,
    "h": 253,
    "x": 542,
    "y": 515,
    "padding": 10
  },
  "annotations": []
}
----


# src/modules/devops-guide/nav.adoc

* xref:index.adoc[]

** xref:system-requirements.adoc[]

** Maintenance
*** xref:maintenance/backups.adoc[]
*** xref:maintenance/database-password.adoc[]
*** xref:maintenance/sql-snippets.adoc[]

** xref:troubleshooting/index.adoc[]
*** xref:troubleshooting/health-check.adoc[]
*** xref:troubleshooting/logging.adoc[]
*** xref:troubleshooting/web-console.adoc[]

** xref:access-control/index.adoc[]
*** xref:access-control/optimize-rbac-system-resource-usage.adoc[]

** xref:discovery/index.adoc[]
** xref:i18n/index.adoc[]
** xref:email-relay.adoc[]
** xref:sink-route.adoc[]
** xref:pdf-renderer.adoc[]
** xref:server-plugins/index.adoc[]
** xref:installing-sass/index.adoc[]

** References
*** System Configuration
**** xref:references/configuration/server.adoc[]
**** xref:references/configuration/corredor.adoc[]
*** Command Line Interface
**** xref:references/cli-reference.adoc[]

** Examples
*** Command Line Interface
**** xref:examples/cli/record-import.adoc[]
**** xref:examples/cli/resource-translation-import.adoc[]
*** xref:examples/deploy-offline/index.adoc[]
**** xref:examples/deploy-offline/multi-mysql.adoc[]
**** xref:examples/deploy-offline/single-sqlite-inmem.adoc[]
*** xref:examples/deploy-online/index.adoc[]
**** xref:examples/deploy-online/multi-mysql.adoc[]
**** xref:examples/deploy-online/multi-pgsql.adoc[]
// **** xref:examples/deploy-online/single-mysql.adoc[]
// **** xref:examples/deploy-online/single-pgsql.adoc[]

** Miscellaneous
*** xref:miscellaneous/containerized-storage.adoc[]
*** Benchmarks
**** xref:miscellaneous/benchmark-classic.adoc[]
**** xref:miscellaneous/benchmark-dedicated.adoc[]

** xref:upgrade/index.adoc[]
*** xref:upgrade/202303.adoc[]
*** xref:upgrade/202209.adoc[]
*** xref:upgrade/202109.adoc[]
*** xref:upgrade/202103.adoc[]
*** xref:upgrade/202012.adoc[]
*** xref:upgrade/202009.adoc[]
*** xref:upgrade/202003.adoc[]


# src/modules/devops-guide/pages/access-control/index.adoc

include::ROOT:partial$variables.adoc[]

= Access Control
:page-aliases: 2024.9@maintenance/access-control.adoc

{PRODUCT_NAME} defines three particular role types which need to be registered in the `.env` file.

.The role types:
* Bypass: `RBAC_BYPASS_ROLES`; defaults to `super-admin`.
Bypass roles may *not* appear in any of the other lists.
* Authenticated: `RBAC_AUTHENTICATED_ROLES`; defaults to `authenticated`.
Authenticated roles may *not* appear in any of the other lists.
* Anonymous: `RBAC_ANONYMOUS_ROLES`; defaults to `anonymous`.

The `.env` variables accept a space-delimited list of role handles.

[CAUTION]
====
{PRODUCT_NAME} will refuse to start if the role type configuration is invalid or the roles don't exist.
====


# src/modules/devops-guide/pages/access-control/optimize-rbac-system-resource-usage.adoc

include::ROOT:partial$variables.adoc[]

= Optimize RBAC System Resource Usage

{PRODUCT_NAME} access control, from version xref:ROOT:changelog/202409/index.adoc[] forth, allows system administrators to control system resource usage.
Prior versions, to provide best performance possible, pulled the entire access control model to memory which proved to be ineffective for a subset of use-cases.
Refer to the xref:devops-guide:references/configuration/server.adoc[] for details on available configuration options.

[IMPORTANT]
====
Refer to the <<#most-common-scenarios>> section to determine if this makes sense for you.
====

== How it Works

The original implementation held the entire security context in an in-memory index.
The index is now split up into the following components:

* `The in-memory index` which holds a portion (or the entire) security context in-memory.
* `The counter` which holds some metadata regarding system access and what resources make the most sense to keep in memory.
* `The service` which ties all the new pieces together, combining the in-memory and database-stored security context.
* `Service performance logger` which stores some metadata regarding system access, index hits, index misses, and timings.

[NOTE]
====
To avoid preserving previously held resources which are no longer used, the counter applies a decay factor.
====

Whenever the service determines the in memory state needs to re-evaluate, it looks up the counters' state to determine what is used the most.

== Monitoring

To monitor your system, we recommend inspecting both system resource utilization along with inspecting the `/system/stats/` endpoint.

.The `/system/stats/` endpoint reports the following parameters:
* `cacheHits` reports the total number of access evaluation requests pulled from the index.
* `cacheMisses` reports the total number of access evaluation requests pulled from the database.
* `cacheUpdates` reports the total number of cache updates.
* `avgDbTiming` reports the average cache miss timing in nanoseconds (includes both preparing the query and parsing results).
* `minDbTiming` reports the minimum cache miss timing in nanoseconds (includes both preparing the query and parsing results).
* `maxDbTiming` reports the maximum cache miss timing in nanoseconds (includes both preparing the query and parsing results).
* `avgIndexTiming` reports the average cache hit timing in nanoseconds.
* `minIndexTiming` reports the minimum cache hit timing in nanoseconds.
* `maxIndexTiming` reports the maximum cache hit timing in nanoseconds.
* `indexSize` reports the current index size.
* `lastHits` reports the last 500 index hits.
* `lastMisses` reports the last 500 index misses.
* `lastDbTimings` reports the last 500 cache miss timings.
* `lastIndexTimings` reports the last 500 cache hit timings.
* `counters` reports the current counter states.

[#most-common-scenarios]
== Most Common Scenarios

=== Low-Power Server

In case you're running {PRODUCT_NAME} on a server with heavily limited resources (primarily focusing on RAM), consider limiting the index size or turning in memory indexing all together.

[NOTE]
====
To disable in memory indexing, set `RBAC_MAX_INDEX_SIZE=0`
====

=== Large Number of RBAC Rules

In case you're not doing role composition or you're implementing role hierarchy/access on a more granular approach, your system might programmatically assigning roles and rules to all or most {PRODUCT_NAME} {APP_NAME_COMPOSE}.
If that's the case, you might want to limit the in memory index size based on your system.


# src/modules/devops-guide/pages/discovery/index.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} {APP_NAME_DISCOVERY}
:keywords: discovery, search, record searcher, record searching, resource searcher, resource searching, data discovery
:description: Learn how to configure the system to support {PRODUCT_NAME} {APP_NAME_DISCOVERY}

{PRODUCT_NAME} {APP_NAME_DISCOVERY} provides a powerful search engine to interact with your data.
{PRODUCT_NAME} {APP_NAME_DISCOVERY} defines an intuitive interface to search and, in some cases, visualizes the data such as geographical metadata.

Refer to the xref:integrator-guide:discovery/index.adoc[menu:Low-Code Platform Developer Guide[{PRODUCT_NAME} {APP_NAME_DISCOVERY}]] to learn how to configure and use {PRODUCT_NAME} {APP_NAME_DISCOVERY}.

== Configuring {PRODUCT_NAME} Server

To enable {PRODUCT_NAME} {APP_NAME_DISCOVERY}, access the Docker container and run the following commands:

.Enable {PRODUCT_NAME} {APP_NAME_DISCOVERY} for {APP_NAME_COMPOSE} namespaces:
[source,bash]
----
corteza-server settings set discovery.compose-namespaces.enabled true
----

.Enable {PRODUCT_NAME} {APP_NAME_DISCOVERY} for {APP_NAME_COMPOSE} modules:
[source,bash]
----
corteza-server settings set discovery.compose-modules.enabled true
----

.Enable {PRODUCT_NAME} {APP_NAME_DISCOVERY} for {APP_NAME_COMPOSE} records:
[source,bash]
----
corteza-server settings set discovery.compose-records.enabled true
----

.Enable {PRODUCT_NAME} {APP_NAME_DISCOVERY} for users:
[source,bash]
----
corteza-server settings set discovery.system-users.enabled true
----

.Next, set the following `.env` variables for your {PRODUCT_NAME} server:
[source,env]
----
DISCOVERY_ENABLED=true
DISCOVERY_BASE_URL=your-discovery-server-base-url
# Optional variable for debugging
# DISCOVERY_DEBUG=true
----

[NOTE]
====
For an example of an online deployment, refer to xref:examples/deploy-online/multi-discovery-pgsql.adoc[].
====

[NOTE]
====
To access the Docker container, run the following command:

[source,bash]
----
docker-compose exec server bash
----
====


# src/modules/devops-guide/pages/email-relay.adoc

include::ROOT:partial$variables.adoc[]

= Email Relay
:page-aliases:  2024.9@extension-requirements/email-relay.adoc
:description: {PRODUCT_NAME} allows you to detect and react to incoming emails via automation scripts.
:keywords: dev-ops, DevOps, email relay, automation scripts

{PRODUCT_NAME} allows you to detect and react to incoming emails via automation scripts.
You can implement automatic responses, create records based on the email content, and forward the email to your supervisor.

[NOTE]
====
Here, only how to setup an email relay is covered.
Refer to the xref:integrator-guide:index.adoc[low-code platform developer guide] for details on using this feature.
====

// Move this to the low-code platform developer guide
//
// [IMPORTANT]
// ====
// Automation script examples that cover email relays assume that you've followed these instructions.

// If not, the example may not work as expected.
// ====

[NOTE]
====
*DevNote* provide a nice little diagram outlining this.
====

.Flow outline:
. Postfix (or similar) forwards the email to the sink API endpoint,
. {PRODUCT_NAME} sink service processes the payload to prepare an automation script event,
. the event is dispatched on the event bus, executing any automation scripts that match the event constraints.

== {PRODUCT_NAME} Setup

Internally, email relays use sink routes, a sink route signature must be generated.
See xref:sink-route.adoc[] on how to set that up.

[IMPORTANT]
====
Make sure to specify a `--content-type email`.
====

== Post-fix Setup

[IMPORTANT]
====
Make sure to change the parameters to fit your environment.
====

.Edit `/etc/postfix/main.cf`:
[source,text]
----
virtual_alias_maps = pcre:/etc/postfix/virtual_alias
----

.Add virtual alias to `/etc/postfix/virtual_alias`:
[source,text]
----
# Catch-all for corteza.domain.tld and redirect it to corteza_sink mailbox
/.+@corteza\.domain\.tld$/ corteza_sink
----

.Update virtual-alias map/db file, and restart postfix
[source,bash]
----
postmap /etc/postfix/virtual_alias
postfix reload
----

.Add entry to `/etc/aliases`
[source,bash,subs="attributes"]
----
corteza_sink: "| curl --data-binary @- '{API_SYSTEM_BASE_URL}/sink?content-type=email&expires=&method=POST&origin=postfix&__sign=187...3D'"
----

[NOTE]
====
The above forwards any email for a specific mailbox to a curl command, which then pushes that raw email to the sink endpoint on the {PRODUCT_NAME} API.
====

.Update aliases
[source,bash]
----
newaliases
----

== Testing Post-fix Changes

[NOTE]
====
We recommend using a different machine -- one that is not running postfix.
====

You can verify if everything works correctly by either sending an email to the configured address or with a simple CLI command:

[source,bash]
----
# Make sure to change `test@corteza.domain.tld`.
echo "hello corteza"|mail -s 'hello' test@corteza.domain.tld
----

This produces a new entry in your mail log (usually `/var/log/mail.log`) for the test email, along with a log that looks something in the lines of:

[source,text]
----
postfix/smtpd[23155]: connect from some-host.tld[xxx.xxx.xxx.xxx]
postfix/smtpd[23155]: 277AF5C1B78: client=some-host.tld[xxx.xxx.xxx.xxx]
postfix/cleanup[23159]: 277AF5C1B78: message-id=<b808218e-ce41-6cbf-cb4f-be2b4cf8f776@crust.tech>
postfix/qmgr[14490]: 277AF5C1B78: from=<sender@some-host.tld>, size=1476, nrcpt=1 (queue active)
postfix/smtpd[23155]: disconnect from some-host.tld[xxx.xxx.xxx.xxx] ehlo=2 starttls=1 mail=1 rcpt=1 data=1 quit=1 commands=7
postfix/local[23160]: 277AF5C1B78: to=<corteza_sink@my-server>, orig_to=<demo@corteza.domain.tld>, relay=local, delay=0.67, delays=0.03/0.01/0/0.62, dsn=2.0.0, status=sent (delivered to command:  curl --data-binary @- 'https://api.your-corteza-instance.tld/system/sink?content-type=email&expires=&method=POST&origin=postfix&__sign=187...3D')
postfix/qmgr[14490]: 277AF5C1B78: removed
----

[TIP]
====
If nothing happens when you send an email, it is possible that there is a firewall issue and blocked ports.
====

== Testing {PRODUCT_NAME}

To test whether your sink signature and automaton script are setup correctly, you can use the following command:

[source,bash,subs=attributes]
----
echo "
From: &lt;sender@cortezaproject.org&gt;
To: &lt;test@corteza.domain.tld&gt;
Subject: hello
Message-ID: &lt;1234@local.machine.example&gt;

Ola Corteza!
" | curl -i --data-binary @- "{API_SYSTEM_BASE_URL}/sink?content-type=email&expires=&method=POST&origin=postfix&__sign=187...3D"
----

If this command does not return a `200 OK` response, it means that something is misconfigured.
Refer to system logs to see exactly where the issue lies.


# src/modules/devops-guide/pages/examples/cli/record-import.adoc

include::ROOT:partial$variables.adoc[]

= Import {APP_NAME_COMPOSE} Records
:page-aliases: 2024.9@cli/record-import.adoc

[IMPORTANT]
====
`2021.9.5` patch release requires you to provide module field definitions along with record import definitions (note the module fields entries in the `defs.yaml` -- snippet below).
If the field definitions are not provided, the import process errors out with missing field errors.
This requirement will be lifted in a future patch release.
====

[CAUTION]
====
Before importing larger datasets (especially to production), it is advised to make a database backup and to test the configuration locally or on a staging server.
====

.To import {APP_NAME_COMPOSE} records you need to:
. Prepare the source files -- the CSV or JSONL files and the definition file(s),
. run the command.

== Source Files

Prepare a directory where all of your source files reside in.

.`/import`:
[source]
----
/import
  /aa.csv
  /bb.csv
  /cc.csv
  /defs.yaml
----

The `.csv` files contain the records we wish to import, and the `defs.yaml` provides all of the import definitions.

[TIP]
====
You can use multiple definition files, for example one per module.
====

[TIP]
====
You can provide import definition inside your provision YAML files.
====

.`defs.yaml`:
[source,yaml]
----
namespace: my-namespace
modules:
  aa:
    fields:
      f1:
        kind: String
        label: f1
    records: <1>
      source: aa.csv <2>
      key: id <3>
      mapping: <4>
        id: / <5>
        f1: <6>
          field: f1 <7>
  bb:
    fields:
      ref_a:
        kind: Record
        label: ref_a
        options:
          module: aa
      f1:
        kind: String
        label: f1
    records:
      source: bb.csv
      key: id
      mapping:
        id: /
        ref_a:
          field: ref_a
        f1:
          field: f1
  cc:
    fields:
      ref_a:
        kind: Record
        label: ref_a
        options:
          module: aa
      ref_b:
        kind: Record
        label: ref_b
        options:
          module: bb
      f1:
        kind: String
        label: f1
    records:
      source: cc.csv
      key: id
      mapping:
        id: /
        ref_a:
          field: ref_a
        ref_b:
          field: ref_b
        f1:
          field: f1
----
<1> The `records` key contains the record import definitions.
<2> The `source` key specifies what source file should be used (the name of the file).
<3> The `key` key specifies what column should be used as the identifier for the record when matching references.
<4> The `mapping` key specifies how the sources columns should be mapped to the module fields.
<5> When you use the `/` instead of a module field, the column is omitted.
<6> The key of the map defines the column of the source.
<7> The field defines the module field the column value should be mapped to.

.`aa.csv`:
[source,csv]
----
id,f1
aa_1,aa_v_1
aa_2,aa_v_2
aa_3,aa_v_3
----

.`bb.csv`:
[source,csv]
----
id,ref_a,f1
bb_1,aa_1,bb_v_1
bb_2,aa_1,bb_v_2
bb_3,aa_1,bb_v_3
bb_4,aa_2,bb_v_4
bb_5,aa_2,bb_v_5
bb_6,aa_3,bb_v_6
bb_7,aa_3,bb_v_7
----

[NOTE]
====
Notice how the `ref_a` column in the `bb.csv` file references the `id` column in the `aa.csv` file.
====

.`cc.csv`:
[source,csv]
----
id,ref_a,ref_b,f1
cc_1,aa_1,bb_1,cc_v_1
cc_2,aa_1,bb_1,cc_v_2
cc_3,aa_3,bb_1,cc_v_3
cc_4,aa_3,bb_1,cc_v_4
cc_5,aa_3,bb_6,cc_v_5
cc_6,aa_3,bb_7,cc_v_6
----

== Running the Import

Use the xref:references/cli-reference.adoc#import[import CLI command] to import your records.

The argument to the CLI command needs to be the location of the source files, in our above case this is `/import`.

.An example of running the CLI command for our case:
[source,bash]
----
corteza-server import --merge-left-existing /import
----

== Updating Records

[NOTE]
====
If you wish to update your records using the import CLI command, you must use the record ID that {PRODUCT_NAME} assigned to the original.
The identification process is subject to change in future versions.
====

Below is an example of updating records of three modules.

[CAUTION]
====
The values provided under the `id` column will be different for your example.
====

.`aa.csv`:
[source,csv]
----
id,f1
262499403762254961,aa_v_1 (EDITED aa_v_1)
262499403779032177,aa_v_2 (EDITED aa_v_2)
262499403779097713,aa_v_3 (EDITED aa_v_3)
----

.`bb.csv`:
[source,csv]
----
id,ref_a,f1
262499403779163249,262499403762254961,bb_v_1 (EDITED bb_v_1)
262499403779228785,262499403762254961,bb_v_2 (EDITED bb_v_2)
262499403795809393,262499403762254961,bb_v_3 (EDITED bb_v_3)
262499403795874929,262499403779032177,bb_v_4 (EDITED bb_v_4)
262499403795940465,262499403779032177,bb_v_5 (EDITED bb_v_5)
262499403796006001,262499403779097713,bb_v_6 (EDITED bb_v_6)
262499403796071537,262499403779097713,bb_v_7 (EDITED bb_v_7)
----

.`cc.csv`:
[source,csv]
----
id,ref_a,ref_b,f1
262499403796137073,262499403762254961,262499403779163249,cc_v_1 (EDITED cc_v_1)
262499403812586609,262499403762254961,262499403779163249,cc_v_2 (EDITED cc_v_2)
262499403812652145,262499403779097713,262499403779163249,cc_v_3 (EDITED cc_v_3)
262499403812717681,262499403779097713,262499403779163249,cc_v_4 (EDITED cc_v_4)
262499403812783217,262499403779097713,262499403796006001,cc_v_5 (EDITED cc_v_5)
262499403812848753,262499403779097713,262499403796071537,cc_v_6 (EDITED cc_v_6)
----


# src/modules/devops-guide/pages/examples/cli/resource-translation-import.adoc

include::ROOT:partial$variables.adoc[]

= Importing Resource Translations
:page-aliases: 2024.9@cli/resource-translation-import.adoc

[IMPORTANT]
====
After you have imported the translations, you need to restart the server for the changes to take affect.
Translations are kept in-memory of the process running the server.
We are looking into improving this in the future releases.
====

[CAUTION]
====
Before importing larger datasets (especially to production), it is advised to make a database backup and to test the configuration locally or on a staging server.
====

.To import resource translations you need to:
. Prepare the source files,
. run the command.

== Source Files

Prepare a directory where all of your source files reside in.

.`/import`:
[source]
----
/import
  /corteza::compose:module.yaml
  /corteza::compose:namespace.yaml
  /resource-translation.yaml
----

The `resource-translation.yaml` file contains the resource translations you wish to import, and the other two files,(`corteza::compose:module.yaml` and `corteza::compose:namespace.yaml`) contain the definitions for the resources we are applying the translations for.

[IMPORTANT]
====
The current resource-translations importer requires you to provide the definitions for the resources you are applying the translations for.
We are looking in improving this in the future releases
====

== Running the Import

Use the xref:references/cli-reference.adoc#import[import CLI command] to import your resource-translations.

The argument to the CLI command needs to be the location of the source files, in our above case this is `/import`.

[NOTE]
====
By default, the import CLI command skips already existing resources.

.You can control the behavior using the following flags:
[source]
----
--merge-left-existing             Update any existing values; existing data takes priority. Default skips.
--merge-right-existing            Update any existing values; new data takes priority. Default skips.
--replace-existing                Replace any existing values. Default skips.
----

====

.An example of running the CLI command for our case:
[source,bash]
----
corteza-server import /import
----


# src/modules/devops-guide/pages/examples/deploy-offline/index.adoc

= Offline Deployment Examples

:leveloffset: +1

include::./multi-mysql.adoc[]

include::./single-sqlite-inmem.adoc[]

:leveloffset: -1


# src/modules/devops-guide/pages/examples/deploy-offline/multi-mysql.adoc

= Multi-image MySQL
:page-aliases: 2024.9@offline-deployment/multi-mysql.adoc, 2024.9@offline-deployment/single-mysql.adoc
:page-noindex: true

[NOTE]
====
*DevNote*: Describe this configuration; how many/what services it runs and things like that.
====

.`docker-compose.yaml`
[source,yaml]
----
include::example$deploy/local-mysql/docker-compose.yaml[]
----

.`.env`
[source,yaml]
----
include::example$deploy/local-mysql/env-example.txt[]
----


# src/modules/devops-guide/pages/examples/deploy-offline/single-sqlite-inmem.adoc

= Single Image SQLite in Memory
:page-aliases: 2024.9@offline-deployment/single-sqlite-inmem.adoc, 2024.9@offline-deployment/single-sqlite.adoc
:page-noindex: true

[NOTE]
====
*DevNote*: Describe this configuration; how many/what services it runs and things like that.
====

.`docker-compose.yaml`
[source,yaml]
----
include::example$deploy/local-in-mem/docker-compose.yaml[]
----


# src/modules/devops-guide/pages/examples/deploy-online/index.adoc

= Online Deployment Examples

:leveloffset: +1

include::./multi-mysql.adoc[]

include::./multi-pgsql.adoc[]

include::./multi-discovery-pgsql.adoc[]

// include::./single-mysql.adoc[]

// include::./single-pgsql.adoc[]

:leveloffset: -1


# src/modules/devops-guide/pages/examples/deploy-online/multi-discovery-pgsql.adoc

= Multi-image Discovery with PostgreSQL
:page-noindex: true

[NOTE]
====
Currently Corteza Discovery is tested on a running production servers in combination with PostgreSQL database, but should work with the latest MySQL versions.
Beside the `server` and `db` containers, there should be also the indexer (`es`) and the searcher (`discovery`) running.
====

.`docker-compose.yaml`
[source,yaml]
----
include::example$deploy/prod-discovery-pgsql/docker-compose.yaml[]
----

.`.env`
[source,env]
----
include::example$deploy/prod-discovery-pgsql/env-example.txt[]
----


# src/modules/devops-guide/pages/examples/deploy-online/multi-mysql.adoc

= Multi-Image MySQL
:page-aliases: 2024.9@online-deployment/multi-mysql.adoc, 2024.9@online-deployment/single-mysql.adoc
:page-noindex: true

[NOTE]
====
*DevNote*: Describe this configuration; how many/what services it runs and things like that.
====

.`docker-compose.yaml`
[source,yaml]
----
include::example$deploy/prod-mysql/docker-compose.yaml[]
----

.`.env`
[source,env]
----
include::example$deploy/prod-mysql/env-example.txt[]
----


# src/modules/devops-guide/pages/examples/deploy-online/multi-pgsql.adoc

= Multi-Image PostgreSQL
:page-aliases: 2024.9@online-deployment/multi-pgsql.adoc, 2024.9@online-deployment/single-pgsql.adoc
:page-noindex: true

[NOTE]
====
*DevNote*: Describe this configuration; how many/what services it runs and things like that.
====

.`docker-compose.yaml`
[source,yaml]
----
include::example$deploy/prod-pgsql/docker-compose.yaml[]
----

.`.env`
[source,env]
----
include::example$deploy/prod-pgsql/env-example.txt[]
----


# src/modules/devops-guide/pages/examples/deploy-online/single-mysql.adoc

= Single-Image MySQL

[source,txt]
----
- target file structure
- raw config files
- exclude any meta text such as run commands and such...
----


# src/modules/devops-guide/pages/examples/deploy-online/single-pgsql.adoc

= Single-Image PostgreSQL

[source,txt]
----
- target file structure
- raw config files
- exclude any meta text such as run commands and such...
----


# src/modules/devops-guide/pages/i18n/index.adoc

include::ROOT:partial$variables.adoc[]

= Internationalization
:page-aliases: 2024.9@maintenance/i18n.adoc

{PRODUCT_NAME} allows you to fully translate most aspect of the system.
From the <<ui-translations,user interface>> to custom <<resource-translations,{APP_NAME_COMPOSE} configurations>> such as modules and their fields.

User interface translations are provided via static `.yaml` files, which are bundled into the `corteza-server` docker image.

If you wish to upload additional or modified translations, you need to do some server-side configuration.

== Configuring the System

Applying the following steps allows your {PRODUCT_NAME} instance to serve customized translations.

[CAUTION]
====
{PRODUCT_NAME} ignores translations for languages that are not defined in the `.env` file.
See <<languages-manage,managing languages>> for details.
====

=== Preparing the File Structure

Create a new directory on the server running {PRODUCT_NAME}.

.Lets assume the file structure looks like this:
[source]
----
📁 my-corteza
  📄 docker-compose.yaml
  📄 .env
  📁 my-locale <1>
    📁 src <2>
----
<1> We use the `my-locale` directory to hold our custom translations and any corresponding metadata.
<2> The `src` directory holds the translation files and appropriate configuration files.

=== System Configurations

Firstly, define the volume in your `docker-compose.yaml` file.
An example following the above file system would look like this:

[source,yaml]
----
version: '3.5'

services:
// ...
// Additional services here
// ...

  server:
    image: cortezaproject/corteza:${VERSION}
    restart: always
    env_file: [ .env ]
    depends_on: [ db ]
    volumes: ["./my-locale:/my-locale"] <1>
    // ...
    // Additional configurations here
    // ...

// ...
// Additional services here
// ...
----
<1> This is where you mount the volume.

Secondly, you need to tell {PRODUCT_NAME} where the translations are located at.
This is done by the `LOCALE_PATH` `.env` variable.
An example following the above setup would look like this:

[source,env]
----
// ...
// Additional configurations here
// ...

LOCALE_PATH=../my-locale/src <1>

// ...
// Additional configurations here
// ...
----
<1> This is where you define the path.
If you wish to define multiple paths, use the colon (`:`) as the delimiter.
To exemplify; `LOCALE_PATH="../my-locale-en/src:../my-locale-de/src"`.
When multiple paths are used, defiitions are overriden in the same order as defined.

=== Applying Changes

After all of the configuration is in place, you need to reload the configurations.

.Run:
[source,bash]
----
docker-compose up -d
----

[IMPORTANT]
====
If you update translation files after {PRODUCT_NAME} server started, you must restart it.

.Run:
[source,bash]
----
docker-compose restart
----
====

[#languages-manage]
== Managing Available Languages

The languages that you wish to support by your {PRODUCT_NAME} instance *must* be defined by the `LOCALE_LANGUAGES` `.env` variable.

The language tag must follow the https://en.wikipedia.org/wiki/IETF_language_tag[BCP-47] standard.
An extensive list of languages is available https://www.techonthenet.com/js/language_tags.php[here].

Languages can be defined using a simple language tag, such as `en` and `sl`.
If you need to be more specific, you can use a region suffix, such as `en-US` and `en-UK`.
{PRODUCT_NAME} tries to detect the language from the request headers and serve appropriate translation.

If you want to define multiple languages, you need to separate them with a comma (`,`).

.An example configuration that uses English, German, and Italian languages:
[source]
----
LOCALE_LANGUAGES="en,de,it"
----

== Development Environment

{PRODUCT_NAME} provides some helpful utilities for debugging and general translations, which can be enabled with the following `.env` variables.

[cols="2s,5a"]
|===
| Variable | Description

| [#env-locale_log]#<<env-locale_log,`LOCALE_LOG`>>#
| The `LOCALE_LOG` variable makes the {PRODUCT_NAME} server output logs of what is happening in the system.
This can help you debug issues.

| [#env-locale_development_mode]#<<env-locale_development_mode,`LOCALE_DEVELOPMENT_MODE`>>#
| The `LOCALE_DEVELOPMENT_MODE` variable makes translation modifications easier, as the translation files are loaded for each request instead of at boot-time.

|===

== Troubleshooting

=== Language Not Loaded as Expected?

When languages do not load as expected, enable logging and restart the server.
First few log lines should describe what is going on and what languages are loaded.


# src/modules/devops-guide/pages/index.adoc

include::ROOT:partial$variables.adoc[]

= DevOps Guide
:page-aliases: 2024.9@prerequisites.adoc
:description: Learn how to setup and maintain {PRODUCT_NAME}
:keywords: Dev-Pps, DevOps, setup, configure, deploy, maintenance

The DevOps guide covers the process of setting up, configuring, and maintaining your {PRODUCT_NAME} instance.

This page attempts to provide simple instructions to setup an instance that should be used for most cases.
More complex use cases and advanced readers should refer to additional DevOps guide sub pages.

[IMPORTANT]
====
{PRODUCT_NAME} is compiled, developed, and tested for modern browsers.
If you need to support older browsers, such as InternetExplorer, you need to build your images.
Refer to xref:system-requirements.adoc[] for more details.
====

== Prerequisites

[#docker]
=== Docker

To use our pre-built Docker images, you must have Docker setup and running on every system you wish to set up {PRODUCT_NAME}.
You can follow https://docs.docker.com/get-docker/[the official documentation] to get it setup.

Alternatively, you can download prebuilt sources from our https://releases.cortezaproject.org/files/[releases page] or you can build your own.

[#docker-compose]
=== Docker Compose

Docker Compose makes your life easier when running multiple Docker images where each can be arbitrarily configured.
You can follow https://docs.docker.com/compose/install/[the official documentation] to get it setup.

[NOTE]
====
When using `.env` files, you need to explicitly specify this inside the `docker-compose.yaml` file, for example:

[source,yaml]
----
version: '3.5'

services:
  server:
    image: cortezaproject/corteza:${VERSION}
    restart: always
    env_file: [ .env ] # <- see here
    depends_on: [ db ]
    ports: [ "127.0.0.1:18084:80" ]

  # ...
----
====

== Architecture and Repository Overview

=== {PRODUCT_NAME} Architecture

.The diagram outlines different {PRODUCT_NAME} parts, their relation, and how they interact.
[plantuml,data-sync-origin,svg,role=component data-zoomable]
----
@startuml
component "Public Network" #E5412215 {
  package "Web Applications" {
    [Corteza Compose] as webappCompose
    [Corteza Workflow] as webappWorkflow
    [Corteza Admin] as webappAdmin
    [Corteza Reporter] as webappReporter
    [Corteza Discovery] as webappDiscovery

    interface "REST API" as restW

    webappCompose -down- restW
    webappWorkflow -down- restW
    webappAdmin -down- restW
    webappReporter -down- restW
    webappDiscovery -down- restW

    interface "HTTP" as httpW

    webappCompose -down- httpW
    webappWorkflow -down- httpW
    webappAdmin -down- httpW
    webappReporter -down- httpW
    webappDiscovery -down- httpW
  }
}

component "Private Network" {
  package "Corteza Server" {
    interface "REST API" as rest
    restW -down- rest

    interface "HTTP" as authHTTP
    httpW -down- authHTTP

    [Corteza Services] as svc
    rest -down- svc

    [Corteza Auth] as auth
    auth -right- svc
    authHTTP -down- auth
  }

  package "Corteza Discovery Server" {
    interface "REST API" as restD
    svc -down- restD

    interface "REST API" as restS
    webappDiscovery -down- restS

    [Indexer] as Indexer
    restD -down- Indexer

    [Searcher] as Searcher
    restS -down- Searcher
  }

  package "Corteza Corredor Server" {
    interface "GRPC" as grpc
    [Automation Runner] as corredorRunner

    svc -left- grpc
    grpc -left- corredorRunner
  }


  package "Auxiliary Services" as aux {
    component db [
      Database
      ....
      MySQL, PostgreSQL,
      ElasticSearch,
      OpenSearch, ...
    ]
    component mta [
      MTA
      ....
      Local, remote
      SMTP server
    ]
    component objs [
      Object Storage
      ....
      Local disc,
      Min.io
    ]
    component logs [
      Log Storage
      ....
      STDOUT,
      ElasticSearch
    ]
    component errt [
      Error Tracking
      ....
      STDOUT,
      Sentry
    ]
  }

  svc -down- db
  svc -down- mta
  svc -down- objs
  svc -down- logs
  svc -down- errt

  Indexer -down- db
  Searcher -down- db
}
@enduml
----

The web applications communicate with the server over the REST API and authenticate via the authentication server.

{PRODUCT_NAME} {APP_NAME_DISCOVERY} additionally communicates with `corteza-server-discovery`.

The server interacts with all internal auxiliary services such as the database, object storage, error and log tracking, automation runners, ...

.Some of the auxiliary services include:
* data federation,
* data storage,
* logger,
* email sender.

=== {PRODUCT_NAME} Repositories and Their Relation

.The diagram outlines {PRODUCT_NAME} repositories and their relation in regards to the build pipeline.
image::developer-guide:build-pipelines.png[role="data-zoomable"]

.{PRODUCT_NAME} core repositories:
. {GIT_MONOREPO_LINK}[`corteza`]: The monorepo containing the codebase for core {PRODUCT_NAME} features.
. {GIT_REPO_LINK_PREFIX}-server-corredor[`corteza-server-corredor`]: {APP_AUTOMATION} automation runner.
. {GIT_REPO_LINK_PREFIX}-docs[`corteza-docs`]: {PRODUCT_NAME} documentation.

== System Configuration Files

{PRODUCT_NAME} is configured via the environment (`.env`) file.
It allows you to quickly deploy and configure how {PRODUCT_NAME} should behave on another system.

Our examples are configured to work as is, but feel free to tweak the xref:references/configuration/server.adoc[server] and the xref:references/configuration/corredor.adoc[{APP_AUTOMATION} server] as you see fit.

[NOTE]
====
The `.env` file is at the root of the project folder.
In the context of Docker Compose, it is next to the `docker-compose.yaml` file.
====

The `.env` file performs *implicit Docker Compose configuration*, *variable substitution for Docker configurations*, and *service configurations*.

You can use variables defined in the `.env` file inside your `docker-compose.yaml` files using `$\{VARIABLE_HERE}`.

[#deploy-offline]
== Offline Deployment

Offline deployments run all services on the same network where the ports are bound to the host's network.

[IMPORTANT]
====
Offline deployments are suitable only for local development and demos (environments that are not accessible from the outside).
====

This section provides a minimum setup with PostgreSQL as the persistent database storage.
See xref:examples/deploy-offline/index.adoc[] for example offline deployment configurations.

=== Setting up Your File Structure

.Your file structure should look like this:
[source]
----
📁 my-corteza
  📄 .env
  📄 docker-compose.yaml
  📁 data <1>
    📁 server <2>
    📁 db <3>
----
<1> Make sure to change the owner to the Docker container (you can use `chown 1001:1001 data/db` and `chown 4242:4242 data/server`).
Omit if you won't use persistent storage.
<2> Here is where all of the server data is stored, for example uploaded attachments.
<3> Here is where the database data is stored.

=== Configure docker-compose.yaml

.Your configuration should look like this:
[source,yaml]
----
include::example$deploy/local-pgsql/docker-compose.yaml[]
----

[NOTE]
====
Supported PostgreSQL versions 13, 14, 15
====

=== Configure .env

.Your configuration should look like this:
[source,.env]
----
include::example$deploy/local-pgsql/env-example.txt[]
----

=== Running the Services

In the root of your project (next to your `docker-compose.yaml` and `.env` files), run the docker compose (the execution can take a few seconds).
The command (downloads and) runs all of the services configured in your `docker-compose.yaml` file.

[source,bash]
----
docker-compose up -d
----

Check if everything started correctly by running `docker-compose ps`.
The output should look like this:

[source]
----
include::example$deploy/local-pgsql/output-ps.txt[]
----

See xref:troubleshooting/index.adoc[] if something went wrong or failed to start.

=== Testing the Deploy

. Direct your browser to http://localhost:18080 (change the port if you used a different port).
You should be redirected to the authentication page (`/auth`).
. Create your account through the sign-up form (the first created account is an administrator by default).
. Check the server version http://localhost:18080/version.
. Check the server's health http://localhost:18080/healthcheck.
. Check the API documentation http://localhost:18080/api/docs/.

[NOTE]
====
If you did not configure your SMTP settings, all sign-ups are marked as confirmed.
====

[#deploy-online]
== Online Deployment

[NOTE]
====
If you're using Nginx and the WebSocket connection is failing, refer to xref:troubleshooting/index.adoc#ws-nginx-connection-fail[menu:Maintenance[Troubleshooting]].
====

Online setups separate your services into two networks; internal and proxy.
The internal network hides most of the system from the internet.
This section provides a minimum setup with PostgreSQL as the persistent database storage with {APP_AUTOMATION} server enabled.

[TIP]
====
You can use the same steps to configure multiple online deployments, for example a staging and a production environment.
====

See xref:examples/deploy-online/index.adoc[] for example online deployment configurations.

=== Setting up Your File Structure

.Your file structure should look like this:
[source]
----
📁 my-proxy <1>
  📄 docker-compose.yaml
  📄 custom.conf <2>
📁 my-corteza
  📄 .env
  📄 docker-compose.yaml
  📁 data <3>
    📁 server <4>
    📁 db <5>
----
<1> Omit this if you're not planning on using Nginx reverse proxy or if it's already setup.
<2> `custom.conf` must be placed next to the `docker-compose.yaml` file.
<3> Make sure to change the owner to the Docker container (you can use `chown 1001:1001 data/db` and `chown 4242:4242 data/server`).
Omit if you won't use persistent storage.
<4> Here is where all of the server data is stored, such as uploaded attachments.
<5> Here is where the database can store the data.

=== Setting up Your Nginx Reverse Proxy

⚠️ We are inside the `my-proxy` directory.

This part automates the creation and renewal of Let's Encrypt TLS certificates, forward traffic to Docker containers and simplifies complicated firewall configurations.

[CAUTION]
====
The following instructions assume that you don't have anything similar setup in your current environment.

If you are using other means of providing traffic forwarding or SSL certificate handling, proceed with caution.
====

We will be using https://github.com/jwilder/nginx-proxy[Nginx Proxy] and https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion[LetsEncrypt Nginx Proxy Companion].
If you wish to use or are using something else, feel free to skip this section.


.Your `docker-compose.yaml` should look like this:
[source,yaml]
----
include::example$deploy/prod-proxy-nginx/docker-compose.yaml[]
----

[NOTE]
====
Supported PostgreSQL versions 13, 14, 15
====

.Your `custom.conf` should look like this:
[source,yaml]
----
include::example$deploy/prod-proxy-nginx/custom.conf[]
----

Inside your `my-proxy` directory, run `docker-compose up -d` (the execution can take a few seconds) to start the reverse proxy.

Check if everything started correctly by running `docker-compose ps`.
The output should look like this:

[source]
----
include::example$deploy/prod-proxy-nginx/output-ps.txt[]
----

=== Configuring docker-compose.yaml

⚠️ We are inside the `my-corteza` directory.

[IMPORTANT]
====
Containers *must* be on the same network as `nginx-proxy` (in the examples, we're using a network named `proxy`).
====

.Your configuration should look like this:
[source,yaml]
----
include::example$deploy/prod-pgsql/docker-compose.yaml[]
----

=== Configure .env

⚠️ We are inside the `my-corteza` directory.

.Your configuration should look like this:
[source,.env]
----
include::example$deploy/prod-pgsql/env-example.txt[]
----

=== Running the Services

Inside your `my-corteza` directory (next to your `docker-compose.yaml` and `.env` files), run the docker compose (the execution can take a few seconds).
The command (downloads and) runs all of the services configured in your `docker-compose.yaml` file.

[source,bash]
----
docker-compose up -d
----

Check whether everything started correctly by running `docker-compose ps`.
The output should look like this:

[source]
----
include::example$deploy/prod-pgsql/output-ps.txt[]
----

See xref:troubleshooting/index.adoc[] if something went wrong or failed to start.

=== Testing the Deployment

. Direct your browser to `http://your-demo.example.tld`.
You will be redirected to the authentication page (`/auth`).
. Create your account through the sign-up form (the first created account is an administrator by default).
. Check the server version http://your-demo.example.tld/version
. Check the server's health http://your-demo.example.tld/healthcheck
. Check the API documentation http://your-demo.example.tld/api/docs/

[#useful-commands]
== Useful Commands

.A list of useful Docker commands:
[cols="2s,2m"]
|===
| [#docker-exec]#<<docker-exec,Run commands inside a container (started)>>#
| docker exec -it <container name> help

| [#docker-exec-stopped]#<<docker-exec-stopped,Run commands inside a container (not started)>>#
| docker run -it --rm <container name> help
|===

.A list of useful Docker Compose commands:
[cols="2s,2m"]
|===
| [#docker-compose-stop-rm]#<<docker-compose-stop-rm,Stop and remove containers along with their volumes without confirmation>>#
| docker-compose rm --force --stop -v

| [#docker-compose-logs-full]#<<docker-compose-logs-full,View logs for all running containers>>#
| docker-compose logs --follow --tail 20

| [#docker-compose-logs-specific]#<<docker-compose-logs-specific,View logs for a specific container>>#
| docker-compose logs --follow --tail 20 <service name>

| [#docker-compose-exec]#<<docker-compose-exec,Execute with Docker Compose>>#
| docker-compose exec <service name> help

| [#docker-compose-bash]#<<docker-compose-bash,Access bash in the container at `WORKDIR`>>#
| docker-compose exec <service name> bash
|===

== Where to next

.The sub-sections under menu:DevOps guide go into more details regarding specific topics, such as:
* xref:maintenance/backups.adoc[performing backups],
* xref:troubleshooting/index.adoc[troubleshooting issues],
* opening additional automation capabilities with xref:email-relay.adoc[], xref:sink-route.adoc[], xref:pdf-renderer.adoc[], and
* xref:i18n/index.adoc[].

.To develop your own {APP_NAME_COMPOSE} applications, refer to the xref:integrator-guide:index.adoc[]:
* xref:integrator-guide:authentication/index.adoc[] and xref:integrator-guide:security-model/index.adoc[],
* xref:integrator-guide:i18n/index.adoc[internationalization],
* xref:integrator-guide:accessing-corteza/index.adoc[interacting via the REST API],
* xref:integrator-guide:compose-configuration/index.adoc[{APP_NAME_COMPOSE} configuration], and
* xref:integrator-guide:automation/index.adoc[].


# src/modules/devops-guide/pages/installing-sass/index.adoc

include::ROOT:partial$variables.adoc[]

= Installing  Dart Sass 

== Development Enviroment
 
Follow the instructions below to install dart-sass binaries based on your operating system:

[cols="2s,5a"]
|===
| [#scss-local-linux]#<<scss-local-linux,Installing on Linux>>#
|
[source, bash]
----
# Using Homebrew.
brew install sass/sass/sass

# Using Snap
sudo snap install dart-sass
----

| [#scss-local-macOS]#<<scss-local-macOS,Installing on MacOS>>#
|
[source, bash]
----
brew install sass/sass/sass
----

| [#scss-local-windows]#<<scss-local-windows,Installing on Windows>>#
|
[source, bash]
----
# Using Chocolatey
choco install sass

# Using Scoop
scoop install sass
----

|===

Alternatively, you can download Dart Sass binaries directly from the https://github.com/sass/dart-sass/releases[dart-sass release page].

[IMPORTANT]
====
When using prebuilt binaries, make sure to add Dart Sass to your system's PATH.
====

== Build Enviroment

In a build environment, especially when deploying with CI/CD pipelines or Docker, you can ensure that Dart Sass is available using the following methods:

[cols="2s,5a"]
|===
| [#scss-deployment-github-pages]#<<scss-deployment-github-pages,CI/CD deployment on GitHub pages>>#
|

To install Dart Sass for CI/CD deployment on GitHub Pages, include the following step in your workflow file:

[source, bash]
----
- name: Install Dart Sass
  run: sudo snap install dart-sass
----

| [#scss-deployment-docker]#<<scss-deployment-docker, Docker deployment>>#
|
To install Dart Sass for Docker, include the following step in your Dockerfile:

[source, Dockerfile]
----
# Replace the image with your deplyment Docker image
FROM ubuntu:20.04

RUN apt-get -y update \
 && apt-get -y install \
    ca-certificates \
    curl \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/local

# Replace the SASS_VERSION with the version you want to install
ARG SASS_VERSION=1.67.0
ARG SASS_URL="https://github.com/sass/dart-sass/releases/download/${SASS_VERSION}/dart-sass-${SASS_VERSION}-linux-x64.tar.gz"

RUN curl -OL $SASS_URL

# Extract the release (if it's an archive)
RUN tar -xzf dart-sass-${SASS_VERSION}-linux-x64.tar.gz

# Clean up downloaded files (optional)
RUN rm -rf dart-sass-${SASS_VERSION}-linux-x64.tar.gz

ENV PATH=$PATH:/usr/local/dart-sass

----

|===


# src/modules/devops-guide/pages/maintenance/backups.adoc

include::ROOT:partial$variables.adoc[]

= Backups
:description: An example of how to perform data backups and restore the state based on the backup.
:keywords: dev-ops, DevOps, CLI, command-line interface, maintenance

We recommend backing up your database and uploaded files regularly.
It is also highly recommended to backup before you upgrade to a more recent {PRODUCT_NAME} version.

[TIP]
====
You can define a cron job that backups your data to external storage.
====

[NOTE]
====
*DevNote* add some example setups, as we have now with a CRON job?
====

[#reduce-size]
== Reducing Backup Size

For some cases, you can omit specific database tables which allow you to reduce the size of the backup.
This reduction also comes in handy when you wish to migrate your production database to your local instance.

[cols="2s,5a"]
|===
| [#backup-optional_table-auth_sessions]#<<backup-optional_table-auth_sessions,auth_sessions>>#
| The `auth_sessions` table stores user's authentication sessions.
If you omit this table, the users will have to re-login after the database is restored.
The `auth_sessions` table can safely be omitted in any case.

| [#backup-optional_table-credentials]#<<backup-optional_table-credentials,credentials>>#
| The `credentials` table stores authentication related secrets such as passwords, reset tokens, and email confirmation tokens.
If you omit the `credentials` table all issued credentials will need to be re-issues requiring your users to reset their passwords, re-send the password reset emails, and re-send the email confirm emails.
The `credentials` table can can safely be omitted in any case where some cases might recommend for it to be omitted.

| [#backup-optional_table-auth_oa2tokens]#<<backup-optional_table-auth_oa2tokens,auth_oa2tokens>>#
| The `auth_oa2tokens` table stores access tokens issues by the {PRODUCT_NAME} server to web applications.
If you omit the `auth_oa2tokens` table all of the access tokens will be invalidated and will need to be re-issued.
The `auth_oa2tokens` table can safely be omitted in any case where some cases might recommend for it to be omitted.

[CAUTION]
====
If you invalidate access tokens all of the authenticated web applications must re-authenticate.
This could cause issues for cases where the web application only re-generates tokens when they are scheduled to expire.
====

| [#backup-optional_table-actionlog]#<<backup-optional_table-actionlog,actionlog>>#
| The `actionlog` table stores events the {PRODUCT_NAME} server considered significant, such as creating users, registering auth clients, and looking up records.
If you omit the `actionlog` table the action history will be lost.
The `actionlog` table can safely be omitted for development related cases.

| [#backup-optional_table-automation_sessions]#<<backup-optional_table-automation_sessions,automation_sessions>>#
| The `automation_sessions` table stores metadata regarding workflow execution such as what step the workflow is on, what parameters were passed to the workflow, and the outcome of the execution.
If you omit the `automation_sessions` table the workflow execution history will be lost and any prompted or suspended workflows will not complete.
The `automation_sessions` table can safely be omitted for development related cases.

| [#backup-optional_table-compose_record]#<<backup-optional_table-compose_record,compose_record>>#
| The `compose_record` table stores record metadata created in your {PRODUCT_NAME} {APP_NAME_COMPOSE} applications.
If you omit the `compose_record` table all of the records created for your {APP_NAME_COMPOSE} applications will be lost.
The `compose_record` table can be omitted if you want to backup the system structure but omit all of the data.

| [#backup-optional_table-compose_record_value]#<<backup-optional_table-compose_record_value,compose_record_value>>#
| The `compose_record_value` table stores record values created in your {PRODUCT_NAME} {APP_NAME_COMPOSE} applications.
If you omit the `compose_record_value` table all of the records created for your {APP_NAME_COMPOSE} applications will be lost.
The `compose_record_value` table can be omitted if you want to backup the system structure but omit all of the data.

| [#backup-optional_table-queue_messages]#<<backup-optional_table-queue_messages,queue_messages>>#
| The `queue_messages` table stores the messages passed into the messaging queue.
If you omit the `queue_messages` table all of the messages passed into the messaging queue will be lost.
The `queue_messages` table can safely be dropped for most cases.

| [#backup-optional_table-resource_activity_log]#<<backup-optional_table-resource_activity_log,resource_activity_log>>#
| The `resource_activity_log` table stores the history of resource changes such as record value changes.
If you omit the `resource_activity_log` table the history of all resources will be lost.
The `resource_activity_log` table can safely be omitted for development cases.

|===

== MySQL Database

If you're using a different database engine, refer to their documentation on how to perform backups.

=== Backup

[NOTE]
====
Refer to the <<reduce-size,reducing backup size>> section to see what tables you can omit for your use-case.
An example command which omits specific tables is available below.
====

We recommend you use the `mysqldump` tool.
It's builtin into the `db` container (`percona:8.0` image).

[CAUTION]
====
Do not attempt to copy raw database files to perform a backup.
It might lead to corrupted data.
====

[WARNING]
====
By default, `mysqldump` locks the tables when you run the export.
Table locks might cause issues when running in production, so do keep this in mind.
====

.Database dump command:
[source,bash]
----
# This dumps the entire database and place it in the dump.sql file.
docker-compose exec -T \
    --env MYSQL_PWD=your-password db \
    mysqldump your-db-name --add-drop-database -u your-username > dump.sql

# This dumps the database without actionlog, automation sessions, and resource activity log
# These are generally the largest and can safely be omitted.
docker-compose exec -T \
    --env MYSQL_PWD=your-password db \
    mysqldump your-db-name --add-drop-database --ignore-table=dbname.actionlog --ignore-table=dbname.automation_sessions --ignore-table=dbname.resource_activity_log -u your-username > dump.sql
----

[CAUTION]
====
If you've changed the database service name (`db`) inside your `docker-compose.yaml`, make sure to change it in the above command.
====

=== Restoration

[NOTE]
====
We recommend that {PRODUCT_NAME} server is shut-down until the restore procedure finishes.
====

.Database restore command:
[source,bash]
----
# This restores the database based on the dump.sql file.
docker-compose exec -T \
    --env MYSQL_PWD=your-password db \
    mysql your-db-name -u your-username < dump.sql
----

[CAUTION]
====
If you've changed the database service name (`db`) inside your `docker-compose.yaml`, make sure to change it in the above command.
====

== PostgreSQL Database

=== Backup

[NOTE]
====
Refer to the <<reduce-size,reducing backup size>> section to see what tables you can omit for your use-case.
An example command which omits specific tables is available below.
====

We recommend you use the `pg_dumpall` or `pg_dump` tool.
`pg_dumpall` is a utility for writing out ("dumping") all PostgreSQL databases of a cluster into one script file.
The script file contains SQL commands that can be used as input to psql to restore the databases.
It does this by calling `pg_dump` for each database in a cluster.

[CAUTION]
====
Do not try to copy raw database files to perform a backup.
It might lead to corrupted data.
====

[WARNING]
====
By default, `pg_dump` locks the tables when you run the export.
Table locks might cause issues when running in production, so do keep this in mind.
====

.Database Dump Command:
[source,bash]
----
# This dumps all databases and place them in the dump.sql file.
docker-compose exec db \
    pg_dumpall -c -U your-username > dump.sql

# This dumps the entire database and place it in the dump.sql file.
docker-compose exec db \
    pg_dump -d your-db-name -c -U your-username > dump.sql

# To reduce the size of the sql,
# This dumps all databases and place them in the dump.gz file.
docker-compose exec db \
    pg_dumpall -c -U your-username | \
    gzip > /var/data/postgres/backups/dump.gz


# This dumps the database without actionlog, automation sessions, and resource activity log
# These are generally the largest and can safely be omitted.
docker-compose exec db \
    pg_dump -T corteza.actionlog -T corteza.automation_sessions -T corteza.resource_activity_log -c -U your-username corteza > dump.sql
----

[CAUTION]
====
If you've changed the database service name (`db`) inside your `docker-compose.yaml`, make sure to also change it in the above command.
====

=== Restoration

[NOTE]
====
It is recommended that {PRODUCT_NAME} server is shut-down until the restore procedure finishes.
====

.Database Restore Command:
[source,bash]
----
# This restores the database based on the dump.sql file.
cat dump.sql | \
    docker-compose exec db psql -U your-username

# This restores a specific database based on the dump.sql file.
cat dump.sql | \
    docker-compose exec db psql -U your-username -d your-db-name

# To restore a compressed sql,
# This restores the database based on the dump.gz file.
gzip < dump.gz | \
    docker-compose exec db psql -U your-username
----

[CAUTION]
====
If you've changed the database service name (`db`) inside your `docker-compose.yaml`, make sure to change it in the above command.
====

== Files

=== Backup

Without object storage service like Min.io, uploaded files are stored directly on the filesystem.
{PRODUCT_NAME} server stores data to the `/data` directory (if not configured differently with `*_STORAGE_PATH` environmental variables).

You can use any standard file management tools to make a backup copy of the files.

.Compressing files with the `tar` command:
[source,bash]
----
# This compresses all your uploaded files into the backup.tar.bz2 archive,
tar -cjf backup.tar.bz2 data/server/
----
=== Restore

.Uncompromising files from the archive with the `tar` command:
[source,bash]
----
# This restores your backup.tar.bz2 archive
tar -xjf backup.tar.bz2
----


# src/modules/devops-guide/pages/maintenance/database-password.adoc

include::ROOT:partial$variables.adoc[]

= Changing the Database Password
:description: Learn how to change the database password for increased security
:keywords: database change, password change, database password, database password change

== MySQL

If your database is running in a Docker container, log into it by running:

[source,bash]
----
docker exec -it <container_id> bash
----

Enter the MySQL CLI by running:

[source,bash]
----
mysql -u<root_mysql_user> -p<old_password>
----

To change the password for MySQL 5.7 and above, run:

[source,bash]
----
mysql> SET PASSWORD FOR 'root' = PASSWORD('new_password');
mysql> FLUSH PRIVILEGES;
----

To change the password for older versions (before 5.7), run:

[source,bash]
----
mysql> ALTER USER '<mysql_user>'@'localhost' IDENTIFIED BY '<mysql_password>';
mysql> FLUSH PRIVILEGES;
----

== PostgreSQL

If your database is running in a Docker container, log into it by running:

[source,bash]
----
docker exec -it <container_id> bash
----

Once inside the container, change the password with:

[source,bash]
----
psql --user <postgresql_user>
\password
\q
----


# src/modules/devops-guide/pages/maintenance/sql-snippets.adoc

include::ROOT:partial$variables.adoc[]

= SQL Snippets
:description: Learn the most common SQL snippets when working with {PRODUCT_NAME}
:keywords: database commands, SQL commands, delete records, delete records database, common SQL

[CAUTION]
====
Before performing destructive operations, it is recommended you create a database backup.
====

[TIP]
====
When deleting data, you can replace `DELETE` with `SELECT` to view what is about to get deleted.
====

== Deleting All Records

[source,sql]
----
-- Record values
delete from compose_record_value;

-- Records
delete from compose_record;
----

== Deleting All Records of a Namespace

[source,sql]
----
-- Record values
delete from compose_record_value where record_id in (select id from compose_record where rel_namespace = {NAMESPACE_ID} AND rel_module = {MODULE_ID});

-- Records
delete from compose_record where rel_namespace = {NAMESPACE_ID};
----

== Deleting All Records of a Module

[source,sql]
----
-- Record values
delete from compose_record_value where record_id in (select id from compose_record where rel_namespace = {NAMESPACE_ID} AND rel_module = {MODULE_ID});

-- Records
delete from compose_record where rel_namespace = {NAMESPACE_ID} AND rel_module = {MODULE_ID};
----


== Deleting Specific Record Values

[source,sql]
----
delete from compose_record_value where name = {FIELD_NAME} AND record_id in (select id from compose_record where rel_namespace = {NAMESPACE_ID} AND rel_module = {MODULE_ID});
----

== Deleting All Soft Deleted Records

[source,sql]
----
-- Record values
delete from compose_record_value where record_id in (select id from compose_record where rel_namespace = {NAMESPACE_ID} AND rel_module = {MODULE_ID} and deleted_at IS NOT NULL);

-- Records
delete from compose_record where rel_namespace = {NAMESPACE_ID} AND rel_module = {MODULE_ID} and deleted_at IS NOT NULL;
----


# src/modules/devops-guide/pages/miscellaneous/benchmark-classic.adoc

include::generated:partial$benchmarks/bench-classic.gen.adoc[]


# src/modules/devops-guide/pages/miscellaneous/benchmark-dedicated.adoc

include::generated:partial$benchmarks/bench-dedicated.gen.adoc[]


# src/modules/devops-guide/pages/miscellaneous/containerized-storage.adoc

include::ROOT:partial$setup/containerized-db.adoc[]


# src/modules/devops-guide/pages/pdf-renderer.adoc

include::ROOT:partial$variables.adoc[]

= PDF Renderer
:page-aliases: 2024.9@extension-requirements/pdf-renderer.adoc

To enable PDF rendering, you need to set up https://github.com/gotenberg/gotenberg[Gotenberg].
Gotenberg exposes an API to a headless browser that can convert various formats into PDF documents.

[CAUTION]
====
Don't forget to reload the configuration with `docker-compose up -d`.
====

After the feature is enabled, you will see a btn:[Preview PDF] button at the bottom of the template editor page.

.The screenshot shows the PDF preview option after the feature is successfully enabled.
image::template-preview-pdf-enabled.png[role="data-zoomable"]


== Setup Gotenberg

.Add the `gotenberg` service to the `docker-compose.yaml` file:
[source,yaml]
----
# ...

services:
  gotenberg:
    image: thecodingmachine/gotenberg:6
    networks: [ internal ]
    restart: on-failure

# ...
----

.An example setup which includes Gotenberg:
[source,yaml]
----
version: '3.5'

services:
  gotenberg:
    image: thecodingmachine/gotenberg:6
    networks: [ internal ]
    restart: on-failure

  db:
    image: percona:8.0
    networks: [ internal ]
    cap_add:
      - SYS_NICE  # mbind warning fix
    environment:
      MYSQL_DATABASE:      ...
      MYSQL_USER:          ...
      MYSQL_PASSWORD:      ...
      MYSQL_ROOT_PASSWORD: ...
    restart: on-failure

  server:
    image: cortezaproject/corteza:${VERSION}
    env_file: [ .env ]
    depends_on: [ db ]
    networks: [ party, internal ]
    environment:
      VIRTUAL_HOST:     ${DOMAIN}
      LETSENCRYPT_HOST: ${DOMAIN}
    restart: on-failure

networks: { internal: {}, party: { name: party } }
----

== Configuring {PRODUCT_NAME} Server

Add the following two variables to the `.env` file:

[source,.env]
----
TEMPLATE_RENDERER_GOTENBERG_ADDRESS=http://gotenberg:3000
TEMPLATE_RENDERER_GOTENBERG_ENABLED=true
----

== Reload the Configuration

Reload the configuration with the `docker-compose up -d` command.


# src/modules/devops-guide/pages/references/cli-reference.adoc

include::ROOT:partial$variables.adoc[]

= CLI Reference
:page-aliases: 2024.9@maintenance/cli-reference.adoc
:description: {PRODUCT_NAME} command-line interface tool allows you to quickly interact with different parts of the system -- from changing the settings to assigning roles to users.
:keywords: dev-ops, devops, cli, command-line interface, maintenance

[NOTE]
====
*DevNote* think about adding some more examples/usecases?
Update/assure the commands are still as are and valid.
====

[NOTE]
====
*DevNote* add some more notes, descriptions.
Consider generating this.
====

{PRODUCT_NAME} command-line interface tool allows you to quickly interact with different parts of the system -- from changing the settings to assigning roles to users.

== Running CLI interface via docker

If you are running a deployment via docker or docker compose, you can easily execute an already running server outside of the containers.

=== Docker Compose

[NOTE]
====
Refer to more docker compose examples at xref:index.adoc#useful-commands[useful Docker commands].
====

[source,shell]
----
$ docker-compose exec <service name> ./bin/corteza-server <command>
----

=== Docker

First, find the ID of the container which is running your {PRODUCT_NAME} server in the current project directory.
You can use the accrued container ID to execute CLI commands as illustrated by the following example.

[NOTE]
====
The example assumes the service name is `server`.
====

[source,shell]
----
$ docker ps | grep `basename $PWD | sed -e 's/\.//g'`_server
$ docker exec <container ID> ./bin/corteza-server <command>
----

== Authentication

=== Auto Discovery

Auto discovers new OIDC client.

[source,shell]
----
Usage:
  corteza-server auth auto-discovery [name] [url] [flags]

Flags:
      --enable            Enable this provider and external auth
  -h, --help              help for auto-discovery
      --skip-validation   Skip validation
----

[#auth-jwt]
=== JWT

Generates a new JWT for a user.

[source,shell]
----
Usage:
  corteza-server auth jwt [email-or-id] [flags]

Flags:
  -h, --help   help for jwt
----

=== Test Notification

Sends samples of all authentication notification to a recipient.

[source,shell]
----
Usage:
  corteza-server auth test-notifications [recipient] [flags]

Flags:
  -h, --help   help for test-notifications
----

[#import]
== Import

Imports data from yaml sources.

[CAUTION]
====
When importing RBAC rules, the changes do not automatically change.
RBAC rules are reloaded in 1h intervals.
If you need to reflect the changes immediately, you will need to restart the {PRODUCT_NAME} server.
====

[source,shell]
----
Usage:
  corteza-server import [flags]

Flags:
  -h, --help                   help for import
      --merge-left-existing    Update any existing values; existing data takes priority. Default skips.
      --merge-right-existing   Update any existing values; new data takes priority. Default skips.
      --replace-existing       Replace any existing values. Default skips.
----

== Provision

Provision tasks

[source,shell]
----
Usage:
  corteza-server provision [flags]

Flags:
  -h, --help   help for provision
----

== RBAC

Checks and manipulates permissions.

=== Check

Checks applied permissions against given file (only supports compose permissions for now).

[source,shell]
----
Usage:
  corteza-server rbac check [flags]

Flags:
  -h, --help   help for check
----

== Roles

Role management

=== Add user

Adds a user to a role.

[source,shell]
----
Usage:
  corteza-server roles useradd [role-ID-or-name-or-handle] [user-ID-or-email] [flags]

Flags:
  -h, --help   help for useradd
----

== Serve api

Starts HTTP server with REST API.

[source,shell]
----
Usage:
  corteza-server serve-api [flags]

Aliases:
  serve-api, serve

Flags:
  -h, --help   help for serve-api
----

[#sink-signature]
== Sink signature

Creates a signature for a sink HTTP endpoint.

[source,shell]
----
Usage:
  corteza-server sink signature [flags]

Flags:
      --content-type string   Content type (optional)
      --expires string        Date of expiration (YYYY-MM-DD, optional)
  -h, --help                  help for signature
      --max-body-size int     Max allowed body size
      --method string         HTTP method that will be used (optional)
      --origin string         Origin of the request (arbitrary string, optional)
      --path string           Full sink request path (do not include /sink prefix, add / for just root)
      --signature-in-path     Include signature in a path instead of query string
----

== Upgrading

[source,shell]
----
Usage:
  corteza-server upgrade [flags]

Flags:
  -h, --help   help for upgrade
----

== Users

User management

=== Add user

Add new user

[source,shell]
----
Usage:
  corteza-server users add [email] [flags]

Flags:
  -h, --help          help for add
      --no-password   Create user without password
----

=== List

List users

[source,shell]
----
Usage:
  corteza-server users list [flags]

Flags:
  -h, --help           help for list
  -l, --limit int      How many entry to display (default 20)
  -q, --query string   Query and filter by handle, email, name
----

=== Password

Change password for user

[source,shell]
----
Usage:
  corteza-server users password [email] [flags]

Flags:
  -h, --help   help for password
----

== Federation Sync

.There are two commands with which you can handle federation sync:
* data sync,
* structure sync.

The two commands (`corteza-server sync data` and `corteza-server sync structure`) force the background watcher to run.

[source,shell]
----
Usage:
  corteza-server sync [command]

Available Commands:
  data        Sync data
  structure   Sync structure

Flags:
  -h, --help   help for sync
----

== Version

[source,shell]
----
Usage:
  corteza-server version [flags]

Flags:
  -h, --help   help for version
----


# src/modules/devops-guide/pages/references/configuration/corredor.adoc

include::ROOT:partial$variables.adoc[]

= {APP_AUTOMATION} Server configuration
:page-aliases: 2024.9@configuration/corredor.adoc
:description: {APP_AUTOMATION} server configuration outlines all of the different configuration options that you can define inside your `.env` file to control the behavior.
:keywords: dev-ops, configuration, config, {APP_AUTOMATION} server

.[#CORREDOR_ADDR]#<<CORREDOR_ADDR,*CORREDOR_ADDR*>>#
* *type*: `string`
* *description*: Be careful when sharing your environmental variables, `CORREDOR_ADDR` is used by both, {APP_AUTOMATION} and API Server.

When used by {APP_AUTOMATION} server it sets the IP address and port server listens on.
It defaults to `0.0.0.0:80` in Docker and `localhost:50051` in development mode.
This instructs server to listen on all interfaces, all IP addresses on port 80.

It is also used by API server to set where the server can find and connect to {APP_AUTOMATION} Server.
Defaults are defined by context. Building from source and running in development mode, value is `localhost:50051`,
in Docker container it is set to `corredor:80`.

These context-dependant defaults allow us to have working setup without additional changes.

* *default*: `0.0.0.0:80`

.[#CORREDOR_ENABLED]#<<CORREDOR_ENABLED,*CORREDOR_ENABLED*>>#
* *type*: `bool`
* *description*: Only used by the API server to enable or disable {APP_AUTOMATION} server use.
{APP_AUTOMATION} server ignores this config.

* *default*: `false`

.[#CORREDOR_ENABLED]#<<CORREDOR_ENVIRONMENT,*CORREDOR_ENVIRONMENT*>>#
* *type*: `string`
* *description*: Enables development mode when value of the variable starts with `"dev"`.
Otherwise {APP_AUTOMATION} starts in production mode.

When `CORREDOR_ENVIRONMENT` is not set, Corredor looks for `CORREDOR_ENV` and `NODE_ENV` and uses first one available.

* *default*: `false`

.[#CORREDOR_MAX_BACKOFF_DELAY]#<<CORREDOR_MAX_BACKOFF_DELAY,*CORREDOR_MAX_BACKOFF_DELAY*>>#
* *type*: `duration`
* *description*: Maximum amount of time to wait before retrying the failed connection from API to {APP_AUTOMATION} server.
* *default*: `1m`

.[#CORREDOR_EXEC_CSERVERS_API_BASEURL_TEMPLATE]#<<CORREDOR_EXEC_CSERVERS_API_BASEURL_TEMPLATE,*CORREDOR_EXEC_CSERVERS_API_BASEURL_TEMPLATE*>>#
* *type*: `string`
* *description*: Location of the Corteza server API.
\{host\} is replaced with value from env variables (in this order: `CORREDOR_EXEC_CSERVERS_API_HOST`, `DOMAIN`, `HOSTNAME`, `HOST`), \{service\} is replaced dynamically inside {APP_AUTOMATION} with `compose`, `system` or `messaging`.
* *default*: `https://api.\{host\}/\{service\}`

.[#CORREDOR_EXEC_CSERVERS_API_HOST]#<<CORREDOR_EXEC_CSERVERS_API_HOST,*CORREDOR_EXEC_CSERVERS_API_HOST*>>#
* *type*: `string`
* *description*: Hostname is used for the template.
* *default*: ``

.[#CORREDOR_LOG_ENABLED]#<<CORREDOR_LOG_ENABLED,*CORREDOR_LOG_ENABLED*>>#
* *type*: `boolean`
* *description*: Enable logging in {APP_AUTOMATION} server.
* *default*: `corredor`

.[#CORREDOR_LOG_LEVEL]#<<CORREDOR_LOG_LEVEL,*CORREDOR_LOG_LEVEL*>>#
* *type*: `string`
* *description*: Default is `trace` when `CORREDOR_ENVIRONMENT` is set to `dev`.
Defines amount of information server logs.
* *default*: `info`

.[#CORREDOR_LOG_PRETTY]#<<CORREDOR_LOG_PRETTY,*CORREDOR_LOG_PRETTY*>>#
* *type*: `boolean`
* *description*: When set to true, logs are logged formatted to ease development.
* *default*: `false`

.[#CORREDOR_EXT_DEPENDENCIES_AUTO_UPDATE]#<<CORREDOR_EXT_DEPENDENCIES_AUTO_UPDATE,*CORREDOR_EXT_DEPENDENCIES_AUTO_UPDATE*>>#
* *type*: `boolean`
* *description*: {APP_AUTOMATION} auto updates script dependencies found in `package.json` files.
* *default*: `true`

.[#CORREDOR_EXT_SERVER_SCRIPTS_ENABLED]#<<CORREDOR_EXT_SERVER_SCRIPTS_ENABLED,*CORREDOR_EXT_SERVER_SCRIPTS_ENABLED*>>#
* *type*: `boolean`
* *description*: Server scripts are enabled.
* *default*: `true`

.[#CORREDOR_EXT_SERVER_SCRIPTS_WATCH]#<<CORREDOR_EXT_SERVER_SCRIPTS_WATCH,*CORREDOR_EXT_SERVER_SCRIPTS_WATCH*>>#
* *type*: `boolean`
* *description*: {APP_AUTOMATION} reloads server-scripts on change.
* *default*: `true`

.[#CORREDOR_EXT_CLIENT_SCRIPTS_ENABLED]#<<CORREDOR_EXT_CLIENT_SCRIPTS_ENABLED,*CORREDOR_EXT_CLIENT_SCRIPTS_ENABLED*>>#
* *type*: `boolean`
* *description*: Client scripts are enabled.
* *default*: `true`

.[#CORREDOR_EXT_CLIENT_SCRIPTS_WATCH]#<<CORREDOR_EXT_CLIENT_SCRIPTS_WATCH,*CORREDOR_EXT_CLIENT_SCRIPTS_WATCH*>>#
* *type*: `boolean`
* *description*: {APP_AUTOMATION} reloads client-scripts on change.
* *default*: `true`

.[#CORREDOR_SERVER_CERTIFICATES_ENABLED]#<<CORREDOR_SERVER_CERTIFICATES_ENABLED,*CORREDOR_SERVER_CERTIFICATES_ENABLED*>>#
* *type*: `boolean`
* *description*: Requires a valid certificate for connecting to {APP_AUTOMATION} server.
Set to false when running in development mode.

Used by {APP_AUTOMATION} server.
* *default*: `true`

.[#CORREDOR_SERVER_CERTIFICATES_PATH]#<<CORREDOR_SERVER_CERTIFICATES_PATH,*CORREDOR_SERVER_CERTIFICATES_PATH*>>#
* *type*: `string`
* *description*: Base path for all certificate files

Used by {APP_AUTOMATION} server.
* *default*: `/certs`

.[#CORREDOR_SERVER_CERTIFICATES_CA]#<<CORREDOR_SERVER_CERTIFICATES_CA,*CORREDOR_SERVER_CERTIFICATES_CA*>>#
* *type*: `string`
* *description*: Path to certificate authority file

Used by {APP_AUTOMATION} server.
* *default*: `ca.crt`

.[#CORREDOR_SERVER_CERTIFICATES_PRIVATE]#<<CORREDOR_SERVER_CERTIFICATES_PRIVATE,*CORREDOR_SERVER_CERTIFICATES_PRIVATE*>>#
* *type*: `string`
* *description*: Path to private key file for {APP_AUTOMATION} server.

Used by {APP_AUTOMATION} server.
* *default*: `private.key`

.[#CORREDOR_SERVER_CERTIFICATES_PUBLIC]#<<CORREDOR_SERVER_CERTIFICATES_PUBLIC,*CORREDOR_SERVER_CERTIFICATES_PUBLIC*>>#
* *type*: `string`
* *description*: Path to certificate file for {APP_AUTOMATION} server.

Used by {APP_AUTOMATION} server.
* *default*: `public.crt`

.[#CORREDOR_CLIENT_CERTIFICATES_ENABLED]#<<CORREDOR_CLIENT_CERTIFICATES_ENABLED,*CORREDOR_CLIENT_CERTIFICATES_ENABLED*>>#
* *type*: `boolean`
* *description*: Establish secure connection to {APP_AUTOMATION} server.
Set to false when running in development mode.

Used by API server.
* *default*: `true`

.[#CORREDOR_CLIENT_CERTIFICATES_PATH]#<<CORREDOR_CLIENT_CERTIFICATES_PATH,*CORREDOR_CLIENT_CERTIFICATES_PATH*>>#
* *type*: `string`
* *description*: Base path for all certificate files.

Used by API server.
* *default*: `/certs/corredor/client`

.[#CORREDOR_CLIENT_CERTIFICATES_CA]#<<CORREDOR_CLIENT_CERTIFICATES_CA,*CORREDOR_CLIENT_CERTIFICATES_CA*>>#
* *type*: `string`
* *description*: Path to certificate authority file.

Used by API server.
* *default*: `ca.crt`

.[#CORREDOR_CLIENT_CERTIFICATES_PRIVATE]#<<CORREDOR_CLIENT_CERTIFICATES_PRIVATE,*CORREDOR_CLIENT_CERTIFICATES_PRIVATE*>>#
* *type*: `string`
* *description*: Path to private key file for {APP_AUTOMATION} server.

Used by API server.
* *default*: `private.key`

.[#CORREDOR_CLIENT_CERTIFICATES_PUBLIC]#<<CORREDOR_CLIENT_CERTIFICATES_PUBLIC,*CORREDOR_CLIENT_CERTIFICATES_PUBLIC*>>#
* *type*: `string`
* *description*: Path to certificate file for {APP_AUTOMATION} server.

Used by API server.
* *default*: `public.crt`


# src/modules/devops-guide/pages/references/configuration/server.adoc

= Server configuration
:page-aliases: 2024.9@configuration/server.adoc

:leveloffset: +1

include::generated:partial$env-options.gen.adoc[]

:leveloffset: -1

// Will probably refactor the list to this:
// [cols="2a,6a"]
// |===
// | [#DB_DSN]#<<DB_DSN,*DB_DSN*>>#
// |
// * *type*: string,
// * *descriptions*: Database connection string
// * *default*: `sqlite3://file::memory:?cache=shared&mode=memory`

// | [#DB_DSN]#<<DB_DSN,*DB_DSN*>>#
// |
// * *type*: string,
// * *descriptions*: Database connection string
// * *default*: `sqlite3://file::memory:?cache=shared&mode=memory`

// | [#DB_DSN]#<<DB_DSN,*DB_DSN*>>#
// |
// * *type*: string,
// * *descriptions*: Database connection string
// * *default*: `sqlite3://file::memory:?cache=shared&mode=memory`

// |===


# src/modules/devops-guide/pages/server-plugins/index.adoc

include::ROOT:partial$variables.adoc[]

= Server plugins

[IMPORTANT]
====
*Deprecation warning:* Plugin support has been deprecated in {PRODUCT_NAME} _2022.9_.
This section of documentation will be removed in {PRODUCT_NAME} _2023.3_.
====


# src/modules/devops-guide/pages/sink-route.adoc

include::ROOT:partial$variables.adoc[]

= Sink Routes
:page-aliases: 2024.9@extension-requirements/sink-route.adoc
:description: {PRODUCT_NAME} allows you to detect incoming HTTP requests via automation scripts.
:keywords: dev-ops, DevOps, webhook, automation scripts

{PRODUCT_NAME} allows you to detect incoming HTTP requests via automation scripts -- sink routes.
Sink routes allow you to implement custom API endpoints to add support for things like webhooks.

[NOTE]
====
Here, we only cover how to setup a sink route.
Refer to the xref:integrator-guide:index.adoc[] for details on how to use them.
====

== Generating a Signature

A *sink signature* is used to authorize incoming HTTP requests to the `/sink` route.

[IMPORTANT]
====
Sink signatures should be treated as passwords.
====

A sink signature is generated using the xref:references/cli-reference.adoc#sink-signature[sink signature] CLI command.

For example `{CLI_CMD} sink signature` returns such an output (the signature will be different):

[source]
----
/system/sink?__sign=187...3D
Sink request constraints:
 - signature should be part of query-string
 - body size is not limited
----

[IMPORTANT]
====
Refer to the CLI command reference for details on available options (`{CLI_CMD} sink signature -h`).
The above command creates an unconstrained signature (any request is considered as valid).
====

The signature can be found at the end of the `__sign` query parameter.

[IMPORTANT]
====
This signature should be stored somewhere safe as it is required to authenticate any request to the sink route.
====

Each request to the sink route must specify the sink signature we generated above.

[CAUTION]
====
Some services (when implementing the OAuth2 flow) may not allow the use of query parameters.
See <<sign-in-path>> to bypass the restriction.
====

== Use the Sink Route

When you need to use the sink route (e.g. you wish to define a webhook), all inbound requests must specify the sink signature generated above.
Either in the query parameter or in the path (depending on the provided CLI parameters).

For example:
[source,bash]
----
curl '$BASE_API_URL/system/sink?__sign=$SINK_SIGNATURE' \
  --data-binary '{
    "a": "b"
  }';
----

[IMPORTANT]
====
Note that when using a custom API base URL (see: xref:configuration/server.adoc#_http_api_base_url[HTTP_API_BASE_URL]) or you have webapp incorporated into the server (see: xref:configuration/server.adoc#_http_webapp_enabled[HTTP_WEBAPP_ENABLED]), the sink url would be prefixed (ie by default per webapp enabled: `$BASE_API_URL/api/system/sink?__sign=$SINK_SIGNATURE`).
====

[#sign-in-path]
== Unable to Use Query Parameters?

If you can't use a query parameter to authenticate the request, add the `--signature-in-path` argument tho the xref:references/cli-reference.adoc#sink-signature[sink signature] CLI command.

For example `{CLI_CMD} sink signature --signature-in-path` returns such an output (the signature will be different):

[source]
----
/system/sink/ext_mautic/lead/__sign=7a9...==
Sink request constraints:
 - signature should be part of path
 - body size is not limited
----

[CAUTION]
====
The "in path" signature *can not be used* inside a query parameter and vice-versa.
====


# src/modules/devops-guide/pages/system-requirements.adoc

include::ROOT:partial$variables.adoc[]

= System Requirements

== Supported Clients

[IMPORTANT]
====
{PRODUCT_NAME} doesn't support older browsers.
If you wish to do so, you may build your own Docker containers with custom build procedures.
====

.{PRODUCT_NAME} supports the following clients:
[cols=","]
|===
|Client |Version

|Chrome| v78+
|Firefox| v68+
|Safari| v12+
|Edge| v44+
|iOS| iPhone 5s devices and later with iOS 12+
|Android| Android 7+
|===

== Server Operating System

Any Docker-compatible operating system is supported. 

[NOTE]
====
We recommend a Linux-based operating system, preferably Ubuntu LTS.
====

== Docker

The minimum Docker Engine version is 1.12.x

== HTTP Server

You should place the API and the web applications behind a firewall or an HTTP reverse proxy.
The reverse proxy is responsible for traffic forwarding to {PRODUCT_NAME} services and https://en.wikipedia.org/wiki/TLS_termination_proxy[SSL termination].

[NOTE]
====
Most of the popular HTTP servers support this.
====

The documentation provides configurations guides for https://github.com/nginxproxy/nginx-proxy[Nginx Reverse Proxy] and the https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion[LetsEncrypt nginx-proxy companion].

[NOTE]
====
It isn't obligatory to use Nginx; you can use the HTTP server you are most familiar with.

Use provided examples for Nginx as a reference on how to configure it.
====

== Database

It is recommended to use the https://hub.docker.com/_/postgres[PostgreSQL] 13, either native on the host or provided via Docker.

[NOTE]
====
{PRODUCT_NAME} also supports MySQL for which we recommend https://hub.docker.com/_/percona[Percona Server for MySQL] 8.x.
====

== Hardware

|===
| Number of Users | Processor      | Memory
|    1 - 500      |  1 vCPU/cores  |  2 GB RAM
|  500 - 1000     |  2 vCPU/cores  |  4 GB RAM
| 1000 - 2000     |  4 vCPU/cores  |  8 GB RAM
| 2000 - 5000     |  8 vCPU/cores  | 16 GB RAM
| 5000+           | 16 vCPU/cores  | 32 GB RAM
|===

== Storage

.Estimated storage per user per month:
[cols="m,,"]
|===
|Volume|Description|Recommended Storage

| Low volume
| *{APP_NAME_COMPOSE}*: creating plain-text records (without file upload).
| 5 MB/user/month

|Medium volume
| *{APP_NAME_COMPOSE}*: attaching documents to records.
| 25 MB/user/month

| High volume
| *{APP_NAME_COMPOSE}*: attaching a high number of documents to records daily.
| 100 MB/user/month

|===

.For the annual storage calculation you will need:
* Base storage (operating system and core components) of 10 GB,
* recommended storage per user per month based on the matrix above (multiplied by 12 to get the yearly amount),
* average number of users in a year,
* apply a safety factor; we recommend at least 2.0.

.The formula:
----
total = (nr. of users * recommended storage * 12 * safety factor) + base storage
----

.Example calculation for 30 medium usage users:
----
Recommended storage = (30 * 25 MB * 12 * 2) + 10 GB = 28 GB / year
----

== Network

Depending on your configuration, {PRODUCT_NAME} may need some access to outside services.

If you intend to use any email communication; such as sending confirmation emails, password reset emails, or sending emails from automation scripts; you must configure your SMTP servers to be accessible.

If you enable federation, the nodes ({PRODUCT_NAME} instances) must be *visible and allow traffic* between them on the designated HTTP ports.

If you enable OAuth2 or OIDC sign-up or access external services via automation scripts, you should allow HTTP traffic.

== Domain and Hostname

The most common way to set up your {PRODUCT_NAME}  instance is hosting the web application and the API server on one domain and providing a hostname for each;

* Hostname for Web application,

* hostname for API server.

Alternatively, if needed, the setup could be split into two and host the web application and the API server separately. 
This would require you to have two domains.

[NOTE]
====
If you already own a domain, you can add two or more hosts and use them to access your {PRODUCT_NAME}  instance.
====

== HTTPS/SSL Certificates

{PRODUCT_NAME} supports any SSL certificate from all certificate authorities (CA).
You can use any existing or new SSL certificate from any commercial SSL certificate provider or self-signed.

We use https://en.wikipedia.org/wiki/Let's_Encrypt[Let's Encrypt].

[NOTE]
====
If you aren't using any other HTTP server, we highly recommend using the use of https://github.com/nginxproxy/nginx-proxy[Nginx Reverse Proxy] and https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion[LetsEncrypt companion container for nginx-proxy].

It is an automated and the simplest way to secure {PRODUCT_NAME} or any other web application you host.
====


# src/modules/devops-guide/pages/troubleshooting/health-check.adoc

include::ROOT:partial$variables.adoc[]

= Health Check
:page-aliases: 2024.9@maintenance/health-check.adoc
:description: A health check is a series of steps you should take to verify that everything is set up and working correctly.
:keywords: dev-ops, DevOps, CLI, health check, maintenance

A health check is a series of steps the system performs to determine if the {PRODUCT_NAME} instance is working as intended.

To access the automated health check, you can navigate to the `/healthcheck` endpoint of your {PRODUCT_NAME} instance.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "troubleshooting/health-check/http.png",
    "alias": "troubleshooting-health-check-http",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 204,
    "h": 109
  }
}
----

Alternatively, you can run the `docker-compose ps` command to check the health from the CLI.

[source]
----
       Name                      Command                  State                Ports
---------------------------------------------------------------------------------------------
my-corteza_db_1       /docker-entrypoint.sh mysqld     Up (healthy)   3306/tcp, 33060/tcp
my-corteza_server_1   ./bin/corteza-server serve-api   Up (healthy)   127.0.0.1:18080->80/tcp
----

Refer to the xref:troubleshooting/index.adoc[] docs for additional help with fixing unhealthy parts of the system.


# src/modules/devops-guide/pages/troubleshooting/index.adoc

include::ROOT:partial$variables.adoc[]

= Troubleshooting
:page-aliases: 2024.9@maintenance/troubleshooting.adoc
:description: These troubleshooting steps help you solve the most common issues we have encountered in the past.
:keywords: dev-ops, DevOps, troubleshooting

In case you are experiencing issues while setting up or using {PRODUCT_NAME} you can use the following tools and knowledge bases to help you resolve your issue.

{PRODUCT_NAME} introduces a xref:troubleshooting/web-console.adoc[] which provides an easy way to access important information such as server logs.
The web console can be used to try and pinpoint what is causing the issue.

If you are unable to resolve the issue, you can reach out to the community on https://forum.cortezaproject.org/[our forum].

== Ports are not available

When running various services on your machine, it's common that the ports are already in use.
You see something like this:

[source]
----
Cannot start service server: Ports are not available: listen tcp 127.0.0.1:18080: bind: address already in use
----

If you see this error, you can change the port number to a number between `1024` and `65535`.
You can also replace the value for `services.server.ports` in `docker-compose.yaml` to `["80"]`, and Docker then picks an available port for you.

[#ws-nginx-connection-fail]
== WebSocket connection failing with Nginx

If the WebSocket connection is failing to establish, you might need to enable Nginx WebSocket proxying.

[NOTE]
====
You can find detailed instructions and further examples in the https://nginx.org/en/docs/http/websocket.html[Nginx documentation].
====

Inside your `nginx.conf` file (by default, it is located inside the `/etc/nginx` directory), add the following lines to the `server` configuration section;

[source]
----
location /api/websocket {
  proxy_pass http://server:80;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "Upgrade";
  proxy_set_header Host $host;
}

----
[CAUTION]
====
Make sure to adjust the location if you've defined a custom configuration that affects the base path.
====

== Connection to {APP_AUTOMATION} server

You might see one or more connection refused errors in server container logs (`docker-compose logs -f server`):

[source]
----
{"level":"error","ts":1608125024.4714684,"logger":"corredor","caller":"corredor/service.go:427","msg":"could not load corredor server scripts","error":"rpc error: code = DeadlineExceeded desc = latest balancer error: connection error: desc = \"transport: Error while dialing dial tcp 172.23.0.2:80: connect: connection refused\"","stacktrace":"github.com/cortezaproject/corteza-server/pkg/corredor.(*service).loadServerScripts\n\t/drone/src/pkg/corredor/service.go:427"}
----

If there are a couple of errors when the server is starting up, that's ok.
Sometimes it takes more time to start up {APP_AUTOMATION} server, and {PRODUCT_NAME} server can not yet connect to it.

If the problem persists and you can see {APP_AUTOMATION} state as healthy, verify the changes you might have made to the configuration.

== Network Proxy Declared as External

[source]
----
ERROR: Network proxy declared as external, but could not be found. Please create the network manually using `docker network create proxy` and try again.
----

Make sure your nginx-proxy service is up and running before running {PRODUCT_NAME}.

[source,bash]
----
$ docker network create proxy
----

== Blank Screen on `/auth` With the "state does not match" Error in the Browser Console

The `state does not match` error usually occurs in the development environment or where the {PRODUCT_NAME} server is frequently restarted.

The authentication state, which is carried through the user authentication flow, is not persistent and will perish on server restart.
If the error occurs and persists on the production environment, verify your `AUTH_SESSION_*` `.env` settings (in case you have modified them).

== Stuck on Login Screen After Providing Valid Credentials

Please note that some deployments (like with Docker) might not have all configuration available for valid auto-configuration.
Check what cookies are sent in the response headers on login.

_Please note that examples below have an abbreviated session value._

=== Broken Configuration, User is Stuck on Login Screen

[source]
----
set-Cookie:
    session=MTYzODQ...tCLvO_DHhw==;
    Path=/auth;
    Domain=e3a47cb50c17; <1>
    Expires=Sun, 27 Nov 2022 10:13:08 GMT;
    Max-Age=31104000;
    HttpOnly
----
<1> A set of random characters where the domain or hostname should represent the Docker container ID (and hostname).
Setup like this requires `DOMAIN` variable to be set (for example. `DOMAIN=localhost:8080`).
//Editor's note: is what it is set to important?
Do not forget to recreate your server container after the change.

=== Valid Cookie Example

[source]
----
set-Cookie: <1>
    session=MTYzODQ...tCLvO_DHhw==;
    Path=/auth;
    Expires=Sun, 27 Nov 2022 12:58:01 GMT;
    Max-Age=31104000;
    HttpOnly
----
<1> When you provide `DOMAIN` option like instructed in the example above, notice that "Domain" flag on the cookie is missing.
{PRODUCT_NAME} removes it when you use port in the domain.

=== Valid Example of a Cookie on a Secure Host

[source]
----
set-cookie:
    session=MTYzODQ...tCLvO_DHhw==;
    Path=/auth;
    Domain=corteza.example.org;
    Expires=Fri, 03 Dec 2021 12:58:46 GMT;
    Max-Age=86400;
    HttpOnly;
    Secure <1>
----
<1> Note the "Secure" cookie flag.
This cookie is sent back to the server only if server is on secure domain (HTTPS).
If you used `HTTP_SSL_TERMINATED` or `LETSENCRYPT_HOST` options, Corteza assumes that it is served on a secured domain.

== Further Troubleshooting

If you continue to have issues with {PRODUCT_NAME}, we encourage you to contact other users on our https://latest.cortezaproject.org[community server].
You'll more than likely find someone who can help you out.
You can also open an issue on our https://github.com/cortezaproject/corteza-server[cortezaproject/corteza-server] GitHub repository.

== SMTP not Working

You can use the `corteza-server auth test-notifications` command to verify that your SMTP configuration is working correctly.
The command sends a test email to the provided email address.

[source,bash]
----
corteza-server auth test-notifications your-email@example.tld
----

Depending on your provider, the email can take different amounts of time to be delivered.
If you can't see the email, make sure to check your spam folder and server logs.

.Connection and authentication errors look like this:
[source]
----
could not send email: dial tcp [::1]:25: connect: connection refused
----

== Changes to the Default Auth-Client Settings Seem not to have been Applied

Restarting the server is required when an admin modifies default authentication client settings, such as client secret or redirect URIs, because those changes are not applied immediately.


# src/modules/devops-guide/pages/troubleshooting/logging.adoc

include::ROOT:partial$variables.adoc[]

= Logging
:page-aliases: 2024.9@logging.adoc

Logging can be configured in the `.env` file using the `LOG_*` variables.

== Log Levels

[NOTE]
====
`LOG_DEBUG=true` acts like setting `LOG_LEVEL=ALL`
====

[cols="1s,5a"]
|===
| [#log-level-all]#<<log-level-all,ALL>>#
|
The `LOG_LEVEL=ALL` logs all system and custom defined log levels.

| [#log-level-debug]#<<log-level-debug,DEBUG>>#
|
The `LOG_LEVEL=DEBUG` logs diagnostic information in a verbose, detailed manner.
The log level should be used for testing, diagnostic, and troubleshooting purposes.

| [#log-level-info]#<<log-level-info,INFO>>#
|
The `LOG_LEVEL=INFO` logs informative outputs of the system, such as services stopping or starting.
The log level can be used to describe what a particular task has done, such as what data was accessed and what interactions were performed.

| [#log-level-warn]#<<log-level-warn,WARN>>#
|
The `LOG_LEVEL=WARN` logs unexpected issues that may occur when it isn't clear to the particular service what it should do with the input, or the provided data is malformed.
The log level is used when the system functions correctly, but the issue should be looked into.

| [#log-level-error]#<<log-level-error,ERROR>>#
|
The `LOG_LEVEL=ERROR` logs unexpected issues that prevent the system from functioning properly, such as inability to access files, other {PRODUCT_NAME} services, or external services.
The log level is used when the issue is blocking the system from functioning properly.
It should be addressed as a priority.

| [#log-level-dpanic]#<<log-level-dpanic,DPANIC>>#
|
Reserved; unused.

| [#log-level-panic]#<<log-level-panic,PANIC>>#
|
Reserved; unused.

| [#log-level-fatal]#<<log-level-fatal,FATAL>>#
|
The `LOG_LEVEL=FATAL` logs unexpected issues which may cause a serious problem or a corruption to occur.
The log level is used to indicate a catastrophic state of the system, which must be addressed as a priority.

| [#log-level-off]#<<log-level-off,OFF>>#
|
If both logging `.env` variables are not set (`LOG_DEBUG` and `LOG_LEVEL`), logs are not recorded.
|===

== Env Variables:
[source,.env]
----
# Logging level we want to use (values: debug, info, warn, error, dpanic, panic, fatal)
# Minimise the logging level. If set to "warn", Levels warn, error, dpanic panic and fatal will be logged.
LOG_LEVEL=debug

//Editor's note: Line 63 - MinimiZe

# Disables JSON format for logging and enables more human-readable output with colors.
# Disable for production.
LOG_DEBUG=true/false

# Log filtering rules by level and name (log-level:log-namespace).
# Please note that level (LOG_LEVEL) is applied before filter and it affects the final output!
# Leave unset for production.
# Log warnings, errors, panic, fatals. Everything from workflow is logged.
# See more examples and documentation here: https://github.com/moul/zapfilter
LOG_FILTER=warn+:workflow.*

# Set to true to see where the logging was called from.
# Disable for production.
LOG_INCLUDE_CALLER=true/false

# Include stack-trace when logging at a specified level or below.
# Disable for production.
# Default value: "dpanic"
# Possible values: debug, info, warn, error, dpanic, panic, fatal
LOG_STACKTRACE_LEVEL

----

== Workflow Logging

The xref:integrator-guide:automation/workflows/index.adoc#functions[workflow function steps] allow you to log messages from inside a workflow.

Make sure that the `.env` variables are set accordingly.

[TIP]
====
You can use a `LOG_FILTER` to show only the logs that match the provided pattern.

[source,.env]
----
# Log filtering rules by level and name (log-level:log-namespace).
# Please note that level (LOG_LEVEL) is applied before filter and it affects the final output!
# Leave unset for production.
# Log warnings, errors, panic, fatals. Everything from workflow is logged.
# LOG_FILTER={LOG_LEVEL}+:workflow.*
LOG_FILTER=warn+:workflow.*

# For colorful and human-readable output
LOG_DEBUG=true
----
====

[cols="1s,5a"]
|===
| Function | .env Configuration

| [#workflow-log-debug]#<<workflow-log-debug,Log debug message>>#
|
[source,.env]
----
LOG_DEBUG=true

# OR

LOG_LEVEL=debug
----

| [#workflow-log-info]#<<workflow-log-info,Log info message>>#
|
[source,.env]
----
LOG_DEBUG=true

# OR

LOG_LEVEL=debug
# OR
LOG_LEVEL=info
----

| [#workflow-log-warning]#<<workflow-log-warning,Log warning message>>#
|
[source,.env]
----
LOG_DEBUG=true

# OR

LOG_LEVEL=debug
# OR
LOG_LEVEL=info
# OR
LOG_LEVEL=warn
----

| [#workflow-log-error]#<<workflow-log-error,Log error message>>#
|
[source,.env]
----
LOG_DEBUG=true

# OR

LOG_LEVEL=debug
# OR
LOG_LEVEL=info
# OR
LOG_LEVEL=warn
# OR
LOG_LEVEL=error
----
|===


# src/modules/devops-guide/pages/troubleshooting/web-console.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} Server Web Console

The {PRODUCT_NAME} server web console provides a fast and easy way to inspect your system which can greatly simplify and speedup troubleshooting process.

.The screenshot shows the {PRODUCT_NAME} server web console home page.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "web-console-home.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "h": 300
  },
  "annotations": []
}
----

When enabled, the web console is available at `https://\{BASE_URL}/console` (for example `https://corteza.domain.tld/console`)

[CAUTION]
====
The {PRODUCT_NAME} server web console exposes details and configuration about your server and {PRODUCT_NAME} itself.
Make sure to keep it safe behind strong credentials.
====

== Configuration

When running in development mode (by setting the `ENVIRONMENT=dev` `.env` variable), the web console is enabled and open to everyone.

The web console can explicitly be enabled by setting the `HTTP_SERVER_WEB_CONSOLE_ENABLED=true` `.env` variable.

[CAUTION]
====
The web console doesn't implement the standard security model.
Anyone with the required credentials may access the web console.
====

The web console access credentials can be controlled by setting the `HTTP_SERVER_WEB_CONSOLE_USERNAME` and `HTTP_SERVER_WEB_CONSOLE_PASSWORD` `.env` variables.

== Accessing logs

To access server logs, navigate to the web console by accessing `https://\{BASE_URL}/console` and navigating to the *logs* tab.
The logs display the latest 10240 entries.

.The screenshot shows the log viewer.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "web-console-logs.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 78,
    "y": 17,
    "w": 44,
    "h": 21
  }]
}
----


# src/modules/devops-guide/pages/upgrade/202003.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2020.3
:page-aliases: 2024.9@upgrade-guide:202003.adoc

== After the Upgrade

=== {APP_AUTOMATION} Scripts

{PRODUCT_NAME} 2020.3 introduces a new way of how automation scripts are stored, handled and executed.
The code, configuration and triggers are no longer stored in the {PRODUCT_NAME} database, but are defined as JavaScript files on the filesystem and accessed directly by the {PRODUCT_NAME} {APP_AUTOMATION} server.

All pre-installed scripts for the CRM and ServiceCloud have already been migrated and are ready for use.

[IMPORTANT]
====
You need to migrate any custom automation scripts manually.
====

There are 2 available `script-migrator` commands, one for system other one for {APP_NAME_COMPOSE} service:

[source,subs="attributes"]
----
{CLI_CMD_SYSTEM} script-migrator --dst <base-location>
{CLI_CMD_COMPOSE} script-migrator --dst <base-location>
----

These two commands create a simple structure under `<base-location>/<service>/custom`
(`system/custom/` and `compose/custom/`) containing scripts from both services.

[CAUTION]
====
The script migrator tool directly exports the script's source code and triggers without running any checks or tests.
Make sure you test each script and trigger after the migration.
====

Point script-migrator tool (base-location) to Corredor's `usr/server` directory.
This creates script source files (javascript) directly to the recommended location.

The script files' names are created from the script names (with suffixing script ID in case of any duplicated).
Migrator skips all deleted scripts, deleted triggers, scripts with "test" name or without any code.

[NOTE]
====
If possible, module handle is used where a module is referenced (in Compose scripts).
====


# src/modules/devops-guide/pages/upgrade/202009.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2020.9
:page-aliases: 2024.9@upgrade-guide:202009.adoc

== After the Upgrade

=== {PRODUCT_NAME} Service Cloud

{PRODUCT_NAME} 2020.9 renames {PRODUCT_NAME} Service Cloud to {PRODUCT_NAME} Case Management.
The new automation scripts are *not* compatible with the previous namespace.

.Follow this set of steps to properly update your instance:
. Rename the Service Cloud namespace name to {PRODUCT_NAME} Case Management.
. Change the service-cloud namespace slug to case-management.
. Go over each page in the {PRODUCT_NAME} Case Management namespace and replace the old service-cloud automation buttons with new case-management buttons.
. Test your changes to assure everything works as it should.


# src/modules/devops-guide/pages/upgrade/202012.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2020.12
:page-aliases: 2024.9@upgrade-guide:202012.adoc

[IMPORTANT]
====
Due to *database schema changes*, it's not possible to downgrade or revert your installation after upgrading to `2020.12`.
Please be extremely careful, backup your database and follow the recommended steps.
====

[IMPORTANT]
====
If you use {PRODUCT_NAME} REST API, please note that paging parameters on certain endpoints have changed.
====

== After the Upgrade

=== Field Expressions and Automation Scripts

With the introduction of field expressions, some {APP_AUTOMATION} automation scripts became obsolete and were removed from the 2020.12 release.
This affects existing deployments that use CRM and Case Management applications.

THe automated upgrade does not replace the removed automation scripts with module field expressions in case you've manually changed parts of the configuration.
The removed automation scripts need to be manually replaced with module field expressions.

.Module modifications:
|===
| Module| Field| Value expression| Sanitizer| Validators

| Account
| BillingStreet
|
|
| `trim(value)`

| Account
| BillingCity
|
|
| `trim(value)`

| Account
| BillingState
|
|
| `trim(value)`

| Account
| BillingPostalCode
|
|
| `trim(value)`

| Account
| ShippingStreet
|
|
| `trim(value)`

| Account
| ShippingCity
|
|
| `trim(value)`

| Account
| ShippingState
|
|
| `trim(value)`

| Account
| ShippingPostalCode
|
|
| `trim(value)`

| Account
| GeneratedBillingAddress
| `trim(trim(trim(BillingStreet?BillingStreet:"") + "\n" + trim(trim(trim(BillingPostalCode?BillingPostalCode:"") + " " + trim(BillingCity?BillingCity:"")) + " " + trim(BillingState?BillingState:""))) + "\n" + trim(BillingCountry?BillingCountry:""))`
|
|

| Account
| GeneratedShippingAddress
| `trim(trim(trim(BillingStreet?BillingStreet:"") + "\n" + trim(trim(trim(BillingPostalCode?BillingPostalCode:"") + " " + trim(BillingCity?BillingCity:"")) + " " + trim(BillingState?BillingState:""))) + "\n" + trim(BillingCountry?BillingCountry:""))`
|
|

| Lead
| Street
|
|
| `trim(value)`

| Lead
| City
|
|
| `trim(value)`

| Lead
| State
|
|
| `trim(value)`

| Lead
| PostalCode
|
|
| `trim(value)`

| Lead
| GeneratedAddress
| `trim(trim(trim(BillingStreet?BillingStreet:"") + "\n" + trim(trim(trim(BillingPostalCode?BillingPostalCode:"") + " " + trim(BillingCity?BillingCity:"")) + " " + trim(BillingState?BillingState:""))) + "\n" + trim(BillingCountry?BillingCountry:""))`
|
|

| Lead
| RecordLabel
| `trim((FirstName ? FirstName : "") + " " + (LastName ? LastName : ""))`
|
|

| Quote
| Discount
|
|
| `value < 0`: "Discount can not be a negative number"

| Quote
| Subtotal
|
|
| `value < 0`: "Sub total can not be a negative number"

| Quote
| Tax
|
|
| `value < 0`: "Tax can not be a negative number"

| Quote
| TotalPrice
| `max(max((Subtotal?Subtotal:0) - (Discount?Discount:0), 0) + (ShippingHandling?ShippingHandling:0))`
|
|

| Quote
| GrandTotal
| `TotalPrice * (Tax ? 1+Tax/100 : 1)`
|
|

|===

=== Federation (experimental feature)

Currently {PRODUCT_NAME} does not import Federation roles and RBAC rules when upgrading existing database.
This can be done manually by running the following command:

[source,shell]
----
docker-compose exec server corteza-server import /corteza/provision/200_federation
----


# src/modules/devops-guide/pages/upgrade/202103.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2021.3
:page-aliases: 2024.9@upgrade-guide:202103.adoc

== After the Upgrade

=== {PRODUCT_NAME} {APP_NAME_WORKFLOW}

{PRODUCT_NAME} introduces workflows as an alternative to automation scripts.
Workflows allow you perform the vast majority of automation script tasks while keeping the visual factor.

It is highly recommended you migrate your automation scripts to workflows.
Refer to the xref:2021.3@integrator-guide:workflows/index.adoc[low-code platform developer guide] for details.

.Make sure you run partial provision for importing workflows and associated permissions:
[source,shell]
----
docker-compose exec server corteza-server import /corteza/provision/300_automation
----

=== Templates

{PRODUCT_NAME} introduces templates as a standardized facility to handle and render documents based on generic templates.
Prior to 2021.3, templates were handled either in {APP_NAME_COMPOSE} modules or as `.html` files and rendered using our `corteza-js/renderer` package.
As of 2021.3, you are able to define and render templates directly with the core system.

It is highly recommended you move your templates to the new standardized facility.
Refer to the xref:integrator-guide:templates/index.adoc[low-code platform developer guide] for details.

=== Authentication

{PRODUCT_NAME} reworks how the authentication system works.
As of 2021.3, all of the authentication endpoints are removed and no longer work.

If you were using the authentication endpoints to obtain a JWT token for API access, you can use the xref:devops-guide:references/cli-reference.adoc#auth-jwt[JWT CLI command].

If you were using the authentication endpoints to authenticate users on your custom portals, you need to register an auth client in the {PRODUCT_NAME} {APP_NAME_AUTH} panel and rework your authentication logic to use the OAuth 2 flow.


# src/modules/devops-guide/pages/upgrade/202109.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2021.9
:page-aliases: 2024.9@upgrade-guide:202109.adoc

== Docker Image Changes

{PRODUCT_NAME} changed how Docker images are structured from 2021.9 on.

[IMPORTANT]
====
If you were using `cortezaproject/corteza-server` to run server and web applications before `2021.9`, you must switch to `cortezaproject/corteza`.
====

Docker image `cortezaproject/corteza-server` in `2021.9` should be used only as application server.


# src/modules/devops-guide/pages/upgrade/202209.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2022.9
:page-aliases: 2024.9@upgrade-guide:202209.adoc


The `2022.9` upgrade does not require any additional interactions from the system administrator.
Please note the changelog and the xref:ROOT:changelog/202209/index.adoc#2022_9-important[important upgrade notes] disclosed in the changelog section.


# src/modules/devops-guide/pages/upgrade/202303.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading to 2023.3
:page-aliases: 2024.9@upgrade-guide:202303.adoc

== After the Upgrade

{PRODUCT_NAME} `2023.3` introduces a new resource - `corteza:compose:page-layout`.
As with most other resources, it introduces new RBAC rules.

Re-visit your security model setup and adjust your RBAC rules to incorporate the new resource.

[CAUTION]
====
If a specific role does not have read access to a specific page layout, that layout will not be shown and some pages may appear empty (due to no page layouts being available).
====


# src/modules/devops-guide/pages/upgrade/index.adoc

include::ROOT:partial$variables.adoc[]

= Upgrading {PRODUCT_NAME}
:page-aliases: 2024.9@upgrade-guide:index.adoc

This guide helps you upgrade your {PRODUCT_NAME} to the newest version in no time!

[IMPORTANT]
====
While there are internal safeguards in place that can prevent data loss or other kinds of disasters, make sure you backup your database before you upgrade.
Refer to xref:devops-guide:maintenance/backups.adoc[devops guide on backup procedure] for details.
====

[IMPORTANT]
====
If you are upgrading multiple versions at the same time; for example from 2019.12 to 2020.9; you should follow all the upgrade guides between the two versions.
====

== Recommended Steps for {PRODUCT_NAME} Upgrade

.Especially before any major version upgrade, it is recommended that before upgrading your production you either:
- upgrade your staging environment, or
- deploy a temporary environment with a copy of the production database and perform a test upgrade there.

.Steps to upgrade {PRODUCT_NAME} when deployed with *docker-compose*:
. changing image versions in your `docker-compose.yaml` (or  `.env`) file,
. pull new images from docker hub with `docker-compose pull`,
. recreate containers with `docker-compose up -d`.

:leveloffset: +1

include::202303.adoc[]

:leveloffset: -1


# src/modules/devops-guide/partials/warnings/sqlite.adoc

*Potential data loss when using SQLite in memory.*

We strongly recommend you use other DB engines (PostgreSQL or MySQL).
If you are set on using SQLite, make sure to use persistent storage.

The used SQLite driver https://pkg.go.dev/github.com/mattn/go-sqlite3[mattn/go-sqlite3] re-creates the entire database whenever a new connection is established and drops the whole database when the last connection is closed.

We use SQLite primarily for testing, so this isn't an issue for us.
We will work on a more robust solution in future releases.


# src/modules/end-user-guide/nav.adoc

* xref:index.adoc[]


** xref:data-privacy/index.adoc[]
*** xref:data-privacy/data-privacy-console.adoc[]
*** xref:data-privacy/data-privacy-officer.adoc[]
** xref:crm/index.adoc[]
** xref:case-management/index.adoc[]


# src/modules/end-user-guide/pages/case-management/accounts.adoc

include::ROOT:partial$variables.adoc[]

= Accounts

The Accounts page is accessible by clicking on the menu:Accounts[] section in the main navigation bar on the top of the screen.

Accounts are entities (companies or other) that you currently do business with.
An account stores essential data regarding the company, along with a set of contacts, entitlements and cases.

== Adding a new account

. Navigate to the menu:Accounts[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

== Adding a case for an account

. Navigate to the menu:Accounts[select account],
. scroll down to the "cases" page block,
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

[NOTE]
====
Refer to xref:case-management/index.adoc#cases[the cases section] for additional details.
====

[#account-add-entitlement]
== Adding an entitlement for an account

. Navigate to the menu:Accounts[select account],
. scroll down to the "entitlements" page block,
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.


# src/modules/end-user-guide/pages/case-management/cases.adoc

include::ROOT:partial$variables.adoc[]

[#cases]
= Cases

The Cases page is accessible by clicking on the menu:Cases[] section in the main navigation bar on the top of the screen.

.There are three pages dedicated to cases:
* menu:Cases[] shows all of the cases in the system,
* menu:All New cases[] shows only the cases that have the `status of being new,
* menu:My new cases[] shows only the new cases that you are responsible for.

.A typical case flow:
. A client contacts the company with an issue,
. the service agent checks the clients account to see if their entitlements permit support for the issue,
. if the client is entitled to support, a new case is created, directly from the account page,
. the agent inserts any relevant parameters to the case, assigns a category (the default is "problem"), links any related products, contacts, and assigns an agent,
. the assigned agent works on the case, creates updates and finally closes the case.

== Adding a new case

. Navigate to the menu:Cases[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

Each case has an automatically generated case number, which starts with "ticket#" followed by a number.
An example case number is `ticket#20191025094353420`.

[NOTE]
====
The ticket number provides a unique identification which is used within the system.
To make the ticket understandable, provide a good subject.
A good subject alone allows you to get a general idea of what the ticket is about.
Make sure that the subject is short, clear and straight to the point.
====

== The key parts of a case

Case Description::
    This is where you find the base information regarding a case; its status, priority, and a related product.

Case Details::
    This is where you can find essential relations, such as the related account, contact, case owner, and it's cost.

Updates::
    This is where all the updates related to the case are kept.
    It can be anything from receiving updates from the clients to us contacting the client and gives you a clear picture of what is going on.
    It is posiible to add a new update by clicking on the "Add Update to this Case" button.
    Case status changes automatically when you create an update.

Knowledge Base::
    This is where you can quickly search through the knowledge base to find relevant information in order to get a better understanding of the task at hand.

== Email template

Refer to the xref:integrator-guide:templates/index.adoc[menu:Low-Code Platform Developer Guide[Templates]] for details on how to add a new or modify existing templates.


# src/modules/end-user-guide/pages/case-management/contacts.adoc

include::ROOT:partial$variables.adoc[]

= Contacts

The Contacts page is accessible by clicking on the menu:Accounts[Contacts] section in the main navigation bar on the top of the screen.

A contact belongs to an account; you can think of them as employees for a specific company that you are allowed to contact.

== Adding a new contact

. Navigate to the menu:Accounts[Contacts],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

== The key parts of a contact

[IMPORTANT]
====
A contact has two particular elements that indicate how and if you can contact them:

* Do Not Call,
* Email Opt Out.

The agent should check these fields before trying to make any contact.
====

Personal Data::
    Here the essential information regarding contacts, such as their name, title, phone, and email are stored.

Contact Address::
    Here their contact address (if it is necessary to generate any quotes, send packages or dispatch maintainers) are stored.

Contact Twitter Feed::
    Here you can keep track of the contact's latest updates via Twitter. 
//Nika's note: Only Twitter?

Cases related to this Contact::
    Here the cases that are related to the contact; either created by the contact, or those which it are responsible for are stored.

Emails::
    Here, in chronological order, the emails that you have previously sent to the contact are stored.
    These are usually generated based on cases.

== Adding a case for a contact

. Navigate to the menu:Accounts[Contacts,select account],
. scroll down to the "cases" page block,
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

[NOTE]
====
Refer to xref:case-management/index.adoc#cases[the cases section] for additional details.
====


# src/modules/end-user-guide/pages/case-management/dashboards.adoc

include::ROOT:partial$variables.adoc[]

= Dashboards

The Dashboards page is accessible by clicking on the menu:Dashboards[] section in the main navigation bar on the top of the screen.

Dashboards help you to visually understand changing business conditions, so you can make decisions based on the real-time data of your Case Management.
Refer to the xref:integrator-guide:compose-configuration/index.adoc[menu:Low-Code Platform Developer Guide[Low Code configuration]] if you wish to add additional dashboards.

[TIP]
====
You can easily define new dashboards to expose the data you care about the most.
====


# src/modules/end-user-guide/pages/case-management/departments.adoc

include::ROOT:partial$variables.adoc[]

= Departments

The Departments page is accessible by clicking on the menu:Departments[] section in the main navigation bar on the top of the screen.

Companies usually consist of multiple departments that may have different costs when performing their tasks.
One hour support by the service department is not the same as one hour support by R&D.
This allows the system to calculate the cost of a particular case automatically.

[NOTE]
====
A department is not directly assigned to a case, but rather its update.
This allows multiple departments to work on the same case.
====

== Adding a department

. Navigate to the menu:Departments[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

== The key parts of a department

Department details::
    Here the essential information regarding a department, such as its name, list of employees, and it's hourly cost are stored.

Total time and cost of department related to work on cases::
    Here you can see some quick statistics regarding total consumed times and the total cost of the department.
    The system calculates this, so that you don't have to worry about this.

Case updates related to the department::
    Here you can see all of the case updates that are assigned to this department.
    This can help us determine what department has the most significant load so you can properly adjust our business process.

[IMPORTANT]
====
Changing the hourly cost of a department only affects new entries.
Old entries and their costs remain untouched unless they are updated.
====


# src/modules/end-user-guide/pages/case-management/entitlement-templates.adoc

include::ROOT:partial$variables.adoc[]

= Entitlement templates

The Products page is accessible by clicking on the menu:Products[Entitlement Templates] section in the main navigation bar on the top of the screen.

A product or service typically comes with entitlement to support.
For example, a software license may allow the client to contact you by phone when they have issues or questions.
Or, when you sell hardware, you may need to offer a period of guarantee, allowing the client to contact you when in case product breaks within that period.

Case Management provides an easy way of defining the most common entitlements as entitlement templates.
After creating a template, you bind it to a product.
Now, whenever an entitlement is created for that product, the template will be used to prefill the base information regarding the entitlement.

== Adding an entitlement template

. Navigate to the menu:Products[Entitlement Templates],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

== Adding an entitlement template to an existing product

. Navigate to the menu:Products[select a product],
. click on the btn:[Edit] button in the bottom right corner,
. select the "entitlement template" in the "product description" page block,
. press the btn:[Save] button in the bottom right corner.

== Adding an entitlement template to a new product

. Navigate to the menu:Products[Entitlement Templates,select a template],
. navigate to the "Products that use this entitlements template" page block,
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.


# src/modules/end-user-guide/pages/case-management/entitlements.adoc

include::ROOT:partial$variables.adoc[]

= Entitlements

The Entitlements page is accessible by clicking on the menu:Accounts[Entitlements] section in the main navigation bar on the top of the screen.

Entitlements are types of customer support, such as *phone support* or *email support*.
You can set up entitlements to help support agents determine whether a customer is eligible for support or not.

Entitlements are related to an account and a product.
For a fixed amount of time (defined by the start and end date), they are entitelled to certain services provided by the seller.

An entitlement can be created either manually, or <<account-add-entitlement,from an account>>.

== Adding an entitlement

. Navigate to the menu:Accounts[Entitle,ents],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

[TIP]
====
You can define an entitlement template under a product to automatically supply some of the data beforehand.
Refer to entitlement templates for more information.
====


# src/modules/end-user-guide/pages/case-management/home.adoc

include::ROOT:partial$variables.adoc[]

= Home

The home page is accessible by clicking on the menu:Home[] section in the main navigation bar on the top of the screen.

The home page is a dashboard for your business; it gives a quick overview of your cases, so you know what is going on.

It shows you essential statistics regarding your cases. They may be sorted by priority, status, and category.


# src/modules/end-user-guide/pages/case-management/index.adoc

include::ROOT:partial$variables.adoc[]

= Case Management

{PRODUCT_NAME} Case Management is a *highly flexible*, *scalable* and *open source* solution for keeping up with customer cases.

:leveloffset: +1

include::home.adoc[]

include::cases.adoc[]

include::accounts.adoc[]

include::contacts.adoc[]

include::entitlements.adoc[]

include::products.adoc[]

include::entitlement-templates.adoc[]

include::knowledge-base.adoc[]

include::departments.adoc[]

include::settings.adoc[]

include::dashboards.adoc[]

:leveloffset: -1


# src/modules/end-user-guide/pages/case-management/knowledge-base.adoc

include::ROOT:partial$variables.adoc[]

= Knowledge base

[NOTE]
====
We use *KB* as a  notation to reference to the knowledge base.
====

The Knowledge Base page is accessible by clicking on the menu:Knowledge Base[] section in the main navigation bar on the top of the screen.

The KB stores various information regarding your products, services and other so that you can solve repeating cases faster.

== Adding a knowledge base entry

. Navigate to the menu:Knowledge Base[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

[NOTE]
====
The KB number gets calculated by the system.
====

== The key parts of a knowledge base entry

Details::
    Here the essential information regarding the entry, such as the type, related product, description, its status and some other metadata are stored.

Cases with this KB Item as Solution::
    Here you see all the cases that you solved with the help of this entry.
    This helps you distinguish good entries from bad ones to improve the KB.
    It also allows other agents to solve similar cases much faster.

== Tips for improving quality

Implement reviews::
    You can use the status field of the entry to indicate if it needs to be reviewed by an expert, or if it's accepted or rejected.


# src/modules/end-user-guide/pages/case-management/products.adoc

include::ROOT:partial$variables.adoc[]

= Products

The Products page is accessible by clicking on the menu:Products[] section in the main navigation bar on the top of the screen.

A product can be a physical or a software product, as well as a service provided by your company.
Products allow you to keep track of how much turnover a specific product or a product family provides.
You also get an overview of all cases for a specific product.

== Adding a product

. Navigate to the menu:Products[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

== The key parts of a product

Product Description::
    Here the essential information regarding the product, such as it's product code, name, family and optionally an entitlement template are stored.

[TIP]
====
You can use entitlement templates to automate the creation of more common entitlements, such as a hardware warranty for a product.
====

Case totals::
    Here the total time and cost that a specific product has required so far can be seen.
    The system calculates these fields, so there is no need to worry about that!

Cases related to this product::
    Here you can find all the cases created for the product.
    It can help us identify the most problematic products and the most common issues.

Entitlements for this product::
    Here you can find all of the entitlements created for this product.

Knowledge Base items related to this product::
    The knowledge base allows us to provide some information regarding the product, so our support agents can provide quality answers without the need for experts.

[NOTE]
====
The knowledge base is accessible from the case creation screen.
====


# src/modules/end-user-guide/pages/case-management/settings.adoc

include::ROOT:partial$variables.adoc[]

= Settings

The Settings page is accessible by clicking on the menu:Settings[] section in the main navigation bar on the top of the screen.

== Available settings

=== The following number for a KB item

This indicates the following ID that is used for the adjacent KB item (entry).
Unless you migrate from another system, this value doesn't need to be changed.

=== The default cost per hour

This is used if a department doesn't define its hourly cost or if you don't assign a department to the case update.

[NOTE]
====
We strongly advise that each department explicitly specifies an hourly cost.
====

=== The default department for new ticket

This is the default department that will be assigned to a ticket if no other department is selected.

=== The default time for a case update

This is the default time that is used when working on case updates.

[TIP]
====
You can calculate the average spent time and use that value here.
====

=== The default case link

This is the base URL that is used when generating links to cases.

[TIP]
====
If you have an external portal that is able to display cases stored by {PRODUCT_NAME}, you can change this link to point to that portal.
====

== Step by step configuration

=== The following number for a KB item

If you've migrated from another system, insert the next number that should be used.
If not, you can leave this as it is.

=== The default cost per hour

Enter a default cost that should be used when working on a case update.

=== The default department for new ticket

Select the default department.
You should first create departments if you don't see any.

=== The default time for a case update

Enter a default time that should be used when working on a case update.

=== The default case link

. Navigate to the "Pages" of your admin panel,
. find the page called `Record page for module "Case"`,
. copy the page ID (this is the long number at the end of the address, similar to the above channel ID),
. insert `{APP_COMPOSE_BASE_URL}/ns/case-management/pages/<page_ID_here>/record`.
For example: `{APP_COMPOSE_BASE_URL}/ns/case-management/pages/111502308285612036/record`

[TIP]
====
If you have an external portal that is able to display cases stored by {PRODUCT_NAME}, you can change this link to point to that portal.
====


# src/modules/end-user-guide/pages/crm/accounts.adoc

include::ROOT:partial$variables.adoc[]

= Accounts

The Accounts page is accessible by clicking on the menu:Accounts[] section in the main navigation bar on the top of the screen.

Accounts are entities (companies or other) that you currently do business with.
Here you can store information such as the size of a company, opportunities and business contact information.

An account can be created either manually, or by <<lead-convert,converting a lead>>.

The most important block in accounts is *opportunities* as it expresses the potential of sales.
To generate a new opportunity for the account, press the btn:[Create new Opportunity from this account] button.

.Other related blocks are:
. *Contacts*: all the contacts related to the account.
. *Contracts*: all contracts, active or inactive related to the account.
. *Cases*: all cases that are related to the account.
. *Notes*, *Events* and *Tasks*.

[NOTE]
====
The primary contact provides contact information when generating documents such as quotes.
====

[TIP]
====
* You can create new contracts for the account by pressing the "Create new Contract from this account" button.
* You can create new cases for the account by pressing the "Create new Case from this account" button.
====

== Adding a new account manually

. Navigate to the menu:Accounts[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

[#account-new-opportunity]
== Adding an opportunity for an account

. Navigate to the menu:Accounts[select an account],
. click on the btn:[Create new Opportunity from this Account] button.

== Adding a contract for an account

. Navigate to the menu:Accounts[select an account],
. click on the btn:[Create new Contract from this Account] button.

== Adding a case for an account

. Navigate to the menu:Accounts[select an account],
. click on the btn:[Create new Case from this Account] button.


# src/modules/end-user-guide/pages/crm/campaigns.adoc

include::ROOT:partial$variables.adoc[]

= Campaigns

The Campaigns page is accessible by clicking on the menu:Campaigns[] section in the main navigation bar on the top of the screen.

A campaign is a planned marketing project that you want to manage and keep track of from within the CRM.
This allows you to analyze different business strategies and analyze which one is the most effective.

A campaign can be anything; a simple newsletter, seminar, conference, or any other type of marketing initiative.

Leads, contacts, accounts and opportunities are related to campaigns as *campaign members*.
The campaign - opportunity relationship allows you to calculate values such as the ROI (Return of Investment) based on the campaign cost and the expected revenue.

//To calculate the ROI, you need to insert the cost of the campaign.
//Nika's note: insert the cost of the campaign where? - clarity purposes
The CRM creates the numbers that compare the costs to the value of the won opportunities.

[TIP]
====
Try to bind all of your leads with campaigns.
Upon lead conversion, the campaigns are mapped to the account and opportunity, allowing you to define the ROI of your lead generation activities.
====

== Adding a new campaign

. Navigate to the menu:Campaigns[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.


# src/modules/end-user-guide/pages/crm/cases.adoc

include::ROOT:partial$variables.adoc[]

= Cases

The Cases page is accessible by clicking on the menu:Mode[Cases] section in the main navigation bar on the top of the screen.

The {PRODUCT_NAME} CRM implements a simplified case management tool.
It allows you to keep track of various customer complaints, disputes or similar.

[IMPORTANT]
====
The CRM and the xref:case-management/index.adoc[Case Management] do not share data.
====

Cases can be linked to accounts, contacts, products or even to other cases.

You can define who is part of the case, what role they have, keep track of the progress, assign tasks and add notes.

[NOTE]
====
You can store a resolved case as a "Solution".
Solutions help you to solve similar (future) cases with ease.
====

== Adding a new case

. Navigate to the menu:More[Cases],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

== Marking the case as "in progress"

. Navigate to the menu:More[Cases,select a case],
. click on the btn:[Set Case status to Working].

== Marking the case as "closed"

. Navigate to the menu:More[Cases,select a case],
. click on the btn:[Set Case status to Closed].

== Sharing the progress to a contact

. Navigate to the menu:More[Cases,select a case],
. click on the btn:[Inform the contact via email of the Case solution].


# src/modules/end-user-guide/pages/crm/dashboards.adoc

include::ROOT:partial$variables.adoc[]

= Dashboards

The Dashboards page is accessible by clicking on the menu:Dashboards[] section in the main navigation bar on the top of the screen.

Dashboards help you to visually understand changing business conditions so you can make decisions based on the real-time data of your CRM.

{PRODUCT_NAME} CRM comes built-in with a handful of predefined dashboards that should give you enough understanding about the business.
Refer to the xref:integrator-guide:compose-configuration/index.adoc[menu:Low-Code Platform Developer Guide[Low Code configuration]] if you wish to add additional dashboards.

[TIP]
====
You can include social media feeds with your dashboards.
Refer to the xref:integrator-guide:compose-configuration/index.adoc[menu:Low-Code Platform Developer Guide[Low Code configuration]] for more information.
====


# src/modules/end-user-guide/pages/crm/events.adoc

include::ROOT:partial$variables.adoc[]

= Events

The Events page is accessible by clicking on the menu:Events[] section in the main navigation bar on the top of the screen.

Events help you stay organized by keeping track of the things you should do.

You can access your events either from the Events page or from the homepage.
They are also accessible from any other page that allows events; such as leads and opportunities.


== Adding a new custom event

. Navigate to the menu:Tasks[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

== Adding a new event for a lead

. Navigate to the menu:Leads[select a lead],
. scroll down to the "events" page block,
. click on the btn:[+ Add] button.

== Adding a new event for an account

. Navigate to the menu:Accounts[select an account],
. scroll down to the "events" page block,
. click on the btn:[+ Add] button.

== Adding a new event for a contact

. Navigate to the menu:Contacts[select a contact],
. scroll down to the "events" page block,
. click on the btn:[+ Add] button.

== Adding a new event for an opportunity

. Navigate to the menu:Opportunities[select an opportunity],
. scroll down to the "events" page block,
. click on the btn:[+ Add] button.

== Adding a new event for a quote

. Navigate to the menu:Quotes[select a quote],
. scroll down to the "events" page block,
. click on the btn:[+ Add] button.

== Adding a new event for a contract

. Navigate to the menu:Contracts[select a contract],
. scroll down to the "events" page block,
. click on the btn:[+ Add] button.


# src/modules/end-user-guide/pages/crm/home.adoc

include::ROOT:partial$variables.adoc[]

= Home

The home page is accessible by clicking on the menu:Home[] section in the main navigation bar on the top of the screen.

The homepage is the main dashboard for your business; it gives you a quick overview of the most important information in the CRM.

By default, it shows you essential statistics regarding your leads, a calendar with events, as well as lists of your new leads, key opportunities and tasks.


# src/modules/end-user-guide/pages/crm/index.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} CRM

{PRODUCT_NAME} CRM is a *highly flexible*, *scalable* and *open source* Customer Relationship Management solution.

:leveloffset: +1

include::home.adoc[]

include::leads.adoc[]

include::accounts.adoc[]

include::opportunities.adoc[]

include::tasks.adoc[]

include::campaigns.adoc[]

include::quotes.adoc[]

include::products.adoc[]

include::dashboards.adoc[]

include::cases.adoc[]

include::events.adoc[]

:leveloffset: -1


# src/modules/end-user-guide/pages/crm/leads.adoc

include::ROOT:partial$variables.adoc[]

= Leads

The Leads page is accessible by clicking on the menu:Leads[] section in the main navigation bar on the top of the screen.

A *lead* (may also be referred to as prospect) is an individual who *might become a customer* but currently is not.
They are usually converted into accounts, contacts and opportunities.

.There are three pages dedicated to leads:
* menu:Leads[] shows all of the leads in the system,
* menu:All New Leads[] shows only the leads that have the `New` status,
* menu:My Leads[] shows only the leads assigned to you.

The typical process of handling a lead after it is inserted in the system is for the assigned salesperson to follow up on the lead.
This salesperson can contact, and further qualify the lead.

== Adding a new lead

. Navigate to the menu:Leads[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

[TIP]
====
* The rating field allows you to see which leads are qualified as good leads.
* Try to retrieve as much relevant lead data as possible.
It helps create interesting charts, such as leads per country or leads per industry.
* Fill in the lead's personal or company twitter profile.
This allows you to see, directly in the lead record, a list of latest tweets from that profile.
* You can create notes, events and tasks for a lead.
====

[#lead-convert]
== The conversion of a lead

A lead should be converted when there is a sales opportunity.

[NOTE]
====
When a lead is converted, the generated contact is set as the primary contact for the account.
==== 

.There are two options:
* [#lead-convert-account]#<<lead-convert-account,Converting the lead into an account>># when it shows some interest but it is not exactly clear what the sales opportunity is.
This conversion creates an account and a contact for the lead.
To use this conversion, navigate to menu:Lead[select a lead] and click on the btn:[Convert this Lead into an Account] button.
* [#lead-convert-account_opp]#<<lead-convert-account,Converting the lead into an account and opportunity>># when it shows some interest and you already have enough information about the sales opportunity.
This conversion creates an account, a contact and an opportunity for this lead.
To use this conversion navigate to menu:Lead[select a lead] and click on the btn:[Convert this Lead into an Account and Opportunity] button.

== Tips for determining the lead rating

If a lead *shows commercial interest*, such as a request for pricing, and the lead's *location matches the region your business targets*, this lead could be considered a *5 star lead*.

If a lead *performs some additional interactions*, such as going through a demo, they could be considered a *3 star lead*.

If a lead *contacts* you, but it's clear that there is no explicit business intention, it can be considered a *0 star* or a *1 star* lead.


# src/modules/end-user-guide/pages/crm/opportunities.adoc

include::ROOT:partial$variables.adoc[]

= Opportunities

The Opportunities page is accessible by clicking on the menu:Opportunities[] section in the main navigation bar on the top of the screen.

An account can be created either manually, or by <<account-new-opportunity,generating it from an account>>.

When generating an opportunity for a given account, you indicate that you have uncovered a potential future sale and thus potential revenue.

An *opportunity name* should be short and descriptive in order to identify what the opportunity is about quickly.
to illustrate; "300 licenses" is a good example as it is short and straight to the point.

The default close date is set to one month after the opportunity is created (can be configured with <<settings,settings>>).

The *stage* field allows you to identify what stage a given opportunity is in.
When you create an opportunity, it is set to *Qualification*.
Once correctly qualified, you can move it to *Proposal* (or to *Need Analysis*, if more analysis is needed).
The last few steps are *Negotiation*, followed by *Closed Won* or *Closed Lost*.

[TIP]
====
Use the Contact Roles block to create a clear overview of the people related to the opportunity, including the contact data and role.
====

== Adding a new opportunity manually

. Navigate to the menu:Opportunities[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

== Adding products and updating amounts

. Navigate to the menu:Opportunities[select an opportunity],
. select a price book,
. add products by clicking on the btn:[+ Add] button in the "products" block,
. click on the btn:[Update prices of Products by applying the selected Price Book and inserted discounts] button,
. press the btn:[Save] button on the bottom right corner.

[IMPORTANT]
====
You only have to insert the quantity and optionally the discount for a product.
Other fields are filled in automatically.
====

[NOTE]
====
You can overwrite the list price of the product by inserting a different sales price manually.
====

[#opportunity-generate-quote]
== Generating a quote for the opportunity

. Navigate to the menu:Opportunities[select an opportunity],
. click on the btn:[Create a new Quote for this opportunity] button.

== Tips for the qualification of leads

.It is useful to reflect upon the following data:
* *budget*: check whether there is a budget,
* *authority*: check if you are able to communicate with the decision-makers,
* *need*: check if there is an actual need for the product/service,
* *timeline*: check on what timeline the product/service needs to be delivered or implemented, and if this timeline is compatible with your capabilities,
* *competition*: check with whom you are competing.


# src/modules/end-user-guide/pages/crm/products.adoc

include::ROOT:partial$variables.adoc[]

= Products

The Products page is accessible by clicking on the menu:Products[] section in the main navigation bar on the top of the screen.

Here you can manage all of your company's products and services.
Each product has a description and related files.
The cost of the product is determined by the price book.
The product can be linked to cases.

[NOTE]
====
The cost is determined by the <<price-book,price book>>, not by the product itself.
====

== Adding a new product

. Navigate to the menu:Products[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

[#price-book]
== Price book

The price book page is accessible by clicking on the menu:Products[Price book] section in the main navigation bar on the top of the screen.

[NOTE]
====
Your company may have different price books depending on the region and client organization type.
====

The price book determines how much the product or service costs.
When creating an opportunity, product prices and the totals are calculated based on the selected price book.

=== Adding a new price book entry

. Navigate to the menu:Products[Price book,select a price book],
. click on the btn:[+ Add] button on the *price book entries* page block,
. populate the data and press the btn:[Save] button on the bottom right corner.

[TIP]
====
If you wish to add multiple price book entries at the same time, click on the btn:[Edit] button in the bottom right corner.
This allows you to add multiple price book entries at the same time.
====


# src/modules/end-user-guide/pages/crm/quotes.adoc

include::ROOT:partial$variables.adoc[]

= Quotes

The Quotes page is accessible by clicking on the menu:Quotes[] section in the main navigation bar on the top of the screen.

A quote can be created either manually, or by <<opportunity-generate-quote,generating it from an opportunity>>.
An opportunity can have multiple quotes.
A quote allows you to complete the payment and thus charge the customer.

[IMPORTANT]
====
{PRODUCT_NAME} does not implement a payment mechanism.
You should use an external provider.
====

Products in an opportunity are inserted as quote line items.

Quote *bill to*, *quote to* and *ship to* information are retrieved from the related account.

== Adding a new quote manually

. Navigate to the menu:Quotes[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button in the bottom right corner.

== Sending the quote to a primary contact

. Navigate to the menu:Opportunities[select an opportunity],
. click on the btn:[Send this Quote via email to the primary contact] button.

== Sending the quote to a custom contact

. Navigate to the menu:Opportunities[select an opportunity],
. click on the btn:[Send this Quote to a custom email] button,
. insert the email address into the requested prompt window and press btn:[Submit].


# src/modules/end-user-guide/pages/crm/settings.adoc

include::ROOT:partial$variables.adoc[]

= Settings

This special module only has one record.
Here you can set:

.Opportunity settings
* The days for an opportunity to close
* The default probability of an opportunity
* The default forecast category
* The default opportunity stage

.Quote settings
* The next quote number
* The days for a quote to expire
* The default email to send the quote from

.Contract settings
* The next contract number
* The default time for a contract (in months)

.Case settings
* The next case number
* The next solution number


# src/modules/end-user-guide/pages/crm/tasks.adoc

include::ROOT:partial$variables.adoc[]

= Tasks

The Tasks page is accessible by clicking on the menu:Tasks[] section in the main navigation bar on the top of the screen.

Tasks allow you to keep track of pending tasks that need to be handled and are displayed in the list or on the calendar on the homepage.
Tasks can refer to leads, accounts, contacts, opportunities, quotes, or contracts.

[NOTE]
====
Make sure to mark the task as "closed" once it has been completed.
====

== Adding a new custom task

. Navigate to the menu:Tasks[],
. click on the btn:[+ Add] button to open the form,
. populate the data and press the btn:[Save] button on the bottom right corner.

== Adding a new task for a lead

. Navigate to the menu:Leads[select a lead],
. scroll down to the "tasks" page block,
. click on the btn:[+ Add] button.

== Adding a new task for an account

. Navigate to the menu:Accounts[select an account],
. scroll down to the "tasks" page block,
. click on the btn:[+ Add] button.

== Adding a new task for a contact

. Navigate to the menu:Contacts[select a contact],
. scroll down to the "tasks" page block,
. click on the btn:[+ Add] button.

== Adding a new task for an opportunity

. Navigate to the menu:Opportunities[select an opportunity],
. scroll down to the "tasks" page block,
. click on the btn:[+ Add] button.

== Adding a new task for a quote

. Navigate to the menu:Quotes[select a quote],
. scroll down to the "tasks" page block,
. click on the btn:[+ Add] button.

== Adding a new task for a contract

. Navigate to the menu:Contracts[select a contract],
. scroll down to the "tasks" page block,
. click on the btn:[+ Add] button.


# src/modules/end-user-guide/pages/data-privacy/data-privacy-console.adoc

include::ROOT:partial$variables.adoc[]

= Data Privacy Console

The data privacy console enables you to access your data.
It provides a platform where you may submit requests to modify, delete, and export your data.
These requests (deletion, correction, and export) concerning the treatment of your data are forwarded to the xref:data-privacy/data-privacy-officer.adoc[data privacy officer (DPO)].

This feature is also enabled to allow all users to browse locations where the data is stored.

.The screenshot shows the overview of the data privacy console.
image::data-privacy/data-privacy-console.png[role="data-zoomable"]

// == Data Overview

// Data overview allows you to review your profile information and your data stored in Corteza applications.

// image::data-privacy/data-overview.png[role="data-zoomable"]

// * Profile Information - Contact information, names, surnames, nicknames, profile picture.

// * Data Application - Personal data stored in your {PRODUCT_NAME} instance.

== Privacy Requests
The privacy request feature enables you to access and manage a list of all your privacy-related requests.

image::data-privacy/privacy-requests-list.png[role="data-zoomable"]

You can cancel pending requests by selecting them from the list and clicking the btn:[Cancel Request] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/manage-request-lists.png",
    "alias": "manage-request-lists",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 30,
    "y": 73,
    "h": 32,
    "w": 126
  }]
}
----

Additionally, you can click on a specific request to examine it and make comments instructing the data privacy officer how to treat your data or cancel the request using the btn:[Cancel Request] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/pending-export-request.png",
    "alias": "pending-export-request",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1782,
    "y": 1035,
    "h": 32,
    "w": 123
  }]
}
----

=== Correction Request

When a user is dissatisfied with their personal information because it is inaccurate, incomplete, misleading, or out-of-date, they can request that the information be rectified or deleted.

To request a correction:

. On your {PRODUCT_NAME} instance navigate to the Data Privacy Console by clicking on btn:[Privacy] application.
. Click on btn:[Data Overview] 
. Select Application data(Your data is stored in {PRODUCT_NAME} instance).
. Select the type of connection by selecting it from the Connection dropdown. 
. Fill in the data with the necessary corrections. 
. Click the btn:[Request Correction] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/correction-request.png",
    "alias": "correction-request",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1717,
    "y": 1023,
    "h": 40,
    "w": 186
  }]
}
----

=== Deletion request

When a user is dissatisfied with their personal information for any reason, they can make use of the Data Deletion Requests feature to request its deletion.

To request a data deletion:

. On your {PRODUCT_NAME} instance navigate to the Data Privacy Console by clicking on btn:[Privacy] application.
. Click on btn:[Data Overview] 
. Select Application data(Your data is stored in {PRODUCT_NAME} instance).
. Select the type of connection by selecting it from the Connection dropdown. 
. Click on the btn:[Delete Selected Data] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/delete-request.png",
    "alias": "delete-request",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1703,
    "y": 1023,
    "h": 40,
    "w": 200
  }]
}
----

=== Data Export Request

The data export feature provides a convenient way to obtain a copy of your data for backup or import it into a different system.

To make a data export request;

. On your {PRODUCT_NAME} instance navigate to the Data Privacy Console by clicking on btn:[Privacy] application.
. Open a new data export request.
. Choose either *Profile information* or *Application Data* as the data type.
. Choose the data range and output file format, either JSON or CSV.
. Click on the btn:[Export Selected Data] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/export-request.png",
    "alias": "export-request",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1704,
    "y": 1024,
    "h": 39,
    "w": 199
  }]
}
----



# src/modules/end-user-guide/pages/data-privacy/data-privacy-officer.adoc

include::ROOT:partial$variables.adoc[]

= Data Privacy Officer

The data privacy officer (also referred to as DPO) is a role assigned to a user to grant him sufficient permissions to access all received data privacy requests.
A DPO can approve or deny requests, give comments, and schedule execution using the data privacy officer console.

== Capabilities of Data privacy officer(DPO)

A data privacy officer has the following capabilities:

. Search for records with data-sensitive fields retrieve the required information.

. Reject a request if it is not unjustified or in accordance with the established privacy policies.

. Review submitted requests and prepare responses.

. Update records with sensitive data to comply with the data update or removal request.

. Access a list of data privacy requests and provide responses.

. Create a privacy-request policy to govern how privacy requests are handled.

== Data Privacy Officer Console

The data privacy officer console is a user interface that enables a DPO to access privacy requests from other users concerning the handling of personal data.

[IMPORTANT]
====
The DPO console is only accessible to users assigned the role of a data privacy officer.
====

Using the data privacy officer console, a DPO can approve or reject requests, provide feedback in the form of comments, schedule requests for execution, and have an overview of modules with sensitive data.

image::data-privacy/dpo-console.png[role="data-zoomable"]

=== Privacy Requests

The DPO has access to a list of pending requests that need to be approved.
The privacy requests include correction, export, and deletion.

To access these requests:

On your {PRODUCT_NAME} instance navigate to the Data Privacy Console by clicking on btn:[Privacy] application.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/corteza-application.png",
    "alias": "corteza-application",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 640,
    "y": 539,
    "h": 169,
    "w": 202
  }]
}
----

On the data privacy console, click on btn:[incoming privacy button].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/incoming-privacy.png",
    "alias": "incomimg-privacy",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 30,
    "y": 205,
    "h": 25,
    "w": 422
  }]
}
----

Once on the privacy requests page, you can click on btn:[approve Requests] to approve all pending requests.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/privacy-request-list.png",
    "alias": "privacy-request-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 20,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 20,
    "y": 0,
    "w": 1070,
    "h": 228
  },
  "annotations": [{
    "kind": "box",
    "x": 33,
    "y": 75,
    "h": 30,
    "w": 136
  }]
}
----

Additionally,you can click on each individual request to approve or reject it.

[NOTE]
====
Additionally, the DPO can also respond by providing feedback to a request using the comment dialog box.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/data-export-request.png",
    "alias": "data-export-request",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1777,
    "y": 1033,
    "h": 32,
    "w": 128
  }]
}
----

[cols="1s,5a"]
|===
| [#correction-request]#<<correction-request,Correction Request>>#
|
Through the data privacy console, the DPO has access to correction requests made by users to correct their data because it is inaccurate, incomplete, misleading, or out-of-date.

image::data-privacy/correction-request.png[role="data-zoomable"]

| [#deletion-request]#<<deletion-request,Deletion request>>#
|
Through the data privacy console, the DPO has access to deletion requests made by users in case they are dissatisfied with their personal information for any reason.

image::data-privacy/data-deletion-request.png[role="data-zoomable"]

| [#data-export-request]#<<data-export-request,Data Export Request>>#
|
Through the data privacy console, the DPO has access to data export requests made by users when they want to obtain a copy of their data for backup or import it into a different system.

image::data-privacy/data-export-request.png[role="data-zoomable"]

|===

=== Sensitive Modules

The DPO has access to an overview of all modules with sensitive data fields. 
In addition, he can search for modules containing sensitive data fields.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitive-modules.png",
    "alias": "sensitive-modules",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "w": 1820,
    "h": 1080
  },
  "focus": {
    "x": 10,
    "y": 10,
    "w": 1770,
    "h": 170
  },
  "annotations": []
}
----


# src/modules/end-user-guide/pages/data-privacy/index.adoc

include::ROOT:partial$variables.adoc[]

= Data Privacy

Data privacy allows us to specify and describe, how and where sensitive data is stored on a module-field level.

It expands the current data storing capabilities and adds features that enable {PRODUCT_NAME} administrators to have more control over data privacy and managing private data.
With information from data sources set on a specific module, each record will be able to hold detailed information about the ownership and location(s) of particular data. 

{PRODUCT_NAME} enables the selection of predefined data policies or new policies to describe the processing purpose and rules at a record field level.


# src/modules/end-user-guide/pages/getting-started.adoc

include::ROOT:partial$variables.adoc[]

= Getting Started

// @todo

== Creating an account

// @todo

== Signing in

// @todo


# src/modules/end-user-guide/pages/index.adoc

include::ROOT:partial$variables.adoc[]

= Application End-User Guide
:description: {PRODUCT_NAME} application end-user guide covers all aspects of using core {PRODUCT_NAME} applications. It's designed to to be easily understandable by non-techy people.
:keywords: end-user, application end-user guide, crm, case management, application, {PRODUCT_NAME}

The application end-user guide covers all of the applications that are built by the {PRODUCT_NAME} team.
The guide teaches you how to use the applications without requiring any technical knowledge.

[NOTE]
====
The landing page is under construction.
====

.References:
* xref:crm/index.adoc[]
* xref:case-management/index.adoc[]


# src/modules/external/nav.adoc

include::ROOT:partial$variables.adoc[]

* https://docs.cortezaproject.org/corteza-api-docs/corteza-js/{PAGE-VERSION}/index.html[Corteza js API]
* https://docs.cortezaproject.org/corteza-api-docs/corteza-server/{PAGE-VERSION}/index.html[Corteza server API]

# src/modules/generated/partials/access-control/automation/component.gen.adoc

= Automation

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-automation-grant]#<<rbac-automation-grant,grant>>#
| Manage automation permissions
| Deny


| [#rbac-automation-workflow.create]#<<rbac-automation-workflow.create,workflow.create>>#
| Create workflows
| Deny


| [#rbac-automation-triggers.search]#<<rbac-automation-triggers.search,triggers.search>>#
| List, search or filter triggers
| Deny


| [#rbac-automation-sessions.search]#<<rbac-automation-sessions.search,sessions.search>>#
| List, search or filter sessions
| Deny


| [#rbac-automation-workflows.search]#<<rbac-automation-workflows.search,workflows.search>>#
| List, search or filter workflows
| Deny


| [#rbac-automation-resource-translations.manage]#<<rbac-automation-resource-translations.manage,resource-translations.manage>>#
| List, search, create, or update resource translations
| Deny


|===


# src/modules/generated/partials/access-control/automation/index.gen.adoc

= Automation

:leveloffset: +1

include::./component.gen.adoc[]

include::./resource.workflow.gen.adoc[]

include::./resource.session.gen.adoc[]

include::./resource.trigger.gen.adoc[]


:leveloffset: -1



# src/modules/generated/partials/access-control/automation/resource.workflow.gen.adoc

= workflow

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-workflow-read]#<<rbac-workflow-read,read>>#
| Read workflow
| Deny


| [#rbac-workflow-update]#<<rbac-workflow-update,update>>#
| Update workflow
| Deny


| [#rbac-workflow-delete]#<<rbac-workflow-delete,delete>>#
| Delete workflow
| Deny


| [#rbac-workflow-undelete]#<<rbac-workflow-undelete,undelete>>#
| Undelete workflow
| Deny


| [#rbac-workflow-execute]#<<rbac-workflow-execute,execute>>#
| Execute workflow
| Deny


| [#rbac-workflow-triggers.manage]#<<rbac-workflow-triggers.manage,triggers.manage>>#
| Manage workflow triggers
| Deny


| [#rbac-workflow-sessions.manage]#<<rbac-workflow-sessions.manage,sessions.manage>>#
| Manage workflow sessions
| Deny


|===


# src/modules/generated/partials/access-control/compose/component.gen.adoc

= Compose

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-compose-grant]#<<rbac-compose-grant,grant>>#
| Manage compose permissions
| Deny


| [#rbac-compose-settings.read]#<<rbac-compose-settings.read,settings.read>>#
| Read settings
| Deny


| [#rbac-compose-settings.manage]#<<rbac-compose-settings.manage,settings.manage>>#
| Manage settings
| Deny


| [#rbac-compose-namespace.create]#<<rbac-compose-namespace.create,namespace.create>>#
| Create namespace
| Deny


| [#rbac-compose-namespaces.search]#<<rbac-compose-namespaces.search,namespaces.search>>#
| List, search or filter namespaces
| Deny


| [#rbac-compose-resource-translations.manage]#<<rbac-compose-resource-translations.manage,resource-translations.manage>>#
| List, search, create, or update resource translations
| Deny


|===


# src/modules/generated/partials/access-control/compose/index.gen.adoc

= Compose

:leveloffset: +1

include::./component.gen.adoc[]

include::./resource.attachment.gen.adoc[]

include::./resource.chart.gen.adoc[]

include::./resource.module.gen.adoc[]

include::./resource.module-field.gen.adoc[]

include::./resource.namespace.gen.adoc[]

include::./resource.page.gen.adoc[]

include::./resource.page-layout.gen.adoc[]

include::./resource.record.gen.adoc[]

include::./resource.record-revision.gen.adoc[]


:leveloffset: -1



# src/modules/generated/partials/access-control/compose/resource.chart.gen.adoc

= chart

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-chart-read]#<<rbac-chart-read,read>>#
| read
| Deny


| [#rbac-chart-update]#<<rbac-chart-update,update>>#
| update
| Deny


| [#rbac-chart-delete]#<<rbac-chart-delete,delete>>#
| delete
| Deny


|===


# src/modules/generated/partials/access-control/compose/resource.module-field.gen.adoc

= module-field

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-module-field-record.value.read]#<<rbac-module-field-record.value.read,record.value.read>>#
| Read field value on records
| Deny


| [#rbac-module-field-record.value.update]#<<rbac-module-field-record.value.update,record.value.update>>#
| Update field value on records
| Deny


|===


# src/modules/generated/partials/access-control/compose/resource.module.gen.adoc

= module

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-module-read]#<<rbac-module-read,read>>#
| read
| Deny


| [#rbac-module-update]#<<rbac-module-update,update>>#
| update
| Deny


| [#rbac-module-delete]#<<rbac-module-delete,delete>>#
| delete
| Deny


| [#rbac-module-record.create]#<<rbac-module-record.create,record.create>>#
| Create record
| Deny


| [#rbac-module-owned-record.create]#<<rbac-module-owned-record.create,owned-record.create>>#
| Create record with custom owner
| Deny


| [#rbac-module-records.search]#<<rbac-module-records.search,records.search>>#
| List, search or filter records
| Deny


|===


# src/modules/generated/partials/access-control/compose/resource.namespace.gen.adoc

= namespace

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-namespace-read]#<<rbac-namespace-read,read>>#
| read
| Deny


| [#rbac-namespace-update]#<<rbac-namespace-update,update>>#
| update
| Deny


| [#rbac-namespace-delete]#<<rbac-namespace-delete,delete>>#
| delete
| Deny


| [#rbac-namespace-manage]#<<rbac-namespace-manage,manage>>#
| Access to namespace admin panel
| Deny


| [#rbac-namespace-module.create]#<<rbac-namespace-module.create,module.create>>#
| Create module on namespace
| Deny


| [#rbac-namespace-modules.search]#<<rbac-namespace-modules.search,modules.search>>#
| List, search or filter module on namespace
| Deny


| [#rbac-namespace-chart.create]#<<rbac-namespace-chart.create,chart.create>>#
| Create chart on namespace
| Deny


| [#rbac-namespace-charts.search]#<<rbac-namespace-charts.search,charts.search>>#
| List, search or filter chart on namespace
| Deny


| [#rbac-namespace-page.create]#<<rbac-namespace-page.create,page.create>>#
| Create page on namespace
| Deny


| [#rbac-namespace-pages.search]#<<rbac-namespace-pages.search,pages.search>>#
| List, search or filter pages on namespace
| Deny


|===


# src/modules/generated/partials/access-control/compose/resource.page-layout.gen.adoc

= page-layout

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-page-layout-read]#<<rbac-page-layout-read,read>>#
| read
| Deny


| [#rbac-page-layout-update]#<<rbac-page-layout-update,update>>#
| update
| Deny


| [#rbac-page-layout-delete]#<<rbac-page-layout-delete,delete>>#
| delete
| Deny


|===


# src/modules/generated/partials/access-control/compose/resource.page.gen.adoc

= page

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-page-read]#<<rbac-page-read,read>>#
| read
| Deny


| [#rbac-page-update]#<<rbac-page-update,update>>#
| update
| Deny


| [#rbac-page-delete]#<<rbac-page-delete,delete>>#
| delete
| Deny


| [#rbac-page-page-layout.create]#<<rbac-page-page-layout.create,page-layout.create>>#
| Create page layout on namespace
| Deny


| [#rbac-page-page-layouts.search]#<<rbac-page-page-layouts.search,page-layouts.search>>#
| List, search or filter page layouts on namespace
| Deny


|===


# src/modules/generated/partials/access-control/compose/resource.record.gen.adoc

= record

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-record-read]#<<rbac-record-read,read>>#
| read
| Deny


| [#rbac-record-update]#<<rbac-record-update,update>>#
| update
| Deny


| [#rbac-record-delete]#<<rbac-record-delete,delete>>#
| delete
| Deny


| [#rbac-record-undelete]#<<rbac-record-undelete,undelete>>#
| undelete
| Deny


| [#rbac-record-owner.manage]#<<rbac-record-owner.manage,owner.manage>>#
| owner.manage
| Deny


| [#rbac-record-revisions.search]#<<rbac-record-revisions.search,revisions.search>>#
| revisions.search
| Deny


|===


# src/modules/generated/partials/access-control/federation/component.gen.adoc

= Federation

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-federation-grant]#<<rbac-federation-grant,grant>>#
| Manage federation permissions
| Deny


| [#rbac-federation-pair]#<<rbac-federation-pair,pair>>#
| Pair federation nodes
| Deny


| [#rbac-federation-settings.read]#<<rbac-federation-settings.read,settings.read>>#
| Read settings
| Deny


| [#rbac-federation-settings.manage]#<<rbac-federation-settings.manage,settings.manage>>#
| Manage settings
| Deny


| [#rbac-federation-node.create]#<<rbac-federation-node.create,node.create>>#
| Create new federation node
| Deny


| [#rbac-federation-nodes.search]#<<rbac-federation-nodes.search,nodes.search>>#
| List, search or filter federation nodes
| Deny


|===


# src/modules/generated/partials/access-control/federation/index.gen.adoc

= Federation

:leveloffset: +1

include::./component.gen.adoc[]

include::./resource.node.gen.adoc[]

include::./resource.node-sync.gen.adoc[]

include::./resource.exposed-module.gen.adoc[]

include::./resource.shared-module.gen.adoc[]

include::./resource.module-mapping.gen.adoc[]


:leveloffset: -1



# src/modules/generated/partials/access-control/federation/resource.exposed-module.gen.adoc

= exposed-module

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-exposed-module-manage]#<<rbac-exposed-module-manage,manage>>#
| Manage exposed module module
| Deny


|===


# src/modules/generated/partials/access-control/federation/resource.node.gen.adoc

= node

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-node-manage]#<<rbac-node-manage,manage>>#
| Manage federation node
| Deny


| [#rbac-node-module.create]#<<rbac-node-module.create,module.create>>#
| Create shared module
| Deny


|===


# src/modules/generated/partials/access-control/federation/resource.shared-module.gen.adoc

= shared-module

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-shared-module-map]#<<rbac-shared-module-map,map>>#
| Map shared module
| Deny


|===


# src/modules/generated/partials/access-control/system/component.gen.adoc

= System

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-system-grant]#<<rbac-system-grant,grant>>#
| Manage system permissions
| Deny


| [#rbac-system-action-log.read]#<<rbac-system-action-log.read,action-log.read>>#
| Access to action log
| Deny


| [#rbac-system-settings.read]#<<rbac-system-settings.read,settings.read>>#
| Read system settings
| Deny


| [#rbac-system-settings.manage]#<<rbac-system-settings.manage,settings.manage>>#
| Manage system settings
| Deny


| [#rbac-system-auth-client.create]#<<rbac-system-auth-client.create,auth-client.create>>#
| Create auth clients
| Deny


| [#rbac-system-auth-clients.search]#<<rbac-system-auth-clients.search,auth-clients.search>>#
| List, search or filter auth clients
| Deny


| [#rbac-system-role.create]#<<rbac-system-role.create,role.create>>#
| Create roles
| Deny


| [#rbac-system-roles.search]#<<rbac-system-roles.search,roles.search>>#
| List, search or filter roles
| Deny


| [#rbac-system-user.create]#<<rbac-system-user.create,user.create>>#
| Create users
| Deny


| [#rbac-system-users.search]#<<rbac-system-users.search,users.search>>#
| List, search or filter users
| Deny


| [#rbac-system-dal-connection.create]#<<rbac-system-dal-connection.create,dal-connection.create>>#
| Create DAL connections
| Deny


| [#rbac-system-dal-connections.search]#<<rbac-system-dal-connections.search,dal-connections.search>>#
| List, search or filter DAL connections
| Deny


| [#rbac-system-dal-sensitivity-level.manage]#<<rbac-system-dal-sensitivity-level.manage,dal-sensitivity-level.manage>>#
| Can manage DAL sensitivity levels
| Deny


| [#rbac-system-application.create]#<<rbac-system-application.create,application.create>>#
| Create applications
| Deny


| [#rbac-system-applications.search]#<<rbac-system-applications.search,applications.search>>#
| List, search or filter auth clients
| Deny


| [#rbac-system-application.flag.self]#<<rbac-system-application.flag.self,application.flag.self>>#
| Manage private flags for applications
| Deny


| [#rbac-system-application.flag.global]#<<rbac-system-application.flag.global,application.flag.global>>#
| Manage global flags for applications
| Deny


| [#rbac-system-template.create]#<<rbac-system-template.create,template.create>>#
| Create template
| Deny


| [#rbac-system-templates.search]#<<rbac-system-templates.search,templates.search>>#
| List, search or filter templates
| Deny


| [#rbac-system-report.create]#<<rbac-system-report.create,report.create>>#
| Create report
| Deny


| [#rbac-system-reports.search]#<<rbac-system-reports.search,reports.search>>#
| List, search or filter reports
| Deny


| [#rbac-system-reminder.assign]#<<rbac-system-reminder.assign,reminder.assign>>#
|  Assign reminders
| Deny


| [#rbac-system-queue.create]#<<rbac-system-queue.create,queue.create>>#
| Create messagebus queues
| Deny


| [#rbac-system-queues.search]#<<rbac-system-queues.search,queues.search>>#
| List, search or filter messagebus queues
| Deny


| [#rbac-system-apigw-route.create]#<<rbac-system-apigw-route.create,apigw-route.create>>#
| Create API gateway route
| Deny


| [#rbac-system-apigw-routes.search]#<<rbac-system-apigw-routes.search,apigw-routes.search>>#
| List search or filter API gateway routes
| Deny


| [#rbac-system-resource-translations.manage]#<<rbac-system-resource-translations.manage,resource-translations.manage>>#
| List, search, create, or update resource translations
| Deny


| [#rbac-system-dal-schema-alterations.manage]#<<rbac-system-dal-schema-alterations.manage,dal-schema-alterations.manage>>#
| List, search, apply, or dismiss DAL alterations
| Deny


| [#rbac-system-data-privacy-request.create]#<<rbac-system-data-privacy-request.create,data-privacy-request.create>>#
| Create data privacy requests
| Deny


| [#rbac-system-data-privacy-requests.search]#<<rbac-system-data-privacy-requests.search,data-privacy-requests.search>>#
| List, search or filter data privacy requests
| Deny


|===


# src/modules/generated/partials/access-control/system/index.gen.adoc

= System

:leveloffset: +1

include::./component.gen.adoc[]

include::./resource.attachment.gen.adoc[]

include::./resource.application.gen.adoc[]

include::./resource.apigw-route.gen.adoc[]

include::./resource.apigw-filter.gen.adoc[]

include::./resource.auth-client.gen.adoc[]

include::./resource.auth-confirmed-client.gen.adoc[]

include::./resource.auth-session.gen.adoc[]

include::./resource.auth-oa2token.gen.adoc[]

include::./resource.credential.gen.adoc[]

include::./resource.data-privacy-request.gen.adoc[]

include::./resource.data-privacy-request-comment.gen.adoc[]

include::./resource.queue.gen.adoc[]

include::./resource.queue-message.gen.adoc[]

include::./resource.reminder.gen.adoc[]

include::./resource.report.gen.adoc[]

include::./resource.resource-translation.gen.adoc[]

include::./resource.role.gen.adoc[]

include::./resource.role-member.gen.adoc[]

include::./resource.settings.gen.adoc[]

include::./resource.template.gen.adoc[]

include::./resource.user.gen.adoc[]

include::./resource.dal-connection.gen.adoc[]

include::./resource.dal-sensitivity-level.gen.adoc[]

include::./resource.dal-schema-alteration.gen.adoc[]


:leveloffset: -1



# src/modules/generated/partials/access-control/system/resource.apigw-route.gen.adoc

= apigw-route

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-apigw-route-read]#<<rbac-apigw-route-read,read>>#
| Read API Gateway route
| Deny


| [#rbac-apigw-route-update]#<<rbac-apigw-route-update,update>>#
| Update API Gateway route
| Deny


| [#rbac-apigw-route-delete]#<<rbac-apigw-route-delete,delete>>#
| Delete API Gateway route
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.application.gen.adoc

= application

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-application-read]#<<rbac-application-read,read>>#
| Read application
| Deny


| [#rbac-application-update]#<<rbac-application-update,update>>#
| Update application
| Deny


| [#rbac-application-delete]#<<rbac-application-delete,delete>>#
| Delete application
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.auth-client.gen.adoc

= auth-client

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-auth-client-read]#<<rbac-auth-client-read,read>>#
| Read authorization client
| Deny


| [#rbac-auth-client-update]#<<rbac-auth-client-update,update>>#
| Update authorization client
| Deny


| [#rbac-auth-client-delete]#<<rbac-auth-client-delete,delete>>#
| Delete authorization client
| Deny


| [#rbac-auth-client-authorize]#<<rbac-auth-client-authorize,authorize>>#
| Authorize authorization client
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.dal-connection.gen.adoc

= dal-connection

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-dal-connection-read]#<<rbac-dal-connection-read,read>>#
| Read connection
| Deny


| [#rbac-dal-connection-update]#<<rbac-dal-connection-update,update>>#
| Update connection
| Deny


| [#rbac-dal-connection-delete]#<<rbac-dal-connection-delete,delete>>#
| Delete connection
| Deny


| [#rbac-dal-connection-dal-config.manage]#<<rbac-dal-connection-dal-config.manage,dal-config.manage>>#
| Manage DAL configuration
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.data-privacy-request.gen.adoc

= data-privacy-request

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-data-privacy-request-read]#<<rbac-data-privacy-request-read,read>>#
| Read data privacy request
| Deny


| [#rbac-data-privacy-request-approve]#<<rbac-data-privacy-request-approve,approve>>#
| Approve/Reject data privacy request
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.queue.gen.adoc

= queue

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-queue-read]#<<rbac-queue-read,read>>#
| Read queue
| Deny


| [#rbac-queue-update]#<<rbac-queue-update,update>>#
| Update queue
| Deny


| [#rbac-queue-delete]#<<rbac-queue-delete,delete>>#
| Delete queue
| Deny


| [#rbac-queue-queue.read]#<<rbac-queue-queue.read,queue.read>>#
| Read from queue
| Deny


| [#rbac-queue-queue.write]#<<rbac-queue-queue.write,queue.write>>#
| Write to queue
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.report.gen.adoc

= report

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-report-read]#<<rbac-report-read,read>>#
| Read report
| Deny


| [#rbac-report-update]#<<rbac-report-update,update>>#
| Update report
| Deny


| [#rbac-report-delete]#<<rbac-report-delete,delete>>#
| Delete report
| Deny


| [#rbac-report-run]#<<rbac-report-run,run>>#
| Run report
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.role.gen.adoc

= role

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-role-read]#<<rbac-role-read,read>>#
| Read role
| Deny


| [#rbac-role-update]#<<rbac-role-update,update>>#
| Update role
| Deny


| [#rbac-role-delete]#<<rbac-role-delete,delete>>#
| Delete role
| Deny


| [#rbac-role-members.manage]#<<rbac-role-members.manage,members.manage>>#
| Manage members
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.template.gen.adoc

= template

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-template-read]#<<rbac-template-read,read>>#
| Read template
| Deny


| [#rbac-template-update]#<<rbac-template-update,update>>#
| Update template
| Deny


| [#rbac-template-delete]#<<rbac-template-delete,delete>>#
| Delete template
| Deny


| [#rbac-template-render]#<<rbac-template-render,render>>#
| Render template
| Deny


|===


# src/modules/generated/partials/access-control/system/resource.user.gen.adoc

= user

[cols="1s,5a,5a"]
|===
| Operation| Description | Default


| [#rbac-user-read]#<<rbac-user-read,read>>#
| Read user
| Deny


| [#rbac-user-update]#<<rbac-user-update,update>>#
| Update user
| Deny


| [#rbac-user-delete]#<<rbac-user-delete,delete>>#
| Delete user
| Deny


| [#rbac-user-suspend]#<<rbac-user-suspend,suspend>>#
| Suspend user
| Deny


| [#rbac-user-unsuspend]#<<rbac-user-unsuspend,unsuspend>>#
| Unsuspend user
| Deny


| [#rbac-user-email.unmask]#<<rbac-user-email.unmask,email.unmask>>#
| Unmask email
| Deny


| [#rbac-user-name.unmask]#<<rbac-user-name.unmask,name.unmask>>#
| Unmask name
| Deny


| [#rbac-user-impersonate]#<<rbac-user-impersonate,impersonate>>#
| Impersonate user
| Deny


| [#rbac-user-credentials.manage]#<<rbac-user-credentials.manage,credentials.manage>>#
| Manage user's credentials
| Deny


|===


# src/modules/generated/partials/afunc.gen.adoc

// This file is auto-generated.
//
// Changes to this file may cause incorrect behavior and will be lost if
// the code is regenerated.
//
// Definitions file that controls how this file is generated:
//  - automation/automation/apigw_body_handler.yaml
//  - automation/automation/corredor_handler.yaml
//  - automation/automation/email_handler.yaml
//  - automation/automation/http_request_handler.yaml
//  - automation/automation/jsenv_handler.yaml
//  - automation/automation/jwt_handler.yaml
//  - automation/automation/log_handler.yaml
//  - automation/automation/loop_handler.yaml
//  - automation/automation/oauth2_handler.yaml
//  - automation/automation/queue_handler.yaml
//  - compose/automation/attachment_handler.yaml
//  - compose/automation/modules_handler.yaml
//  - compose/automation/namespaces_handler.yaml
//  - compose/automation/records_handler.yaml
//  - system/automation/actionlog_handler.yaml
//  - system/automation/rbac_handler.yaml
//  - system/automation/roles_handler.yaml
//  - system/automation/templates_handler.yaml
//  - system/automation/users_handler.yaml
//  - system/automation/valuestore_handler.yaml


= `apigwBody`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-apigwbody-read]#<<fnc-apigwbody-read,Read request body from integration gateway>>#
| 
|
.Parameters:
* #*# `request`
(
   `HttpRequest`,)

.Results:
* body (`String`)

|===
= `corredor`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-corredor-exec]#<<fnc-corredor-exec,Corredor automation script executor>>#
| Executes script in Corredor Automation server
|
.Parameters:
* #*# `script`
(
   `String`,)
* `args`
(
   `Vars`,)

.Results:
* results (`Vars`)

|===
= `email`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-email-send]#<<fnc-email-send,Email>>#
| Sends email directly
|
.Parameters:
* `Subject`
(
   `String`,
   `Reader`,)
* `Reply to`
(
   `String`,
   `User`,)
* `Sender`
(
   `String`,
   `User`,)
* `Recipients`
(
   `String`,
   `KV`,
   `User`,)
* `CC`
(
   `String`,
   `KV`,
   `User`,)
* `HTML message body`
(
   `String`,
   `Reader`,)
* `Plain text message body`
(
   `String`,
   `Reader`,)

| [#fnc-email-message]#<<fnc-email-message,Email builder>>#
| Constructs new email message from basic parameters without sending it
|
.Parameters:
* `Subject`
(
   `String`,
   `Reader`,)
* `Reply to`
(
   `String`,
   `User`,)
* `Sender`
(
   `String`,
   `User`,)
* `Recipients`
(
   `String`,
   `KV`,
   `User`,)
* `CC`
(
   `String`,
   `KV`,
   `User`,)
* `HTML message body`
(
   `String`,
   `Reader`,)
* `Plain text message body`
(
   `String`,
   `Reader`,)

.Results:
* message (`EmailMessage`)

| [#fnc-email-sendmessage]#<<fnc-email-sendmessage,Email sender>>#
| Sends email message
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)

| [#fnc-email-setsubject]#<<fnc-email-setsubject,Email subject>>#
| Sets subject on the email message
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Subject`
(
   `String`,)

| [#fnc-email-setheaders]#<<fnc-email-setheaders,Email headers>>#
| Sets message headers (overrides any existing headers, subject, recipients)
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Headers`
(
   `KVV`,)

| [#fnc-email-setheader]#<<fnc-email-setheader,Email header>>#
| Sets or removes specific header without changing the rest
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Value`
(
   `String`,)
* `Value`
(
   `String`,)

| [#fnc-email-setaddress]#<<fnc-email-setaddress,Email set address>>#
| Sets the recipient, sender or reply-to addresses
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Type`
(
   `String`,)
* #*# `Address`
(
   `String`,)
* `Name`
(
   `String`,)

| [#fnc-email-addaddress]#<<fnc-email-addaddress,Email add address>>#
| Adds new recipient, sender or reply-to address
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Type`
(
   `String`,)
* #*# `Address`
(
   `String`,)
* `Name`
(
   `String`,)

| [#fnc-email-attach]#<<fnc-email-attach,Email attachment>>#
| Attach content to an email message
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Content`
(
   `Reader`,
   `String`,)
* `Name`
(
   `String`,)

| [#fnc-email-embed]#<<fnc-email-embed,Email embedded attachment>>#
| Embed file (image) to an email message
|
.Parameters:
* #*# `Message to be sent`
(
   `EmailMessage`,)
* #*# `Content`
(
   `Reader`,)
* `Name`
(
   `String`,)

|===
= `httpRequest`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-httprequest-send]#<<fnc-httprequest-send,HTTP request>>#
| Sends HTTP requests
|
.Parameters:
* #*# `url`
(
   `String`,)
* #*# `method`
(
   `String`,)
* `params`
(
   `KVV`,)
* `headers`
(
   `KVV`,)
* `headerAuthBearer`
(
   `String`,)
* `headerAuthUsername`
(
   `String`,)
* `headerAuthPassword`
(
   `String`,)
* `headerUserAgent`
(
   `String`,)
* `headerContentType`
(
   `String`,)
* `timeout`
(
   `Duration`,)
* `form`
(
   `KVV`,)
* `body`
(
   `String`,
   `Reader`,
   `Any`,)

.Results:
* status (`String`)
* statusCode (`Integer`)
* headers (`KVV`)
* contentLength (`Integer`)
* contentType (`String`)
* body (`Reader`)

|===
= `jsenv`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-jsenv-execute]#<<fnc-jsenv-execute,Process arbitrary data in jsenv>>#
| 
|
.Parameters:
* #*# `scope`
(
   `Any`,
   `Reader`,)
* #*# `source`
(
   `String`,)

.Results:
* resultString (`String`)
* resultInt (`Integer`)
* resultBool (`Boolean`)
* resultAny (`Any`)

|===
= `jwt`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-jwt-generate]#<<fnc-jwt-generate,Generate JWT>>#
| 
|
.Parameters:
* `scope`
(
   `String`,)
* #*# `header`
(
   `Vars`,
   `String`,)
* #*# `payload`
(
   `Vars`,
   `String`,)
* #*# `secret`
(
   `String`,
   `Reader`,)

.Results:
* token (`String`)

|===
= `log`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-log-debug]#<<fnc-log-debug,Log debug message>>#
| 
|
.Parameters:
* #*# `message`
(
   `String`,)
* `fields`
(
   `KV`,)

| [#fnc-log-info]#<<fnc-log-info,Log info message>>#
| 
|
.Parameters:
* #*# `message`
(
   `String`,)
* `fields`
(
   `KV`,)

| [#fnc-log-warn]#<<fnc-log-warn,Log warning message>>#
| 
|
.Parameters:
* #*# `message`
(
   `String`,)
* `fields`
(
   `KV`,)

| [#fnc-log-error]#<<fnc-log-error,Log error message>>#
| 
|
.Parameters:
* #*# `message`
(
   `String`,)
* `fields`
(
   `KV`,)

|===
= `loop`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

|===
= `oauth2`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-oauth2-authenticate]#<<fnc-oauth2-authenticate,Authentication: OAUTH2>>#
| 
|
.Parameters:
* #*# `client`
(
   `String`,)
* #*# `secret`
(
   `String`,)
* #*# `scope`
(
   `String`,)
* #*# `tokenUrl`
(
   `String`,)

.Results:
* accessToken (`String`)
* refreshToken (`String`)
* token (`Any`)

|===
= `queue`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-queue-write]#<<fnc-queue-write,Queue message send>>#
| 
|
.Parameters:
* #*# `payload`
(
   `String`,
   `Reader`,)
* #*# `queue`
(
   `String`,)

|===
= `attachment`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-attachment-lookup]#<<fnc-attachment-lookup,Attachment lookup>>#
| Find specific attachment by ID
|
.Parameters:
* #*# `attachment`
(
   `ID`,)

.Results:
* attachment (`Attachment`)

| [#fnc-attachment-create]#<<fnc-attachment-create,Create file and attach it to a resource>>#
| 
|
.Parameters:
* `name`
(
   `String`,)
* #*# `resource`
(
   `ComposeRecord`,)
* `fieldName`
(
   `String`,)
* #*# `content`
(
   `String`,
   `Reader`,
   `Bytes`,)

.Results:
* attachment (`Attachment`)

| [#fnc-attachment-delete]#<<fnc-attachment-delete,Delete attachment>>#
| 
|
.Parameters:
* #*# `attachment`
(
   `ID`,)

| [#fnc-attachment-openoriginal]#<<fnc-attachment-openoriginal,Open original attachment>>#
| 
|
.Parameters:
* #*# `attachment`
(
   `ID`,
   `Attachment`,)

.Results:
* content (`Reader`)

| [#fnc-attachment-openpreview]#<<fnc-attachment-openpreview,Open attachment preview>>#
| 
|
.Parameters:
* #*# `attachment`
(
   `ID`,
   `Attachment`,)

.Results:
* content (`Reader`)

|===
= `modules`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-modules-lookup]#<<fnc-modules-lookup,Compose module lookup>>#
| Find specific module by ID or handle
|
.Parameters:
* #*# `module`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)

.Results:
* module (`ComposeModule`)

|===
= `namespaces`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-namespaces-lookup]#<<fnc-namespaces-lookup,Compose namespace lookup>>#
| Find specific namespace by ID or handle
|
.Parameters:
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)

.Results:
* namespace (`ComposeNamespace`)

|===
= `records`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-records-lookup]#<<fnc-records-lookup,Compose record lookup>>#
| Find specific record by ID
|
.Parameters:
* #*# `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)
* #*# `record`
(
   `ID`,
   `ComposeRecord`,)

.Results:
* record (`ComposeRecord`)

| [#fnc-records-search]#<<fnc-records-search,Compose records search>>#
| 
|
.Parameters:
* #*# `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)
* `query`
(
   `String`,)
* `meta`
(
   `Meta`,)
* `deleted`
(
   `UnsignedInteger`,)
* `sort`
(
   `String`,)
* `limit`
(
   `UnsignedInteger`,)
* `incTotal`
(
   `Boolean`,)
* `incPageNavigation`
(
   `Boolean`,)
* `pageCursor`
(
   `String`,)

.Results:
* records (`ComposeRecord`)
* Total records found (`UnsignedInteger`)
* nextPage (`String`)
* prevPage (`String`)
* pageNavigation (`Array`)

| [#fnc-records-first]#<<fnc-records-first,Compose record lookup (first created)>>#
| 
|
.Parameters:
* #*# `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)

.Results:
* record (`ComposeRecord`)

| [#fnc-records-last]#<<fnc-records-last,Compose record lookup (last created)>>#
| 
|
.Parameters:
* #*# `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)

.Results:
* record (`ComposeRecord`)

| [#fnc-records-new]#<<fnc-records-new,Compose record maker>>#
| Creates new compose record instance without saving it
|
.Parameters:
* #*# `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)

.Results:
* record (`ComposeRecord`)

| [#fnc-records-validate]#<<fnc-records-validate,Compose record validator>>#
| 
|
.Parameters:
* #*# `record`
(
   `ComposeRecord`,)

.Results:
* Set to true when record is valid (`Boolean`)

| [#fnc-records-create]#<<fnc-records-create,Compose record create>>#
| 
|
.Parameters:
* #*# `record`
(
   `ComposeRecord`,)

.Results:
* record (`ComposeRecord`)

| [#fnc-records-update]#<<fnc-records-update,Compose record update>>#
| 
|
.Parameters:
* #*# `record`
(
   `ComposeRecord`,)

.Results:
* record (`ComposeRecord`)

| [#fnc-records-delete]#<<fnc-records-delete,Compose record delete>>#
| 
|
.Parameters:
* `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)
* #*# `record`
(
   `ID`,
   `ComposeRecord`,)

| [#fnc-records-report]#<<fnc-records-report,Report>>#
| Compose records report
|
.Parameters:
* #*# `Module to set record type`
(
   `ID`,
   `Handle`,
   `ComposeModule`,)
* #*# `namespace`
(
   `ID`,
   `Handle`,
   `ComposeNamespace`,)
* #*# `Metrics for records report`
(
   `String`,)
* #*# `Dimensons for records report`
(
   `String`,)
* #*# `Filter for records report`
(
   `String`,)

.Results:
* Complex structure holding complete records report (`Any`)

|===
= `actionlog`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-actionlog-search]#<<fnc-actionlog-search,Action log search>>#
| 
|
.Parameters:
* `fromTimestamp`
(
   `DateTime`,)
* `toTimestamp`
(
   `DateTime`,)
* `beforeActionID`
(
   `ID`,)
* `actorID`
(
   `ID`,)
* `origin`
(
   `String`,)
* `resource`
(
   `String`,)
* `action`
(
   `String`,)
* `limit`
(
   `UnsignedInteger`,)

.Results:
* actions (`Action`)

| [#fnc-actionlog-record]#<<fnc-actionlog-record,Record action into action log>>#
| 
|
.Parameters:
* `action`
(
   `String`,)
* `resource`
(
   `String`,)
* `error`
(
   `String`,)
* `severity`
(
   `String`,)
* `description`
(
   `String`,)
* `meta`
(
   `Vars`,)

|===
= `rbac`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-rbac-allow]#<<fnc-rbac-allow,RBAC: Allow operation on resource to a role>>#
| 
|
.Parameters:
* #*# `resource`
(
   `RbacResource`,)
* #*# `role`
(
   `ID`,
   `Handle`,
   `Role`,)
* #*# `operation`
(
   `String`,)

| [#fnc-rbac-deny]#<<fnc-rbac-deny,RBAC: Deny operation on resource to a role>>#
| 
|
.Parameters:
* #*# `resource`
(
   `RbacResource`,)
* #*# `role`
(
   `ID`,
   `Handle`,
   `Role`,)
* #*# `operation`
(
   `String`,)

| [#fnc-rbac-inherit]#<<fnc-rbac-inherit,RBAC: Remove allow/deny operation of a role from resource>>#
| 
|
.Parameters:
* #*# `resource`
(
   `RbacResource`,)
* #*# `role`
(
   `ID`,
   `Handle`,
   `Role`,)
* #*# `operation`
(
   `String`,)

| [#fnc-rbac-check]#<<fnc-rbac-check,RBAC: Can user perform an operation on a resource>>#
| 
|
.Parameters:
* #*# `resource`
(
   `RbacResource`,)
* #*# `operation`
(
   `String`,)
* `user`
(
   `User`,)

.Results:
* can (`Boolean`)

|===
= `roles`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-roles-lookup]#<<fnc-roles-lookup,Role lookup>>#
| Find specific role by ID or handle
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Role`,)

.Results:
* role (`Role`)

| [#fnc-roles-searchmembers]#<<fnc-roles-searchmembers,Role members search>>#
| Find members for a specific roleby ID or handle
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Role`,)

.Results:
* users (`User`)
* total (`UnsignedInteger`)

| [#fnc-roles-addmember]#<<fnc-roles-addmember,Role membership add>>#
| 
|
.Parameters:
* #*# `role`
(
   `ID`,
   `Handle`,
   `Role`,)
* #*# `user`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

| [#fnc-roles-removemember]#<<fnc-roles-removemember,Role membership remove>>#
| 
|
.Parameters:
* #*# `role`
(
   `ID`,
   `Handle`,
   `Role`,)
* #*# `user`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

| [#fnc-roles-search]#<<fnc-roles-search,Roles search>>#
| 
|
.Parameters:
* `query`
(
   `String`,)
* `memberID`
(
   `ID`,)
* `handle`
(
   `String`,)
* `name`
(
   `String`,)
* `labels`
(
   `KV`,)
* `deleted`
(
   `UnsignedInteger`,)
* `archived`
(
   `UnsignedInteger`,)
* `sort`
(
   `String`,)
* `limit`
(
   `UnsignedInteger`,)
* `incTotal`
(
   `Boolean`,)
* `incPageNavigation`
(
   `Boolean`,)
* `pageCursor`
(
   `String`,)

.Results:
* roles (`Role`)
* total (`UnsignedInteger`)

| [#fnc-roles-create]#<<fnc-roles-create,Role creator>>#
| 
|
.Parameters:
* #*# `role`
(
   `Role`,)

.Results:
* role (`Role`)

| [#fnc-roles-update]#<<fnc-roles-update,Role update>>#
| 
|
.Parameters:
* #*# `role`
(
   `Role`,)

.Results:
* role (`Role`)

| [#fnc-roles-delete]#<<fnc-roles-delete,Role delete>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Role`,)

| [#fnc-roles-recover]#<<fnc-roles-recover,Role recover>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Role`,)

| [#fnc-roles-archive]#<<fnc-roles-archive,Role archive>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Role`,)

| [#fnc-roles-unarchive]#<<fnc-roles-unarchive,Role unarchive>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Role`,)

|===
= `templates`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-templates-lookup]#<<fnc-templates-lookup,Template lookup>>#
| Find specific template by ID or handle
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Template`,)

.Results:
* template (`Template`)

| [#fnc-templates-search]#<<fnc-templates-search,Templates search>>#
| 
|
.Parameters:
* `handle`
(
   `String`,)
* `type`
(
   `String`,)
* `ownerID`
(
   `ID`,)
* `partial`
(
   `Boolean`,)
* `labels`
(
   `KV`,)
* `sort`
(
   `String`,)
* `limit`
(
   `UnsignedInteger`,)
* `incTotal`
(
   `Boolean`,)
* `incPageNavigation`
(
   `Boolean`,)
* `pageCursor`
(
   `String`,)

.Results:
* templates (`Template`)
* total (`UnsignedInteger`)

| [#fnc-templates-create]#<<fnc-templates-create,Template create>>#
| 
|
.Parameters:
* #*# `template`
(
   `Template`,)

.Results:
* template (`Template`)

| [#fnc-templates-update]#<<fnc-templates-update,Template update>>#
| 
|
.Parameters:
* #*# `template`
(
   `Template`,)

.Results:
* template (`Template`)

| [#fnc-templates-delete]#<<fnc-templates-delete,Template delete>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Template`,)

| [#fnc-templates-recover]#<<fnc-templates-recover,Template recover>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Template`,)

| [#fnc-templates-render]#<<fnc-templates-render,Template render>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `Template`,)
* `documentName`
(
   `String`,)
* `documentType`
(
   `String`,)
* `variables`
(
   `Vars`,)
* `options`
(
   `RenderOptions`,)

.Results:
* document (`RenderedDocument`)

|===
= `users`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-users-lookup]#<<fnc-users-lookup,User lookup>>#
| Find specific user by ID, handle or string
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

.Results:
* user (`User`)

| [#fnc-users-searchmembership]#<<fnc-users-searchmembership,User role search>>#
| Search user role membership by ID, handle or string
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

.Results:
* roles (`Role`)
* total (`UnsignedInteger`)

| [#fnc-users-checkmembership]#<<fnc-users-checkmembership,User membership check>>#
| Find user role membership by ID, handle or string
|
.Parameters:
* #*# `user`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)
* #*# `role`
(
   `ID`,
   `Handle`,
   `Role`,)

.Results:
* member (`Boolean`)

| [#fnc-users-search]#<<fnc-users-search,User search>>#
| 
|
.Parameters:
* `query`
(
   `String`,)
* `email`
(
   `String`,)
* `handle`
(
   `String`,)
* `labels`
(
   `KV`,)
* `deleted`
(
   `UnsignedInteger`,)
* `suspended`
(
   `UnsignedInteger`,)
* `sort`
(
   `String`,)
* `limit`
(
   `UnsignedInteger`,)
* `incTotal`
(
   `Boolean`,)
* `incPageNavigation`
(
   `Boolean`,)
* `pageCursor`
(
   `String`,)

.Results:
* users (`User`)
* total (`UnsignedInteger`)

| [#fnc-users-create]#<<fnc-users-create,User create>>#
| 
|
.Parameters:
* #*# `user`
(
   `User`,)

.Results:
* user (`User`)

| [#fnc-users-update]#<<fnc-users-update,User update>>#
| 
|
.Parameters:
* #*# `user`
(
   `User`,)

.Results:
* user (`User`)

| [#fnc-users-delete]#<<fnc-users-delete,User delete>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

| [#fnc-users-recover]#<<fnc-users-recover,User recover>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

| [#fnc-users-suspend]#<<fnc-users-suspend,User suspend>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

| [#fnc-users-unsuspend]#<<fnc-users-unsuspend,User unsuspend>>#
| 
|
.Parameters:
* #*# `lookup`
(
   `ID`,
   `Handle`,
   `String`,
   `User`,)

|===
= `valuestore`

[cols="2m,4a,3a"]
|===
| Name | Description | I/O

| [#fnc-valuestore-env]#<<fnc-valuestore-env,Get ENV variable>>#
| Get ENV variable for the specified key. If the key doesn't correspond to any value, nil is returned
|
.Parameters:
* #*# `key`
(
   `String`,)

.Results:
* value (`Any`)

|===


# src/modules/generated/partials/benchmarks/bench-classic-benchmark-intro.adoc

The shared table benchmarks the default out-of-the-box setup where all of the modules utilize the same database table with all of the values JSON encoded into a single column.
This setup is intended for generic and low volume modules since it's easier to setup and requires less maintenance.

[NOTE]
====
This document should be used as a base to figure out what setup would work best for you.
You can use the raw numbers of different scenarios to deduct your own conclusions on how well a specific setup would pan out for your use case.
====

.Testing notes:
* All times are in MS with networking overhead excluded (the scripts were ran directly on the host server).
* Each scenario used a dedicated DB table which was configured as the standard `compose_records` one. The primary reason is consistent repeatability. Namespace and module identifiers are indexed so the overhead is negligible.
* Records were created from a pre-defined dataset with randomly generated data using faker.js.
* Benchmarks were ran on a dedicated cloud instance with minimal background processes.
* The tests use Postgres as the database.

.Testing observations:
* We observed some random spikes under the max time which we couldn't quite explain. Our guess would indicate some background system task or potential throttling. Ideally, in future tests, such anomalies would be excluded or better handled.

.Future plans:
* Increase the amount of data points to better indicate the trend.
* Include some projections to indicate how it would behave on larger datasets.
* Provide memory profiling to indicate consumption and better suggest recommended system specs.


# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-create-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-create-intro.adoc

The scenario benchmarks insertion times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark inserts a single record into the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-delete-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-delete-intro.adoc

The scenario benchmarks delete times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark deletes a single record from the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-lookup-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-lookup-intro.adoc

The scenario benchmarks lookup times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark looks up a single record from the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-update-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-crud-operations-crud-update-intro.adoc

The scenario benchmarks update times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark updates a single record from the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-classic-list-filter---sort-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-list-filter---sort-search-intro.adoc

The scenario benchmarks fetching the first page of records when providing a filter and a sort.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-classic-list-filter-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-list-filter-search-intro.adoc

The scenario benchmarks fetching the first page of records when providing a filter.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-classic-list-plain-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-list-plain-search-intro.adoc

The scenario benchmarks fetching the first page of records without any other sorting/filtering parameters.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-classic-list-sort-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-classic-list-sort-search-intro.adoc

The scenario benchmarks fetching the first page of records when providing a sort.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-classic.gen.adoc

include::ROOT:partial$variables.adoc[]
include::variables.adoc[]

= {bench-classic}

include::bench-classic-benchmark-intro.adoc[]

== {crud-operations}: {crud-create}

include::bench-classic-crud-operations-crud-create-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 103, 98, 103, 104, 103, 102, 107, 103, 102, 100 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 112, 169, 119, 115, 116, 117, 117, 126, 152, 151 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 106.8, 116.5, 108.8, 109.8, 109.7, 108.8, 111.5, 111.3, 114.7, 113 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 103| 112| 106.8| 1| 1| 1
| 1| 200000| 98| 169| 116.5| 1.05| 0.66| 0.92
| 1| 300000| 103| 119| 108.8| 0.95| 1.42| 1.07
| 1| 400000| 104| 115| 109.8| 0.99| 1.03| 0.99
| 1| 500000| 103| 116| 109.7| 1.01| 0.99| 1
| 1| 600000| 102| 117| 108.8| 1.01| 0.99| 1.01
| 1| 700000| 107| 117| 111.5| 0.95| 1| 0.98
| 1| 800000| 103| 126| 111.3| 1.04| 0.93| 1
| 1| 900000| 102| 152| 114.7| 1.01| 0.83| 0.97
| 1| 1000000| 100| 151| 113| 1.02| 1.01| 1.02
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 104, 103, 106, 103, 99, 105, 107, 103, 102, 102 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 115, 126, 139, 127, 124, 115, 139, 173, 144, 134 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 110.1, 112, 116.5, 111, 108.7, 109.5, 115, 115.8, 112.9, 111.2 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 104| 115| 110.1| 1| 1| 1
| 10| 200000| 103| 126| 112| 1.01| 0.91| 0.98
| 10| 300000| 106| 139| 116.5| 0.97| 0.91| 0.96
| 10| 400000| 103| 127| 111| 1.03| 1.09| 1.05
| 10| 500000| 99| 124| 108.7| 1.04| 1.02| 1.02
| 10| 600000| 105| 115| 109.5| 0.94| 1.08| 0.99
| 10| 700000| 107| 139| 115| 0.98| 0.83| 0.95
| 10| 800000| 103| 173| 115.8| 1.04| 0.8| 0.99
| 10| 900000| 102| 144| 112.9| 1.01| 1.2| 1.03
| 10| 1000000| 102| 134| 111.2| 1| 1.07| 1.02
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 110, 105, 112, 105, 105, 109, 105, 108, 107, 109 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 180, 198, 169, 210, 134, 150, 158, 148, 178, 179 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 132.6, 123.7, 126.6, 124.4, 117.2, 122.7, 119.5, 121.2, 127.8, 126.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 110| 180| 132.6| 1| 1| 1
| 50| 200000| 105| 198| 123.7| 1.05| 0.91| 1.07
| 50| 300000| 112| 169| 126.6| 0.94| 1.17| 0.98
| 50| 400000| 105| 210| 124.4| 1.07| 0.8| 1.02
| 50| 500000| 105| 134| 117.2| 1| 1.57| 1.06
| 50| 600000| 109| 150| 122.7| 0.96| 0.89| 0.96
| 50| 700000| 105| 158| 119.5| 1.04| 0.95| 1.03
| 50| 800000| 108| 148| 121.2| 0.97| 1.07| 0.99
| 50| 900000| 107| 178| 127.8| 1.01| 0.83| 0.95
| 50| 1000000| 109| 179| 126.1| 0.98| 0.99| 1.01
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 116, 117, 114, 116, 119, 119, 118, 116, 116, 120 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 136, 163, 131, 153, 164, 135, 134, 157, 128, 190 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 124.5, 127.6, 122.6, 128.4, 128.1, 124.7, 124.4, 130.8, 122.3, 133 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 116| 136| 124.5| 1| 1| 1
| 100| 200000| 117| 163| 127.6| 0.99| 0.83| 0.98
| 100| 300000| 114| 131| 122.6| 1.03| 1.24| 1.04
| 100| 400000| 116| 153| 128.4| 0.98| 0.86| 0.95
| 100| 500000| 119| 164| 128.1| 0.97| 0.93| 1
| 100| 600000| 119| 135| 124.7| 1| 1.21| 1.03
| 100| 700000| 118| 134| 124.4| 1.01| 1.01| 1
| 100| 800000| 116| 157| 130.8| 1.02| 0.85| 0.95
| 100| 900000| 116| 128| 122.3| 1| 1.23| 1.07
| 100| 1000000| 120| 190| 133| 0.97| 0.67| 0.92
|===

include::bench-classic-crud-operations-crud-create-footnote.adoc[]

== {crud-operations}: {crud-lookup}

include::bench-classic-crud-operations-crud-lookup-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 112, 125, 133, 162, 141, 144, 150, 156, 171, 197 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 140, 176, 208, 219, 158, 160, 178, 181, 314, 355 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 118.4, 144.8, 172.2, 179.8, 149.2, 151.5, 166.2, 165.6, 208.9, 261.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 112| 140| 118.4| 1| 1| 1
| 1| 200000| 125| 176| 144.8| 0.9| 0.8| 0.82
| 1| 300000| 133| 208| 172.2| 0.94| 0.85| 0.84
| 1| 400000| 162| 219| 179.8| 0.82| 0.95| 0.96
| 1| 500000| 141| 158| 149.2| 1.15| 1.39| 1.21
| 1| 600000| 144| 160| 151.5| 0.98| 0.99| 0.98
| 1| 700000| 150| 178| 166.2| 0.96| 0.9| 0.91
| 1| 800000| 156| 181| 165.6| 0.96| 0.98| 1
| 1| 900000| 171| 314| 208.9| 0.91| 0.58| 0.79
| 1| 1000000| 197| 355| 261.1| 0.87| 0.88| 0.8
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 127, 152, 195, 191, 212, 206, 247, 324, 339, 401 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 168, 289, 411, 476, 413, 368, 540, 447, 714, 679 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 143.4, 209.3, 263.4, 292, 276.1, 296.1, 361.1, 382.5, 476.3, 547.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 127| 168| 143.4| 1| 1| 1
| 10| 200000| 152| 289| 209.3| 0.84| 0.58| 0.69
| 10| 300000| 195| 411| 263.4| 0.78| 0.7| 0.79
| 10| 400000| 191| 476| 292| 1.02| 0.86| 0.9
| 10| 500000| 212| 413| 276.1| 0.9| 1.15| 1.06
| 10| 600000| 206| 368| 296.1| 1.03| 1.12| 0.93
| 10| 700000| 247| 540| 361.1| 0.83| 0.68| 0.82
| 10| 800000| 324| 447| 382.5| 0.76| 1.21| 0.94
| 10| 900000| 339| 714| 476.3| 0.96| 0.63| 0.8
| 10| 1000000| 401| 679| 547.6| 0.85| 1.05| 0.87
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 187, 266, 432, 479, 486, 975, 106, 110, 110, 662 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 510, 1303, 701, 1178, 801, 1656, 2437, 2000, 2878, 3179 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 248.3, 514, 563.4, 635.7, 675.3, 1405.5, 801.8, 1276.6, 1649.2, 1893.2 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 187| 510| 248.3| 1| 1| 1
| 50| 200000| 266| 1303| 514| 0.7| 0.39| 0.48
| 50| 300000| 432| 701| 563.4| 0.62| 1.86| 0.91
| 50| 400000| 479| 1178| 635.7| 0.9| 0.6| 0.89
| 50| 500000| 486| 801| 675.3| 0.99| 1.47| 0.94
| 50| 600000| 975| 1656| 1405.5| 0.5| 0.48| 0.48
| 50| 700000| 106| 2437| 801.8| 9.2| 0.68| 1.75
| 50| 800000| 110| 2000| 1276.6| 0.96| 1.22| 0.63
| 50| 900000| 110| 2878| 1649.2| 1| 0.69| 0.77
| 50| 1000000| 662| 3179| 1893.2| 0.17| 0.91| 0.87
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 119, 136, 155, 163, 167, 191, 181, 204, 191, 218 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 167, 162, 180, 217, 317, 441, 373, 374, 334, 473 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 131.7, 147.5, 163.6, 182.4, 215.8, 236.9, 230.7, 293.9, 238, 318.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 119| 167| 131.7| 1| 1| 1
| 100| 200000| 136| 162| 147.5| 0.88| 1.03| 0.89
| 100| 300000| 155| 180| 163.6| 0.88| 0.9| 0.9
| 100| 400000| 163| 217| 182.4| 0.95| 0.83| 0.9
| 100| 500000| 167| 317| 215.8| 0.98| 0.68| 0.85
| 100| 600000| 191| 441| 236.9| 0.87| 0.72| 0.91
| 100| 700000| 181| 373| 230.7| 1.06| 1.18| 1.03
| 100| 800000| 204| 374| 293.9| 0.89| 1| 0.78
| 100| 900000| 191| 334| 238| 1.07| 1.12| 1.23
| 100| 1000000| 218| 473| 318.1| 0.88| 0.71| 0.75
|===

include::bench-classic-crud-operations-crud-lookup-footnote.adoc[]

== {crud-operations}: {crud-update}

include::bench-classic-crud-operations-crud-update-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 127, 161, 172, 205, 200, 214, 240, 272, 293, 380 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 147, 238, 271, 307, 233, 255, 328, 344, 439, 584 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 137.6, 195.1, 230.7, 261.4, 215.7, 233.6, 276.7, 302.5, 361.1, 473.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 127| 147| 137.6| 1| 1| 1
| 1| 200000| 161| 238| 195.1| 0.79| 0.62| 0.71
| 1| 300000| 172| 271| 230.7| 0.94| 0.88| 0.85
| 1| 400000| 205| 307| 261.4| 0.84| 0.88| 0.88
| 1| 500000| 200| 233| 215.7| 1.02| 1.32| 1.21
| 1| 600000| 214| 255| 233.6| 0.93| 0.91| 0.92
| 1| 700000| 240| 328| 276.7| 0.89| 0.78| 0.84
| 1| 800000| 272| 344| 302.5| 0.88| 0.95| 0.91
| 1| 900000| 293| 439| 361.1| 0.93| 0.78| 0.84
| 1| 1000000| 380| 584| 473.1| 0.77| 0.75| 0.76
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 165, 258, 354, 322, 422, 466, 509, 501, 631, 729 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 239, 484, 627, 528, 683, 717, 820, 753, 1177, 1037 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 188.4, 344.6, 429, 433.1, 534.4, 529.4, 631.2, 634.1, 901.4, 897.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 165| 239| 188.4| 1| 1| 1
| 10| 200000| 258| 484| 344.6| 0.64| 0.49| 0.55
| 10| 300000| 354| 627| 429| 0.73| 0.77| 0.8
| 10| 400000| 322| 528| 433.1| 1.1| 1.19| 0.99
| 10| 500000| 422| 683| 534.4| 0.76| 0.77| 0.81
| 10| 600000| 466| 717| 529.4| 0.91| 0.95| 1.01
| 10| 700000| 509| 820| 631.2| 0.92| 0.87| 0.84
| 10| 800000| 501| 753| 634.1| 1.02| 1.09| 1
| 10| 900000| 631| 1177| 901.4| 0.79| 0.64| 0.7
| 10| 1000000| 729| 1037| 897.1| 0.87| 1.14| 1
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 286, 457, 542, 936, 751, 1984, 2154, 2245, 2448, 3636 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 435, 957, 1025, 1372, 1535, 3070, 4020, 3810, 5539, 6192 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 357.1, 721.5, 824.3, 1133.2, 1106.7, 2580.3, 2785.5, 2898.4, 3790.6, 4888.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 286| 435| 357.1| 1| 1| 1
| 50| 200000| 457| 957| 721.5| 0.63| 0.45| 0.49
| 50| 300000| 542| 1025| 824.3| 0.84| 0.93| 0.88
| 50| 400000| 936| 1372| 1133.2| 0.58| 0.75| 0.73
| 50| 500000| 751| 1535| 1106.7| 1.25| 0.89| 1.02
| 50| 600000| 1984| 3070| 2580.3| 0.38| 0.5| 0.43
| 50| 700000| 2154| 4020| 2785.5| 0.92| 0.76| 0.93
| 50| 800000| 2245| 3810| 2898.4| 0.96| 1.06| 0.96
| 50| 900000| 2448| 5539| 3790.6| 0.92| 0.69| 0.76
| 50| 1000000| 3636| 6192| 4888.1| 0.67| 0.89| 0.78
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 141, 201, 222, 225, 286, 294, 309, 336, 357, 356 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 182, 258, 247, 368, 350, 471, 412, 539, 513, 649 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 161.6, 220.4, 230.5, 275, 320.9, 357.8, 369.9, 428.1, 413.3, 494.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 141| 182| 161.6| 1| 1| 1
| 100| 200000| 201| 258| 220.4| 0.7| 0.71| 0.73
| 100| 300000| 222| 247| 230.5| 0.91| 1.04| 0.96
| 100| 400000| 225| 368| 275| 0.99| 0.67| 0.84
| 100| 500000| 286| 350| 320.9| 0.79| 1.05| 0.86
| 100| 600000| 294| 471| 357.8| 0.97| 0.74| 0.9
| 100| 700000| 309| 412| 369.9| 0.95| 1.14| 0.97
| 100| 800000| 336| 539| 428.1| 0.92| 0.76| 0.86
| 100| 900000| 357| 513| 413.3| 0.94| 1.05| 1.04
| 100| 1000000| 356| 649| 494.6| 1| 0.79| 0.84
|===

include::bench-classic-crud-operations-crud-update-footnote.adoc[]

== {crud-operations}: {crud-delete}

include::bench-classic-crud-operations-crud-delete-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 121, 149, 176, 194, 192, 211, 227, 272, 296, 306 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 143, 220, 430, 334, 227, 341, 350, 306, 408, 502 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 133, 194.8, 247.3, 259.5, 209.5, 241.6, 272.4, 287.1, 338.4, 409.8 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 121| 143| 133| 1| 1| 1
| 1| 200000| 149| 220| 194.8| 0.81| 0.65| 0.68
| 1| 300000| 176| 430| 247.3| 0.85| 0.51| 0.79
| 1| 400000| 194| 334| 259.5| 0.91| 1.29| 0.95
| 1| 500000| 192| 227| 209.5| 1.01| 1.47| 1.24
| 1| 600000| 211| 341| 241.6| 0.91| 0.67| 0.87
| 1| 700000| 227| 350| 272.4| 0.93| 0.97| 0.89
| 1| 800000| 272| 306| 287.1| 0.83| 1.14| 0.95
| 1| 900000| 296| 408| 338.4| 0.92| 0.75| 0.85
| 1| 1000000| 306| 502| 409.8| 0.97| 0.81| 0.83
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 156, 254, 345, 276, 320, 344, 462, 552, 627, 703 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 227, 458, 526, 637, 627, 575, 819, 833, 1384, 1391 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 180.6, 330.1, 433.5, 454.3, 503.2, 466.5, 639.6, 685.1, 884.1, 1016.9 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 156| 227| 180.6| 1| 1| 1
| 10| 200000| 254| 458| 330.1| 0.61| 0.5| 0.55
| 10| 300000| 345| 526| 433.5| 0.74| 0.87| 0.76
| 10| 400000| 276| 637| 454.3| 1.25| 0.83| 0.95
| 10| 500000| 320| 627| 503.2| 0.86| 1.02| 0.9
| 10| 600000| 344| 575| 466.5| 0.93| 1.09| 1.08
| 10| 700000| 462| 819| 639.6| 0.74| 0.7| 0.73
| 10| 800000| 552| 833| 685.1| 0.84| 0.98| 0.93
| 10| 900000| 627| 1384| 884.1| 0.88| 0.6| 0.77
| 10| 1000000| 703| 1391| 1016.9| 0.89| 0.99| 0.87
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 278, 453, 793, 784, 1024, 1944, 2113, 2274, 2663, 3686 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 432, 980, 1003, 1229, 1325, 2998, 4556, 4684, 5121, 5732 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 332.8, 740.6, 882.1, 1061, 1161.6, 2586.5, 2896.6, 3228.6, 3662.5, 4647.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 278| 432| 332.8| 1| 1| 1
| 50| 200000| 453| 980| 740.6| 0.61| 0.44| 0.45
| 50| 300000| 793| 1003| 882.1| 0.57| 0.98| 0.84
| 50| 400000| 784| 1229| 1061| 1.01| 0.82| 0.83
| 50| 500000| 1024| 1325| 1161.6| 0.77| 0.93| 0.91
| 50| 600000| 1944| 2998| 2586.5| 0.53| 0.44| 0.45
| 50| 700000| 2113| 4556| 2896.6| 0.92| 0.66| 0.89
| 50| 800000| 2274| 4684| 3228.6| 0.93| 0.97| 0.9
| 50| 900000| 2663| 5121| 3662.5| 0.85| 0.91| 0.88
| 50| 1000000| 3686| 5732| 4647.5| 0.72| 0.89| 0.79
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 134, 168, 193, 226, 270, 231, 311, 309, 344, 283 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 167, 226, 238, 311, 398, 463, 427, 648, 462, 682 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 147.7, 200.6, 213.2, 255.5, 319.7, 366, 352.6, 451.8, 392.8, 454.4 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 134| 167| 147.7| 1| 1| 1
| 100| 200000| 168| 226| 200.6| 0.8| 0.74| 0.74
| 100| 300000| 193| 238| 213.2| 0.87| 0.95| 0.94
| 100| 400000| 226| 311| 255.5| 0.85| 0.77| 0.83
| 100| 500000| 270| 398| 319.7| 0.84| 0.78| 0.8
| 100| 600000| 231| 463| 366| 1.17| 0.86| 0.87
| 100| 700000| 311| 427| 352.6| 0.74| 1.08| 1.04
| 100| 800000| 309| 648| 451.8| 1.01| 0.66| 0.78
| 100| 900000| 344| 462| 392.8| 0.9| 1.4| 1.15
| 100| 1000000| 283| 682| 454.4| 1.22| 0.68| 0.86
|===

include::bench-classic-crud-operations-crud-delete-footnote.adoc[]

== {list-filter}: {search}

include::bench-classic-list-filter-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 147, 167, 206, 268, 259, 257, 347, 425, 467, 478 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 197, 305, 531, 397, 560, 442, 842, 780, 855, 1090 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 171.1, 199.4, 317.6, 330.6, 333.2, 362.4, 483.5, 561.5, 605.9, 657.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 147| 197| 171.1| 1| 1| 1
| 1| 200000| 167| 305| 199.4| 0.88| 0.65| 0.86
| 1| 300000| 206| 531| 317.6| 0.81| 0.57| 0.63
| 1| 400000| 268| 397| 330.6| 0.77| 1.34| 0.96
| 1| 500000| 259| 560| 333.2| 1.03| 0.71| 0.99
| 1| 600000| 257| 442| 362.4| 1.01| 1.27| 0.92
| 1| 700000| 347| 842| 483.5| 0.74| 0.52| 0.75
| 1| 800000| 425| 780| 561.5| 0.82| 1.08| 0.86
| 1| 900000| 467| 855| 605.9| 0.91| 0.91| 0.93
| 1| 1000000| 478| 1090| 657.6| 0.98| 0.78| 0.92
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 249, 282, 483, 518, 557, 720, 664, 819, 1010, 1036 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 310, 576, 1006, 781, 994, 1341, 1918, 2076, 2087, 2511 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 272.2, 408.9, 679.9, 630.5, 756.5, 869.6, 1088.3, 1362.1, 1261.2, 1337 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 249| 310| 272.2| 1| 1| 1
| 10| 200000| 282| 576| 408.9| 0.88| 0.54| 0.67
| 10| 300000| 483| 1006| 679.9| 0.58| 0.57| 0.6
| 10| 400000| 518| 781| 630.5| 0.93| 1.29| 1.08
| 10| 500000| 557| 994| 756.5| 0.93| 0.79| 0.83
| 10| 600000| 720| 1341| 869.6| 0.77| 0.74| 0.87
| 10| 700000| 664| 1918| 1088.3| 1.08| 0.7| 0.8
| 10| 800000| 819| 2076| 1362.1| 0.81| 0.92| 0.8
| 10| 900000| 1010| 2087| 1261.2| 0.81| 0.99| 1.08
| 10| 1000000| 1036| 2511| 1337| 0.97| 0.83| 0.94
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 539, 1309, 1763, 2050, 2564, 2961, 3052, 4244, 4442, 5156 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 1049, 2806, 2217, 5836, 4201, 9138, 5668, 11147, 7382, 15973 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 744.2, 2138.1, 2008.2, 3014, 3093.9, 5019.7, 3909.6, 5832.7, 5249, 6875 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 539| 1049| 744.2| 1| 1| 1
| 50| 200000| 1309| 2806| 2138.1| 0.41| 0.37| 0.35
| 50| 300000| 1763| 2217| 2008.2| 0.74| 1.27| 1.06
| 50| 400000| 2050| 5836| 3014| 0.86| 0.38| 0.67
| 50| 500000| 2564| 4201| 3093.9| 0.8| 1.39| 0.97
| 50| 600000| 2961| 9138| 5019.7| 0.87| 0.46| 0.62
| 50| 700000| 3052| 5668| 3909.6| 0.97| 1.61| 1.28
| 50| 800000| 4244| 11147| 5832.7| 0.72| 0.51| 0.67
| 50| 900000| 4442| 7382| 5249| 0.96| 1.51| 1.11
| 50| 1000000| 5156| 15973| 6875| 0.86| 0.46| 0.76
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 4631, 4454, 9425, 12032, 22679, 56534, 20436, 37712, 26639, 27680 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 11722, 11748, 16404, 22468, 34568, 62023, 35426, 48479, 46577, 37706 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 6098.2, 6394.4, 10905.3, 14475.3, 28872.5, 58330.2, 23787.1, 44679.9, 36614.2, 29703.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 4631| 11722| 6098.2| 1| 1| 1
| 100| 200000| 4454| 11748| 6394.4| 1.04| 1| 0.95
| 100| 300000| 9425| 16404| 10905.3| 0.47| 0.72| 0.59
| 100| 400000| 12032| 22468| 14475.3| 0.78| 0.73| 0.75
| 100| 500000| 22679| 34568| 28872.5| 0.53| 0.65| 0.5
| 100| 600000| 56534| 62023| 58330.2| 0.4| 0.56| 0.49
| 100| 700000| 20436| 35426| 23787.1| 2.77| 1.75| 2.45
| 100| 800000| 37712| 48479| 44679.9| 0.54| 0.73| 0.53
| 100| 900000| 26639| 46577| 36614.2| 1.42| 1.04| 1.22
| 100| 1000000| 27680| 37706| 29703.6| 0.96| 1.24| 1.23
|===

include::bench-classic-list-filter-search-footnote.adoc[]

== {list-filter---sort}: {search}

include::bench-classic-list-filter---sort-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 156, 166, 184, 237, 270, 290, 335, 373, 444, 444 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 229, 303, 387, 504, 545, 643, 449, 528, 985, 1087 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 179.6, 205, 276.3, 315.1, 377.9, 372, 406.5, 427.2, 679.9, 694.8 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 156| 229| 179.6| 1| 1| 1
| 1| 200000| 166| 303| 205| 0.94| 0.76| 0.88
| 1| 300000| 184| 387| 276.3| 0.9| 0.78| 0.74
| 1| 400000| 237| 504| 315.1| 0.78| 0.77| 0.88
| 1| 500000| 270| 545| 377.9| 0.88| 0.92| 0.83
| 1| 600000| 290| 643| 372| 0.93| 0.85| 1.02
| 1| 700000| 335| 449| 406.5| 0.87| 1.43| 0.92
| 1| 800000| 373| 528| 427.2| 0.9| 0.85| 0.95
| 1| 900000| 444| 985| 679.9| 0.84| 0.54| 0.63
| 1| 1000000| 444| 1087| 694.8| 1| 0.91| 0.98
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 270, 500, 716, 860, 857, 1090, 1165, 1472, 1728, 2153 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 538, 1303, 1781, 1201, 1302, 1620, 2813, 1662, 2660, 5705 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 361.4, 874.9, 1070.3, 980.8, 1086.7, 1462.4, 1563.4, 1541.8, 1946, 3652.9 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 270| 538| 361.4| 1| 1| 1
| 10| 200000| 500| 1303| 874.9| 0.54| 0.41| 0.41
| 10| 300000| 716| 1781| 1070.3| 0.7| 0.73| 0.82
| 10| 400000| 860| 1201| 980.8| 0.83| 1.48| 1.09
| 10| 500000| 857| 1302| 1086.7| 1| 0.92| 0.9
| 10| 600000| 1090| 1620| 1462.4| 0.79| 0.8| 0.74
| 10| 700000| 1165| 2813| 1563.4| 0.94| 0.58| 0.94
| 10| 800000| 1472| 1662| 1541.8| 0.79| 1.69| 1.01
| 10| 900000| 1728| 2660| 1946| 0.85| 0.62| 0.79
| 10| 1000000| 2153| 5705| 3652.9| 0.8| 0.47| 0.53
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 633, 1914, 2330, 3582, 3562, 3965, 4983, 5733, 7575, 9320 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 1001, 5230, 3879, 9070, 4493, 4953, 7320, 8707, 9002, 26861 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 876.7, 3309.7, 3036.5, 4592.5, 3927.2, 4297.1, 5548.8, 6967.8, 8258.5, 17746.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 633| 1001| 876.7| 1| 1| 1
| 50| 200000| 1914| 5230| 3309.7| 0.33| 0.19| 0.26
| 50| 300000| 2330| 3879| 3036.5| 0.82| 1.35| 1.09
| 50| 400000| 3582| 9070| 4592.5| 0.65| 0.43| 0.66
| 50| 500000| 3562| 4493| 3927.2| 1.01| 2.02| 1.17
| 50| 600000| 3965| 4953| 4297.1| 0.9| 0.91| 0.91
| 50| 700000| 4983| 7320| 5548.8| 0.8| 0.68| 0.77
| 50| 800000| 5733| 8707| 6967.8| 0.87| 0.84| 0.8
| 50| 900000| 7575| 9002| 8258.5| 0.76| 0.97| 0.84
| 50| 1000000| 9320| 26861| 17746.6| 0.81| 0.34| 0.47
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 5656, 9109, 15154, 20537, 27343, 33815, 41986, 48619, 83967, 58621 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 11754, 23810, 20422, 29360, 42598, 52748, 78931, 59930, 98283, 84241 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 6821.9, 12577.8, 16509.2, 22571.5, 33434.5, 38520.4, 59694.6, 53338.8, 91999.9, 71139 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 5656| 11754| 6821.9| 1| 1| 1
| 100| 200000| 9109| 23810| 12577.8| 0.62| 0.49| 0.54
| 100| 300000| 15154| 20422| 16509.2| 0.6| 1.17| 0.76
| 100| 400000| 20537| 29360| 22571.5| 0.74| 0.7| 0.73
| 100| 500000| 27343| 42598| 33434.5| 0.75| 0.69| 0.68
| 100| 600000| 33815| 52748| 38520.4| 0.81| 0.81| 0.87
| 100| 700000| 41986| 78931| 59694.6| 0.81| 0.67| 0.65
| 100| 800000| 48619| 59930| 53338.8| 0.86| 1.32| 1.12
| 100| 900000| 83967| 98283| 91999.9| 0.58| 0.61| 0.58
| 100| 1000000| 58621| 84241| 71139| 1.43| 1.17| 1.29
|===

include::bench-classic-list-filter---sort-search-footnote.adoc[]

== {list-plain}: {search}

include::bench-classic-list-plain-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 127, 141, 184, 190, 192, 204, 219, 275, 217, 312 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 184, 263, 357, 325, 451, 491, 740, 928, 584, 687 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 154.5, 174.6, 233.8, 230.2, 294.1, 288.2, 372.2, 359.6, 347.3, 395.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 127| 184| 154.5| 1| 1| 1
| 1| 200000| 141| 263| 174.6| 0.9| 0.7| 0.88
| 1| 300000| 184| 357| 233.8| 0.77| 0.74| 0.75
| 1| 400000| 190| 325| 230.2| 0.97| 1.1| 1.02
| 1| 500000| 192| 451| 294.1| 0.99| 0.72| 0.78
| 1| 600000| 204| 491| 288.2| 0.94| 0.92| 1.02
| 1| 700000| 219| 740| 372.2| 0.93| 0.66| 0.77
| 1| 800000| 275| 928| 359.6| 0.8| 0.8| 1.04
| 1| 900000| 217| 584| 347.3| 1.27| 1.59| 1.04
| 1| 1000000| 312| 687| 395.6| 0.7| 0.85| 0.88
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 165, 166, 262, 272, 305, 340, 321, 466, 463, 428 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 497, 479, 641, 704, 869, 819, 1982, 1314, 2071, 2067 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 237.2, 295.6, 359.5, 386.1, 409.1, 507.4, 603.8, 637.4, 823.1, 813.8 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 165| 497| 237.2| 1| 1| 1
| 10| 200000| 166| 479| 295.6| 0.99| 1.04| 0.8
| 10| 300000| 262| 641| 359.5| 0.63| 0.75| 0.82
| 10| 400000| 272| 704| 386.1| 0.96| 0.91| 0.93
| 10| 500000| 305| 869| 409.1| 0.89| 0.81| 0.94
| 10| 600000| 340| 819| 507.4| 0.9| 1.06| 0.81
| 10| 700000| 321| 1982| 603.8| 1.06| 0.41| 0.84
| 10| 800000| 466| 1314| 637.4| 0.69| 1.51| 0.95
| 10| 900000| 463| 2071| 823.1| 1.01| 0.63| 0.77
| 10| 1000000| 428| 2067| 813.8| 1.08| 1| 1.01
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 335, 395, 594, 720, 898, 993, 1028, 1228, 1278, 1362 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 1083, 1938, 1918, 2738, 3077, 2609, 2853, 3492, 3661, 5229 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 530.2, 676.6, 899.8, 1051.5, 1265.5, 1282.8, 1485.4, 1784.4, 1778.8, 2102.7 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 335| 1083| 530.2| 1| 1| 1
| 50| 200000| 395| 1938| 676.6| 0.85| 0.56| 0.78
| 50| 300000| 594| 1918| 899.8| 0.66| 1.01| 0.75
| 50| 400000| 720| 2738| 1051.5| 0.83| 0.7| 0.86
| 50| 500000| 898| 3077| 1265.5| 0.8| 0.89| 0.83
| 50| 600000| 993| 2609| 1282.8| 0.9| 1.18| 0.99
| 50| 700000| 1028| 2853| 1485.4| 0.97| 0.91| 0.86
| 50| 800000| 1228| 3492| 1784.4| 0.84| 0.82| 0.83
| 50| 900000| 1278| 3661| 1778.8| 0.96| 0.95| 1
| 50| 1000000| 1362| 5229| 2102.7| 0.94| 0.7| 0.85
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 354, 346, 454, 414, 416, 480, 437, 465, 478, 407 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 441, 429, 584, 553, 572, 731, 644, 737, 1129, 1307 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 370.8, 399.7, 493.7, 468.7, 479, 555.7, 522.5, 556.3, 596, 770.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 354| 441| 370.8| 1| 1| 1
| 100| 200000| 346| 429| 399.7| 1.02| 1.03| 0.93
| 100| 300000| 454| 584| 493.7| 0.76| 0.73| 0.81
| 100| 400000| 414| 553| 468.7| 1.1| 1.06| 1.05
| 100| 500000| 416| 572| 479| 1| 0.97| 0.98
| 100| 600000| 480| 731| 555.7| 0.87| 0.78| 0.86
| 100| 700000| 437| 644| 522.5| 1.1| 1.14| 1.06
| 100| 800000| 465| 737| 556.3| 0.94| 0.87| 0.94
| 100| 900000| 478| 1129| 596| 0.97| 0.65| 0.93
| 100| 1000000| 407| 1307| 770.5| 1.17| 0.86| 0.77
|===

include::bench-classic-list-plain-search-footnote.adoc[]

== {list-sort}: {search}

include::bench-classic-list-sort-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 153, 176, 227, 283, 306, 289, 384, 373, 485, 554 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 185, 279, 479, 693, 388, 360, 856, 750, 1079, 1440 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 163, 209.6, 337.5, 422.9, 356.4, 319.2, 540.5, 472.3, 678.4, 771.4 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 153| 185| 163| 1| 1| 1
| 1| 200000| 176| 279| 209.6| 0.87| 0.66| 0.78
| 1| 300000| 227| 479| 337.5| 0.78| 0.58| 0.62
| 1| 400000| 283| 693| 422.9| 0.8| 0.69| 0.8
| 1| 500000| 306| 388| 356.4| 0.92| 1.79| 1.19
| 1| 600000| 289| 360| 319.2| 1.06| 1.08| 1.12
| 1| 700000| 384| 856| 540.5| 0.75| 0.42| 0.59
| 1| 800000| 373| 750| 472.3| 1.03| 1.14| 1.14
| 1| 900000| 485| 1079| 678.4| 0.77| 0.7| 0.7
| 1| 1000000| 554| 1440| 771.4| 0.88| 0.75| 0.88
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 291, 669, 833, 1176, 843, 977, 1478, 1614, 2009, 2618 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 409, 2063, 2111, 2866, 1501, 1053, 2192, 2334, 3414, 6860 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 312.9, 1066.1, 1125.6, 1855.6, 980.9, 1010.5, 1728.8, 1867.9, 2467.8, 4126.4 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 291| 409| 312.9| 1| 1| 1
| 10| 200000| 669| 2063| 1066.1| 0.43| 0.2| 0.29
| 10| 300000| 833| 2111| 1125.6| 0.8| 0.98| 0.95
| 10| 400000| 1176| 2866| 1855.6| 0.71| 0.74| 0.61
| 10| 500000| 843| 1501| 980.9| 1.4| 1.91| 1.89
| 10| 600000| 977| 1053| 1010.5| 0.86| 1.43| 0.97
| 10| 700000| 1478| 2192| 1728.8| 0.66| 0.48| 0.58
| 10| 800000| 1614| 2334| 1867.9| 0.92| 0.94| 0.93
| 10| 900000| 2009| 3414| 2467.8| 0.8| 0.68| 0.76
| 10| 1000000| 2618| 6860| 4126.4| 0.77| 0.5| 0.6
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 521, 1873, 2893, 3474, 3285, 2673, 4944, 6060, 8875, 8397 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 627, 4525, 8615, 9207, 4420, 5023, 7427, 8959, 23484, 28815 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 560.9, 2770.3, 4972.9, 5120.5, 3741, 3939.3, 5697.8, 6605.6, 12285.7, 13872.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 521| 627| 560.9| 1| 1| 1
| 50| 200000| 1873| 4525| 2770.3| 0.28| 0.14| 0.2
| 50| 300000| 2893| 8615| 4972.9| 0.65| 0.53| 0.56
| 50| 400000| 3474| 9207| 5120.5| 0.83| 0.94| 0.97
| 50| 500000| 3285| 4420| 3741| 1.06| 2.08| 1.37
| 50| 600000| 2673| 5023| 3939.3| 1.23| 0.88| 0.95
| 50| 700000| 4944| 7427| 5697.8| 0.54| 0.68| 0.69
| 50| 800000| 6060| 8959| 6605.6| 0.82| 0.83| 0.86
| 50| 900000| 8875| 23484| 12285.7| 0.68| 0.38| 0.54
| 50| 1000000| 8397| 28815| 13872.1| 1.06| 0.81| 0.89
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 4269, 9678, 20708, 25743, 24804, 30332, 41961, 45881, 83982, 52443 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 5611, 26862, 37772, 65667, 36126, 35392, 78030, 59383, 145701, 69243 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 4583, 14043.2, 27065.8, 36611.5, 27865.9, 33364.3, 59373.5, 51142.4, 98477.4, 57934.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 4269| 5611| 4583| 1| 1| 1
| 100| 200000| 9678| 26862| 14043.2| 0.44| 0.21| 0.33
| 100| 300000| 20708| 37772| 27065.8| 0.47| 0.71| 0.52
| 100| 400000| 25743| 65667| 36611.5| 0.8| 0.58| 0.74
| 100| 500000| 24804| 36126| 27865.9| 1.04| 1.82| 1.31
| 100| 600000| 30332| 35392| 33364.3| 0.82| 1.02| 0.84
| 100| 700000| 41961| 78030| 59373.5| 0.72| 0.45| 0.56
| 100| 800000| 45881| 59383| 51142.4| 0.91| 1.31| 1.16
| 100| 900000| 83982| 145701| 98477.4| 0.55| 0.41| 0.52
| 100| 1000000| 52443| 69243| 57934.5| 1.6| 2.1| 1.7
|===

include::bench-classic-list-sort-search-footnote.adoc[]


# src/modules/generated/partials/benchmarks/bench-dedicated-benchmark-intro.adoc

The dedicated table benchmarks the optimized setup where module fields get their own dedicated table columns. You can apply standard database optimizations (such as indexing) to better suit your needs.
This setup is intended for high volume modules since it can better utilize indexing and reduce the JSON encoding overhead.

[NOTE]
====
This document should be used as a base to figure out what setup would work best for you.
You can use the raw numbers of different scenarios to deduct your own conclusions on how well a specific setup would pan out for your use case.
====

.Testing notes:
* A sub-select of columns specified indexes which affects both the CRUD and search operations.
* All times are in MS with networking overhead excluded (the scripts were ran directly on the host server).
* Each scenario used a dedicated DB table which was configured to define a dedicated column for each module field. The primary reason is consistent repeatability.
* Records were created from a pre-defined dataset with randomly generated data using faker.js.
* Benchmarks were ran on a dedicated cloud instance with minimal background processes.
* The tests use Postgres as the database.

.Testing observations:
* We observed some random spikes under the max time which we couldn't quite explain. Our guess would indicate some background system task or potential throttling. Ideally, in future tests, such anomalies would be excluded or better handled.

.Future plans:
* Increase the amount of data points to better indicate the trend.
* Include some projections to indicate how it would behave on larger datasets.
* Provide memory profiling to indicate consumption and better suggest recommended system specs.


# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-create-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-create-intro.adoc

The scenario benchmarks insertion times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark inserts a single record into the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-delete-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-delete-intro.adoc

The scenario benchmarks delete times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark deletes a single record from the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-lookup-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-lookup-intro.adoc

The scenario benchmarks lookup times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark looks up a single record from the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-update-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-crud-operations-crud-update-intro.adoc

The scenario benchmarks update times into an already existing module with N pre-created records (where N is the record count in the following tables).

[NOTE]
====
This benchmark updates a single record from the module with N records pre-created before the scenario.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-list-filter---sort-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-list-filter---sort-search-intro.adoc

The scenario benchmarks fetching the first page of records when providing a filter and a sort.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-list-filter-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-list-filter-search-intro.adoc

The scenario benchmarks fetching the first page of records when providing a filter.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-list-plain-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-list-plain-search-intro.adoc

The scenario benchmarks fetching the first page of records without any other sorting/filtering parameters.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-dedicated-list-sort-search-footnote.adoc



# src/modules/generated/partials/benchmarks/bench-dedicated-list-sort-search-intro.adoc

The scenario benchmarks fetching the first page of records when providing a sort.
The page size is 20 records.

[IMPORTANT]
====
The scenario excludes both the total record count and the complete paging navigation.
====


# src/modules/generated/partials/benchmarks/bench-dedicated.gen.adoc

include::ROOT:partial$variables.adoc[]
include::variables.adoc[]

= {bench-dedicated}

include::bench-dedicated-benchmark-intro.adoc[]

== {crud-operations}: {crud-create}

include::bench-dedicated-crud-operations-crud-create-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 140, 134, 128, 142, 147, 140, 139, 128, 142, 116 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 208, 161, 180, 168, 158, 152, 2693, 156, 180, 162 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 157.3, 146.1, 147.4, 150.5, 150.1, 146.5, 403.4, 144.5, 153.6, 137.3 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 140| 208| 157.3| 1| 1| 1
| 1| 200000| 134| 161| 146.1| 1.04| 1.29| 1.08
| 1| 300000| 128| 180| 147.4| 1.05| 0.89| 0.99
| 1| 400000| 142| 168| 150.5| 0.9| 1.07| 0.98
| 1| 500000| 147| 158| 150.1| 0.97| 1.06| 1
| 1| 600000| 140| 152| 146.5| 1.05| 1.04| 1.02
| 1| 700000| 139| 2693| 403.4| 1.01| 0.06| 0.36
| 1| 800000| 128| 156| 144.5| 1.09| 17.26| 2.79
| 1| 900000| 142| 180| 153.6| 0.9| 0.87| 0.94
| 1| 1000000| 116| 162| 137.3| 1.22| 1.11| 1.12
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 139, 123, 131, 132, 146, 146, 146, 144, 139, 138 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 166, 159, 177, 211, 164, 222, 188, 170, 208, 227 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 152.1, 137.7, 145.2, 158, 151.8, 160, 160.5, 151.8, 161.6, 159.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 139| 166| 152.1| 1| 1| 1
| 10| 200000| 123| 159| 137.7| 1.13| 1.04| 1.1
| 10| 300000| 131| 177| 145.2| 0.94| 0.9| 0.95
| 10| 400000| 132| 211| 158| 0.99| 0.84| 0.92
| 10| 500000| 146| 164| 151.8| 0.9| 1.29| 1.04
| 10| 600000| 146| 222| 160| 1| 0.74| 0.95
| 10| 700000| 146| 188| 160.5| 1| 1.18| 1
| 10| 800000| 144| 170| 151.8| 1.01| 1.11| 1.06
| 10| 900000| 139| 208| 161.6| 1.04| 0.82| 0.94
| 10| 1000000| 138| 227| 159.5| 1.01| 0.92| 1.01
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 138, 134, 137, 132, 140, 135, 148, 144, 142, 144 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 204, 167, 181, 225, 214, 183, 174, 184, 166, 166 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 159.3, 145.8, 155.6, 154.2, 160.5, 155.3, 156.3, 157.6, 153.1, 154.2 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 138| 204| 159.3| 1| 1| 1
| 50| 200000| 134| 167| 145.8| 1.03| 1.22| 1.09
| 50| 300000| 137| 181| 155.6| 0.98| 0.92| 0.94
| 50| 400000| 132| 225| 154.2| 1.04| 0.8| 1.01
| 50| 500000| 140| 214| 160.5| 0.94| 1.05| 0.96
| 50| 600000| 135| 183| 155.3| 1.04| 1.17| 1.03
| 50| 700000| 148| 174| 156.3| 0.91| 1.05| 0.99
| 50| 800000| 144| 184| 157.6| 1.03| 0.95| 0.99
| 50| 900000| 142| 166| 153.1| 1.01| 1.11| 1.03
| 50| 1000000| 144| 166| 154.2| 0.99| 1| 0.99
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 164, 154, 150, 149, 153, 161, 142, 145, 152, 150 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 607, 194, 192, 195, 229, 262, 190, 276, 196, 178 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 215.7, 168, 170, 168.9, 174.5, 181.4, 163.2, 179.3, 170.9, 164.4 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 164| 607| 215.7| 1| 1| 1
| 100| 200000| 154| 194| 168| 1.06| 3.13| 1.28
| 100| 300000| 150| 192| 170| 1.03| 1.01| 0.99
| 100| 400000| 149| 195| 168.9| 1.01| 0.98| 1.01
| 100| 500000| 153| 229| 174.5| 0.97| 0.85| 0.97
| 100| 600000| 161| 262| 181.4| 0.95| 0.87| 0.96
| 100| 700000| 142| 190| 163.2| 1.13| 1.38| 1.11
| 100| 800000| 145| 276| 179.3| 0.98| 0.69| 0.91
| 100| 900000| 152| 196| 170.9| 0.95| 1.41| 1.05
| 100| 1000000| 150| 178| 164.4| 1.01| 1.1| 1.04
|===

include::bench-dedicated-crud-operations-crud-create-footnote.adoc[]

== {crud-operations}: {crud-lookup}

include::bench-dedicated-crud-operations-crud-lookup-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 138, 118, 118, 133, 141, 133, 125, 129, 144, 119 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 157, 164, 147, 159, 176, 157, 157, 166, 155, 153 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 145.4, 136.8, 133.9, 145.7, 150.9, 146.6, 145.4, 145.1, 148.9, 139 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 138| 157| 145.4| 1| 1| 1
| 1| 200000| 118| 164| 136.8| 1.17| 0.96| 1.06
| 1| 300000| 118| 147| 133.9| 1| 1.12| 1.02
| 1| 400000| 133| 159| 145.7| 0.89| 0.92| 0.92
| 1| 500000| 141| 176| 150.9| 0.94| 0.9| 0.97
| 1| 600000| 133| 157| 146.6| 1.06| 1.12| 1.03
| 1| 700000| 125| 157| 145.4| 1.06| 1| 1.01
| 1| 800000| 129| 166| 145.1| 0.97| 0.95| 1
| 1| 900000| 144| 155| 148.9| 0.9| 1.07| 0.97
| 1| 1000000| 119| 153| 139| 1.21| 1.01| 1.07
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 142, 116, 114, 114, 146, 146, 141, 137, 128, 112 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 173, 150, 181, 203, 214, 155, 192, 169, 174, 172 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 150.7, 138.4, 146.4, 147.3, 161.1, 148.9, 156.1, 151.1, 153.7, 141.7 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 142| 173| 150.7| 1| 1| 1
| 10| 200000| 116| 150| 138.4| 1.22| 1.15| 1.09
| 10| 300000| 114| 181| 146.4| 1.02| 0.83| 0.95
| 10| 400000| 114| 203| 147.3| 1| 0.89| 0.99
| 10| 500000| 146| 214| 161.1| 0.78| 0.95| 0.91
| 10| 600000| 146| 155| 148.9| 1| 1.38| 1.08
| 10| 700000| 141| 192| 156.1| 1.04| 0.81| 0.95
| 10| 800000| 137| 169| 151.1| 1.03| 1.14| 1.03
| 10| 900000| 128| 174| 153.7| 1.07| 0.97| 0.98
| 10| 1000000| 112| 172| 141.7| 1.14| 1.01| 1.08
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 146, 129, 134, 128, 143, 132, 140, 146, 123, 128 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 198, 155, 216, 154, 197, 157, 157, 206, 183, 162 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 154.2, 141.1, 159.1, 140.5, 158.4, 146.8, 148, 157.4, 151.5, 143.7 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 146| 198| 154.2| 1| 1| 1
| 50| 200000| 129| 155| 141.1| 1.13| 1.28| 1.09
| 50| 300000| 134| 216| 159.1| 0.96| 0.72| 0.89
| 50| 400000| 128| 154| 140.5| 1.05| 1.4| 1.13
| 50| 500000| 143| 197| 158.4| 0.9| 0.78| 0.89
| 50| 600000| 132| 157| 146.8| 1.08| 1.25| 1.08
| 50| 700000| 140| 157| 148| 0.94| 1| 0.99
| 50| 800000| 146| 206| 157.4| 0.96| 0.76| 0.94
| 50| 900000| 123| 183| 151.5| 1.19| 1.13| 1.04
| 50| 1000000| 128| 162| 143.7| 0.96| 1.13| 1.05
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 156, 126, 134, 140, 124, 142, 132, 132, 135, 132 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 403, 162, 159, 184, 167, 174, 203, 215, 204, 166 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 194, 148.8, 149.2, 155.8, 151.6, 160, 151.6, 164.3, 159.2, 149.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 156| 403| 194| 1| 1| 1
| 100| 200000| 126| 162| 148.8| 1.24| 2.49| 1.3
| 100| 300000| 134| 159| 149.2| 0.94| 1.02| 1
| 100| 400000| 140| 184| 155.8| 0.96| 0.86| 0.96
| 100| 500000| 124| 167| 151.6| 1.13| 1.1| 1.03
| 100| 600000| 142| 174| 160| 0.87| 0.96| 0.95
| 100| 700000| 132| 203| 151.6| 1.08| 0.86| 1.06
| 100| 800000| 132| 215| 164.3| 1| 0.94| 0.92
| 100| 900000| 135| 204| 159.2| 0.98| 1.05| 1.03
| 100| 1000000| 132| 166| 149.5| 1.02| 1.23| 1.06
|===

include::bench-dedicated-crud-operations-crud-lookup-footnote.adoc[]

== {crud-operations}: {crud-update}

include::bench-dedicated-crud-operations-crud-update-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 139, 123, 129, 138, 142, 139, 139, 131, 143, 128 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 164, 163, 201, 166, 158, 183, 191, 212, 172, 157 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 152.3, 142.7, 147.4, 154.1, 151.2, 149.5, 153.4, 157.7, 154.4, 142 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 139| 164| 152.3| 1| 1| 1
| 1| 200000| 123| 163| 142.7| 1.13| 1.01| 1.07
| 1| 300000| 129| 201| 147.4| 0.95| 0.81| 0.97
| 1| 400000| 138| 166| 154.1| 0.93| 1.21| 0.96
| 1| 500000| 142| 158| 151.2| 0.97| 1.05| 1.02
| 1| 600000| 139| 183| 149.5| 1.02| 0.86| 1.01
| 1| 700000| 139| 191| 153.4| 1| 0.96| 0.97
| 1| 800000| 131| 212| 157.7| 1.06| 0.9| 0.97
| 1| 900000| 143| 172| 154.4| 0.92| 1.23| 1.02
| 1| 1000000| 128| 157| 142| 1.12| 1.1| 1.09
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 145, 132, 142, 137, 141, 148, 134, 147, 148, 131 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 168, 152, 184, 202, 208, 164, 349, 174, 174, 184 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 154.4, 141.8, 153.9, 154.1, 161.3, 155.8, 180.1, 157.2, 156.6, 148.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 145| 168| 154.4| 1| 1| 1
| 10| 200000| 132| 152| 141.8| 1.1| 1.11| 1.09
| 10| 300000| 142| 184| 153.9| 0.93| 0.83| 0.92
| 10| 400000| 137| 202| 154.1| 1.04| 0.91| 1
| 10| 500000| 141| 208| 161.3| 0.97| 0.97| 0.96
| 10| 600000| 148| 164| 155.8| 0.95| 1.27| 1.04
| 10| 700000| 134| 349| 180.1| 1.1| 0.47| 0.87
| 10| 800000| 147| 174| 157.2| 0.91| 2.01| 1.15
| 10| 900000| 148| 174| 156.6| 0.99| 1| 1
| 10| 1000000| 131| 184| 148.5| 1.13| 0.95| 1.05
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 141, 129, 141, 139, 146, 144, 150, 138, 141, 127 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 166, 195, 207, 197, 167, 163, 170, 198, 213, 196 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 151.5, 147, 162.3, 163.2, 154, 152.6, 157.6, 157.3, 161.5, 158.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 141| 166| 151.5| 1| 1| 1
| 50| 200000| 129| 195| 147| 1.09| 0.85| 1.03
| 50| 300000| 141| 207| 162.3| 0.91| 0.94| 0.91
| 50| 400000| 139| 197| 163.2| 1.01| 1.05| 0.99
| 50| 500000| 146| 167| 154| 0.95| 1.18| 1.06
| 50| 600000| 144| 163| 152.6| 1.01| 1.02| 1.01
| 50| 700000| 150| 170| 157.6| 0.96| 0.96| 0.97
| 50| 800000| 138| 198| 157.3| 1.09| 0.86| 1
| 50| 900000| 141| 213| 161.5| 0.98| 0.93| 0.97
| 50| 1000000| 127| 196| 158.6| 1.11| 1.09| 1.02
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 165, 147, 161, 162, 153, 161, 161, 152, 145, 152 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 214, 190, 186, 205, 174, 1726, 186, 194, 181, 234 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 178.3, 162.9, 171.5, 180.2, 165.6, 333.7, 173.4, 169.2, 166.1, 169.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 165| 214| 178.3| 1| 1| 1
| 100| 200000| 147| 190| 162.9| 1.12| 1.13| 1.09
| 100| 300000| 161| 186| 171.5| 0.91| 1.02| 0.95
| 100| 400000| 162| 205| 180.2| 0.99| 0.91| 0.95
| 100| 500000| 153| 174| 165.6| 1.06| 1.18| 1.09
| 100| 600000| 161| 1726| 333.7| 0.95| 0.1| 0.5
| 100| 700000| 161| 186| 173.4| 1| 9.28| 1.92
| 100| 800000| 152| 194| 169.2| 1.06| 0.96| 1.02
| 100| 900000| 145| 181| 166.1| 1.05| 1.07| 1.02
| 100| 1000000| 152| 234| 169.5| 0.95| 0.77| 0.98
|===

include::bench-dedicated-crud-operations-crud-update-footnote.adoc[]

== {crud-operations}: {crud-delete}

include::bench-dedicated-crud-operations-crud-delete-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 139, 123, 122, 140, 146, 140, 140, 137, 139, 124 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 164, 160, 204, 165, 163, 157, 185, 165, 169, 157 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 149.7, 142.5, 143.4, 152.1, 152.2, 147.5, 151.9, 151.1, 151.4, 135.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 139| 164| 149.7| 1| 1| 1
| 1| 200000| 123| 160| 142.5| 1.13| 1.02| 1.05
| 1| 300000| 122| 204| 143.4| 1.01| 0.78| 0.99
| 1| 400000| 140| 165| 152.1| 0.87| 1.24| 0.94
| 1| 500000| 146| 163| 152.2| 0.96| 1.01| 1
| 1| 600000| 140| 157| 147.5| 1.04| 1.04| 1.03
| 1| 700000| 140| 185| 151.9| 1| 0.85| 0.97
| 1| 800000| 137| 165| 151.1| 1.02| 1.12| 1.01
| 1| 900000| 139| 169| 151.4| 0.99| 0.98| 1
| 1| 1000000| 124| 157| 135.5| 1.12| 1.08| 1.12
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 134, 116, 129, 128, 140, 144, 146, 140, 140, 118 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 173, 163, 157, 165, 173, 195, 172, 183, 174, 173 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 149.7, 140.5, 140.9, 142.5, 154.5, 154.3, 154.2, 155.9, 152.1, 148.9 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 134| 173| 149.7| 1| 1| 1
| 10| 200000| 116| 163| 140.5| 1.16| 1.06| 1.07
| 10| 300000| 129| 157| 140.9| 0.9| 1.04| 1
| 10| 400000| 128| 165| 142.5| 1.01| 0.95| 0.99
| 10| 500000| 140| 173| 154.5| 0.91| 0.95| 0.92
| 10| 600000| 144| 195| 154.3| 0.97| 0.89| 1
| 10| 700000| 146| 172| 154.2| 0.99| 1.13| 1
| 10| 800000| 140| 183| 155.9| 1.04| 0.94| 0.99
| 10| 900000| 140| 174| 152.1| 1| 1.05| 1.02
| 10| 1000000| 118| 173| 148.9| 1.19| 1.01| 1.02
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 144, 136, 124, 130, 140, 145, 137, 141, 126, 129 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 224, 192, 166, 153, 166, 154, 166, 164, 162, 195 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 156, 156.4, 146.6, 144.2, 150.4, 148.3, 148.3, 149, 147.1, 151.9 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 144| 224| 156| 1| 1| 1
| 50| 200000| 136| 192| 156.4| 1.06| 1.17| 1
| 50| 300000| 124| 166| 146.6| 1.1| 1.16| 1.07
| 50| 400000| 130| 153| 144.2| 0.95| 1.08| 1.02
| 50| 500000| 140| 166| 150.4| 0.93| 0.92| 0.96
| 50| 600000| 145| 154| 148.3| 0.97| 1.08| 1.01
| 50| 700000| 137| 166| 148.3| 1.06| 0.93| 1
| 50| 800000| 141| 164| 149| 0.97| 1.01| 1
| 50| 900000| 126| 162| 147.1| 1.12| 1.01| 1.01
| 50| 1000000| 129| 195| 151.9| 0.98| 0.83| 0.97
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 148, 137, 135, 137, 136, 142, 146, 132, 129, 127 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 200, 168, 183, 162, 168, 253, 222, 170, 184, 203 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 168.3, 152.5, 154, 152.3, 154.8, 166.8, 168.6, 153.4, 151.3, 155.4 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 148| 200| 168.3| 1| 1| 1
| 100| 200000| 137| 168| 152.5| 1.08| 1.19| 1.1
| 100| 300000| 135| 183| 154| 1.01| 0.92| 0.99
| 100| 400000| 137| 162| 152.3| 0.99| 1.13| 1.01
| 100| 500000| 136| 168| 154.8| 1.01| 0.96| 0.98
| 100| 600000| 142| 253| 166.8| 0.96| 0.66| 0.93
| 100| 700000| 146| 222| 168.6| 0.97| 1.14| 0.99
| 100| 800000| 132| 170| 153.4| 1.11| 1.31| 1.1
| 100| 900000| 129| 184| 151.3| 1.02| 0.92| 1.01
| 100| 1000000| 127| 203| 155.4| 1.02| 0.91| 0.97
|===

include::bench-dedicated-crud-operations-crud-delete-footnote.adoc[]

== {list-filter}: {search}

include::bench-dedicated-list-filter-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 132, 136, 125, 121, 126, 115, 129, 131, 124, 135 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 160, 188, 164, 208, 179, 168, 154, 190, 165, 160 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 146.4, 153.1, 143.6, 150.1, 141.6, 149.3, 142.3, 146.7, 143.9, 146.8 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 132| 160| 146.4| 1| 1| 1
| 1| 200000| 136| 188| 153.1| 0.97| 0.85| 0.96
| 1| 300000| 125| 164| 143.6| 1.09| 1.15| 1.07
| 1| 400000| 121| 208| 150.1| 1.03| 0.79| 0.96
| 1| 500000| 126| 179| 141.6| 0.96| 1.16| 1.06
| 1| 600000| 115| 168| 149.3| 1.1| 1.07| 0.95
| 1| 700000| 129| 154| 142.3| 0.89| 1.09| 1.05
| 1| 800000| 131| 190| 146.7| 0.98| 0.81| 0.97
| 1| 900000| 124| 165| 143.9| 1.06| 1.15| 1.02
| 1| 1000000| 135| 160| 146.8| 0.92| 1.03| 0.98
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 157, 163, 167, 168, 171, 169, 168, 175, 172, 175 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 239, 208, 195, 223, 204, 214, 205, 223, 207, 243 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 188.8, 183.2, 184.4, 198.5, 186.5, 187.3, 184.9, 192.1, 189.7, 192.9 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 157| 239| 188.8| 1| 1| 1
| 10| 200000| 163| 208| 183.2| 0.96| 1.15| 1.03
| 10| 300000| 167| 195| 184.4| 0.98| 1.07| 0.99
| 10| 400000| 168| 223| 198.5| 0.99| 0.87| 0.93
| 10| 500000| 171| 204| 186.5| 0.98| 1.09| 1.06
| 10| 600000| 169| 214| 187.3| 1.01| 0.95| 1
| 10| 700000| 168| 205| 184.9| 1.01| 1.04| 1.01
| 10| 800000| 175| 223| 192.1| 0.96| 0.92| 0.96
| 10| 900000| 172| 207| 189.7| 1.02| 1.08| 1.01
| 10| 1000000| 175| 243| 192.9| 0.98| 0.85| 0.98
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 224, 208, 220, 225, 216, 222, 207, 211, 217, 217 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 269, 259, 268, 253, 259, 260, 303, 282, 295, 265 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 244.4, 237.4, 246.3, 237.6, 238, 239, 240.7, 240.7, 247.4, 236.5 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 224| 269| 244.4| 1| 1| 1
| 50| 200000| 208| 259| 237.4| 1.08| 1.04| 1.03
| 50| 300000| 220| 268| 246.3| 0.95| 0.97| 0.96
| 50| 400000| 225| 253| 237.6| 0.98| 1.06| 1.04
| 50| 500000| 216| 259| 238| 1.04| 0.98| 1
| 50| 600000| 222| 260| 239| 0.97| 1| 1
| 50| 700000| 207| 303| 240.7| 1.07| 0.86| 0.99
| 50| 800000| 211| 282| 240.7| 0.98| 1.07| 1
| 50| 900000| 217| 295| 247.4| 0.97| 0.96| 0.97
| 50| 1000000| 217| 265| 236.5| 1| 1.11| 1.05
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 344, 347, 326, 329, 334, 353, 363, 353, 362, 333 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 490, 381, 399, 392, 430, 430, 439, 399, 479, 381 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 393.6, 359.8, 363.7, 365.6, 384.2, 394.8, 393.5, 373.1, 392, 355.6 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 344| 490| 393.6| 1| 1| 1
| 100| 200000| 347| 381| 359.8| 0.99| 1.29| 1.09
| 100| 300000| 326| 399| 363.7| 1.06| 0.95| 0.99
| 100| 400000| 329| 392| 365.6| 0.99| 1.02| 0.99
| 100| 500000| 334| 430| 384.2| 0.99| 0.91| 0.95
| 100| 600000| 353| 430| 394.8| 0.95| 1| 0.97
| 100| 700000| 363| 439| 393.5| 0.97| 0.98| 1
| 100| 800000| 353| 399| 373.1| 1.03| 1.1| 1.05
| 100| 900000| 362| 479| 392| 0.98| 0.83| 0.95
| 100| 1000000| 333| 381| 355.6| 1.09| 1.26| 1.1
|===

include::bench-dedicated-list-filter-search-footnote.adoc[]

== {list-filter---sort}: {search}

include::bench-dedicated-list-filter---sort-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 169, 180, 211, 233, 301, 332, 373, 365, 455, 478 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 363, 264, 562, 1027, 1229, 1209, 1719, 1645, 754, 2027 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 201.4, 208.1, 273.3, 341.6, 426, 448, 536.2, 544.9, 544.2, 671.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 169| 363| 201.4| 1| 1| 1
| 1| 200000| 180| 264| 208.1| 0.94| 1.38| 0.97
| 1| 300000| 211| 562| 273.3| 0.85| 0.47| 0.76
| 1| 400000| 233| 1027| 341.6| 0.91| 0.55| 0.8
| 1| 500000| 301| 1229| 426| 0.77| 0.84| 0.8
| 1| 600000| 332| 1209| 448| 0.91| 1.02| 0.95
| 1| 700000| 373| 1719| 536.2| 0.89| 0.7| 0.84
| 1| 800000| 365| 1645| 544.9| 1.02| 1.04| 0.98
| 1| 900000| 455| 754| 544.2| 0.8| 2.18| 1
| 1| 1000000| 478| 2027| 671.1| 0.95| 0.37| 0.81
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 182, 157, 186, 160, 155, 168, 180, 172, 178, 163 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 636, 203, 341, 420, 452, 576, 648, 657, 364, 1460 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 237.3, 180.7, 218.1, 212.5, 222.6, 240.7, 238.1, 235.7, 216.8, 319.3 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 182| 636| 237.3| 1| 1| 1
| 10| 200000| 157| 203| 180.7| 1.16| 3.13| 1.31
| 10| 300000| 186| 341| 218.1| 0.84| 0.6| 0.83
| 10| 400000| 160| 420| 212.5| 1.16| 0.81| 1.03
| 10| 500000| 155| 452| 222.6| 1.03| 0.93| 0.95
| 10| 600000| 168| 576| 240.7| 0.92| 0.78| 0.92
| 10| 700000| 180| 648| 238.1| 0.93| 0.89| 1.01
| 10| 800000| 172| 657| 235.7| 1.05| 0.99| 1.01
| 10| 900000| 178| 364| 216.8| 0.97| 1.8| 1.09
| 10| 1000000| 163| 1460| 319.3| 1.09| 0.25| 0.68
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 233, 217, 231, 228, 221, 248, 229, 224, 212, 234 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 296, 384, 439, 436, 495, 556, 697, 265, 457, 1295 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 255.7, 248.3, 271.1, 268.6, 270.4, 289.6, 297.5, 247.2, 282.8, 360.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 233| 296| 255.7| 1| 1| 1
| 50| 200000| 217| 384| 248.3| 1.07| 0.77| 1.03
| 50| 300000| 231| 439| 271.1| 0.94| 0.87| 0.92
| 50| 400000| 228| 436| 268.6| 1.01| 1.01| 1.01
| 50| 500000| 221| 495| 270.4| 1.03| 0.88| 0.99
| 50| 600000| 248| 556| 289.6| 0.89| 0.89| 0.93
| 50| 700000| 229| 697| 297.5| 1.08| 0.8| 0.97
| 50| 800000| 224| 265| 247.2| 1.02| 2.63| 1.2
| 50| 900000| 212| 457| 282.8| 1.06| 0.58| 0.87
| 50| 1000000| 234| 1295| 360.1| 0.91| 0.35| 0.79
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 345, 351, 358, 371, 359, 385, 364, 357, 359, 368 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 473, 414, 799, 741, 824, 1308, 869, 1090, 832, 1460 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 406.7, 372.6, 420.5, 431, 459.7, 495.5, 446.1, 475.1, 451.3, 493.8 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 345| 473| 406.7| 1| 1| 1
| 100| 200000| 351| 414| 372.6| 0.98| 1.14| 1.09
| 100| 300000| 358| 799| 420.5| 0.98| 0.52| 0.89
| 100| 400000| 371| 741| 431| 0.96| 1.08| 0.98
| 100| 500000| 359| 824| 459.7| 1.03| 0.9| 0.94
| 100| 600000| 385| 1308| 495.5| 0.93| 0.63| 0.93
| 100| 700000| 364| 869| 446.1| 1.06| 1.51| 1.11
| 100| 800000| 357| 1090| 475.1| 1.02| 0.8| 0.94
| 100| 900000| 359| 832| 451.3| 0.99| 1.31| 1.05
| 100| 1000000| 368| 1460| 493.8| 0.98| 0.57| 0.91
|===

include::bench-dedicated-list-filter---sort-search-footnote.adoc[]

== {list-plain}: {search}

include::bench-dedicated-list-plain-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 130, 137, 126, 121, 134, 130, 119, 132, 129, 124 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 167, 162, 157, 164, 178, 192, 164, 162, 180, 165 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 146.1, 149.1, 142.8, 141.7, 141.6, 150.5, 137.4, 145.1, 144.3, 139.7 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 130| 167| 146.1| 1| 1| 1
| 1| 200000| 137| 162| 149.1| 0.95| 1.03| 0.98
| 1| 300000| 126| 157| 142.8| 1.09| 1.03| 1.04
| 1| 400000| 121| 164| 141.7| 1.04| 0.96| 1.01
| 1| 500000| 134| 178| 141.6| 0.9| 0.92| 1
| 1| 600000| 130| 192| 150.5| 1.03| 0.93| 0.94
| 1| 700000| 119| 164| 137.4| 1.09| 1.17| 1.1
| 1| 800000| 132| 162| 145.1| 0.9| 1.01| 0.95
| 1| 900000| 129| 180| 144.3| 1.02| 0.9| 1.01
| 1| 1000000| 124| 165| 139.7| 1.04| 1.09| 1.03
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 157, 159, 165, 176, 179, 147, 149, 163, 165, 173 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 262, 197, 205, 222, 197, 215, 216, 214, 212, 233 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 192.9, 178.4, 186.3, 193, 187.7, 188, 187.2, 184.4, 183, 197.2 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 157| 262| 192.9| 1| 1| 1
| 10| 200000| 159| 197| 178.4| 0.99| 1.33| 1.08
| 10| 300000| 165| 205| 186.3| 0.96| 0.96| 0.96
| 10| 400000| 176| 222| 193| 0.94| 0.92| 0.97
| 10| 500000| 179| 197| 187.7| 0.98| 1.13| 1.03
| 10| 600000| 147| 215| 188| 1.22| 0.92| 1
| 10| 700000| 149| 216| 187.2| 0.99| 1| 1
| 10| 800000| 163| 214| 184.4| 0.91| 1.01| 1.02
| 10| 900000| 165| 212| 183| 0.99| 1.01| 1.01
| 10| 1000000| 173| 233| 197.2| 0.95| 0.91| 0.93
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 221, 210, 205, 217, 216, 220, 207, 208, 198, 211 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 262, 258, 273, 260, 245, 285, 303, 263, 274, 260 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 236.5, 233.9, 242.9, 235.8, 231.7, 241.9, 250.7, 238.8, 236.9, 232 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 221| 262| 236.5| 1| 1| 1
| 50| 200000| 210| 258| 233.9| 1.05| 1.02| 1.01
| 50| 300000| 205| 273| 242.9| 1.02| 0.95| 0.96
| 50| 400000| 217| 260| 235.8| 0.94| 1.05| 1.03
| 50| 500000| 216| 245| 231.7| 1| 1.06| 1.02
| 50| 600000| 220| 285| 241.9| 0.98| 0.86| 0.96
| 50| 700000| 207| 303| 250.7| 1.06| 0.94| 0.96
| 50| 800000| 208| 263| 238.8| 1| 1.15| 1.05
| 50| 900000| 198| 274| 236.9| 1.05| 0.96| 1.01
| 50| 1000000| 211| 260| 232| 0.94| 1.05| 1.02
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 351, 334, 340, 349, 343, 354, 340, 347, 324, 327 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 450, 392, 396, 427, 416, 415, 415, 424, 424, 395 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 391.3, 359.8, 370.1, 386.4, 376.5, 386.8, 391.7, 379.3, 380.5, 363.1 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 351| 450| 391.3| 1| 1| 1
| 100| 200000| 334| 392| 359.8| 1.05| 1.15| 1.09
| 100| 300000| 340| 396| 370.1| 0.98| 0.99| 0.97
| 100| 400000| 349| 427| 386.4| 0.97| 0.93| 0.96
| 100| 500000| 343| 416| 376.5| 1.02| 1.03| 1.03
| 100| 600000| 354| 415| 386.8| 0.97| 1| 0.97
| 100| 700000| 340| 415| 391.7| 1.04| 1| 0.99
| 100| 800000| 347| 424| 379.3| 0.98| 0.98| 1.03
| 100| 900000| 324| 424| 380.5| 1.07| 1| 1
| 100| 1000000| 327| 395| 363.1| 0.99| 1.07| 1.05
|===

include::bench-dedicated-list-plain-search-footnote.adoc[]

== {list-sort}: {search}

include::bench-dedicated-list-sort-search-intro.adoc[]


=== {dimension-x} 1

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 136, 135, 136, 132, 131, 134, 134, 135, 126, 138 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 213, 171, 286, 834, 416, 481, 638, 591, 184, 670 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 155.6, 146.7, 164.5, 214.8, 171.8, 195.8, 198.6, 193.1, 150.7, 198.7 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 1| 100000| 136| 213| 155.6| 1| 1| 1
| 1| 200000| 135| 171| 146.7| 1.01| 1.25| 1.06
| 1| 300000| 136| 286| 164.5| 0.99| 0.6| 0.89
| 1| 400000| 132| 834| 214.8| 1.03| 0.34| 0.77
| 1| 500000| 131| 416| 171.8| 1.01| 2| 1.25
| 1| 600000| 134| 481| 195.8| 0.98| 0.86| 0.88
| 1| 700000| 134| 638| 198.6| 1| 0.75| 0.99
| 1| 800000| 135| 591| 193.1| 0.99| 1.08| 1.03
| 1| 900000| 126| 184| 150.7| 1.07| 3.21| 1.28
| 1| 1000000| 138| 670| 198.7| 0.91| 0.27| 0.76
|===

=== {dimension-x} 10

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 175, 157, 191, 159, 172, 181, 182, 170, 182, 144 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 296, 205, 340, 485, 410, 441, 575, 629, 403, 732 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 205.2, 180.9, 217, 220.4, 224.4, 230.2, 227.4, 232.2, 220.4, 246 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 10| 100000| 175| 296| 205.2| 1| 1| 1
| 10| 200000| 157| 205| 180.9| 1.11| 1.44| 1.13
| 10| 300000| 191| 340| 217| 0.82| 0.6| 0.83
| 10| 400000| 159| 485| 220.4| 1.2| 0.7| 0.98
| 10| 500000| 172| 410| 224.4| 0.92| 1.18| 0.98
| 10| 600000| 181| 441| 230.2| 0.95| 0.93| 0.97
| 10| 700000| 182| 575| 227.4| 0.99| 0.77| 1.01
| 10| 800000| 170| 629| 232.2| 1.07| 0.91| 0.98
| 10| 900000| 182| 403| 220.4| 0.93| 1.56| 1.05
| 10| 1000000| 144| 732| 246| 1.26| 0.55| 0.9
|===

=== {dimension-x} 50

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 225, 203, 217, 220, 209, 220, 230, 205, 230, 217 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 289, 284, 409, 524, 532, 539, 703, 248, 492, 879 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 245.6, 238.3, 266.6, 265.1, 272.3, 271.4, 286.3, 234, 268.9, 308.8 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 50| 100000| 225| 289| 245.6| 1| 1| 1
| 50| 200000| 203| 284| 238.3| 1.11| 1.02| 1.03
| 50| 300000| 217| 409| 266.6| 0.94| 0.69| 0.89
| 50| 400000| 220| 524| 265.1| 0.99| 0.78| 1.01
| 50| 500000| 209| 532| 272.3| 1.05| 0.98| 0.97
| 50| 600000| 220| 539| 271.4| 0.95| 0.99| 1
| 50| 700000| 230| 703| 286.3| 0.96| 0.77| 0.95
| 50| 800000| 205| 248| 234| 1.12| 2.83| 1.22
| 50| 900000| 230| 492| 268.9| 0.89| 0.5| 0.87
| 50| 1000000| 217| 879| 308.8| 1.06| 0.56| 0.87
|===

=== {dimension-x} 100

image::https://quickchart.io/chart?bkg=white&c={ 'type': 'line', 'data': { 'labels': [ '100000', '200000', '300000', '400000', '500000', '600000', '700000', '800000', '900000', '1000000' ], 'datasets': [ { 'label': 'Min', 'data': [ 363, 352, 347, 385, 396, 377, 377, 407, 406, 380 ], 'fill': false, 'borderColor': 'rgb(67, 170, 139)' }, { 'label': 'Max', 'data': [ 546, 422, 820, 810, 809, 1050, 881, 1378, 669, 1578 ], 'fill': false, 'borderColor': 'rgb(226, 70, 70)' }, { 'label': 'Avg', 'data': [ 416.5, 384.5, 446.6, 458.8, 487.4, 492.9, 458.9, 527.5, 460.7, 522.4 ], 'fill': false, 'borderColor': 'rgb(117, 141, 155)' } ] }}[width=500,role="data-zoomable"]

[cols="1s,1s,1m,1m,1m,1m,1m,1m"]
|===
| Field Count| Pre-Created Record Count| Min| Max| Avg| Min Delta| Max Delta| Avg Delta

| 100| 100000| 363| 546| 416.5| 1| 1| 1
| 100| 200000| 352| 422| 384.5| 1.03| 1.29| 1.08
| 100| 300000| 347| 820| 446.6| 1.01| 0.51| 0.86
| 100| 400000| 385| 810| 458.8| 0.9| 1.01| 0.97
| 100| 500000| 396| 809| 487.4| 0.97| 1| 0.94
| 100| 600000| 377| 1050| 492.9| 1.05| 0.77| 0.99
| 100| 700000| 377| 881| 458.9| 1| 1.19| 1.07
| 100| 800000| 407| 1378| 527.5| 0.93| 0.64| 0.87
| 100| 900000| 406| 669| 460.7| 1| 2.06| 1.14
| 100| 1000000| 380| 1578| 522.4| 1.07| 0.42| 0.88
|===

include::bench-dedicated-list-sort-search-footnote.adoc[]


# src/modules/generated/partials/benchmarks/variables.adoc

:bench-classic: Benchmark for Shared Tables
:bench-dedicated: Benchmark for Dedicated Tables
:crud-operations: CRUD Operation
:crud-create: Create
:crud-lookup: Lookup
:crud-update: Update
:crud-delete: Delete
:dimension-x: Number of Fields

:list-filter: Filtering Records
:list-sort: Sorting Records
:list-plain: Listing Records
:list-filter---sort: Filtering and Sorting Records
:search: Searching

# src/modules/generated/partials/env-options.gen.adoc

//
// This file is auto-generated.
//

include::ROOT:partial$variables.adoc[]
= Connection to data store backend

== *DB_DSN*

=== Type

`string`


=== Default

[source]
----
sqlite3://file::memory:?cache=shared&mode=memory
----
=== Description

Database connection string.
= HTTP Client

== *HTTP_CLIENT_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
30s
----
=== Description

Default timeout for clients.

== *HTTP_CLIENT_TLS_INSECURE*

=== Type

`bool`


=== Description

Allow insecure (invalid, expired TLS/SSL certificates) connections.

[IMPORTANT]
====
We strongly recommend keeping this value set to false except for local development or demos.
====
= HTTP Server

== *HTTP_ADDR*

=== Type

`string`


=== Default

[source]
----
:80
----
=== Description

IP and port for the HTTP server.

== *HTTP_API_BASE_URL*

=== Type

`string`


=== Default

[source]
----
/
----
=== Description

When webapps are enabled (HTTP_WEBAPP_ENABLED) this is moved to '/api' if not explicitly set otherwise.
API base URL is internaly prefixed with baseUrl

== *HTTP_API_ENABLED*

=== Type

`bool`



== *HTTP_SERVER_ASSETS_PATH*

=== Type

`string`


=== Description

Corteza will directly serve these assets (static files).
When empty path is set (default value), embedded files are used.

== *HTTP_BASE_URL*

=== Type

`string`


=== Default

[source]
----
/
----
=== Description

Base URL (prefix) for all routes (<baseUrl>/auth, <baseUrl>/api, ...)

== *DOMAIN*

=== Type

`string`


=== Default

[source]
----
localhost
----
=== Description

Domain for the HTTP server.

== *DOMAIN_WEBAPP*

=== Type

`string`


=== Default

[source]
----
localhost
----
=== Description

Domain for the HTTP webapp.

== *HTTP_ENABLE_DEBUG_ROUTE*

=== Type

`bool`


=== Description

Enable `/debug` route.

== *HTTP_ENABLE_HEALTHCHECK_ROUTE*

=== Type

`bool`



== *HTTP_METRICS*

=== Type

`bool`


=== Description

Enable (prometheus) metrics.

== *HTTP_REPORT_PANIC*

=== Type

`bool`


=== Description

Report HTTP panic to Sentry.

== *HTTP_ENABLE_VERSION_ROUTE*

=== Type

`bool`


=== Description

Enable `/version` route.

== *HTTP_LOG_REQUEST*

=== Type

`bool`


=== Description

Log HTTP requests.

== *HTTP_LOG_RESPONSE*

=== Type

`bool`


=== Description

Log HTTP responses.

== *HTTP_METRICS_PASSWORD*

=== Type

`string`


=== Description

Password for the metrics endpoint.

== *HTTP_METRICS_NAME*

=== Type

`string`


=== Default

[source]
----
corteza
----
=== Description

Name for metrics endpoint.

== *HTTP_METRICS_USERNAME*

=== Type

`string`


=== Default

[source]
----
metrics
----
=== Description

Username for the metrics endpoint.

== *HTTP_SSL_TERMINATED*

=== Type

`bool`


=== Description

Is SSL termination enabled in ingres, proxy or load balancer that is in front of Corteza?
By default, Corteza checks for presence of LETSENCRYPT_HOST environmental variable.
This DOES NOT enable SSL termination in Cortreza!

== *HTTP_ERROR_TRACING*

=== Type

`bool`



== *HTTP_SERVER_WEB_CONSOLE_ENABLED*

=== Type

`bool`


=== Description

Enable web console. When running in dev environment, web console is enabled by default.

== *HTTP_SERVER_WEB_CONSOLE_PASSWORD*

=== Type

`string`


=== Description

Password for the web console endpoint. When running in dev environment, password is not required.

Corteza intentionally sets default password to random chars to prevent security incidents.

== *HTTP_SERVER_WEB_CONSOLE_USERNAME*

=== Type

`string`


=== Default

[source]
----
admin
----
=== Description

Username for the web console endpoint.

== *HTTP_WEBAPP_BASE_DIR*

=== Type

`string`


=== Default

[source]
----
./webapp/public
----

== *HTTP_WEBAPP_BASE_URL*

=== Type

`string`


=== Default

[source]
----
/
----
=== Description

Webapp base URL is internaly prefixed with baseUrl

== *HTTP_WEBAPP_ENABLED*

=== Type

`bool`



== *HTTP_WEBAPP_LIST*

=== Type

`string`


=== Default

[source]
----
admin,compose,workflow,reporter
----
= RBAC options

== *RBAC_ANONYMOUS_ROLES*

=== Type

`string`


=== Default

[source]
----
anonymous
----
=== Description

Space delimited list of role handles.
These roles are automatically assigned to anonymous user.
Memberships can not be managed for these roles.

== *RBAC_AUTHENTICATED_ROLES*

=== Type

`string`


=== Default

[source]
----
authenticated
----
=== Description

Space delimited list of role handles.
These roles are automatically assigned to authenticated user.
Memberships can not be managed for these roles.
System will refuse to start if roles listed here are also listed under anonymous roles

== *RBAC_BYPASS_ROLES*

=== Type

`string`


=== Default

[source]
----
super-admin
----
=== Description

Space delimited list of role handles.
These roles causes short-circuiting access control check and allowing all operations.
System will refuse to start if check-bypassing roles are also listed as authenticated or anonymous auto-assigned roles.

== *RBAC_LOG*

=== Type

`bool`


=== Description

Log RBAC related events and actions

== *RBAC_SERVICE_USER*

=== Type

`string`


= SCIM Server

== *SCIM_BASE_URL*

=== Type

`string`


=== Default

[source]
----
/scim
----
=== Description

Prefix for SCIM API endpoints

== *SCIM_ENABLED*

=== Type

`bool`


=== Description

Enable SCIM subsystem

== *SCIM_EXTERNAL_ID_AS_PRIMARY*

=== Type

`bool`


=== Description

Use external IDs in SCIM API endpoints

== *SCIM_EXTERNAL_ID_VALIDATION*

=== Type

`string`


=== Default

[source]
----
^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$
----
=== Description

Validates format of external IDs. Defaults to UUID

== *SCIM_SECRET*

=== Type

`string`


=== Description

Secret to use to validate requests on SCIM API endpoints
= Email sending

== *SMTP_FROM*

=== Type

`string`


=== Description

The SMTP `from` email parameter

== *SMTP_HOST*

=== Type

`string`


=== Description

The SMTP server hostname.

== *SMTP_PASS*

=== Type

`string`


=== Description

The SMTP password.

== *SMTP_PORT*

=== Type

`int`


=== Description

The SMTP post.

== *SMTP_TLS_INSECURE*

=== Type

`bool`


=== Description

Allow insecure (invalid, expired TLS certificates) connections.

== *SMTP_TLS_SERVER_NAME*

=== Type

`string`



== *SMTP_USER*

=== Type

`string`


=== Description

The SMTP username.
= Actionlog

== *ACTIONLOG_DEBUG*

=== Type

`bool`



== *ACTIONLOG_ENABLED*

=== Type

`bool`



== *ACTIONLOG_WORKFLOW_FUNCTIONS_ENABLED*

=== Type

`bool`


= API Gateway

== *APIGW_DEBUG*

=== Type

`bool`


=== Description

Enable API Gateway debugging info

== *APIGW_ENABLED*

=== Type

`bool`


=== Description

Enable API Gateway

== *APIGW_LOG_ENABLED*

=== Type

`bool`


=== Description

Enable extra logging

== *APIGW_LOG_REQUEST_BODY*

=== Type

`bool`


=== Description

Enable incoming request body output in logs

== *APIGW_PROFILER_ENABLED*

=== Type

`bool`


=== Description

Enable profiler

== *APIGW_PROFILER_GLOBAL*

=== Type

`bool`


=== Description

Profiler enabled for all routes

== *APIGW_PROXY_ENABLE_DEBUG_LOG*

=== Type

`bool`


=== Description

Enable full debug log on requests / responses - warning, includes sensitive data

== *APIGW_PROXY_FOLLOW_REDIRECTS*

=== Type

`bool`


=== Description

Follow redirects on proxy requests

== *APIGW_PROXY_OUTBOUND_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
30s
----
=== Description

Outbound request timeout
= Authentication

== *AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME*

=== Type

`time.Duration`


=== Default

[source]
----
2h
----
=== Description

Lifetime of the access token. Should be shorter than lifetime of the refresh token.

== *AUTH_ASSETS_PATH*

=== Type

`string`


=== Description

Path to js, css, images and template source files

When corteza starts, if path exists it tries to load template files from it.

When empty path is set (default value), embedded files are used.

== *AUTH_BASE_URL*

=== Type

`string`


=== Description

Frontend base URL. Must be an absolute URL, with the domain.
This is used for some redirects and links in auth emails.

== *AUTH_CSRF_COOKIE_NAME*

=== Type

`string`


=== Default

[source]
----
same-site-authenticity-token
----
=== Description

Cookie name used for CSRF protection

== *AUTH_CSRF_ENABLED*

=== Type

`bool`


=== Description

Enable CSRF protection

== *AUTH_CSRF_FIELD_NAME*

=== Type

`string`


=== Default

[source]
----
same-site-authenticity-token
----
=== Description

Form field name used for CSRF protection

== *AUTH_CSRF_SECRET*

=== Type

`string`


=== Description

Secret used for securing CSRF protection

[IMPORTANT]
====
If secret is not set, system auto-generates one from DB_DSN and HOSTNAME environment variables.
Generated secret will change if you change any of these variables.
====

== *AUTH_DEFAULT_CLIENT*

=== Type

`string`


=== Default

[source]
----
corteza-webapp
----
=== Description

Handle for OAuth2 client used for automatic redirect from /auth/oauth2/go endpoint.

This simplifies configuration for OAuth2 flow for Corteza Web applications as it removes
the need to suply redirection URL and client ID (oauth2/go endpoint does that internally)


== *AUTH_DEVELOPMENT_MODE*

=== Type

`bool`


=== Description

When enabled, corteza reloads template before every execution.
Enable this for debugging or when developing auth templates.

Should be disabled in production where templates do not change between server restarts.

== *AUTH_EXTERNAL_COOKIE_SECRET*

=== Type

`string`


=== Description

Secret used for securing cookies

[IMPORTANT]
====
If secret is not set, system auto-generates one from DB_DSN and HOSTNAME environment variables.
Generated secret will change if you change any of these variables.
====

== *AUTH_EXTERNAL_REDIRECT_URL*

=== Type

`string`


=== Description

Redirect URL to be sent with OAuth2 authentication request to provider

`provider` placeholder is replaced with the actual value when used.

== *AUTH_GARBAGE_COLLECTOR_INTERVAL*

=== Type

`time.Duration`


=== Default

[source]
----
15min
----
=== Description

How often are expired sessions and tokens purged from the database

== *AUTH_JWT_ALGORITHM*

=== Type

`string`


=== Default

[source]
----
HS512
----
=== Description

Algoritm to be use for JWT signature.

Supported valus:
 - HS256, HS384, HS512
 - PS256, PS384, PS512,
 - RS256, RS384, RS512

Provide shared secret string for HS256, HS384, HS512 and full private key or path to the file PS* and RS* algorithms.

== *AUTH_JWT_KEY*

=== Type

`string`


=== Description

Raw private key or absolute or relative path to the file containing one.

== *AUTH_LOG_ENABLED*

=== Type

`bool`


=== Description

Enable extra logging for authentication flows

== *AUTH_PASSWORD_SECURITY*

=== Type

`bool`


=== Description

Password security allows you to disable constraints to which passwords must conform to.

[CAUTION]
====
Disabling password security can be useful for development environments as it removes the need for complex passwords.
Password security *should be enabled* on production environments to avoid security incidents
====

== *AUTH_PROVISION_SUPER_USER*

=== Type

`string`


=== Description

When set, Corteza creates one or more users with the configured values using provided email as a password.
It skips existing (email, handle). All new users are assigned to all bypass roles.

When set in production, Corteza stops and reports an error

== *AUTH_OAUTH2_REFRESH_TOKEN_LIFETIME*

=== Type

`time.Duration`


=== Default

[source]
----
72h
----
=== Description

Lifetime of the refresh token. Should be much longer than lifetime of the access token.

Refresh tokens are used to exchange expired access tokens with new ones.

== *AUTH_REQUEST_RATE_LIMIT*

=== Type

`int`


=== Default

[source]
----
60
----
=== Description

How many requests from a cerain IP address are allowed in a time window.
Set to zero to disable

== *AUTH_REQUEST_RATE_WINDOW_LENGTH*

=== Type

`time.Duration`


=== Default

[source]
----
1m
----
=== Description

How many requests from a cerain IP address are allowed in a time window

== *AUTH_JWT_SECRET*

=== Type

`string`


=== Description

Secret used for signing JWT tokens.
Value is used only when HS256, HS384 or HS512 algorithm is used.

[IMPORTANT]
====
If secret is not set, system auto-generates one from DB_DSN and HOSTNAME environment variables.
Generated secret will change if you change any of these variables.
====

== *AUTH_SESSION_COOKIE_DOMAIN*

=== Type

`string`


=== Description

Session cookie domain

== *AUTH_SESSION_COOKIE_NAME*

=== Type

`string`


=== Default

[source]
----
session
----
=== Description

Session cookie name

== *AUTH_SESSION_COOKIE_PATH*

=== Type

`string`


=== Description

Session cookie path

== *AUTH_SESSION_COOKIE_SECURE*

=== Type

`bool`


=== Description

Defaults to true when HTTPS is used. Corteza will try to guess the this setting by

== *AUTH_SESSION_LIFETIME*

=== Type

`time.Duration`


=== Default

[source]
----
24h
----
=== Description

Maximum time user is allowed to stay idle when logged in without "remember-me" option and before session is expired.

Recomended value is between an hour and a day.

[IMPORTANT]
====
This affects only profile (/auth) pages. Using applications (admin, compose, ...) does not prolong the session.
====


== *AUTH_SESSION_PERM_LIFETIME*

=== Type

`time.Duration`


=== Default

[source]
----
8640h
----
=== Description

Duration of the session in /auth lasts when user logs-in with "remember-me" option.

If set to 0, "remember-me" option is removed.
= Connection to Corredor

== *CORREDOR_ADDR*

=== Type

`string`


=== Default

[source]
----
localhost:50051
----
=== Description

Hostname and port of the Corredor gRPC server.

== *CORREDOR_DEFAULT_EXEC_TIMEOUT*

=== Type

`time.Duration`



== *CORREDOR_ENABLED*

=== Type

`bool`


=== Description

Enable/disable Corredor integration

== *CORREDOR_LIST_REFRESH*

=== Type

`time.Duration`



== *CORREDOR_LIST_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
2s
----

== *CORREDOR_MAX_BACKOFF_DELAY*

=== Type

`time.Duration`


=== Default

[source]
----
1m
----
=== Description

Max delay for backoff on connection.

== *CORREDOR_MAX_RECEIVE_MESSAGE_SIZE*

=== Type

`int`


=== Description

Max message size that can be recived.

== *CORREDOR_RUN_AS_ENABLED*

=== Type

`bool`



== *CORREDOR_CLIENT_CERTIFICATES_CA*

=== Type

`string`


=== Default

[source]
----
ca.crt
----

== *CORREDOR_CLIENT_CERTIFICATES_ENABLED*

=== Type

`bool`



== *CORREDOR_CLIENT_CERTIFICATES_PATH*

=== Type

`string`


=== Default

[source]
----
/certs/corredor/client
----

== *CORREDOR_CLIENT_CERTIFICATES_PRIVATE*

=== Type

`string`


=== Default

[source]
----
private.key
----

== *CORREDOR_CLIENT_CERTIFICATES_PUBLIC*

=== Type

`string`


=== Default

[source]
----
public.crt
----

== *CORREDOR_CLIENT_CERTIFICATES_SERVER_NAME*

=== Type

`string`


= Environment

== *ENVIRONMENT*

=== Type

`string`


=== Default

[source]
----
production
----
= Events and scheduler

== *EVENTBUS_SCHEDULER_ENABLED*

=== Type

`bool`


=== Description

Enable eventbus scheduler.

== *EVENTBUS_SCHEDULER_INTERVAL*

=== Type

`time.Duration`


=== Default

[source]
----
60s
----
=== Description

Set time interval for `eventbus` scheduler.
= federation

== *FEDERATION_SYNC_DATA_MONITOR_INTERVAL*

=== Type

`time.Duration`


=== Default

[source]
----
1m
----
=== Description

Delay in seconds for data sync

== *FEDERATION_SYNC_DATA_PAGE_SIZE*

=== Type

`int`


=== Default

[source]
----
100
----
=== Description

Bulk size in fetching for data sync

== *FEDERATION_ENABLED*

=== Type

`bool`


=== Description

Federation enabled on system, it toggles rest API endpoints, possibility to map modules in Compose and sync itself

== *FEDERATION_HOST*

=== Type

`string`


=== Default

[source]
----
local.cortezaproject.org
----
=== Description

Host that is used during node pairing, also included in invitation

== *FEDERATION_LABEL*

=== Type

`string`


=== Default

[source]
----
federated
----
=== Description

Federation label

== *FEDERATION_SYNC_STRUCTURE_MONITOR_INTERVAL*

=== Type

`time.Duration`


=== Default

[source]
----
2m
----
=== Description

Delay in seconds for structure sync

== *FEDERATION_SYNC_STRUCTURE_PAGE_SIZE*

=== Type

`int`


=== Default

[source]
----
1
----
=== Description

Bulk size in fetching for structure sync
= Limits

== *LIMIT_SYSTEM_USERS*

=== Type

`int`


=== Description

Maximum number of valid (not deleted, not suspended) users
= locale

== *LOCALE_DEVELOPMENT_MODE*

=== Type

`bool`


=== Description

When enabled, Corteza reloads language files on every request
Enable this for debugging or developing.

== *LOCALE_LANGUAGES*

=== Type

`string`


=== Default

[source]
----
en
----
=== Description

List of compa delimited languages (language tags) to enable.
In case when an enabled language can not be loaded, error is logged.

When loading language configurations (config.xml) from the configured path(s).


== *LOCALE_LOG*

=== Type

`bool`


=== Description

Log locale related events and actions

== *LOCALE_PATH*

=== Type

`string`


=== Description

	One or more paths to locale config and translation files, separated by colon

	When with LOCALE_DEVELOPMENT_MODE=true, default value for path is ../../locale

== *LOCALE_QUERY_STRING_PARAM*

=== Type

`string`


=== Default

[source]
----
lng
----
=== Description

Name of the query string parameter used to pass the language tag (it overrides Accept-Language header).
Set it to empty string to disable detection from the query string.
This parameter is ignored if only one language is enabled


== *LOCALE_RESOURCE_TRANSLATIONS_ENABLED*

=== Type

`bool`


=== Description

When enabled, an editor for resource translations is enabled in UI
= log

== *LOG_DEBUG*

=== Type

`bool`


=== Description

Disables json format for logging and enables more human-readable output with colors.

Disable for production.


== *LOG_FILTER*

=== Type

`string`


=== Description

Log filtering rules by level and name (log-level:log-namespace).
Please note that level (LOG_LEVEL) is applied before filter and it affects the final output!

Leave unset for production.

Example:
`warn+:* *:auth,workflow.*`
Log warnings, errors, panic, fatals. Everything from auth and workflow is logged.


See more examples and documentation here: https://github.com/moul/zapfilter


== *LOG_INCLUDE_CALLER*

=== Type

`bool`


=== Description

Set to true to see where the logging was called from.

Disable for production.


== *LOG_LEVEL*

=== Type

`string`


=== Default

[source]
----
warn
----
=== Description

Minimum logging level. If set to "warn",
Levels warn, error, dpanic panic and fatal will be logged.

Recommended value for production: warn

Possible values: debug, info, warn, error, dpanic, panic, fatal


== *LOG_STACKTRACE_LEVEL*

=== Type

`string`


=== Default

[source]
----
dpanic
----
=== Description

Include stack-trace when logging at a specified level or below.
Disable for production.

Possible values: debug, info, warn, error, dpanic, panic, fatal

= Messaging queue

== *MESSAGEBUS_ENABLED*

=== Type

`bool`


=== Description

Enable messagebus

== *MESSAGEBUS_LOG_ENABLED*

=== Type

`bool`


=== Description

Enable extra logging for messagebus watchers
= Monitoring

== *MONITOR_INTERVAL*

=== Type

`time.Duration`


=== Default

[source]
----
5m
----
=== Description

Output (log) interval for monitoring.
= Object (file) storage

== *MINIO_ACCESS_KEY*

=== Type

`string`



== *MINIO_BUCKET*

=== Type

`string`


=== Default

[source]
----
{component}
----
=== Description

`component` placeholder is replaced with service name (e.g system).

== *MINIO_ENDPOINT*

=== Type

`string`



== *MINIO_PATH_PREFIX*

=== Type

`string`


=== Description

`component` placeholder is replaced with service name (e.g system).

== *MINIO_SSEC_KEY*

=== Type

`string`



== *MINIO_SECRET_KEY*

=== Type

`string`



== *MINIO_SECURE*

=== Type

`bool`



== *MINIO_STRICT*

=== Type

`bool`



== *STORAGE_PATH*

=== Type

`string`


=== Default

[source]
----
var/store
----
=== Description

Location where uploaded files are stored.
= Provisioning

== *PROVISION_ALWAYS*

=== Type

`bool`


=== Description

Controls if provision should run when the server starts.

== *PROVISION_PATH*

=== Type

`string`


=== Default

[source]
----
provision/*
----
=== Description

Colon seperated paths to config files for provisioning.
= Sentry monitoring

== *SENTRY_DSN*

=== Type

`string`


=== Description

Set to enable Sentry client.

== *SENTRY_ATTACH_STACKTRACE*

=== Type

`bool`


=== Description

Attach stacktraces

== *SENTRY_DEBUG*

=== Type

`bool`


=== Description

Print out debugging information.

== *SENTRY_DIST*

=== Type

`string`


=== Description

Set reported distribution.

== *SENTRY_ENVIRONMENT*

=== Type

`string`


=== Description

Set reported environment.

== *SENTRY_MAX_BREADCRUMBS*

=== Type

`int`


=== Description

Maximum number of bredcrumbs.

== *SENTRY_RELEASE*

=== Type

`string`


=== Description

Set reported Release.

== *SENTRY_SAMPLE_RATE*

=== Type

`float64`


=== Description

Sample rate for event submission (0.0 - 1.0. defaults to 1.0)

== *SENTRY_SERVERNAME*

=== Type

`string`


=== Description

Set reported Server name.

== *SENTRY_WEBAPP_DSN*

=== Type

`string`


=== Description

Set to enable Sentry client for webapp.
= Rendering engine

== *TEMPLATE_RENDERER_GOTENBERG_ADDRESS*

=== Type

`string`


=== Description

Gotenberg rendering container address.

== *TEMPLATE_RENDERER_GOTENBERG_ENABLED*

=== Type

`bool`


=== Description

Is Gotenberg rendering container enabled.
= Data store (database) upgrade

== *UPGRADE_ALWAYS*

=== Type

`bool`


=== Description

Controls if the upgradable systems should be upgraded when the server starts.

== *UPGRADE_DEBUG*

=== Type

`bool`


=== Description

Enable/disable debug logging.
    To enable debug logging set `UPGRADE_DEBUG=true`.
= Delay system startup

== *WAIT_FOR*

=== Type

`time.Duration`


=== Description

Delays API startup for the amount of time specified (10s, 2m...).
    This delay happens before service (`WAIT_FOR_SERVICES`) probing.

== *WAIT_FOR_SERVICES*

=== Type

`string`


=== Description

Space delimited list of hosts and/or URLs to probe.
    Host format: `host` or `host:443` (port will default to 80).

[NOTE]
====
Services are probed in parallel.
====

== *WAIT_FOR_SERVICES_PROBE_INTERVAL*

=== Type

`time.Duration`


=== Default

[source]
----
5s
----
=== Description

Interval between service probes.

== *WAIT_FOR_SERVICES_PROBE_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
30s
----
=== Description

Timeout for each service probe.

== *WAIT_FOR_SERVICES_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
1m
----
=== Description

Max time for each service probe.

== *WAIT_FOR_STATUS_PAGE*

=== Type

`bool`


=== Description

Show temporary status web page.
= Websocket server

== *WEBSOCKET_LOG_ENABLED*

=== Type

`bool`


=== Description

Enable extra logging for authentication flows

== *WEBSOCKET_PING_PERIOD*

=== Type

`time.Duration`


=== Default

[source]
----
119s
----

== *WEBSOCKET_PING_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
120s
----

== *WEBSOCKET_TIMEOUT*

=== Type

`time.Duration`


=== Default

[source]
----
15s
----
=== Description

Time before `WsServer` gets timed out.
= Workflow

== *WORKFLOW_CALL_STACK_SIZE*

=== Type

`int`


=== Description

Defines the maximum call stack size between workflows

== *WORKFLOW_EXEC_DEBUG*

=== Type

`bool`


=== Description

Enables verbose logging for workflow execution

== *WORKFLOW_REGISTER*

=== Type

`bool`


=== Description

Registers enabled and valid workflows and executes them when triggered

== *WORKFLOW_STACK_TRACE_ENABLED*

=== Type

`bool`


=== Description

Enables execution stack trace construction

== *WORKFLOW_STACK_TRACE_FULL*

=== Type

`bool`


=== Description

Forces the stack trace to record all steps
= Discovery

== *DISCOVERY_BASE_URL*

=== Type

`string`


=== Description

Indicates host of corteza discovery server

== *DISCOVERY_CORTEZA_DOMAIN*

=== Type

`string`


=== Description

Indicates host of corteza compose webapp

== *DISCOVERY_DEBUG*

=== Type

`bool`


=== Description

Enable discovery related activity info

== *DISCOVERY_ENABLED*

=== Type

`bool`


=== Description

Enable discovery endpoints
= attachment

== *AVATAR_INITIALS_BACKGROUND_COLOR*

=== Type

`string`


=== Default

[source]
----
#F3F3F3
----
=== Description

Avatar initials background color

== *AVATAR_INITIALS_COLOR*

=== Type

`string`


=== Default

[source]
----
#162425
----
=== Description

Avatar initials text color

== *AVATAR_INITIALS_FONT_PATH*

=== Type

`string`


=== Default

[source]
----
fonts/Poppins-Regular.ttf
----
=== Description

Avatar initials font file path

== *ATTACHMENT_AVATAR_MAX_FILE_SIZE*

=== Type

`int64`


=== Description

Avatar image maximum upload size, default value is 1MB
= webapp

== *WEBAPP_SCSS_DIR_PATH*

=== Type

`string`


=== Description

Path to custom SCSS source files directory


# src/modules/generated/partials/expr-types.gen.adoc

// This file is auto-generated.
//
// Changes to this file may cause incorrect behavior and will be lost if
// the code is regenerated.
//
// Definitions file that controls how this file is generated:
//  - automation/automation/expr_types.yaml
//  - compose/automation/expr_types.yaml
//  - pkg/expr/expr_types.yaml
//  - system/automation/expr_types.yaml

[cols="2m,3a"]
|===
| Type | Structure

| [#objref-attachment]#<<objref-attachment,Attachment>>#
|
[source]
----
{
   ID (ID)
   kind (String)
   url (Handle)
   previewUrl (Handle)
   name (Handle)
   createdAt (DateTime)
   updatedAt (DateTime)
   deletedAt (DateTime)
}
----

| [#objref-composemodule]#<<objref-composemodule,ComposeModule>>#
|
[source]
----
{
   ID (ID)
   namespaceID (ID)
   name (String)
   handle (Handle)
   labels (KV)
   createdAt (DateTime)
   updatedAt (DateTime)
   deletedAt (DateTime)
}
----

| [#objref-composenamespace]#<<objref-composenamespace,ComposeNamespace>>#
|
[source]
----
{
   ID (ID)
   name (String)
   slug (Handle)
   labels (KV)
   createdAt (DateTime)
   updatedAt (DateTime)
   deletedAt (DateTime)
}
----

| [#objref-composerecord]#<<objref-composerecord,ComposeRecord>>#
|
[source]
----
{
   ID (ID)
   moduleID (ID)
   namespaceID (ID)
   values (ComposeRecordValues)
   meta (Meta)
   ownedBy (ID)
   createdAt (DateTime)
   createdBy (ID)
   updatedAt (DateTime)
   updatedBy (ID)
   deletedAt (DateTime)
   deletedBy (ID)
}
----


| [#objref-httprequest]#<<objref-httprequest,HttpRequest>>#
|
[source]
----
{
   Method (String)
   URL (Url)
   Header (KVV)
   Body (Reader)
   Form (KVV)
   PostForm (KVV)
}
----


| [#objref-queuemessage]#<<objref-queuemessage,QueueMessage>>#
|
[source]
----
{
   Queue (String)
   Payload (Bytes)
}
----

| [#objref-rendereddocument]#<<objref-rendereddocument,RenderedDocument>>#
|
[source]
----
{
   document (Reader)
   name (string)
   type (string)
}
----

| [#objref-role]#<<objref-role,Role>>#
|
[source]
----
{
   ID (ID)
   name (String)
   handle (Handle)
   labels (KV)
   createdAt (DateTime)
   updatedAt (DateTime)
   archivedAt (DateTime)
   deletedAt (DateTime)
}
----

| [#objref-template]#<<objref-template,Template>>#
|
[source]
----
{
   ID (ID)
   handle (Handle)
   language (String)
   type (DocumentType)
   partial (Boolean)
   meta (TemplateMeta)
   template (String)
   labels (KV)
   ownerID (ID)
   createdAt (DateTime)
   updatedAt (DateTime)
   deletedAt (DateTime)
   lastUsedAt (DateTime)
}
----

| [#objref-templatemeta]#<<objref-templatemeta,TemplateMeta>>#
|
[source]
----
{
   short (String)
   description (String)
}
----

| [#objref-user]#<<objref-user,User>>#
|
[source]
----
{
   ID (ID)
   username (String)
   email (String)
   name (String)
   handle (Handle)
   emailConfirmed (Boolean)
   labels (KV)
   createdAt (DateTime)
   updatedAt (DateTime)
   suspendedAt (DateTime)
   deletedAt (DateTime)
}
----


|===


# src/modules/generated/partials/resource-events.gen.adoc

// This file is auto-generated.
//
// Changes to this file may cause incorrect behavior and will be lost if
// the code is regenerated.
//
// Definitions file that controls how this file is generated:
//  - compose/service/event/events.yaml
//  - system/service/event/events.yaml

= Resources and events

== compose

=== Events

.On events:
* `on('manual')`
* `on('interval')`
* `on('timestamp')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:module

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `module`
| `*types.Module`
| yes

| `oldModule`
| `*types.Module`
| no

| `namespace`
| `*types.Namespace`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:namespace

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `namespace`
| `*types.Namespace`
| yes

| `oldNamespace`
| `*types.Namespace`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:page

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `page`
| `*types.Page`
| yes

| `oldPage`
| `*types.Page`
| no

| `namespace`
| `*types.Namespace`
| no

| `selected`
| `[]interface{}`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:page-layout

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `pageLayout`
| `*types.PageLayout`
| yes

| `oldPageLayout`
| `*types.PageLayout`
| no

| `namespace`
| `*types.Namespace`
| no

| `selected`
| `[]interface{}`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:record

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `before('undelete')`
* `after('create')`
* `after('update')`
* `after('delete')`
* `after('undelete')`

.On events:
* `on('manual')`
* `on('iteration')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `record`
| `*types.Record`
| yes

| `oldRecord`
| `*types.Record`
| no

| `module`
| `*types.Module`
| no

| `namespace`
| `*types.Namespace`
| no

| `recordValueErrors`
| `*types.RecordValueErrorSet`
| yes

| `selected`
| `[]interface{}`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system

=== Events

.On events:
* `on('manual')`
* `on('interval')`
* `on('timestamp')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `invoker`
| `auth.Identifiable`
| yes
|===

== system:application

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `application`
| `*types.Application`
| yes

| `oldApplication`
| `*types.Application`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:auth

=== Events
.Before/after events:
* `before('login')`
* `before('signup')`
* `after('login')`
* `after('signup')`



=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `user`
| `*types.User`
| yes

| `provider`
| `*types.AuthProvider`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:auth-client

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `authClient`
| `*types.AuthClient`
| yes

| `oldAuthClient`
| `*types.AuthClient`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:data-privacy-request

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `dataPrivacyRequest`
| `*types.DataPrivacyRequest`
| yes

| `oldDataPrivacyRequest`
| `*types.DataPrivacyRequest`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:mail

=== Events

.On events:
* `on('manual')`
* `on('receive')`
* `on('send')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `message`
| `*types.MailMessage`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:queue

=== Events

.On events:
* `on('message')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `payload`
| `*types.QueueMessage`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:role

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `role`
| `*types.Role`
| yes

| `oldRole`
| `*types.Role`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:role:member

=== Events
.Before/after events:
* `before('add')`
* `before('remove')`
* `after('add')`
* `after('remove')`



=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `user`
| `*types.User`
| yes

| `role`
| `*types.Role`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:sink

=== Events

.On events:
* `on('request')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `response`
| `*types.SinkResponse`
| yes

| `request`
| `*types.SinkRequest`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:user

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `before('suspend')`
* `after('create')`
* `after('update')`
* `after('delete')`
* `after('suspend')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `user`
| `*types.User`
| yes

| `oldUser`
| `*types.User`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===


# src/modules/integrator-guide/nav.adoc

* xref:index.adoc[]

** xref:authentication/index.adoc[]
*** xref:authentication/mfa.adoc[]
*** xref:authentication/authenticate-external/index.adoc[]
**** xref:authentication/authenticate-external/with-corteza.adoc[]
*** xref:authentication/personalization.adoc[]
*** xref:authentication/session-duration.adoc[]
*** xref:authentication/external/index.adoc[]
**** xref:authentication/external/google.adoc[]
**** xref:authentication/external/facebook.adoc[]
**** xref:authentication/external/github.adoc[]
**** xref:authentication/external/linkedin.adoc[]
**** xref:authentication/external/saml/index.adoc[]
***** xref:authentication/external/saml/okta.adoc[Okta]

** xref:security-model/index.adoc[]
*** xref:security-model/users.adoc[]
*** xref:security-model/roles.adoc[]
*** xref:security-model/permissions-evaluation.adoc[]
*** References
**** xref:security-model/references/contextual-role-parameters.adoc[]
**** xref:security-model/references/operations.adoc[]
*** xref:security-model/examples/index.adoc[]
**** xref:security-model/examples/examples-contextual.adoc[]

** xref:create-application.adoc[]

** xref:i18n/index.adoc[]
*** xref:i18n/static.adoc[]
*** xref:i18n/resource.adoc[]

** xref:accessing-corteza/index.adoc[]
*** xref:accessing-corteza/api-clients.adoc[]
*** xref:accessing-corteza/pagination.adoc[]
*** xref:accessing-corteza/ql.adoc[]
// @todo cleanup
*** Examples
**** xref:accessing-corteza/examples/compose-records.adoc[]
**** xref:accessing-corteza/examples/compose-records-bulk.adoc[]
**** xref:accessing-corteza/examples/compose-attachments.adoc[]

** xref:compose-configuration/index.adoc[]
*** xref:compose-configuration/page-layouts.adoc[]
*** xref:compose-configuration/record-revisions.adoc[]
*** xref:compose-configuration/record-storage.adoc[]
*** xref:compose-configuration/record-modal.adoc[]
*** xref:compose-configuration/import-export.adoc[]
*** xref:compose-configuration/duplication-detection.adoc[]
*** xref:compose-configuration/field-types.adoc[]
*** xref:compose-configuration/page-blocks.adoc[]
*** xref:compose-configuration/examples/index.adoc[]
**** xref:compose-configuration/examples/record-filtering-nested.adoc[]
// @todo cleanup
// *** Examples
// **** xref:compose-configuration/examples/page-blocks/index.adoc[]
// **** xref:compose-configuration/examples/field-expressions.adoc[]

** xref:corteza-studio/index.adoc[]

** xref:dal-connections/index.adoc[]
*** xref:dal-connections/connection-management.adoc[]
*** xref:dal-connections/troubleshooting.adoc[]

** Data Privacy
*** xref:data-privacy/sensitivity-levels.adoc[]

** xref:automation/index.adoc[]
*** xref:automation/execution-flow-details.adoc[]
*** xref:automation/workflows/index.adoc[]
**** Scaling
***** xref:automation/workflows/scaling/sub-workflows.adoc[]
**** xref:automation/workflows/execution-lifecycle.adoc[]
**** xref:automation/workflows/style-guide.adoc[]
**** xref:automation/workflows/best-practices.adoc[]
**** xref:automation/workflows/scope-in-depth.adoc[]
**** xref:workflows/record-selection.adoc[]
**** xref:automation/workflows/automation-scripts.adoc[]
**** xref:automation/workflows/email-send.adoc[]
**** xref:automation/workflows/testing-debugging.adoc[]
**** References
***** xref:automation/workflows/func-reference.adoc[]
***** xref:automation/workflows/types.adoc[]
**** xref:automation/workflows/examples/index.adoc[]
***** xref:automation/workflows/examples/interval.adoc[]
***** xref:automation/workflows/examples/timestamp.adoc[]
***** xref:automation/workflows/examples/email-attachment.adoc[]
***** xref:automation/workflows/examples/gw-parse-payload.adoc[]
***** xref:automation/workflows/examples/record.adoc[]
***** xref:automation/workflows/examples/template-rendering.adoc[]
***** xref:automation/workflows/examples/parallelism.adoc[]
***** xref:automation/workflows/examples/dynamic-config.adoc[]
***** xref:automation/workflows/examples/execution-timeout.adoc[]
***** xref:automation/workflows/examples/messagebus-read-write.adoc[]

*** xref:automation/automation-scripts/index.adoc[]
**** xref:automation/automation-scripts/node-modules.adoc[]
**** xref:automation/automation-scripts/edit-built-in-scripts.adoc[]
**** xref:automation/automation-scripts/testing.adoc[]
**** xref:automation/automation-scripts/deploying.adoc[]
**** xref:automation/automation-scripts/debugging.adoc[]
**** xref:automation/automation-scripts/corredor-helpers.adoc[]
**** References
***** xref:automation/automation-scripts/references/resource-events.adoc[]
***** xref:automation/automation-scripts/references/resource-constraints/index.adoc[]
**** Samples
***** xref:automation/automation-scripts/samples/triggers/index.adoc[]
***** xref:automation/automation-scripts/samples/server-scripts/index.adoc[]
***** xref:automation/automation-scripts/samples/client-scripts/index.adoc[]

** xref:api-gw/index.adoc[]
*** xref:api-gw/profiler.adoc[]
*** xref:api-gw/javascript-processing.adoc[]
*** xref:api-gw/workflow-processing.adoc[]

** xref:discovery/index.adoc[]
*** xref:discovery/examples/index.adoc[]
**** xref:discovery/examples/limit-namespace.adoc[]

** xref:reporting/index.adoc[]
*** xref:reporting/expr-reference.adoc[]
*** xref:reporting/prefilter.adoc[]
*** xref:reporting/presort.adoc[]

** xref:expr/index.adoc[]
*** xref:expr/fnc-reference.adoc[]
**** xref:expr/string-formatting.adoc[]
**** xref:expr/datetime-formatting.adoc[]
*** xref:expr/type-reference.adoc[]

** xref:templates/index.adoc[]
*** xref:templates/variables.adoc[]
** xref:server-plugins/index.adoc[]
// *** Examples
// **** ...

** xref:federation/index.adoc[]
*** xref:federation/nodes.adoc[]
*** xref:federation/share-data.adoc[]

** Troubleshooting
*** xref:troubleshooting/stale-data.adoc[]
*** xref:troubleshooting/logging.adoc[]

** xref:miscellaneous.adoc[]

// ** xref:provisioning/index.adoc[]
// *** ...
// *** Samples
// **** ...


# src/modules/integrator-guide/pages/accessing-corteza/api-clients.adoc

include::ROOT:partial$variables.adoc[]

= API Clients
:keywords: API, {PRODUCT_NAME} API, SDK, API client
:description: Learn how to use the pre-defined API clients to interact with {PRODUCT_NAME}

{PRODUCT_NAME} defines a series of JavaScript API clients (SDK's) to work with our API.

[TIP]
====
When writing automation scripts, API clients are provided in the xref:integrator-guide:automation/automation-scripts/index.adoc#execution-context[execution context].
====

You can find the source code on https://github.com/cortezaproject/corteza-js[GitHub/cortezaproject/corteza-js].
NPM packages can be found on https://www.npmjs.com/package/@cortezaproject/corteza-js[NPM/@cortezaproject/corteza-js].

When using our `corteza-js` package, the API clients can be imported using `import { apiClients } from '@cortezaproject/corteza-js'`.

.Available {PRODUCT_NAME} API clients:
* https://github.com/cortezaproject/corteza-js/blob/2021.3.x/src/api-clients/system.ts[`apiClients.System`]
* https://github.com/cortezaproject/corteza-js/blob/2021.3.x/src/api-clients/compose.ts[`apiClients.Compose`]
* https://github.com/cortezaproject/corteza-js/blob/2021.3.x/src/api-clients/automation.ts[`apiClients.Automation`]
* https://github.com/cortezaproject/corteza-js/blob/2021.3.x/src/api-clients/federation.ts[`apiClients.Federation`]

[NOTE]
====
Please refer to the source code for a complete reference.
====


# src/modules/integrator-guide/pages/accessing-corteza/examples/compose-attachments.adoc

include::ROOT:partial$variables.adoc[]

= Working with {APP_NAME_COMPOSE} Attachments

include::partial$api-example-note.adoc[]

== Obtain a Signed Download URL

.Obtain signed URL using attachment read or attachment list endpoints:
* attachment read: `GET $BASE_URL/compose/namespace/$NAMESPACE_ID/attachment/record/$ATTACHMENT_ID`
* attachment list: `GET $BASE_URL/compose/namespace/$NAMESPACE_ID/attachment/record`

.Response object structure:
[source,json]
----
{
  "attachmentID": "$ATTACHMENT_ID",
  "ownerID": "$USER_ID",
  "url": "$ATTACHMENT_ORIGINAL_URL",<1>
  "previewUrl": "$ATTACHMENT_PREVIEW_URL",<2>
  "name": "$FILENAME_ORIGINAL",
  "meta": {...},
  "namespaceID": "$NAMESPACE_ID"
}
----
<1> `url` contains a signed URL to the attachment.
<2> `previewUrl` contains a signed URL to the preview version of the attachment (when available).

=== Example Request

[source,bash]
----
curl "$BASE_URL/compose/namespace/$NAMESPACE_ID/attachment/record/$ATTACHMENT_ID" \
 -H "Authorization: Bearer $JWT";
----

=== Example Response

[source,json]
----
{
  "response": {
    "attachmentID": "$ATTACHMENT_ID",
    "ownerID": "$USER_ID",
    "url": "$ATTACHMENT_ORIGINAL_URL",
    "previewUrl": "$ATTACHMENT_PREVIEW_URL",
    "name": "$FILENAME_ORIGINAL",
    "meta": {...},
    "namespaceID": "$NAMESPACE_ID"
  }
}
----

== Access the Attachment

Use the `$ATTACHMENT_ORIGINAL_URL` to access any downloadable attachment.
You can either download the attachment manually, use a HTTP client (such as Axios), or display the attachment using `<img src="..."` or something similar.


# src/modules/integrator-guide/pages/accessing-corteza/examples/compose-records-bulk.adoc

include::ROOT:partial$variables.adoc[]

= Bulk {APP_NAME_COMPOSE} Record Operations

{PRODUCT_NAME} allows you to create create, update or update multiple records with one request.

== Creating Bulk Records

A bulk payload where records only define their values create a new record for each entry.

[source,bash]
----
curl -X POST "$BASE_URL/api/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  -H 'content-type: application/json' \
  --data-raw '{
    "records": [{
      "set": [
        {"values":[{"name":"f1","value":"a"},{"name":"f1","value":"b"}]},
        {"values":[{"name":"f1","value":"a"},{"name":"f1","value":"b"}]}
      ]
    }]
  }' \
  --compressed
----

* `$BASE_URL` is the URL to your {PRODUCT_NAME} instance (e.g. `https://corteza.mydomain.tld`),
* `$NAMESPACE_ID` is the namespace identifier for which you wish to create records (e.g. `257934065070534659`),
* `$MODULE_ID` is the module identifier for which you wish to create records (e.g. `257934099950366723`),
* `$JWT` is the access token to authorize the request.

== Updating Bulk Records

A bulk payload where records define their `recordID` and their values will update existing records and their values.

[CAUTION]
====
{PRODUCT_NAME} removes any value omitted from the request for the updated record from the existing record.
If you wish to preserve it, you must provide the information in the request.
====

[source,bash]
----
curl -X POST "$BASE_URL/api/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  -H 'content-type: application/json' \
  --data-raw '{
    "records": [{
      "set": [
        {"recordID": "257936153397719043", "values":[{"name":"f1","value":"a edited"},{"name":"f1","value":"b edited"}]},
        {"recordID": "257936153565556739", "values":[{"name":"f1","value":"a edited"},{"name":"f1","value":"b edited 2"}]}
      ]
    }]
}' \
  --compressed
----

* `$BASE_URL` is the URL to your {PRODUCT_NAME} instance (e.g. `https://corteza.mydomain.tld`),
* `$NAMESPACE_ID` is the namespace identifier for which you wish to update records (e.g. `257934065070534659`),
* `$MODULE_ID` is the module identifier for which you wish to update records (e.g. `257934099950366723`),
* `$RECORD_ID_*` is the `recordID` for which you wish to update (e.g. `257936153397719043`),
* `$JWT` is the access token to authorize the request.

== Deleting Bulk Records

A bulk payload where records define their `recordID` and a `deletedAt` timestamp deletes the specified records and their values.

[source,bash]
----
curl -X POST "$BASE_URL/api/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  -H 'content-type: application/json' \
  --data-raw '{
    "records": [{
      "set": [
        { "recordID": "$RECORD_ID_0", "deletedAt": "2021-11-15T09:49:22Z" },
        { "recordID": "$RECORD_ID_1", "deletedAt": "2021-11-15T09:49:22Z" },
        { "recordID": "$RECORD_ID_2", "deletedAt": "2021-11-15T09:49:22Z" }
      ]
    }]
}' \
  --compressed
----

* `$BASE_URL` is the URL to your {PRODUCT_NAME} instance (e.g. `https://corteza.mydomain.tld`),
* `$NAMESPACE_ID` is the namespace identifier for which you wish to delete records (e.g. `257934065070534659`),
* `$MODULE_ID` is the module identifier for which you wish to delete records (e.g. `257934099950366723`),
* `$RECORD_ID_*` is the `recordID` for which you wish to delete (e.g. `257936153397719043`),
* `$JWT` is the access token to authorize the request.


# src/modules/integrator-guide/pages/accessing-corteza/examples/compose-records.adoc

include::ROOT:partial$variables.adoc[]

= Working With {APP_NAME_COMPOSE} Records

== Listing Records

To search over records for a specific module, use the `GET $BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/` endpoint.

Refer to the xref:accessing-corteza/index.adoc#api-endpoints[documentation] on how to get the complete reference.

[source,bash]
----
curl -X GET "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  --compressed;
----

[source,json]
----
{
  "response": {
    "filter": {
      "moduleID": "$MODULE_ID",
      "namespaceID": "$NAMESPACE_ID",
      "query": "",
      "deleted": 0,
      "sort": "id"
    },
    "set": [
      {}
    ]
  }
}
----

== Filtering Records

To search over records for a specific module, use the `GET $BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/` endpoint with the `query` query parameter.

Refer to the xref:accessing-corteza/index.adoc#api-endpoints[documentation] on how to get the complete reference.

[source,bash]
----
curl -X GET "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/?query=f2='value+2'" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  --compressed;
----

[source,json]
----
{
  "response": {
    "filter": {
      "moduleID": "$MODULE_ID",
      "namespaceID": "$NAMESPACE_ID",
      "query": "f2='value 2'",
      "deleted": 0,
      "sort": "id"
    },
    "set": [
      {}
    ]
  }
}
----

== Filtering Records With Missing Values

A record value can have two states -- *existing* and *nonexisting*.
When the value is *nonexisting*, it is `NULL`.

To exemplify; a checkbox field can either be `true`, `false`, and `NULL`, therefore we three values are recognized instead of two.

.The following examples use three records:
* `{ "name": "a", "good": true }`
* `{ "name": "b", "good": false }`
* `{ "name": "c", "good": NULL }`

=== Finding Records Where the Value Is `NULL`

[source,bash]
----
curl "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/?query=good+IS+NULL" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  --compressed;
----

[source,json]
----
{
    "response": {
        "filter": {
            "moduleID": "$MODULE_ID",
            "namespaceID": "$NAMESPACE_ID",
            "query": "good IS NULL",
            "deleted": 0,
            "sort": "id"
        },
        "set": [
            {
                "recordID": "$RECORD_ID",
                "moduleID": "$MODULE_ID",
                "values": [
                    {
                        "name": "name",
                        "value": "c"
                    }
                ],
                "namespaceID": "$NAMESPACE_ID"
            }
        ]
    }
}
----

=== Finding Records Where the Value Is `NULL` or `false`

[source,bash]
----
curl "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/?query=good+IS+NULL+OR+good=false" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  --compressed | pp_json;
----

[source,json]
----
{
    "response": {
        "filter": {
            "moduleID": "$MODULE_ID",
            "namespaceID": "$NAMESPACE_ID",
            "query": "good IS NULL OR good=false",
            "deleted": 0,
            "sort": "id"
        },
        "set": [
            {
                "recordID": "$RECORD_ID",
                "moduleID": "$MODULE_ID",
                "values": [
                    {
                        "name": "good"
                    },
                    {
                        "name": "name",
                        "value": "b"
                    }
                ],
                "namespaceID": "$NAMESPACE_ID"
            },
            {
                "recordID": "$RECORD_ID",
                "moduleID": "$MODULE_ID",
                "values": [
                    {
                        "name": "name",
                        "value": "c"
                    }
                ],
                "namespaceID": "$NAMESPACE_ID"
            }
        ]
    }
}
----

== Updating Records

To update a specific record for a specific module, use the `POST $BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID` endpoint.

The record update API endpoint sets record values to exactly what was provided in the request.
If you wish to update only specific fields, first fetch the original record, change the desired values, then update the record.

The fields you omit in the request are removed from the record (value sanitation, automation, and other system processes may still define the value).

=== Example of Omitting Existing Values

.The following request sets the second field and resets the first (already populated) one:
[source,bash]
----
curl -X POST "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID" \
  -H 'Accept: application/json, text/plain, */*' \
  -H "Authorization: Bearer $JWT" \
  -H 'Content-Type: application/json' \
  --data-raw '{ "values": [
    { "name": "f2", "value": "value 2" }
  ]}
' \
  --compressed
----

.The following response is produced by the above request:
[source,json]
----
{
  "response": {
    "recordID": "$RECORD_ID",
    "moduleID": "$MODULE_ID",
    "values": [
      { "name": "f2", "value": "value 2" }
    ],
    "namespaceID": "$NAMESPACE_ID"
  }
}
----

=== Example of Preserving Existing Values

.The following request sets the second field and preserves the first (already populated) one:
[source,bash]
----
curl -X POST "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID" \
  -H 'Accept: application/json, text/plain, */*' \
  -H "Authorization: Bearer $JWT" \
  -H 'Content-Type: application/json' \
  --data-raw '{ "values": [
    { "name": "f1", "value": "value 1" },
    { "name": "f2", "value": "value 2" }
  ]}
' \
  --compressed
----

.The following response is produced by the above request:
[source,json]
----
{
  "response": {
    "recordID": "$RECORD_ID",
    "moduleID": "$MODULE_ID",
    "values": [
      { "name": "f1", "value": "value 1" },
      { "name": "f2", "value": "value 2" }
    ],
    "namespaceID": "$NAMESPACE_ID"
  }
}
----

== Creating Records

To search over records for a specific module, use the `POST $BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/` endpoint.

Refer to the xref:accessing-corteza/index.adoc#api-endpoints[documentation] on how to get the complete reference.

[source,bash]
----
curl -X POST "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  -H 'Content-Type: application/json' \
  --data-raw '{ "values": [
    { "name": "f1", "value": "value 1" },
    { "name": "f2", "value": "value 2" }
  ]}' \
  --compressed;
----

[source,json]
----
{
  "response": {
    "recordID": "RECORD_ID",
    "moduleID": "MODULE_ID",
    "values": [
      { "name": "f1", "value": "value 1" },
      { "name": "f2", "value": "value 2" }
    ],
    "namespaceID": "NAMESPACE_ID"
  }
}
----

== Read records

To search over records for a specific module, use the `GET $BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID` endpoint.

Refer to the xref:accessing-corteza/index.adoc#api-endpoints[documentation] on how to get the complete reference.

[source,bash]
----
curl -X GET "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  --compressed;
----

[source,json]
----
{
  "response": {
    "recordID": "RECORD_ID",
    "moduleID": "MODULE_ID",
    "values": [
      { "name": "f1", "value": "value 1" },
      { "name": "f2", "value": "value 2" }
    ],
    "namespaceID": "NAMESPACE_ID"
  }
}

----

== Deleting Records

To search over records for a specific module, use the `DELETE $BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID` endpoint.

Refer to the xref:accessing-corteza/index.adoc#api-endpoints[documentation] on how to get the complete reference.

[source,bash]
----
curl -X DELETE "$BASE_URL/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/$RECORD_ID" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  --compressed;
----

[source,json]
----
{ "success": { "message": "OK" } }
----


# src/modules/integrator-guide/pages/accessing-corteza/examples/system/index.adoc

include::ROOT:partial$variables.adoc[]

= System API

[IMPORTANT]
====
Any operation doable via the front-end application is doable via the API; either a single endpoint or a combination of.
====

The system API is responsible for core system resources such as users and roles.
It is also responsible for core operations such as authentication.

[TIP]
====
Whenever an operation affects the system and is not specific to any of our applications, you will most likely need to use the system API
====

[IMPORTANT]
====
We omit most of the data returned by these endpoints.
We replace the important data with variables, such as `$JWT` so that we can copy-paste these examples over any environment.
====

* *URL path*: `/system`,
* *alias*: `$SystemAPI`,


# src/modules/integrator-guide/pages/accessing-corteza/examples/system/sending-emails.adoc

include::ROOT:partial$variables.adoc[]

= Sending emails

To send an email to a recipient or a set of, call the `POST $ComposeAPI/notification/email/send` endpoint.

[NOTE]
====
Refer to the API reference to find all the available parameters.
====

[IMPORTANT]
====
Make sure that you've properly configured your environment with the SMTP credentials.
====


== Example request

[source,bash]
----
curl "$ComposeAPI/notification/email" \
  -H "Authorization: Bearer $JWT" \
  --data "{
    \"to\": [\"$USER_EMAIL\"],
    \"subject\": \"Test CURL email\",
    \"content\": { \"html\": \"<div>Test Content</div>\" }
  }"
----

== Example response

[source,json]
----
{
  "response": true
}
----


# src/modules/integrator-guide/pages/accessing-corteza/index.adoc

include::ROOT:partial$variables.adoc[]

= Accessing {PRODUCT_NAME}
:keywords: API, {PRODUCT_NAME} API, {PRODUCT_NAME}
:description: Learn how to access {PRODUCT_NAME} using it's API-centric design

{PRODUCT_NAME} separates the back-end business logic and the front-end user interface by defining an API that the clients (web applications and other custom applications) can access.

{PRODUCT_NAME} is API-centric, meaning that everything can be done via an API endpoint.

[#authentication]
== Authentication

{PRODUCT_NAME} uses bearer JWT tokens when authenticating HTTP requests.

[WARNING]
====
JWT tokens grant access to your system, so treat them as login credentials.
====

=== Obtaining Access Tokens

Before you can obtain the access token, you need to define an *auth client*, and a *system user*.
You can use an existing user (such as yourself), or create a dedicated user.

[CAUTION]
====
Make sure that the system user has sufficient roles to be able to access resources which you wish to access.
====

Create a new auth client with the `client_credentials` grant type.
Insert the ID of the selected user under the "Impersonate user" (the user that is mentioned above).

[IMPORTANT]
====
Make sure that you are using {PRODUCT_NAME} xref:ROOT:changelog/202103.adoc#p2021_3_4[2021.3.4] or any subsequent versions.
====

If the user's ID is not set or is not valid, an `Error: "auth client security configuration invalid"` error is returned.

.Use the following cURL request example to fetch the access token:
[source,bash]
----
curl -X POST $CORTEZA_URL/auth/oauth2/token \
     -d grant_type=client_credentials \
     -d scope=api \
     -u <client id>:<client secret>
----

.An example of the cURL request:
[source,bash]
----
curl -X POST $CORTEZA_URL/auth/oauth2/token \
     -d grant_type=client_credentials \
     -d scope=api \
     -u 229978909641277628:sMVVcYpXE6bOUm6gG0sJGKmDOzEgkYyhvKyrmcU9fGY8M4GhLd90lThZDxUUFLC9
----

.An example response object:
[source,json]
----
{
  "access_token": "ey...MsLA",
  "expires_in": 7200,
  "refresh_token_expires_in": 0,
  "scope": "api",
  "sub": "229974909641277121",
  "token_type": "Bearer"
}
----

[CAUTION]
====
The above token expires after two hours; make sure to fetch a new one when necessary.
====

=== Using Access Tokens

Each HTTP request to a *protected resource* must provide the bearer JWT token in the `authorization` header.

.Unauthorized requests yield an error response of:
[source,json]
----
{
  "error": {
    "message": "Unauthorized"
  }
}
----

.An example cURL with authentication:
[source,bash]
----
curl "$CORTEZA_URL" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT";
----

.An example cURL without authentication:
[source,bash]
----
curl "$CORTEZA_URL" \
  -H 'accept: application/json, text/plain, */*';
----

// @todo update/assure the bellow list
//
// Most of the endpoints exposed by {PRODUCT_NAME} are protected except for the ones listed in the table below.

// .System endpoints with alternative request authentication:
// [cols="1m,5a"]
// |===
// | Endpoint | Other authentication methods

// | `GET /attachment/\{kind}/\{attachmentID}/original/\{name}`
// | System generated signature.

// | `GET /attachment/\{kind}/\{attachmentID}/preview.\{ext}`
// | System generated signature.

// // ----

// | `GET /auth/`
// | None.

// | `GET /auth/check`
// | None.

// | `POST /auth/exchange`
// | None.

// | `GET /auth/logout`
// | None.

// | `POST /auth/internal/login`
// | None.

// | `POST /auth/internal/signup`
// | None.

// | `POST /auth/internal/request-password-reset`
// | None.

// | `POST /auth/internal/exchange-password-reset-token`
// | System generated password reset token.

// | `POST /auth/internal/reset-password`
// | System generated password reset token.

// | `POST /auth/internal/confirm-email`
// | System generated token.

// // ----

// | `* /sink/*`
// | System generated sink signature.

// |===

.{PRODUCT_NAME} {APP_NAME_COMPOSE} endpoints with alternative request authentication:
[cols="1m,5a"]
|===
| Endpoint | Other authentication methods

| `GET /namespace/\{namespaceID}/attachment/\{kind}/\{attachmentID}/original/\{name}`
| System generated signature.

| `GET /namespace/\{namespaceID}/attachment/\{kind}/\{attachmentID}/preview.\{ext}`
| System generated signature.

|===

.{PRODUCT_NAME} {APP_NAME_FEDERATION} endpoints with alternative request authentication:
[cols="1m,5a"]
|===
| Endpoint | Other authentication methods

| `POST /nodes/\{nodeID}/handshake`
| System generated OTT token.

|===

[#api-endpoints]
== Endpoints

Each {PRODUCT_NAME} instance ships with a built-in API reference that is accessible on the `/docs` endpoint of your {PRODUCT_NAME} API.

[NOTE]
====
If you are using a *different sub-domain* for your API (two separate Docker containers for web app and API), the URL should look something like `https://api.$BASE_URL/docs`.

If you are using *the same domain* for your API (a single Docker container for web app and API), the URL should look something like `https://$BASE_URL/api/docs`.
====
//Editor's note: you could add a hyperlink to the word "this" - like you do oin some other instances.

Here endpoints used for debugging and maintenance are covered.
Refer to the built-in API reference for the complete list of available endpoints.

[TIP]
====
You can use https://latest.cortezaproject.org/api/docs/[community instance] API reference.
====

In addition to the API reference mentioned above, these are the system-level endpoints that need to be explicitly enabled.
They can be enabled for development or debugging but should be disabled when running in production.

.System-level Endpoints:
[cols="1m,5a"]
|===
| Option | Endpoints

| HTTP_ENABLE_DEBUG_ROUTE
|
* `/__profiler` provides server runtime profiling data in the format expected by the pprof visualization tool.
* `/__routes` provides a list of all registered routes.
* `/__eventbus` presents a list of all registered automation script triggers.
* `/__corredor` presents a list of all registered automation scripts.

| HTTP_ENABLE_VERSION_ROUTE
|
* `/version` shows the build time and the {PRODUCT_NAME} version.

| HTTP_ENABLE_HEALTHCHECK_ROUTE
|
* `/healthcheck` performs and displays the system health check.

|===

[#response-format]
== Response Data Format

{PRODUCT_NAME} implements three different response formats based on what you are trying to do, and based on the status.

[IMPORTANT]
====
Error responses use the status code 200 OK, instead of the standard 4xx/5xx -- legacy reasons.
Our API clients cover this case and throw correct errors.
====

.The different response formats:
[cols="2a,5a"]
|===
| [#response-single-items]#<<response-single-items,Working with single items>>#
|

When working with single items, the item (or its status) is provided in the response object.

.Example:
[source,json]
----
{
  "response": {...}
}
----

| [#response-multiple-items]#<<response-multiple-items,Working with multiple items>>#
|

When working with multiple items, the list of items is provided in the response array along with the filter object.

.Example:
[source,json]
----
{
  "response": {
    "filter": {...},
    "set": [...]
  }
}
----

[NOTE]
====
The structure of the `filter` property differs based on the resource.
In general, it specifies what filters were applied to the responding set.
====

| [#response-errors]#<<response-errors,Encountered an error>>#
|

When an error occurs, the error message is provided under the `error.message` property.

.Example:
[source,json]
----
{
  "error": {
    "message": "..."
  }
}
----

When you enable error tracing via the `HTTP_ERROR_TRACING` environment variable, the additional error contexts are provided in the `stack` and `wrap` properties.
This can be useful for debugging but should be turned off in production.

.Example:
[source,json]
----
{
  "error": {
    "message": "...",
    "stack": [...],
    "wrap": {...}
  }
}
----

|===


# src/modules/integrator-guide/pages/accessing-corteza/pagination.adoc

include::ROOT:partial$variables.adoc[]

= Pagination
:keywords: API, {PRODUCT_NAME} API, paging, pagination
:description: Learn how to use the page cursor based pagination

When you perform an operation that supports pagination (such as fetching records), see a `filter` object.

.The `filter` object contains:
[source,json]
----
{
  "limit": ...<1>
  "cursor": "..."<2>
  "nextPage": "..."<3>
  "prevPage": "..."<4>
}
----
<1> `limit` (number) specifies the maximum number of items on a page.
<2> `cursor` (string) specifies the cursor to the current page.
<3> `nextPage` (string) specifies the next page (omitted if there is no next page).
<4> `prevPage` (string) specifies the previous page (omitted if there is no previous page).

When you wish to access a specific page, you must provide the `pageCursor=$PAGE_CURSOR` query parameter.
When accessing the next page, `$PAGE_CURSOR` is `filter.nextPage`; when accessing the previous page, `$PAGE_CURSOR` is `filter.prevPage`.

.For example:
[source,bash]
----
curl -X GET "$API_BASE/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/?pageCursor=$PAGE_CURSOR";
----


# src/modules/integrator-guide/pages/accessing-corteza/ql.adoc

include::ROOT:partial$variables.adoc[]

= Query Language
:keywords: API, {PRODUCT_NAME} API, QL, query language, searching
:description: Learn how to use {PRODUCT_NAME}'s query language to filter data

{PRODUCT_NAME} implements an SQL-like syntax for querying and sorting records.

== Querying

.The general template for constructing a query looks like this:
[source]
----
FIELD OPERATOR VALUE [AND|OR FIELD OPERATOR VALUE [...]]
----

****
* `[ ]` indicates that the encapsulated contents are optional.
* `...` means that the current encapsulated content is repeated.
****

For the following examples, let us assume that we have a module named `test` with the following fields:

* `quantity` of type `Number`
* `price` of type `Number`
* `name` of type `String`
* `visible` of type `Checkbox`

.To query for records with zero quantity or zero price:
[source]
----
quantity = 0 or price = zero
----

.To query all visible records starting with the letter "a":
[source]
----
visible AND name LIKE 'a%'
----

=== Comparison operators

Equal::
  * `=`
Not equal::
  * `!=`
  * `<>`
Less than::
  * `<`
Less than or equal to::
 * `\<=`
Greater than::
  * `>`
Greater than or equal to::
  * `>=`
Matches pattern::
  * `LIKE`
Does not match the pattern::
  * `NOT LIKE`

When matching patterns, use `_` to represent a single character; use `%` to represent zero, one, or multiple characters.

=== Arithmetic Operators

Addition::
  * `+`
Subtraction::
  * `-`
Multiplication::
  * `*`
Division::
  * `/`

=== Boolean Operators

* `AND`: true when left and right are true
* `OR`: true when left or right is true

[#query-mv]
=== Multi-value Fields

Filters for multi-value fields look precisely the same as they would for regular fields.

.To exemplify; let us consider a module with the following fields:
* Field name: `users`, field type: `user selector`, multi value option checked.
* Field name: `selects`, field type: `Select / dropdown`, multi value option checked.

.The following table provides a series of examples with the corresponding query and the expected output:
[cols="2s,5m,5a"]
|===
| [#query-mv-example-1]#<<query-mv-example-2,Filter for current user>>#
| users = $\{userID}
| The filter returns the records where either one of the multi-value values matches the current user.

| [#query-mv-example-3]#<<query-mv-example-4,Filter select for pattern>>#
| selects LIKE 'a%'
| The filter returns the records where either one of the multi-value select options matches the `a%` pattern.

| [#query-mv-example-5]#<<query-mv-example-6,Filter select for value>>#
| selects = 'a2'
| The filter returns the records where either one of the multi-value select options equals `a2`.

| [#query-mv-example-6]#<<query-mv-example-6,Filter for concrete users>>#
| 'A' IN users
| The filter returns record/s where either one of the multi-value select options contains `A`.

| [#query-mv-example-7]#<<query-mv-example-7,Filter out concrete users>>#
| 'A' NOT IN users
| The filter returns record/s where either one of the multi-value select options doesn't contain `A`.

|===

== Sorting

.The general template for constructing a sort looks like this:
[source]
----
FIELD[ DIRECTION][, FIELD[ DIRECTION] [...]]
----

****
* `[ ]` indicates that the encapsulated contents are optional.
* `...` means that the current encapsulated content is repeated.
****

.Supported Directions:
* `ASC`: Sort in ascending order, lower values first (`NULL` values come first).
This is the default sort if no `DIRECTION` is specified.
* `DESC`: Sort in ascending order, lower values last (`NULL` values come last).

For the following examples, let us assume that we have a module named `test` with the following fields:

* `quantity` of type `Number`
* `price` of type `Number`
* `name` of type `String`
* `visible` of type `Checkbox`

.To order records, descending by price and ascending by quantity:
[source]
----
price DESC, quantity
----

=== Multi-value Fields

[IMPORTANT]
====
Sorting over multi-value fields is currently not supported.
====

== Utilities

.Supported date functions:
[cols="1s,5a"]
|===
| [#ql-util-fnc-quarter]#<<ql-util-fnc-quarter,`QUARTER`>>#
|
Returns quarter from the given timestamp.

| [#ql-util-fnc-year]#<<ql-util-fnc-year,`YEAR`>>#
|
Returns year from the given timestamp.

| [#ql-util-fnc-date_format]#<<ql-util-fnc-date_format,`DATE_FORMAT`>>#
|
The function returns the date formatted by the provided format.

Reference to xref:expr/datetime-formatting.adoc[date and time formatting]

| [#ql-util-fnc-date]#<<ql-util-fnc-date,`DATE`>>#
|
Returns date from the given timestamp.

|===


# src/modules/integrator-guide/pages/api-gw/index.adoc

include::ROOT:partial$variables.adoc[]

= Integration Gateway
:keywords: integration gateway, API gateway, custom API, custom endpoints, custom API endpoints, sink alternative
:description: Lean how to define custom API endpoints using the integration gateway

The Integration gateway facility allows you to define custom endpoints that can support custom authentication methods, request validation and rate limiting.

[TIP]
====
Integration gateway serves as an alternative to sink endpoints.
====

These endpoints can be used to define a custom endpoint for incoming webhooks, to process data provided by some external integration, or to proxy requests to another service.

Most of the basic operations can be achieved with the built-in functionality; more advanced operations can be implemented with simple JavaScript code snippets or xref:automation/workflows/index.adoc[workflows].

== Defining a New Endpoint

To define a new endpoint, navigate to your {PRODUCT_NAME} instance (for example http://latest.cortezaproject.org/) and click on the "admin area" application.

.The screenshot shows the app selector and the admin area application.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "app-selector.png",
    "alias": "apigw-app-selector-admin",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 540,
    "y": 510,
    "w": 266,
    "h": 218
  },
  "annotations": []
}
----

In the admin area, navigate to the menu:System[Integration Gateway] sub-page.
From the admin area, you can create and update your endpoints, as well as manage their access control.

.The screenshot shows the route list screen.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-list.png",
    "alias": "api-gw-route-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 450
  },
  "annotations": []
}
----

When you click on the btn:[new] button, a new screen will appear where you need to provide the base parameters of your endpoint.

.The screenshot shows the user interface for creating a new endpoint.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-create.png",
    "alias": "api-gw-route-create",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 450
  },
  "annotations": []
}
----

* *Endpoint* defines the path for the endpoint,
* *method* defines the HTTP method for the endpoint.

The endpoint will be accessible under `$BASE_URL/api/gateway$YOUR_ENDPOINT`.
To exemplify; the `/test-endpoint` endpoint for the `https://latest.cortezaproject.org` instance is available as `https://latest.cortezaproject.org/api/gateway/test-endpoint`.

[TIP]
====
You can specify different HTTP methods on the same route, but they need to be specified as different endpoints, ie. `*GET* /customer` and `*PUT* /customer` being two different integration gateway endpoints.
====

When you submit the forum, an additional "filter list" section opens below the base parameters.
These filters allow you to validate and process requests, as well as defining the response.

Subsequent sections explore specific filters in more depth; what they do, and how they should be used.

.The screenshot shows the user interface for attaching filters to the endpoint.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-filters.png",
    "alias": "api-gw-route-filters",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 598,
    "w": 1070,
    "h": 295
  },
  "annotations": []
}
----

== Request Validation

Request validation is done by using *prefilters*.
prefilters allow you to validate the request and determine if the given endpoint should process it.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-filters.png",
    "alias": "api-gw-route-filters-prefilter",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 598,
    "w": 1070,
    "h": 295
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 586,
    "y": 666,
    "w": 110,
    "h": 20
  }]
}
----

[NOTE]
====
It is currently not possible to use the built-in authentication facility to authenticate requests.
This feature will be added in the future.
====

.The list of available prefilters:
[cols="1s,5a"]
|===
| [#filters-prefilter-queryparam]#<<filters-prefilter-queryparam,Query parameters>>#
|
The query parameters prefilter allows you to define a condition which asserts if the request can be processed by this endpoint based on the query parameters.

The query parameters are passed into the expression evaluation engine as they were provided.
To exemplify; the query parameters `?param1=value1&param2=value2` would be referenced as `param1` and `param2` in the expression.

Refer to the xref:expr/index.adoc[expression] reference for details regarding to writing these expressions.

The following example checks whether the given HTTP request defines the `token` query param of `"super-secret-value"`.

.Endpoint definition:
* endpoint: `/test-query`
* method: `GET`
* query parameters prefilter expression: `token == "super-secret-value"`

.An example of an HTTP request that conforms to the filter:
[source,bash]
----
curl -X GET $BASE_URL/api/test-query?token=super-secret-value
----

.An example of an HTTP request that does not conform to the filter:
[source,bash]
----
curl -X GET $BASE_URL/api/test-query?token=some-other-value-i-guessed
----

[CAUTION]
====
Multi-word and multi-value query parameters can not be used currently.
====

| [#filters-prefilter-header]#<<filters-prefilter-header,Header>>#
|
The header prefilter allows you to define a condition which asserts whether the request can be processed by this endpoint based on the request's headers.

All system defined headers are passed into the expression evaluation engine as provided.
User-define headers will automatically be converted into the `snake-case` + `PascalCase` format.
To exemplify; `test-header` becomes `Test-Header` and `test` becomes `Test`.

The following header `test: value` would be referenced as `Test` in the expression.

Refer to the xref:expr/index.adoc[expression] reference for details regarding writing these expressions.

The following example checks if the given HTTP request defines the `Token` header of `"super-secret-value"`.

.Endpoint definition:
* endpoint: `/test-query`
* method: `GET`
* header prefilter expression: `Token == "super-secret-value"`

.An example of an HTTP request that conforms to the filter:
[source,bash]
----
curl -X GET $BASE_URL/api/test-query \
  -H 'Token: super-secret-value'
----

.An example of an HTTP request that does not conform to the filter:
[source,bash]
----
curl -X GET $BASE_URL/api/test-query \
  -H 'Token: some-other-value-i-guessed'
----

[CAUTION]
====
Multi-word and multi-value headers can not be used currently.
====

| [#filters-prefilter-profiler]#<<filters-prefilter-profiler,Profiler>>#
|
The profiler prefilter enables a specific endpoint to gather useful statistics on an incoming route, such as headers, request body, content length, and request URI.

The prefilter can be added after any `Query parameters` or `Header` prefilter in order to enable the request to go through any authentication checks that might exist on a route.

See more on adding a profiler prefilter on the xref:integrator-guide:api-gw/profiler.adoc#profiler-add[profiler page].

|===

== Request Processing

Request processing is done using *processers*.
A processer defines the core business logic that the endpoint performs.
{PRODUCT_NAME} allows you to process arbitrary payloads, such as a structured JSON or a binary attachment.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-filters.png",
    "alias": "api-gw-route-filters-processer",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 598,
    "w": 1070,
    "h": 295
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 699,
    "y": 666,
    "w": 110,
    "h": 20
  }]
}
----

.A list of available processers:
[cols="1s,5a"]
|===
| [#filters-proc-wfexec]#<<filters-proc-wfexec,Workflow processer>>#
|
The workflow processer allows you to bind a xref:automation/workflows/index.adoc[workflow] to the endpoint.
Refer to the xref:api-gw/workflow-processing.adoc[workflow processing] page for details regarding the interaction.

| [#filters-proc-payloadproc]#<<filters-proc-payloadproc,Payload processer>>#
|
The payload processer allows you to handle the request's payload with the help of JavaScript.

Refer to the xref:api-gw/javascript-processing.adoc[] section for more details.

|===

== Response Preparation

Response preparation is done using *postfilters*.
Postfilters allow you to finalize the request lifecycle depending on the result of the processing.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-filters.png",
    "alias": "api-gw-route-filters-postfilter",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 598,
    "w": 1070,
    "h": 295
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 817,
    "y": 666,
    "w": 110,
    "h": 20
  }]
}
----

.A list of available postfilters:
[cols="1s,5a"]
|===
| [#filters-postfilter-redirect]#<<filters-postfilter-redirect,Redirection>>#
|
The redirect postfilter enriches the response payload with the required redirect HTTP headers.

| [#filters-postfilter-json]#<<filters-postfilter-json,Default JSON response>>#
|
The JSON response postfilter enriches the response headers with the `application/json` content type and JSON encodes the processing results.

|===

== Debugging

=== System Logs

Enable debug logging in your `.env` file.
Refer to the xref:devops-guide:references/configuration/server.adoc[DevOps guide] for details.

=== Inspecting Docker Logs

By default, {PRODUCT_NAME} logs are accessible via Docker logs.
To access these logs, you need to firstly navigate to the directory where your {PRODUCT_NAME} instance resides in.

.An example of navigating to the {PRODUCT_NAME} instance directory:
[source,bash]
----
cd /opt/deploy/{CORTEZA_INSTANCE}/
----

You can use the `docker-compose logs server` command to access the logs output by the `server`.

[TIP]
====
Refer to the `docker-compose logs` documentation for available flags.
Using `docker-compose logs -f --tail=20 server` will follow the logs (new logs will be appended at the bottom) and limit the output to last 20 logs.
====

.A truncated example of running the log command:
[source,bash]
----
docker-compose logs -f --tail=20 server

server_1  | 12:53:14.862        DEBUG   rbac    rbac/service.go:102     allow delete for corteza::compose:record/245030892240891907/245030893465497603/246932114543603715       {"bypass": [], "context": [], "common": [245030892072923139], "authenticated": [245030891334791171], "anonymous": [], "identity": 250804535289769987, "indexed": 63, "rules": 420}
----

You can also use `grep` or log filtering to show only specific logs.
Refer to the xref:devops-guide:troubleshooting/logging.adoc[DevOps guide] for details regarding logging.

.An example of using `grep` to show only debug logs:
[source,bash]
----
user@server:/opt/deploy/{CORTEZA_INSTANCE}/$ docker-compose logs -f --tail=20 server | grep DEBUG
server_1  | 13:52:29.636        DEBUG   rbac    rbac/service.go:102     allow triggers.manage for corteza::automation:workflow/248229091554160643
Last updated 2021-09-27 18:01:45 +0200
Some content has been disabled in this document
----


# src/modules/integrator-guide/pages/api-gw/javascript-processing.adoc

include::ROOT:partial$variables.adoc[]

= Process Requests with JavaScript
:keywords: integration gateway javascript, integration gateway JS, integration gateway process code
:description: Lean how to process integration gateway requests using standard JavaScript

The API GW processing filter includes support to process the request using arbitrary JavaScript code.

To process your requests using JavaScript, open the {APP_NAME_ADMIN} web application, navigate to menu:system[integration gateway] and edit the endpoint you wish to define the code for.

Click on the btn:[processing] tab in the filter list and select the btn:[payload processer] option.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/javascript-processing/define.png",
    "alias": "api-gw-javascript-processing-define",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 598,
    "w": 1070,
    "h": 295
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 699,
    "y": 666,
    "w": 110,
    "h": 20
  }, {
    "kind": "box-note",
    "padding": "sm",
    "y": 781,
    "x": 613,
    "w": 137,
    "h": 16
  }]
}
----

When you add the payload processer a pop-up opens presenting the editor.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/javascript-processing/editor.png",
    "alias": "api-gw-javascript-processing-editor",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 578,
    "y": 51,
    "w": 766,
    "h": 253
  },
  "annotations": []
}
----

Type in the JavaScript code snippet you wish to execute.
The provided JavaScript code is automatically wrapped by a function with the signature of:

[source,ts]
----
function (input: Scope): unknown {
  // {{snippet}}
}
----

To exemplify; the code snippet of `return "Hello, world!"` would become:

[source,js]
----
function (input) {
  return "Hello, world!"
}
----

The following example code snippet takes in the provided `name` and `surname` of our users and returns an array of `fullname` parameters.

[source,js]
----
// We firstly need to get the body of the request
var b = JSON.parse(readRequestBody(input.Get('request')));

return {
  // Assure correct casing
  "results":
    b.map(function({ name, surname }) {
        return {
          "fullname": name[0].toUpperCase() + name.substring(1) + " " + surname[0].toUpperCase() + surname.substring(1)
        }
    }),
  "count": b.length
};
----

The following [#apigw-proc-js-example]#<<apigw-proc-js-example,cURL example>># invokes the above JavaScript function.

[source,bash]
----
curl -X GET $BASE_URL/api/test-js \
  -H 'Content-Type: application/json' \
  -d '[{"name":"johnny","surname":"mnemonic"},{"name":"johnny","surname":"knoxville"}]';
----

== Function Arguments

The code snippet receives a single argument, `input`, that contains the entire request.

.The argument has the signature of:
[source,ts]
----
interface {
  Set: (k: string, v: unknown) => void;
  Get: (k: string) => unknown;
}
----

.The `input` object parameters:
[cols="1m,5a"]
|===
| [#proc-js-input-request]#<<proc-js-input-request,request>>#
|
This is the entire HTTP request object.
Refer to the https://pkg.go.dev/net/http?utm_source=gopls#Request[GO documentation] for details regarding the signature.

| [#proc-js-input-opts]#<<proc-js-input-opts,opts>>#
|
Integration gateway configuration.
Refer to the https://github.com/cortezaproject/corteza-server/blob/{VERSION}/pkg/options/options.gen.go#L84[source] for details.

[NOTE]
====
*DevNote* generate above opt. docs
====

|===

== Function Result

The result of the JavaScript snippet is provided to the post filters that prepare and return an HTTP response.

When the result is a `string`, such as `Hello, world!`, the result is used as is.

When the result is a non-string value, such as `{ key: "value" }`, the result is JSON encoded.

== Built-in Function Reference

[cols="1m,5m,5a,5a"]
|===
|Function |Signature |Description |Example

| [#proc-js-fnc-ref-readRequestBody]#<<proc-js-fnc-ref-readRequestBody,readRequestBody>>#
| readRequestBody(input: HttpRequest): string
| The function returns the contents of the provided request object.
| `readRequestBody(input.Get('request'))` returns the request's body as a string

|===


# src/modules/integrator-guide/pages/api-gw/profiler.adoc

include::ROOT:partial$variables.adoc[]

= Route Profiler
:keywords: integration gateway performance, integration gateway profiling, profiling, performance
:description: Learn how to profile your integration gateway endpoints for debugging and analytics

The *Integration gateway route profiler* simplifies the development and troubleshooting process by allowing you to inspect particular requests in a detailed manner.
Besides development, the profiler can be used to benchmark system performance to help determine potential bottlenecks or to get the general idea of what tye system is capable of.

The profiler was designed in a way that it can be used as a development and debugging tool or as a dashboard to glance over incoming requests.

[IMPORTANT]
====
The profiling results and aggregating stats do not get persisted to the store, so any server restart will restart the profiler itself and consequently remove the gateway requests gathered earlier.
====

[TIP]
====
You can use these benchmarks to determine if you will need to perform some system scaling strategy.
====

== Enabling the Profiler

.There are two ways to use the Integration gateway profiler:
* enabled globally (xref:devops-guide:references/configuration/server.adoc#_apigw_profiler_global[`APIGW_PROFILER_GLOBAL`] `.env` variable)
* enabled specifically per-route (by using profiler prefilter)

[IMPORTANT]
====
The profiler itself is enabled by default, but the global option is disabled, so there will be no requests on the profiler page apart from those that already exist in the Integration gateway and have a profiler prefilter added and enabled.
====

[#profiler-add]
== Configuring The Route Profiler

In order for the profiler to include an integration gateway route, you must explicitly enable it by configuring the *profiler* prefilter.
To add the profiler prefilter to an integration gateway endpoint click on the btn:[add filter] and select the "profiler" from the dropdown list.

[CAUTION]
====
The prefilters are applied in the same order they are defined in, meaning, the profiler applies after all other prefilters defined before it execute.
There is no filter sorting (via drag-drop functionality), so the only way for now it is to remove the other filters and create them in the fashionable order.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/prefilter-select.png",
    "alias": "api-gw-profiler-prefilter-select",
    "w": 1920,
    "h": 1080
  },
    "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 588,
    "y": 651,
    "w": 111,
    "h": 32
  }, {
    "kind": "box-note",
    "padding": "sm",
    "x": 589,
    "y": 698,
    "w": 185,
    "h": 14
  }]
}
----

In the configuration modal window make sure the enabled option is checked and click on the btn:[save & close] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/prefilter-cofigure.png",
    "alias": "api-gw-profiler-prefilter-cofigure",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 577,
    "y": 51,
    "w": 767,
    "h": 148
  }
}
----

When the profiler prefilter is added you will see a new *requests list* at the bottom of the page.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/preflter-added.png",
    "alias": "api-gw-profiler-preflter-added",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 577,
    "y": 544,
    "h": 510,
    "w": 1079
  },
  "annotations": [{
    "kind": "box",
    "x": 564,
    "y": 900,
    "h": 166,
    "w": 1105
  }]
}
----

[#profile-specific]
== Profiling Specific Routes

To profile a specific route open up the route and scroll to the bottom of the page.
The requests list shows all HTTP requests for the particular integration gateway route which ocurred *after* the profiler prefilter has been added.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/route-profiler.png",
    "alias": "api-gw-profiler-route-profiler",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 577,
    "y": 490,
    "w": 1087,
    "h": 579
  }
}
----

To inspect the details of a particular request, click on the btn:[edit] icon at the end of the request entry.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/route-profiler.png",
    "alias": "api-gw-profiler-route-profiler-details-open",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 577,
    "y": 490,
    "w": 1087,
    "h": 579
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1650,
    "y": 629,
    "w": 13,
    "h": 13
  }]
}
----

At the very top of the page you see the *general information*, such as the request ID, HTTP method, response status code, and duration.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/request-details-top.png",
    "alias": "api-gw-profiler-request-details-top-general",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 585,
    "y": 105,
    "w": 530,
    "h": 566
  }
}
----

Next up is the list of *request headers* provided with with the HTTP request.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/request-details-bottom.png",
    "alias": "api-gw-profiler-request-details-bottom-headers",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 580,
    "y": 127,
    "w": 1077,
    "h": 298
  }
}
----

Lastly the raw *request payload* provided with the HTTP request.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/request-details-bottom.png",
    "alias": "api-gw-profiler-request-details-bottom-body",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 586,
    "y": 502,
    "w": 1070,
    "h": 559
  }
}
----

== Profiling the System

To see general system performance we offer a system-wide profiler view.
Navigate to menu:system[integration gateway] and click on the btn:[profiler] button in the top right corner.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/route-list.png",
    "alias": "api-gw-profiler-route-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 600
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1451,
    "y": 80,
    "w": 83,
    "h": 30
  }]
}
----

A new screen appears showing you all registered integration gateway routes (only routes with a *profiler prefilter* are displayed) along with their statistics such as average request times and payload size.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/profiler-general.png",
    "alias": "api-gw-profiler-profiler-general",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 600
  }
}
----

To inspect requests for a particular route, either click on the btn:[edit] icon next to the integration gateway route or follow the instructions <<profile-specific,provided above>>.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/profiler-general.png",
    "alias": "api-gw-profiler-profiler-general-see-specific",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 600
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1648,
    "y": 243,
    "w": 15,
    "h": 15
  }]
}
----

When you inspect a particular integration gateway route, a list of all logged requests is shown.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/profiler/profiler-general-route.png",
    "alias": "api-gw-profiler-profiler-general-route",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "h": 830,
    "w": 1600
  }
}
----


# src/modules/integrator-guide/pages/api-gw/workflow-processing.adoc

include::ROOT:partial$variables.adoc[]

= Workflow Processing
:attachment-path: ../_attachments/api-gw/workflow-processing

When your integration gateway endpoint requires additional processing and the built-in processers do not suffice, you can bind a workflow to the endpoint to handle requests.

To bind a workflow to an integration gateway route, you first need to properly configure the workflow, and then bind it to the route's xref:api-gw/index.adoc#filters-proc-wfexec[workflow processer].

== Workflow Configuration

If you wish for a workflow to be executable by the integration gateway, the workflow must define a proper trigger.

.To configure your workflow:
. Create a new workflow or edit an existent workflow.
Refer to the xref:automation/workflows/index.adoc[workflow documentation] for details.
. Assure that the workflow in question defines a trigger with the resource of `System` and an event of `onManual`.

=== Reading a Request Body via Function

The way the http.Request is wrapped allows us to use it in the JS environment processing function (see more at xref:api-gw/index.adoc[JavaScript processing]) or the function designed specifically for request body content fetching.

.The screenshot shows the base workflow definition via read request body function.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/wf-request-read-fn.png",
    "alias": "wf-request-read-fn",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

Find the link:{attachment-path}/wf-request-read-fn.json[workflow] for this example in the hyperlink.

=== Reading a Request Body via JS

.The screenshot shows the base workflow definition via JS function.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/wf-request-read-js.png",
    "alias": "wf-request-read-js",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

Find the link:{attachment-path}/wf-request-read-js.json[workflow] for this example in the hyperlink.

.The input Javascript source can be as simple as:
[source,javascript]
----
try {
    return JSON.parse(readRequestBody(input));
} catch (e) {
    return 'could not parse request body: ' + e.message
}
----

.The body that is read could also be used as a `string` and later parsed in the subsequent workflow steps:
[source,javascript]
----
try {
    return readRequestBody(input);
} catch (e) {
    return 'could not read request body: ' + e.message
}
----

== Integration Gateway Route Configuration

.To bind a workflow to the integration gateway endpoint:
. Create a new integration gateway endpoint or edit an existing endpoint.
Refer to the xref:api-gw/index.adoc[integration gateway documentation] for details.
. Add a xref:api-gw/index.adoc#filters-proc-wfexec[workflow processer] to the endpoint.
. Select the workflow you wish to bind from the dropdown in the modal window.
. Confirm the selection and press on the btn:[save] button to update the endpoint.

.The screenshot shows the route configuration with workflow processer added.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-wf.png",
    "alias": "route-wf",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

.The screenshot shows the workflow processer configuration.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "api-gw/route-wf-modal.png",
    "alias": "route-wf-modal",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

== Testing

To test if the integration gateway route and the workflow are properly interacting, initiate an HTTP request using Postman or any other tool such as cURL.

Refer to the xref:api-gw/index.adoc#apigw-proc-js-example[curl examples] for details.


# src/modules/integrator-guide/pages/authentication/authenticate-external/index.adoc

include::ROOT:partial$variables.adoc[]

= Authentication of External Applications
:keywords: authentication, integrate, authenticate external application
:description: Learn how to authenticate external applications using {PRODUCT_NAME}

{PRODUCT_NAME} implements the OAuth2 authentication protocol, where it can act both as a OAuth2 server and as an OAuth2 client, allowing both internal and external authentications.

You can allow external applications to use {PRODUCT_NAME} as an authentication provider as long as they support authentication using OAuth2/OIDC protocols.

After a successful authorization with local credentials or an external provider, an *access token* along with a *refresh token* is issued.
This should be done automatically by the client.

The access token is short lived and should be automatically refreshed -- the access token is valid for *2 hours* and the refresh token is valid for *3 days*.
You can control the token expiry using `AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME` and `AUTH_OAUTH2_REFRESH_TOKEN_LIFETIME` `.env` variables.
Refer to xref:authentication/session-duration.adoc[define session duration] for more details.

[TIP]
====
You can use our https://github.com/cortezaproject/corteza-vue/blob/2022.9.x/src/plugins/auth.ts[corteza-vue plugins/auth] to manage this for you.
====

== Configuration of {PRODUCT_NAME}

Access {PRODUCT_NAME} {APP_NAME_ADMIN} panel and navigate to menu:system[auth clients].
Create a new auth client which your external application is going to use to authenticate.

[IMPORTANT]
====
We advise you create a separate auth client for each application that you wish to integrate with.
Reusing the same client may grant some integration access permissions that they should not have.
====

.The auth client consists of:
. a combination of a client ID and a client secret (the client ID is located in the URL address bar),
. a list of scopes to limit access based on the used auth client,
. a list of redirection URIs that can be used with authorization code grant,
. a trusted flag to force users to confirm authentication,
. an auth client validity based on the date.

[IMPORTANT]
====
Make sure to select the appropriate grant type based on your use-case.
Refer to xref:authentication/index.adoc#grant-types[here] for more details.
====

== Configuring External Applications

[NOTE]
====
*DevNote* todo; expand on this section.
====
//Editor's note: Do so before it goes out or delete the note.

Copy the parameters obtained from the auth client into tour external application.
The client ID is the long number at the end of the URL address.

== Authentication Lifecycle

[NOTE]
====
*DevNote* todo; expand on this section.
====

The session on the {PRODUCT_NAME} auth is different from the one on the client application.
This separation allows the {PRODUCT_NAME} auth session to be used when authorizing additional clients.

[CAUTION]
====
Since the authentication sessions between different clients are different, each session must be revoked in order for the user to be, in fact, signed-out.
====

== Notes on Security

* Use HTTPS with valid SSL certificates.
* Authentication forms and endpoints are protected against brute-force and cross-site request attacks.
You can also set your own secrets for JWT, CSRF and cookie value encryption.
* Different expiration durations may be set on sessions temporary and permanent sessions to support your organization's security policies.
* Please see the xref:devops-guide:references/configuration/server.adoc#_authentication[full list of options].
These changes take affect after server restart.

[NOTE]
====
If any of the secrets are changed, users will receive various warnings and will get logged-out.
====

== Tips for Debugging

.If your external application is unable to authenticate, check the following:
* client's ID and secret must match,
* at least one of client's redirect URIs must match (by prefix),
* client's grant flow must match,
* client's scope must match (requested group of scopes must intersect with scopes on the client),
* user authorizing the client must be a carrier of a role that is able to authorize the client,
* the user must be valid (confirmed email, unsuspended, undeleted).

== Glossary

[cols="2s,5a"]
|===
| [#auth-term-user]#<<auth-term-user,The user>>#
|
_In OAuth2 terminology, this is a **resource owner**_.

The user authenticates themselves and authorizes the <<auth-term-client,client>> on the authorization server.

| [#auth-term-auth]#<<auth-term-auth,{PRODUCT_NAME} auth server>>#
|
_In OAuth2 terminology this is a **authorization server**_.

The {PRODUCT_NAME} auth authenticates users, authorizes clients and issues access tokens.

[NOTE]
====
{PRODUCT_NAME} auth runs side-by-side with {PRODUCT_NAME} API server.
====

| [#auth-term-api]#<<auth-term-api,{PRODUCT_NAME} API>>#
|
_In OAuth2 terminology, this is a **resource server**_.

A client must obtain an access token in order to access the resources on the the {PRODUCT_NAME} API.

[NOTE]
====
{PRODUCT_NAME} auth runs side-by-side with {PRODUCT_NAME} API server.
====

| [#auth-term-client]#<<auth-term-client,Client, auth Client, Third-Party Application>>#
|
A client is any application that is used to interact with the {PRODUCT_NAME} API.

| [#auth-term-local-credentials]#<<auth-term-local-credentials,Local credentials>>#
|
Local credentials are the email and the password that authenticate the user.

| [#auth-term-external-providers]#<<auth-term-external-providers,External identity providers>>#
|
An external identity provider is any provider that supports the OpenID Connect (OIDC) protocol such as Google, LinkedIn, and GitHub.

| [#auth-term-security-ctx]#<<auth-term-security-ctx,Security context>>#
|
Security context is a set of roles that is assigned to the user when accessing the {PRODUCT_NAME} API.
|===


# src/modules/integrator-guide/pages/authentication/authenticate-external/with-corteza.adoc

include::ROOT:partial$variables.adoc[]

= Authenticate Using {PRODUCT_NAME}
:keywords: authentication via Corteza, Corteza external provider
:description: Learn how to authenticate {PRODUCT_NAME} instances using different {PRODUCT_NAME} instances

[#provider]
== Configuring the Authentication Provider

Create a new xref:authentication/index.adoc#_auth_client[auth client] and make sure you select the `authorization_code` grant type.
In addition, check the `allow client to use OIDC and verify user's identity` capability.

Optionally check the trusted checkbox to skip the final verification step.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/auth-client.png",
    "alias": "authentication-external-with-corteza-auth-client",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "padding": "sm",
    "x": 854,
    "y": 409,
    "h": 16,
    "w": 527
  }, {
    "padding": "sm",
    "x": 854,
    "y": 660,
    "h": 16,
    "w": 404
  }]
}
----

== Configuring the Authentication Client

Open to the {PRODUCT_NAME} {APP_NAME_ADMIN}, navigate to menu:system[settings] and scroll to the bottom of the page.

Make sure the _enable external authentication_ is checked, and clock on the btn:[add OIDC provider].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/provider-list.png",
    "alias": "authentication-external-with-corteza-provider-list",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 563,
    "y": 505,
    "w": 1110,
    "h": 575
  },
  "annotations": [{
    "x": 584,
    "y": 582,
    "w": 249,
    "h": 17
  }, {
    "x": 1467,
    "y": 616,
    "w": 189,
    "h": 32
  }]
}
----

Fill in the details obtained from the auth client defined <<provider,above>>.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/provider-configure.png",
    "alias": "authentication-external-with-corteza-provider-configure",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 560,
    "y": 30,
    "w": 800,
    "h": 768
  }
}
----

Click on the btn:[submit] button to save the changes.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/provider-added.png",
    "alias": "authentication-external-with-corteza-provider-added",
    "w": 1920,
    "h": 1080
  },
  "view": {},
    "focus": {
    "x": 563,
    "y": 505,
    "w": 1110,
    "h": 575
  },
  "annotations": [{
    "x": 1571,
    "y": 1032,
    "w": 85,
    "h": 37
  }]
}
----

== Authentication

When your users try to authenticate, they are presented with an extra external authentication option.

[NOTE]
====
If the OIDC provider is not available, check your server logs in case there are some errors.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/login-oidc.png",
    "alias": "authentication-external-with-corteza-login-oidc",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "x": 672,
    "y": 645,
    "w": 577,
    "h": 44
  }]
}
----

When you click on the new OIDC authentication option, you are redirected and asked to authenticate using your credentials from the provider {PRODUCT_NAME} instance.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/login.png",
    "alias": "authentication-external-with-corteza-login",
    "w": 1920,
    "h": 1080
  },
  "view": {}
}
----

Once you log into the provider {PRODUCT_NAME} instance, the authentication is successful.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/with-corteza/logged-in.png",
    "alias": "authentication-external-with-corteza-logged-in",
    "w": 1920,
    "h": 1080
  },
  "view": {}
}
----


# src/modules/integrator-guide/pages/authentication/external/facebook.adoc

include::ROOT:partial$variables.adoc[]

= Facebook
:page-aliases: 2024.9@administrator-guide:authentication/authentication-providers/facebook.adoc
:page-noindex: true

.To enable Facebook authentication, you need to retrieve your application credentials:
. Go to https://developers.facebook.com/apps/[Facebook for developers] website, click on *"Add a new app"* or *select an existing app*.
. On the list of available products search for "Facebook Login" and click on the "Set Up" button.
. Select "Web" platform and paste the URL where your {PRODUCT_NAME} system is running.
. Go to "Settings" and then "Basic" in the left sidebar.
. Copy and paste both *App ID* and *App Secret* fields to {PRODUCT_NAME} {APP_NAME_ADMIN}; *app ID* maps to *client key*, *app secret* maps to *secret*.


# src/modules/integrator-guide/pages/authentication/external/github.adoc

include::ROOT:partial$variables.adoc[]

= GitHub
:page-aliases: 2024.9@administrator-guide:authentication/authentication-providers/github.adoc
:page-noindex: true

.To enable GitHub authentication, you need to retrieve your application credentials:
. Go to https://github.com/settings/applications/new[GitHub] and create a new OAuth application.
. Copy and paste both *Client ID* and *Client Secret* fields to {PRODUCT_NAME} {APP_NAME_ADMIN}.


# src/modules/integrator-guide/pages/authentication/external/google.adoc

include::ROOT:partial$variables.adoc[]

= Google
:page-aliases: 2024.9@administrator-guide:authentication/authentication-providers/google.adoc
:page-noindex: true

.To enable Google authentication, you need to retrieve your application credentials:
. Go to https://developers.google.com/identity/sign-in/web/sign-in#before_you_begin[Google Sign-in Guide] and click on "Configure a project" button.
. Select an *existing or create a new* project.
. Set a product name.
. On "Configure your OAuth client" screen select "Web browser" and paste the URL where your {PRODUCT_NAME} system is running (including `https://`).
. Copy and paste both *Client ID* and *Client Secret* fields to {PRODUCT_NAME} {APP_NAME_ADMIN}.


# src/modules/integrator-guide/pages/authentication/external/index.adoc

include::ROOT:partial$variables.adoc[]

= External Authentication Providers
:page-aliases: 2024.9@administrator-guide:authentication/authentication-providers/index.adoc
:keywords: authentication, external providers, external authentication providers
:description: Lean how to use external services to authenticate your users

The use of external authentication providers allows your users to use external services (such as Google and GitHub) for authentication purposes.
External providers can be defined in the {PRODUCT_NAME} {APP_NAME_ADMIN} panel, under the menu:System[Settings,External authentication providers].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/settings.png",
    "alias": "authentication-external-settings",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 576,
    "y": 518,
    "w": 1088,
    "h": 552
  },
  "annotations": []
}
----

To enable an external authentication provider, you must register {PRODUCT_NAME} as a client using the provider's user interface.
Once you've obtained the user key and secret, you can configure {PRODUCT_NAME} using the admin panel.
External providers become effective immediately without server restart.

== Authentication Providers

:leveloffset: +2

include::google.adoc[]

include::facebook.adoc[]

include::github.adoc[]

include::linkedin.adoc[]

include::saml/index.adoc[]

:leveloffset: -1

[#idp-roles]
== Adjust user role membership

Each of the external authentication providers supports restricting and adjusting the user's role membership when a specific external authentication provider is used.

[IMPORTANT]
====
When using in combination with security settings on authentication client, settings from the authentication client are applied first, then settings from external authentication provider.
====

To configure role membership, click on the edit icon next to the external authentication provider.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/settings.png",
    "alias": "authentication-external-settings-roles",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 576,
    "y": 518,
    "w": 1088,
    "h": 552
  },
  "annotations": [{
    "kind": "box",
    "x": 1610,
    "y": 728,
    "w": 20,
    "h": 20
  }]
}
----

On the bottom of the modal you should see three inputs for permitted, prohibited, and forced roles.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/roles.png",
    "alias": "authentication-external-roles",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 560,
    "y": 29,
    "w": 800,
    "h": 566
  },
  "annotations": [{
    "kind": "box",
    "x": 575,
    "y": 266,
    "w": 770,
    "h": 225
  }]
}
----

[cols="1s,5a"]
|===
| [#idp-roles-permitted]#<<idp-roles-permitted,Permitted roles>>#
| List of roles that users are allowed to keep.

| [#idp-roles-prohibited]#<<idp-roles-prohibited,Prohibited roles>>#
| List of roles that are removed from user.

| [#idp-roles-forced]#<<idp-roles-forced,Forced roles>>#
| List of roles that are added to user when authenticating with this external provider.
|===


# src/modules/integrator-guide/pages/authentication/external/linkedin.adoc

include::ROOT:partial$variables.adoc[]

= LinkedIn
:page-aliases: 2024.9@administrator-guide:authentication/authentication-providers/linkedin.adoc
:page-noindex: true

.To enable LinkedIn authentication, you need to retrieve your application credentials:
. Go to https://www.linkedin.com/developers/apps/new[LinkedIn], fill out the form and click on "Create app".
. Go to Auth section and copy and paste both the *Client ID* and *Client Secret* fields to {PRODUCT_NAME} {APP_NAME_ADMIN}.


# src/modules/integrator-guide/pages/authentication/external/saml/index.adoc

include::ROOT:partial$variables.adoc[]

[#saml]
= SAML
:page-aliases: 2024.9@administrator-guide:authentication/authentication-providers/saml.adoc  2024.9@integrator-guide:authentication/external/saml.adoc
:page-noindex: true

To enable SAML authentication, you need to exchange credentials from your identity provider (IdP in the following text).
The configuration process involves the optional key generation and setting up IdP in the Admin panel.

== Generating Private and Public Key Pair

[CAUTION]
====
The example credentials displayed in this document *should not* be used in your instances.
====

[NOTE]
====
This step is optional.
You can use your existing key pair to set up SAML.
====

.Minimum required commands for generating private and public keys used for SAML authentication:
[source,shell script]
----
openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 \
  -keyout private.key \
  -out certificate.crt \
  -subj "/CN=corteza.your-server.com" <1>

openssl rsa -in private.key -out private-rsa.key <2>

cat certificate.crt private-rsa.key <3>
----
<1> The command generates a new key pair.
<2> The command converts the private key to RSA format.
<3> The command prints out the relevant keys you can copy.

[IMPORTANT]
====
The example credentials displayed in this document *should not* be used in your instances.
====

.The following snippet shows an example of a public key.
[source,txt]
----
-----BEGIN CERTIFICATE-----
MIICwDCCAagCCQDbTNd4i3X/4zANBgkqhkiG9w0BAQsFADAiMSAwHgYDVQQDDBdj
b3J0ZXphLnlvdXItc2VydmVyLmNvbTAeFw0yMTEwMDIwNzAwNDVaFw0yMjEwMDIw
NzAwNDVaMCIxIDAeBgNVBAMMF2NvcnRlemEueW91ci1zZXJ2ZXIuY29tMIIBIjAN
BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzb6QFbaa0IOpso8ZyhhWW6P2nwDn
N08LTFtHvRl0y0rspz2/PX5DSkUV+4I5Q2La21BZ8WAm28Ttr3BuUVQsnfDzPbSo
FSdgZYXcJXxeuaumwwtxpHpayvZj8zs0hyaie3diEMX7uqpGs/dL0pCTNmaI8nMo
LMjqJnYlQCz/HAUC5wrQHflfbLy8LA6KpCJuuTrFZGaMSIhW74HCYyp+2jTc6G1N
pxwBnwEqMy4RrYi5Mgn3GCPxo2LnSq3SVIurd5KLZb65YWHqAR4dKEncmdvVIbtS
8s9OgluSL6eXL364gXWW0DPs7saJdd8qclOfNI21Z4wr0PMVk9pyxSEvewIDAQAB
MA0GCSqGSIb3DQEBCwUAA4IBAQBnfhceUSfyRPZjrDixTcilyz8eLoWGOAqIsAOQ
Ai/D6/3mGLMOrIzEfhfkx7yHzwz0RnxNSxr6zdMf2vwWv8uCqf4oii51CXV3XllD
JnXVZjxjzuQbbQUaLHESx3qGpkWDrjMCqkLxTtLyQhG4oHT+re3C5sTodofyPc0Z
FiizNUs9CrdTmjUb43BpDyIZT9CXYbq75VHY/UB/ZtKBmD0PS524CTjegQ66BvW4
rL6Rri8GYpcnFNXZXGvJYeJOMT4U8nP5Bqo0bTV7YiRdx4pqVtroFFh304N4q7gl
aDlfJubiocv/fc4BiqCt/5cPiypAmR5mSTN2x5RjLBGqLhBN
-----END CERTIFICATE-----
----

.The following snippet shows an example of a private RSA key.
[source,txt]
----
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAzb6QFbaa0IOpso8ZyhhWW6P2nwDnN08LTFtHvRl0y0rspz2/
PX5DSkUV+4I5Q2La21BZ8WAm28Ttr3BuUVQsnfDzPbSoFSdgZYXcJXxeuaumwwtx
pHpayvZj8zs0hyaie3diEMX7uqpGs/dL0pCTNmaI8nMoLMjqJnYlQCz/HAUC5wrQ
HflfbLy8LA6KpCJuuTrFZGaMSIhW74HCYyp+2jTc6G1NpxwBnwEqMy4RrYi5Mgn3
GCPxo2LnSq3SVIurd5KLZb65YWHqAR4dKEncmdvVIbtS8s9OgluSL6eXL364gXWW
0DPs7saJdd8qclOfNI21Z4wr0PMVk9pyxSEvewIDAQABAoIBACLk3fUAylLw8Zf6
EyqmZAcY0Nv4wD4uJsFlfc5BggB0jZxzqXqZbnorK2ZDmMin/GxTvV1lrFF7ncAy
dlNOzl5fHjHp8NPdoMi3IjYtWLduuFK+HyEBK2Le1ObMtMTzNX1xKu2jVmU7OdCN
8YsdwAnq6/EKvNaToLqzMPAocX/jv7DDGUJ1r6LWwelV+RW6fbWHV9alnOwOQoPt
4o8r3+ZCLz1YsI+qW9cUBcbos1dkKxY9CdBtdtmFhUb+/tTx9/JRb6W+XJEAgCEM
/xxsu6pKdr9+Rc1YrwgMaMvDRzDQhe6eJM+l84W7axmqm07iuAuOFSE/b8yev/4e
8izw4fECgYEA9G6y/pk9fGxGgE3PRWVqq3/VsVNfNNjOMFUpFlQ3GlA+t0hSC+TU
XpxOufOI6WmV6bj+iVbhQk5iFTmW0+UeS+jHFSr0uzyavag6UJz8EuQfozAonkT2
AXtB9/85MWLo/Eo+CoIhofM+SEKBvcyrx6e+Mn+zEKssWAo5dh9Gd8MCgYEA13so
ZSnT/7vLaWZwCt2rxqHpnmWFwDF9nBWgiyT7ea3dym4DfXMTKIomqTVK9Vzbd9Oy
CmJols2otHtaV96hSi1z9tvfy/6om1k1ms75rFf4GatBjrVMzB/HtE2uGuWsW8Ez
F9BwDU9wX9qs+jCnG0fZm0nzef3lOHZIj3qlJekCgYBbzW/Am4EyR+A6s/6Sy8JC
YyK5FNz/FiZqlLF3x21inpzPbYQTH4B7gC05PbRAJf296FMA9fZoVtQTsKtrLfQx
Al4zHw0HfX2ImbQ9Lpil57PSMHYw6ymR6N8f62VpnQJwLtoaTEGhd5/+t6vOwx4J
QID4qmlwazmeX0ixipGGzQKBgQCq10JXsqoaf9HuZwE+HDIs8gI/S06X6qUkMyFu
MIwRFQBblo290JbH9YBhd5dOoah/gKAQC6XQqo2vSn1+XUyTeyYN+pWdLvKO+FO/
wYnCUpyp/VWkx6lzzV6QXWZEfQQCW1Me9mtgojL+TGoIkrpqrrSgoikf92TdNyqg
VyTIwQKBgGtVa5aJEhau3XUWKUAQbv95QDUNfP9PLs5jHhfflxVkAxlpMc9G4pNV
6mXFSsl8fnvg3HCmSr4rpV5QHUzvdKgbPkMQ8mUEONn/7ad4Xhsxeoz0xS5a8Tub
XhV4F/ngKrnQgxp47BCdNe0vC5Z44OImPpvQBsZ5PueqW+Pr5JHO
-----END RSA PRIVATE KEY-----
----

== Using Signed and Encrypted Requests

The `AuthNRequest` to the IdP can be signed and encrypted with the provided certificate and sent via HTTP-Post binding to the IdP of choice.
Refer to more examples for help on the https://www.samltool.com/generic_sso_req.php[samltool] webpage.

The assertion coming back from IdP can be signed and encrypted, provided that the certificate on the service provider side ({PRODUCT_NAME}) is included in the SAML metadata.
{PRODUCT_NAME} supports signed message and signed and encrypted assertions.
Refer to more examples for help on the https://www.samltool.com/generic_sso_res.php[samltool] webpage.

.Enabling signed requests and responses:
. The "Sign requests" checkbox under "Certificate" section should be enabled (refer to the <<saml-admin-ui,admin ui screenshot>>).
. "Signature method" should be set and depends on the kind of algorithm was specified on the certificate creation (in this example, SHA256 was used).

For more information on AuthNRequest and assertion in metadata refer to the <<saml-developer-notes,developer notes>>.

== SAML Bindings

{PRODUCT_NAME} supports *HTTP POST* and *HTTP Redirect* SAML 2.0 bindings.

.Specifying SAML binding:
The "binding" dropdown should be selected, specifying either _HTTP POST_ or _HTTP Redirect_ binding (refer to the <<saml-admin-ui,admin ui screenshot>>).

[NOTE]
====
The fallback choice is *HTTP Redirect*.
====

For more information on bindings in metadata refer to the <<saml-developer-notes,developer notes>>.

== Setting up the IdP in the Administration Panel

Open your administration panel and navigate to menu:system[settings].

[#saml-admin-ui]
.The screenshot shows the SAML settings in the administration panel under menu:system[settings].
image::authentication/external/saml/admin-settings.png[Screenshot of the configuration window.,role="data-zoomable"]

.Notes on the SAML configuration form:
. If you disable your SAML IdP, all settings are kept in {PRODUCT_NAME}.
Users will no longer be able to use SAML for login.
All active login sessions created using SAML are kept; users are not logged out.
. The name is displayed on the login form (refer to the <<saml-login-ui,below screenshot>>).
. Identity provider URL must point to the URL of the server which provides the metadata.
The metadata is an XML document providing machine-readable instructions for SAML configuration.
. Name, handle and identifier fields need to be specified in order for the user to be created.
When a user successfully logs in using SAML, {PRODUCT_NAME} performs a lookup using a value from the identifier field, which is expected to be an email.
Values from name and handle are used when creating a new user.

.{PRODUCT_NAME} tries to guess the identifier among one of the following:
* default identifier as defined in settings
* `emailAddress`
* `urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress`
* `urn:oasis:names:tc:SAML:attribute:subject-id`
* `email`
* `mail`

[NOTE]
====
The above values follow the industry standard, but you should consult your IdP-specific documentation on what is provided as a part of user data.
====

== Login Screen with SAML Enabled

[#saml-login-ui]
.The screenshot shows the login screen when SAML authentication is enabled.
image::authentication/external/saml/login-screen.png[Screenshot of the login screen.,role="data-zoomable"]

When clicking on the appropriate button (in this case, this is btn:["Login with Example IdP"]), the user enters the SAML authentication flow where the service ({PRODUCT_NAME}) and the identity providers (IdP) exchange information.
The user is automatically redirected back to {PRODUCT_NAME} after successful login on the IdP.

[#saml-developer-notes]
== Developer Notes

When setting up the SAML authentication provider, there is some information that can be read from the SP metadata that is generated from the configuration.

The metadata URL resides at `$BASE_URL/auth/external/saml/metadata`.

.Fetching metadata with curl example:
[source,shell script]
----
curl $BASE_URL/auth/external/saml/metadata
----

.Depending on the configuration, the following information can be read:
[cols="1s,5a"]
|===
| [#logout]#<<logout,Logout info>>#
|
[source,xml]
----
<SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="$BASE_URL/auth/external/saml/slo" ResponseLocation="$BASE_URL/auth/external/saml/slo"></SingleLogoutService>
----

| [#authnrequest]#<<authnrequest,AuthNRequest signed enabled / disabled.>>#
|
[source,xml]
----
<SPSSODescriptor xmlns="urn:oasis:names:tc:SAML:2.0:metadata" protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol" AuthnRequestsSigned="true" WantAssertionsSigned="true">
----

|===


# src/modules/integrator-guide/pages/authentication/external/saml/okta.adoc

include::ROOT:partial$variables.adoc[]

[#saml-okta]
= SAML {PRODUCT_NAME} Integration with Okta

To enable SAML SSO on {PRODUCT_NAME} through Okta you need to create a new application on the Okta IdP as well as configure it on the {PRODUCT_NAME} {APP_NAME_ADMIN} web application.

[CAUTION]
====
The values used in the screenshot and the table are for informational use only and should be changed to reflect your instance settings.
====

== Adding a New Application in Okta

Navigate to https://www.okta.com/ and login to your Okta account.
If you don't have an account, create one before continuing.

[NOTE]
====
For the documentation purposes, a trial Okta account has been created.
The trial version may not support all the features that are in the subscription version, but the basic features for the SAML SSO are included.

For more help on Okta, head to their https://support.okta.com/help[official support site].
====

Firstly, create a new application by navigating to the menu:Applications[Applications] side-menu.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/okta-application.png",
    "alias": "authentication-saml-okta",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 22,
    "y": 228,
    "w": 236,
    "h": 77
  }]
}
----

Click on the btn:[Create App Integration] button and choose *SAML 2.0 integration*.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/okta-application-screen2.png",
    "alias": "authentication-saml-okta-screen2",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 874,
    "y": 463,
    "h": 65,
    "w": 530
  },
  {
    "kind": "box",
    "x": 1352,
    "y": 754,
    "w": 60,
    "h": 40
  }]
}
----

The application wizard guides you to the next screen where you specify the name and the logo of your application.
Once finished, click on the btn:[Next] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/okta-application-screen3.png",
    "alias": "authentication-saml-okta-screen3",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 1239,
    "y": 580,
    "w": 58,
    "h": 38
  }]
}
----

On the next screen you need to configure Okta with the SAML parameters of your service provider, in this case, your {PRODUCT_NAME} instance where SAML is configured.
Once configured, click on the btn:[Next] button to continue on the optional feedback step.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/okta-application-screen4.png",
    "alias": "authentication-saml-okta-screen4",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 615,
    "y": 376,
    "h": 60,
    "w": 671
  },
  {
    "kind": "box",
    "x": 615,
    "y": 498,
    "h": 120,
    "w": 671
  }]
}
----

On the optional feedback step, click on the btn:[finish] button to complete your Okta configuration.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/okta-application-screen5.png",
    "alias": "authentication-saml-okta-screen5",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 1230,
    "y": 560,
    "h": 38,
    "w": 67
  }]
}
----

After the application is created, you can preview it in the menu:Applications[Applications] side-menu.
This is where you fulfil the user management as the created application needs to be connected to the users that will be using it.

image::authentication/external/saml/okta/okta-application-preview.png[Screenshot of the app settings confirmation screen.,role="data-zoomable"]

=== Okta SAML application settings

[Attributes]
|===
|*Setting* |*Value*

|*Single Sign On URL*
|https://{API_DOMAIN}/auth/external/saml/callback

|*Recipient URL*
|https://{API_DOMAIN}/auth/external/saml/callback

|*Destination URL*
|https://{API_DOMAIN}/auth/external/saml/callback

|*Audience Restriction*
|https://{API_DOMAIN}/auth/external/saml/metadata

|*Name ID Format*
|EmailAddress
|===

== Adding the Okta Settings to {PRODUCT_NAME}

After configuring the application on Okta you will need to configure {PRODUCT_NAME} with the parameters provided by Okta.

Navigate to {PRODUCT_NAME} {APP_NAME_ADMIN}, navigate to menu:system[settings] and click on the wrench icon next to the SAML external authentication provider.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/corteza-select-saml.png",
    "alias": "authentication-saml-corteza",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "padding": "lg",
    "x": 1610,
    "y": 933,
    "w": 18,
    "h": 16
  }]
}
----

The Okta related settings are specified in the *identity provider* section, where a metadata URL needs to be provided.

[NOTE]
====
How to generate the metadata URL for Okta is available https://support.okta.com/help/s/question/0D50Z00008G7VVzSAN/how-to-use-okta-idp-metadata-in-service-provider-application?language=en_US[here].
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/corteza-saml-details2.png",
    "alias": "authentication-saml-corteza-details-identity-provider",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 581,
    "y": 340,
    "w": 770,
    "h": 700
  }
}
----

You can find more info on creating the certificate on the xref:authentication/external/saml/index.adoc[] page.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/corteza-saml-details.png",
    "alias": "authentication-saml-corteza-details-certificate",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 580,
    "y": 210,
    "w": 770,
    "h": 220
  }
}
----

Publish the settings by clicking on the btn:[OK] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/external/saml/okta/corteza-saml-details2.png",
    "alias": "authentication-saml-corteza-details2",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 1298,
    "y": 1004,
    "h": 30,
    "w": 50
  }]
}
----

=== {PRODUCT_NAME} Okta SAML application settings

[Attributes]
|===
|*Setting* |*Value*

|*URL*
|https://okta-example-instance.okta.com/app/exk1fgv7123/sso/saml/metadata

|*Name field*
|http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname

|*Handle field*
|http://schemas.microsoft.com/identity/claims/objectidentifier

|*Identifier field*
|http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name
|===


# src/modules/integrator-guide/pages/authentication/index.adoc

include::ROOT:partial$variables.adoc[]

= Authentication
:page-aliases: 2024.9@administrator-guide:authentication/index.adoc
:keywords: authentication, security, login, configure login
:description: Learn how to configure the {PRODUCT_NAME} authentication flow

{PRODUCT_NAME} implements the OAuth2 authentication protocol, where it can act both as a OAuth2 server and as an OAuth2 client, which allows both internal and external authentications.

Basic authentication parameters are configured on the {PRODUCT_NAME} {APP_NAME_ADMIN} web application under menu:system[settings] in the "authentication" section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/config-basic.png",
    "alias": "authentication-config-basic",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 584,
    "y": 104,
    "w": 1070,
    "h": 239
  },
  "annotations": []
}
----

== Defining Password Constraints

{PRODUCT_NAME} allows you to define custom password constraints.
That enables you to better conform to your security model.

Password constraints are configured on the {PRODUCT_NAME} {APP_NAME_ADMIN} web application under menu:system[settings] in the "Password Constraints" section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/password-constraints.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 585,
    "y": 375,
    "w": 1070,
    "h": 234
  },
  "annotations": []
}
----

[cols="2s,5a"]
|===
| [#auth-password-constraint-len]#<<auth-password-constraint-len,Minimum length>>#
|
The minimum length parameter allows you to restrict your users from using short, insecure passwords.
You can not set the minimum length below 8 characters.

The maximum password length is not configurable and is set to 256 characters.

| [#auth-password-constraint-numbers]#<<auth-password-constraint-numbers,Minimum number of numbers>>#
|
The minimum number of numbers allows you to require your users to use numerical characters in their passwords.
The requirement is disabled when the value is left at 0.

| [#auth-password-constraint-symbols]#<<auth-password-constraint-symbols,Minimum number of special characters>>#
|
The minimum number of special characters allows you to require your users to use special characters in their passwords.
The requirement is disabled when the value is left at 0.

|===

[CAUTION]
====
The `AUTH_PASSWORD_SECURITY` `.env` variable allows you to disable password requirements checking by setting it to `false`.
This is handy for local development where you may not wish to handle complex password constraints.

The option should be *disabled* for any production deployment.
If the password security is disabled, a warning message is displayed in the UI.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/password-security-disabled.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 585,
    "y": 375,
    "w": 1070,
    "h": 234
  },
  "annotations": [{
    "kind": "box",
    "x": 585,
    "y": 401,
    "w": 1071,
    "h": 48
  }]
}
----
====

== Auth Client

An *auth client* offers a high-level access control over the use of {PRODUCT_NAME} API and its resources.
An auth client is what applications use when their users attempt to authenticate.

[TIP]
====
You can use {PRODUCT_NAME} to authenticate third-party applications that support OAuth2/OIDC.
====

Auth clients can be defined in the {PRODUCT_NAME} {APP_NAME_ADMIN} panel, under the menu:system[auth clients] section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-client-list.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 480
  },
  "annotations": []
}
----

.From there you can:
* list the auth clients created inside your {PRODUCT_NAME} instance,
* create a new auth client by clicking on the btn:[new] button,
* edit an existing auth client by clicking on the btn:[edit] icon next to the auth client,
* manage global auth client permissions by clicking on the btn:[permissions] button.

=== Base Auth Client Configuration

Base configuration parameters allow you to both identify the auth client, and specify the validity and the scope that the auth client provides.

[TIP]
====
The trusted checkbox removes the final confirmation step when the user authenticates.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-client-create.png",
    "alias": "authentication-auth-client-create-base",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "h": 1080,
    "w": 1600
  },
  "annotations": [{
    "kind": "box",
    "x": 585,
    "y": 163,
    "w": 1070,
    "h": 90
  }, {
    "kind": "box",
    "x": 585,
    "y": 383,
    "w": 1070,
    "h": 287
  }]
}
----

[#grant-types]
=== Grant Types

{PRODUCT_NAME} supports two OAuth2 grant types: *authorization code* and *client credentials*.

.Authentication grant types:
[cols="1s,5a"]
|===
| [#auth-client-grant-authorization-code]#<<auth-client-grant-authorization-code,Authorization code>>#
|
The *authorization code* grant type is used to authenticate users with the classic OAuth2 flow.

To enable this grant type, select the "will be used to authenticate users (grant type = authorization_code)" option.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-client-authorization-code.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 855,
    "y": 406,
    "h": 40,
    "w": 548
  },
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "x": 855,
    "y": 407,
    "w": 526,
    "h": 19
  }]
}
----

| [#auth-client-grant-client-credentials]#<<auth-client-grant-client-credentials,Client credentials>>#
|
The *client credentials* grant type is the simplified authentication flow.
It is normally used to authenticate systems such as external services or applications.

[IMPORTANT]
====
Client credentials grant type requires you to populate the "impersonate user" option.
The impersonated user will be used to create the security context of the JWT token.
====

To enable this grant type, select the "will be used to authenticate machines (grant type = client_credentials)" option.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-client-client-credentials.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 855,
    "y": 406,
    "h": 40,
    "w": 548
  },
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "x": 855,
    "y": 429,
    "w": 547,
    "h": 19
  }]
}
----

|===

[#auth-scope]
=== Authorization Scope

The scope is defined as a series of role memberships that are either *permitted*, *prohibited*, or *forced* on the user when using a specific {PRODUCT_NAME} auth server.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-client-create.png",
    "alias": "authentication-auth-client-create-scope",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "h": 1080,
    "w": 1600
  },
  "focus": {
    "x": 585,
    "y": 690,
    "w": 1070,
    "h": 204
  },
  "annotations": []
}
----


[cols="1s,5a"]
|===
| [#auth-scope-permitted]#<<auth-scope-permitted,Permitted roles>>#
| *Permitted roles* define what roles the user is *allowed to have* when authenticating with this client.

| [#auth-scope-prohibited]#<<auth-scope-prohibited,Prohibited roles>>#
| *Prohibited roles* define what roles the user is *not allowed to have* when authenticating with this client.

| [#auth-scope-forced]#<<auth-scope-forced,Forced roles>>#
| *Forced roles* define what roles the user *will have* have when authenticating with this client.
If the user does not have a forced role, a role will be automatically assigned.
|===

== Limit Access

By default, any user can use any auth client.
To limit access to specific auth clients, navigate to the auth client and set the "authorize client" access control rule.

If a specific role does not have the authorize client RBAC rule, the underlying users can not authenticate with the given auth client.

[NOTE]
====
*DevNote* how can I expand on this...
====


# src/modules/integrator-guide/pages/authentication/mfa.adoc

include::ROOT:partial$variables.adoc[]

= Multi-factor Authentication
:page-aliases: 2024.9@administrator-guide:authentication/mfa.adoc
:keywords: authentication, mfa, multi factor authentication
:description: Learn how to configure multi factor authentication

Multi-factor authentication (MFA) provides an extra layer of security for your users.
{PRODUCT_NAME} provides multi-factor authentication via email or via mobile authenticator application.

== Configure MFA

Multi-factor authentication can be enabled in the {PRODUCT_NAME} {APP_NAME_ADMIN} web application under menu:system[authentication, multi-factor authentication].
You can either *allow* or *force* users to receive their OTP (one-time-password) either via their *email* or their *authenticator application*.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-admin-configure.png",
    "alias": "authentication-mfa-mfa-settings-admin-configure-email",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 424,
    "y": 376,
    "w": 1070,
    "h": 487
  },
  "annotations": [{
    "kind": "box",
    "x": 605,
    "y": 406,
    "w": 387,
    "h": 54
  }]
}
----

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-admin-configure.png",
    "alias": "authentication-mfa-mfa-settings-admin-configure-mobile",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 424,
    "y": 376,
    "w": 1070,
    "h": 487
  },
  "annotations": [{
    "kind": "box",
    "x": 605,
    "y": 556,
    "w": 590,
    "h": 54
  }]
}
----

Next, to enable OTP for a specific user, navigate to menu:system[users] and click on the "edit" icon next to the user you wish to enable it for.
Navigate to the "multi-factor authentication" section and click on the btn:[enable] button.

.The screenshot outlines the user interface used to enable MFA authentication for a specific user.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-enable.png",
    "alias": "authentication-mfa-mfa-enable",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 426,
    "y": 829,
    "w": 1070,
    "h": 150
  },
  "annotations": [{
    "kind": "box",
    "x": 1414,
    "y": 888,
    "w": 80,
    "h": 30
  }]
}
----

From that point on, when a user attempts to login, they will receive an email with the OTP, which they need to provide before the login is finished.

== Use MFA Over Email

To use MFA over email, navigate to your profile and click on the "security" tab.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-auth.png",
    "alias": "authentication-mfa-mfa-settings-auth-email",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

Click on the btn:[configure] button in the "additional security with one-time-password over email" section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-auth-email-enabled.png",
    "alias": "authentication-mfa-mfa-settings-auth-email-enabled",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

The next time you login, you will need to confirm the login by entering the OTP sent to your email.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-login-confirm.png",
    "alias": "authentication-mfa-mfa-login-confirm",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

== Use MFA Over the Authenticator App

To use MFA over email, navigate to your profile and click on the "security" tab.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-auth.png",
    "alias": "authentication-mfa-mfa-settings-auth-app",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

Click on the btn:[configure] button in the "additional security with mobile app (time-based one-time-password)" section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-auth-authenticator-add.png",
    "alias": "authentication-mfa-mfa-settings-auth-authenticator-add",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

Open up your authenticator app and configure {PRODUCT_NAME} by either scanning the QR code provided or by manually providing the parameters provided on the authentication screen.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-settings-auth-authenticator-enabled.png",
    "alias": "authentication-mfa-mfa-settings-auth-authenticator-enabled",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

The next time you login, you will need to confirm the login by entering the OTP generated by your authenticator app.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/mfa/mfa-login-confirm.png",
    "alias": "authentication-mfa-mfa-login-confirm",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----


# src/modules/integrator-guide/pages/authentication/personalization.adoc

include::ROOT:partial$variables.adoc[]

= Personalize Authentication Screens
:page-aliases: 2024.9@personalization/auth.adoc
:keywords: authentication, personalize screens, customize screens
:description: Learn how to personalize {PRODUCT_NAME}'s authentication screens to match your brand

All authentication interfaces used by {PRODUCT_NAME} can be fully modified and styled for your needs.
Personalization is performed by defining a series of templates and assets (e.g. images and JavaScript code).
This allows you to make the authentication screen match the company style guide.

== Setup

=== Enabling Personalization

To enable the personalization of the authentication interfaces, you must set the following variables in your `.env` file:

[cols="2s,5a"]
|===
| Variable | Description

| [#env-devmode]#<<env-devmode,`AUTH_DEVELOPMENT_MODE`>>#
| The `AUTH_DEVELOPMENT_MODE` variable enables development tools to help with the interface personalization.
The development tools include automatic template reloading and developer UI.

| [#env-path]#<<env-path,`AUTH_ASSETS_PATH`>>#
| The `AUTH_ASSETS_PATH` variable defines where the system should read the modified authentication interfaces from.
Point the `AUTH_ASSETS_PATH` variable to the directory that contains the modified assets.
To exemplify; `AUTH_ASSETS_PATH=/opt/deploy/corteza/auth-assets`.
|===

[NOTE]
====
The path for the `AUTH_ASSETS_PATH` variable can be absolute or relative to the `corteza-server` binary.
====

=== Export Current Assets

To export the current authentication assets, run the `auth assets export` command.

[NOTE]
====
Alternatively, you can download the assets from https://github.com/cortezaproject/corteza-server/tree/{{VERSION}}/auth/assets[here].
====

[source]
----
Exports embedded assets into the provided path (must exists)

Usage:
  corteza-server auth assets export [flags]

Flags:
  -h, --help   help for export
----

To exemplify; assuming that we will use the `/opt/deploy/corteza/auth-assets` directory, run:

[source]
----
corteza-server auth assets export /opt/deploy/corteza/auth-assets
----

[NOTE]
====
If you've already defined the <<env-path,`AUTH_ASSETS_PATH`>> `.env` variable, you can omit the path when executing the command.
====

The produced output looks like this:

[source]
----
exporting auth assets to public
directory created
exporting asset /opt/deploy/corteza/auth-assets/public/background.jpeg: ok
exporting asset /opt/deploy/corteza/auth-assets/public/logo.png: ok
exporting asset /opt/deploy/corteza/auth-assets/public/script.js: ok
exporting asset /opt/deploy/corteza/auth-assets/public/style.css: ok
exporting auth assets to templates
directory created
exporting asset /opt/deploy/corteza/auth-assets/templates/authorized-clients.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/change-password.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/error-internal.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/inc_footer.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/inc_header.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/inc_nav.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/inc_toasts.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/login.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/logout.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/mfa-totp-disable.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/mfa-totp.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/mfa.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/oauth2-authorize-client.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/password-reset-requested.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/pending-email-confirmation.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/profile.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/request-password-reset.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/reset-password.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/security.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/sessions.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/signup.html.tpl: ok
exporting asset /opt/deploy/corteza/auth-assets/templates/template-dev.html.tpl: ok
----

[CAUTION]
====
Rerunning the command does not overwrite the existing files.
If you want a fresh start, delete the exported assets and re-export them.
====

== Modifying the Authentication Assets

.The exported assets define the following file structure:
[source]
----
/ public <1>
  / ...
/ templates <2>
  / ---
----
<1> The `/public` subdirectory contains the assets you can use in your authentication screens such as images and stylesheets.
You are free to remove, add or change all of the files in the `/public` subdirectory.
The public files are served in the same format they are defined here in the `/public` subdirectory.
<2> The `/templates` subdirectory contains the HTML templates that are used when displaying the authentication screens.
The templates are written in https://golang.org/pkg/html/template/[go's template syntax].
The syntax is the same as with our xref:templates/index.adoc[document templates].

[WARNING]
====
Template files exported by the CLI command mentioned above should *not* be renamed.
====

If you wish to define reusable components, you can define additional template files (such as the `inc_header.html.tpl` and the `inc_footer.html.tpl`).

=== Change Scenarios

Scenarios can be changed in the `templates/scenarios.yaml` while {PRODUCT_NAME} is running in development mode.

=== Styling

The default stylesheet is included from the Bootstrap CDN in the `inc_header.html.tpl` template.
You are free to change the stylesheet source.

[NOTE]
====
The system doesn't implement automatic style pre-processing or JavaScript transpiling.
You can pre-process the assets with your own tools before using them in the authentication.
====

=== Development Tool

When you enable the <<env-devmode,`AUTH_DEVELOPMENT_MODE`>> `.env` variable, you gain access the development tool accessible under the `$BASE_API_URL/auth/dev` URL.
The development tool displays all of the templates with all of the scenarios.

.A screenshot of the authentication customization development tool.
image::personalization/devtool.png[role="data-zoomable"]

== Deploying the Changed Assets

Once you enable the <<env-devmode,`AUTH_DEVELOPMENT_MODE`>> `.env` variable, the changed assets deploy automatically.

Disable the variable after you're done with the personalizations.

[IMPORTANT]
====
Do not change the <<env-path,`AUTH_ASSETS_PATH`>> `.env` variable as the templates are read directly from the filesystem.
====

When using docker, make sure to either mount the assets' source as a volume or rebuild a custom image on top of the default image.


# src/modules/integrator-guide/pages/authentication/session-duration.adoc

include::ROOT:partial$variables.adoc[]

= Defining Session Duration
:keywords: authentication, security
:description: Learn how to increase security by configuring the authentication session duration

{PRODUCT_NAME} allows you to define how long the access tokens are to be considered valid.

.The three `.env` variables to control the authentication session:
[cols="2s,5a"]
|===
| [#auth-sesion-auth_oauth2_access_token_lifetime]#<<auth-sesion-auth_oauth2_access_token_lifetime,AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME>>#
|
The `AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME` `.env` variable allows you to define how long an access token is valid for.

The access token represents the credentials that allow users to access protected resources such as records, users, and workflows.

.An example of limiting the access token to two minutes:
[source,.env]
----
AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME=2m
----

| [#auth-sesion-auth_oauth2_refresh_token_lifetime]#<<auth-sesion-auth_oauth2_refresh_token_lifetime,AUTH_OAUTH2_REFRESH_TOKEN_LIFETIME>>#
|
The `AUTH_OAUTH2_REFRESH_TOKEN_LIFETIME` `.env` variable allows you to define how long a refresh token should be valid.

The refresh token provides a mechanism which generates a new access token when the old one expires, removing the need to re-authenticate the user.

.An example of limiting the refresh token to two minutes:
[source,.env]
----
AUTH_OAUTH2_REFRESH_TOKEN_LIFETIME=2m
----

| [#auth-sesion-auth_session_lifetime]#<<auth-sesion-auth_session_lifetime,AUTH_SESSION_LIFETIME>>#
|
The `AUTH_SESSION_LIFETIME` `.env` variable allows you to define how long the authentication session should be valid.

The authentication session is generated when the user provides their credentials to the *{PRODUCT_NAME} login page*.
The authentication session is independent of access tokens.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-login.png",
    "alias": "auth-login-reg",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "x": 672,
    "y": 546,
    "h": 40,
    "w": 577
  }]
}
----

.An example of limiting the auth session to two minutes:
[source,.env]
----
AUTH_SESSION_LIFETIME=2m
----

| [#auth-sesion-auth_session_perm_lifetime]#<<auth-sesion-auth_session_perm_lifetime,AUTH_SESSION_PERM_LIFETIME>>#
|
The `AUTH_SESSION_PERM_LIFETIME` `.env` variable allows you to define how long the authentication session should be valid when the btn:[login and remember me] is used.

The authentication session is generated when the user provides their credentials to the *{PRODUCT_NAME} login page*.
The authentication session is independent of access tokens.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "authentication/auth-login.png",
    "alias": "auth-login-perm",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "x": 672,
    "y": 497,
    "h": 42,
    "w": 577
  }]
}
----

.An example of limiting the auth session to two minutes:
[source,.env]
----
AUTH_SESSION_PERM_LIFETIME=2m
----

|===

== Log Out Inactive Users After Two Minutes

If you wish to log out inactive users, you need to set all three of the `.env` variables mentioned above.

[source,.env]
----
AUTH_OAUTH2_ACCESS_TOKEN_LIFETIME=2m
AUTH_SESSION_LIFETIME=2m
AUTH_OAUTH2_REFRESH_TOKEN_LIFETIME=2m
----

[IMPORTANT]
====
When the user is considered inactive is determined by the user's browser.
Usually this is when they close the tab/window or when their computer enters rest mode.
====


# src/modules/integrator-guide/pages/automation/automation-scripts/corredor-helpers.adoc

include::ROOT:partial$variables.adoc[]

= Corredor helpers

Corredor helpers implement the most common operations, such as creating records and sending emails.

[TIP]
====
Corredor helpers come pre-configured in the xref:integrator-guide:automation/automation-scripts/index.adoc#execution-context[execution context].
====

Corredor helpers are context-aware, meaning that they can automatically determine the base parameters required by the operation.
For example, when creating a record, Corredor helpers will know what namespace, module, and record you are using.

[TIP]
====
You can use Corredor helpers outside automation scripts.
====

You can find the source code on https://github.com/cortezaproject/corteza-js[GitHub/cortezaproject/corteza-js].
NPM packages can be found on https://www.npmjs.com/package/@cortezaproject/corteza-js[NPM/@cortezaproject/corteza-js].

[IMPORTANT]
====
Make sure to use the same `@cortezaproject/corteza-js` package version as your {PRODUCT_NAME} instance.
====

When using our `corteza-js` package, the API clients can be imported using `import { corredor } from '@cortezaproject/corteza-js'`.

.Available {PRODUCT_NAME} Corredor helpers:
* https://github.com/cortezaproject/corteza-js/blob/2021.3.x/src/corredor/helpers/system.ts[`corredor.SystemHelper`]
* https://github.com/cortezaproject/corteza-js/blob/2021.3.x/src/corredor/helpers/compose.ts[`corredor.ComposeHelper`]

[NOTE]
====
*DevNote* take note of the compose-ui helper.
====


# src/modules/integrator-guide/pages/automation/automation-scripts/debugging.adoc

include::ROOT:partial$variables.adoc[]

[#extension-debug]
= Debugging

[NOTE]
====
*DevNote*: Add some insight in debugging failing scripts.
====

== Why is it that s script is not valid?

.An automation script is valid when:
* it is defined in a `.js` file,
* located under `client-scripts` or `server-scripts`,
* defines an `export default {...}`,
* defines at least one valid trigger,
* defines a security context in case the script is a sink or deferred,
* conforms to the script signature.

[IMPORTANT]
====
In case of a client-script, make sure that the file structure is appropriate.
====

== Why can't I see my scripts?

.Check whether:
* the {APP_AUTOMATION} container has access to the extension, either via an *existing volume*, or a *new volume*.
* you've uploaded your source files to your server,
* you've reloaded your containers.

[TIP]
====
When registering a new volume, you must use `docker-compose up -d`

When using an existing volume, you can use `docker-compose restart`
====


# src/modules/integrator-guide/pages/automation/automation-scripts/deploying.adoc

include::ROOT:partial$variables.adoc[]

= Deployment of automation scripts

[NOTE]
====
*DevNote* generalize this and move away from automation scripts only.
====

To use your automation scripts, it is necessary to make them available to the {APP_AUTOMATION} server, either locally or on the server.

[IMPORTANT]
====
When running *{APP_AUTOMATION} without Docker* (from the source code), you can skip any *Docker related steps*.
====

.We assume that:
* your *current working directory* is where your extension is,
* your *{PRODUCT_NAME} is located inside* `/opt/deploy/test-project`,
* your `/opt/deploy/test-project` *file structure* looks like this:

[source,txt]
----
data/
docker-compose.yml
.env
----

.In order to deploy your automation scripts:
. Create a new directory for your extension; we name it `corredor`, but the name is inconsequential.
. *Transfer the extension* into the newly created directory (see below sections for tips).
. Add a *new volume* to the `docker-compose.yaml` file, which *contains the extension*, under the `corredor` service, `volumes: [ "./corredor:/corredor/test-extension", ...other volumes you might have... ]`.
. Edit the `.env` (`CORREDOR_EXT_SEARCH_PATHS` variable) file in order to *register the new extension* `CORREDOR_EXT_SEARCH_PATHS=/extensions:/extensions/*:/corredor/test-extension`.
. *Reload the configurations* (`docker-compose up -d`).

.At the end, your file structure should look like the following:
[source,txt]
----
data/
docker-compose.yml
.env
corredor/
  test-extension/
    server-scripts/
      /...
    client-scripts/
      /...
----

[IMPORTANT]
====
`CORREDOR_EXT_SEARCH_PATHS` may contain multiple paths separated by a colon (`:`).
====

[TIP]
====
You can use `docker-compose logs -t --tail 100 -f corredor` to see whether the extension was registered and processed correctly.
====

== Transfer of extensions using git

If using Git to version control your extension, *clone* the repository onto your server (into the volume mentioned above).
You can then *pull the changes* whenever the source code changes.

[NOTE]
====
If the repository is *private*, make sure that the Git client on your server has access to it.
====

== Manual transfer of extensions

You can use `scp`, `rsync` or any other client to transfer the extension onto your server (into the volume mentioned earlier).

[NOTE]
====
We usually use `rsync`, as it is somewhat better at detecting file changes.
====

.Here is an example of a `rsync` command *following the above assumptions*. 
[source,bash]
----
rsync -av -e ssh --exclude="node_modules/*" ./* SSH_USERNAME_HERE@ssh.remote.tld:/opt/deploy/test-project/corredor --delete;
----

Make sure to *change the parameters* before executing the above command.


# src/modules/integrator-guide/pages/automation/automation-scripts/edit-built-in-scripts.adoc

include::ROOT:partial$variables.adoc[]

= Modifying built-in scripts

== Modification of built-in scripts

If you wish to modify an automation script that is defined by another extension (such as CRM scripts) you have two options; to create a modified copy or overwrite scripts.

=== Create a modified copy

.To modify the extension:
. copy the extension source (*clone* the repository or *copy* the files),
. modify the source as you see fit,
. deploy your version instead of the original version.

=== Overwrite the scripts

{APP_AUTOMATION} assigns unique names to each automation script.
The name is generated from the file path.

.For example:
[source,bash]
----
# The CRM extension
/ server-scripts
  / crm
    / Lead
      / SetLabel.js
----

The `SetLabel.js` script script is assigned `/server-scripts/crm/Lead/SetLabel.js:default` as the name.

To overwrite the `SetLabel.js` script, you must define a script that will be assigned the same name (essentially has the same path).

.For example:
[source,bash]
----
# The CRM extension
/ package.json
/ node_modules
/ server-scripts
  / crm
    / Lead
      / SetLabel.js # 👈 We're targeting this one
      / AnotherScript.js

# Your extension
/ package.json
/ node_modules
/ server-scripts
  # To overwrite something in the CRM extension
  / crm
    / Lead
      / SetLabel.js # 👈 This version will replace the CRM version

  # The rest of your code goes here
  / extension
    / Lead
      / SomeScript.js
----

[IMPORTANT]
====
For this to work, you must make sure that your extension is *included after* the extension you wish to modify.

.For example:
[source,.env]
----
# This will NOT work; the CRM is included after
CORREDOR_EXT_SEARCH_PATHS="/your-ext:/crm"

# This will work; the CRM is included before
CORREDOR_EXT_SEARCH_PATHS="/crm:/your-ext"
----
====


# src/modules/integrator-guide/pages/automation/automation-scripts/index.adoc

include::ROOT:partial$variables.adoc[]

= Automation scripts
:keywords: automation, automate business logic, automation script, scripting, code
:description: Learn how to use the flexible JavaScript environment for custom business logic processing

An automation script (further referred to as script) is a piece of code that allows you to implement custom business logic.
Automation scripts are written in plain JavaScript with the support for node packages.

[IMPORTANT]
====
As of xref:ROOT:changelog/202103.adoc[], with the introduction of workflows, automation scripts are disabled by default.
====

Take a look at our samples (menu:Low-Code Platform Developer Guide[Automation scripts,Samples]) and <<sample-project,the sample project>> to get started.

[TIP]
====
See whether you can implement your logic using xref:automation/workflows/index.adoc[].
A workflow is able to xref:automation/workflows/automation-scripts.adoc[execute automation scripts]
====

There are two categories of automation scripts; *server scripts* and *client scripts*.

[cols="1a,5a"]
|===
| [#automation-scripts-server]#<<automation-scripts-server,Server scripts>>#
| Server scripts are executed in the *{PRODUCT_NAME} {APP_AUTOMATION} server*.

.Use server scripts when:
* working with *sensitive data*,
* communicating with *external APIs*,
* it *shouldn't be possible for the script to be interrupted* by the user.

.Examples of usage:
* *create additional records* based on the current data,
* *send email* notifications,
* run *statistic analysis*.

| [#automation-scripts-client]#<<automation-scripts-client,Client scripts>>#
| Client scripts are executed in the client's browser (user agent).

.Use client scripts when:
* you need to *interact with the user*,
* are performing *data validation*,
* *inserting* default *values*.

.Examples of usage:
* *prompt the user* to confirm the form submission,
* *validate the form* submitted by the user,
* *redirect the user* after they've submitted the form,
* open an external webpage.

[IMPORTANT]
====
Client scripts are less secure as they run in the users browser.
Any baked-in credentials are easily accessible, the execution is easily terminated.
====
|===

Which one should you use?
If you need to interact with the user (show notification, request confirmations), use *client scripts*, elsewhere use *server scripts*.

== File structure

To start writing automation scripts, you must first define the appropriate file structure.

.The three main parts:
. `package.json` defines metadata as well as your dependencies.
. `/server-scripts` contains a set of automation scripts that are executed on the {APP_AUTOMATION} server.
. `/client-scripts` contains a set of automation scripts that will be executed inside the web application.
** Each sub-directory inside `/client-scripts` defines a bundle.
When a web application loads, it fetches the bundle that is assigned to it (this is done automatically).

Both `/server-scripts` and `/client-scripts` assume that all underlying files are automation scripts with valid signatures.
When defining a file with utility functions, move it under `/shared` or define a `/util` (or similar) at the root of the project.


.An example filestructure containing all of the available parts:
[source,text]
----
package.json
...
/server-scripts
  ...
/client-scripts
  /admin
      ...
  /compose 
      ...
  /shared
      ...
----

`...` indicates that you are free to structure your files as you see fit.
We do recommend you group your automation scripts based on their content, for example, scripts working with leads should go under the `/Lead` directory.

`/admin` and `/compose` contain scripts specific to each web application (as discussed earlier).

`/shared` contains code that client scripts can reuse.

== Automation script

[CAUTION]
====
It is only possible to define one automation script per file.
====

.This is how a valid automation script looks like:
[source,js]
----
{
  // A short label describing this script
  label: '...',

  // A longer description of what it does. Don\'t go over board.
  description: '...',

  // This controls script-level security, such as the invoking user.
  // We cover some details a bit later.
  security: {...},

  // This function returns a list of triggers that specify when the script should be ran.
  // We cover some details a bit later.
  triggers: (t) {...},

  // This is the code that is ran when the script is executed.
  // We cover some details a bit later.
  exec: (args, ctx) {...};
}
----

.You can use this template to cover most cases of usage:
[source,js]
----
include::example$server-script-sample/implicit-generic.js[]
----

[NOTE]
====
See xref:automation/automation-scripts/samples/server-scripts/index.adoc[server script samples], and xref:automation/automation-scripts/samples/client-scripts/index.adoc[client script samples] for more.
====

=== Execution arguments

Execution arguments (the `args` parameter of the `exec` function) contain the core data that your logic is able to work with.
The data differs based on the event that triggered the automation script.
To examplify; user related events define what user is involved, while record related events define the involved record and the module.

[NOTE]
====
Refer to xref:automation/automation-scripts/references/resource-events.adoc[] for a complete reference of what data each event exposes.
====

[IMPORTANT]
====
Arguments to a client-script are provided via *references* to the original objects, meaning that *any change* to the argument parameter *reflects* back to the original object.

Arguments to a server-script are provided as *a copy* of the original object, meaning that the changes are *not reflected* on the original object.
====

[#execution-context]
=== Execution context

Execution context (the `ctx` parameter of the `exec` function) contains contextual information and utilities that can be used within script execution.

.Execution of context parameters:
[cols="1m,5a"]
|===
| [#context-console]#<<context-console,ctx.console>>#
|
The `console` parameter defines a logger.

[NOTE]
====
When executing client scripts, this is the built-in `window.console`; when executing server scripts, this is a `Pino` logger.
====

| [#context-log]#<<context-log,ctx.log>>#
|
`ctx.log` is an alias for <<context-console,`ctx.console`>>

| [#context-authuser]#<<context-authuser,ctx.$authUser>>#
|
`$authUser` is a reference to the xref:automation/automation-scripts/index.adoc#involing-user[invoking user].

| [#context-systemapi]#<<context-systemapi,ctx.SystemAPI>>#
|
`SystemAPI` is the {PRODUCT_NAME} API client.

| [#context-composeapi]#<<context-composeapi,ctx.ComposeAPI>>#
|
`ComposeAPI` is the {PRODUCT_NAME} {APP_NAME_COMPOSE} API client.

| [#context-system]#<<context-system,ctx.System>>#
|
`System` defines a set of helper methods to work with the core system

| [#context-compose]#<<context-compose,ctx.Compose>>#
|
`Compose` defines a set of helper methods to work with {PRODUCT_NAME} {APP_NAME_COMPOSE} resources.

| [#context-composeui]#<<context-composeui,ctx.ComposeUI>>#
|
`ComposeUI` defines a set of helper methods to work with {PRODUCT_NAME} {APP_NAME_COMPOSE} user interface.

| [#context-frontendbaseurl]#<<context-frontendbaseurl,ctx.frontendBaseURL>>#
|
`frontendBaseURL` defines the base URL address that the front-end web applications are running.
This is useful when generating URL addresses that point to the {PRODUCT_NAME} applications (such as a link to the newly created lead).

|===

=== Execution result

Refer to the xref:automation/execution-flow-details.adoc[execution flow details] sub-section for details on how the execution result affects the system.

[NOTE]
====
*DevNote* document iterators and their special `Aborted` error

[source,js]
----
exec (args, ctx) {
  throw new Error('Aborted')
  // OR
  return false
}
----
====

[cols="2s,5a"]
|===
| [#exec-result-terminate]#<<exec-result-terminate,The execution is terminated>>#
|
The automation script is *terminated* when an error occurs.
This normally causes the original operation to also terminate.

.An example:
[source,js]
----
export default {
  trigger (t) {...}

  exec (args, ctx) {
    throw new Error('Oh no, something went wrong')
  }
}
----

| [#exec-result-unknown]#<<exec-result-unknown,The execution is successful>>#
|
In any other cases the automation script is *successful*.
The returned value is a zero value, if it is either `null` or `undefined`.

.An example:
[source,js]
----
export default {
  trigger (t) {...}

  exec ({ $record }, ctx) {
    return $record
  }
}
----
|===

== Automation triggers

Automation triggers (further referred to as triggers) control the timing of the execution of a specific automation script.
[IMPORTANT]
====
Automation triggers are evaluated in an isolated context that doesn't allow any external data (variables or imports).

.This will not work:
[source,js]
----
const MOD_NAME = 'Contact'

export default {
  triggers ({ on }) {
    return on('manual')
      .for(MOD_NAME) // 👈 we're referencing the constant here
  },
  exec (args, ctx) {...},
}
----
====

.The three main parts of a trigger:
. an event that specifies what system events the trigger reacts to,
. a <<trigger-define-resource,resource>> that specifies what system resource the trigger reacts for,
. a <<trigger-define-constraint,constraint>> that specifies how the event needs be presented as in order for the trigger to react.

.Available trigger types:
[cols="1a,5a"]
|===
| [#trigger-type-explicit]#<<trigger-type-explicit,Explicit>>#
| These are *explicitly triggered* by pressing a *button*.

Use explicit triggers when you wish to *manually initiate an action*, for example an OAuth authentication flow, redirection to an external resource, or data export.

| [#trigger-type-implicit]#<<trigger-type-implicit,Implicit>>#
| These are *implicitly triggered* and based on *system events*.

Use implicit triggers when you wish for an action to be *automatically performed* when triggered by another action or process; such as sending an email when you register a new user or adding a changelog entry when the content changes.

Refer to xref:automation/automation-scripts/references/resource-events.adoc[resources and events] for a complete list of events you can listen for.

| [#trigger-type-deferred]#<<trigger-type-deferred,Deferred>>#
|
[IMPORTANT]
====
Deferred triggers can only be used in server scripts and require explicit security context.
====

The system triggers these *at a certain point in the future*; either *periodically* (define with *cron expressions*), or *at a timestamp* (use *ISO 8601*, `YYYY-MM-DDThh:mm:ssZ` format).


Use deferred triggers when you want an action to *periodically repeat* or *be performed at a certain point in the future*. Examples of such use are  recurring payments or sending holiday newsletters to your subscribers.

[NOTE]
====
The scheduler acts *once per minute*, therefore that is the maximum accuracy {PRODUCT_NAME} supports.
====

| [#trigger-type-sink]#<<trigger-type-sink,Sink>>#
|
[IMPORTANT]
====
Sink triggers can only be used in server scripts and require explicit security context.
====
These are triggered by the system *when it receives a request*; either *HTTP* or *email*.

Use sink triggers when you want to *respond to requests*; such as *webhooks for external services* or *custom API endpoints*, for example *capturing data from external forms*, *tracking external document changes*, and *capturing payments*.

[NOTE]
====
It is recommended you use the REST API interface whenever possible.
====
|===

[#trigger-define-resource]
=== Defining a resource

To define what resource the trigger should react for (such as module, user, role), we use the conveniently named `.for('resource:goes:here')` method.

.An example of specifying a resource:
[source,js]
----
triggers ({ before }) {
  return before('create', 'update')
    // This will trigger for a compose record resource
    .for('compose:record')
},
----

Refer to xref:automation/automation-scripts/references/resource-events.adoc[resources and events] for a complete list of available resources and supported events.

[#trigger-define-constraint]
=== Defining a constraint

[NOTE]
====
Refer to xref:automation/automation-scripts/references/resource-constraints/index.adoc[resource constraints] for a list of available constraint properties for each resource.
====

To define how an event should be presented as (such as the module name, user email, role handle), we use the `.where(property, operator, value)` method or a variation of it.

.To elaborate:
* When applying two arguments to the method, the first one specifies the *property* and the second one specifies the *value*.
The default <<constraint-operator-eq,equality operator>> is used.
* When specifying three arguments to the method, the first one specifies the *property*, the second one specifies the <<trigger-comparison-operators,comparison *operator*>> and the third one specifies the *value*.

.An example of chaining constraints:
[source,js]
----
triggers ({ before }) {
  return before('create', 'update')
    .for('compose:record')
    .where('module', 'Lead')
    .where('namespace', 'crm')
},
----

[#trigger-comparison-operators]
.Available comparison operators:
[cols="1s,5a"]
|===
| [#constraint-operator-eq]#<<constraint-operator-eq,Equals (default)>>#
|
* `eq`
* `=`
* `==`
* `===`

| [#constraint-operator-neq]#<<constraint-operator-neq,Not equals>>#
|
* `not eq`
* `ne`
* `!=`
* `!==`

| [#constraint-operator-prt]#<<constraint-operator-prt,Partial equals>>#
|
* `like`

.Supported wildcards:
* *one or more characters*: `%`, `*`,
* *one character*: `_`, `?`.

| [#constraint-operator-nprt]#<<constraint-operator-nprt,Partial not equals>>#
|
* `not like`

.Supported wildcards:
* *one or more characters*: `%`, `*`,
* *one character*: `_`, `?`.

| [#constraint-operator-regex]#<<constraint-operator-regex,Regex equals>>#
|
* `~`

| [#constraint-operator-nregex]#<<constraint-operator-nregex,Regex not equals>>#
|
* `!~`

|===

=== Conventions

[cols="2s,5a"]
|===
| [#trigger-destructuring]#<<trigger-destructuring,Use object destructuring>>#
|
Object destructuring helps you shorten the code.

.Example:
[source,js]
----
// Instead of using:
triggers (t) {
  return t.after('create')
    .for('compose:record')
    .where('module', 'super_secret_module')
},

// you can do:
triggers ({ after }) { // 👈 this thing
  return after('create')
    .for('compose:record')
    .where('module', 'super_secret_module')
},
----

| [#constrained-constraints]#<<constrained-constraints,Use constraints>>#
|
Loose constraints may lead to unwanted side effects such as running the script when a record in a different namespace is created.

.Example:
[source,js]
----
// Instead of using:
triggers (t) {
  return t.after('create')
    .for('compose:record')
    .where('module', 'super_secret_module')
},

// you should do:
triggers ({ after }) {
  return after('create')
    .for('compose:record')
    .where('module', 'super_secret_module')
    .where('namespace', 'super_secret_namespace') // 👈 this thing
},
----


|===

== Security context

[#involing-user]
=== The invoking user

[IMPORTANT]
====
*Deferred* and *sink* scripts require you to specify the security context as the invoker is not known.
====

The invoking user is a person who performs an action that triggers the script execution.
To examplify; you press a button, therefore you are the invoking user.

By specifying the invoking user, the automation script may access some resources that the actual invoking user may not have access to, such as personal client information.

[CAUTION]
====
You are only able to set the invoking user for server scripts.
====

.An example of defining an invoking user:
[source,js]
----
export default {
  trigger (t) {...}

  security: 'some-user-identifier-here',

  exec (args, ctx) {...}
}
----

You can use the user's handle, email or ID as the user identifier.
We suggest you use an email or a handle.

[TIP]
====
It is a good idea to create a new system user the purpose of which is that of script execution wherever that is needed.
====

=== Allowing and denying script execution

Security context lets you prevent specific users from performing specific operations. Each user is attributed a role that specifies the degree of control they can operate with.
To examplify; you can prevent regular users from signing documents or sending quotes.

.Use these properties when defining the context:
* `allow` specifies which roles are permitted to access the automation script,
* `deny` specifies which roles are not permitted to access the automation script,

[IMPORTANT]
====
This is only available for explicit scripts.
It is ignored for any other script types
====

.An example of permitting access:
[source,js]
----
export default {
  trigger (t) {...}

  security: {
    allow: ['administrator', 'superuser'],
  },

  exec (args, ctx) {...}
}
----

.An example of denying access:
[source,js]
----
export default {
  trigger (t) {...}

  security: {
    deny: ['client', 'lead'],
  },

  exec (args, ctx) {...}
}
----

[#sample-project]
== An example setup

.The file structure (the sources are listed below):
[source,text]
----
/ .gitignore
/ .eslintrc.js
/ .mocharc.js
/ package.json

/ server-scripts
    / Sample.js
    / Sample.test.js
    / ...
/ client-scripts
    / ....
----

.gitignore:
[source,gitignore]
----
include::example$testing-setup/dotgitignore.txt[]
----

.eslintrc.js:
[source,js]
----
include::example$testing-setup/doteslintrc.js[]
----

.mocharc.js:
[source,js]
----
include::example$testing-setup/dotmocharc.js[]
----

.package.json:
[source,json]
----
include::example$testing-setup/package.json[]
----

.Sample.js
[source,js]
----
include::example$testing-setup/server-scripts/example/Sample.js[]
----

[TIP]
====
Pay attention to the following part:

[source,js]
----
// vv this line here vv
/* istanbul ignore next */
trigger ({ before }) {
  return before('create')
},
----

`istanbul ignore next` excludes the following function from the coverage report.
====

.Sample.test.js
[source,js]
----
include::example$testing-setup/server-scripts/example/Sample.test.js[]
----

.The above `package.json` defines three scripts:
* `lint` lints the code using the default ES6 standard (can be configured; see https://eslint.org/docs/rules/[here]),
* `test:unit` runs unit tests defined inside `.test.js` files (can be configured in the `.mocharc.js` file),
* `test:unit:cc` runs unit tests with code coverage.

[NOTE]
====
The code coverage report gets generated into the `coverage` directory.
For a HTML report inspect the `coverage/lcov-report` directory.

Usually the https://www.npmjs.com/package/http-server[http-server] package is used to help with this, but a simple "Open in <browser name here>" suffices.

[source,bash]
----
`http-server coverage/lcov-report`
----
====


# src/modules/integrator-guide/pages/automation/automation-scripts/node-modules.adoc

include::ROOT:partial$variables.adoc[]

= Node modules

[IMPORTANT]
====
Different extensions *do not share* their dependencies.
If two extensions use *the same dependency*, they both need to *define it*.
====

{PRODUCT_NAME} {APP_AUTOMATION} supports internal and external node modules, both on the server-scripts and client-scripts.

[NOTE]
====
Internally, we use the Yarn package manager.
We suggest you do the same.
====

.To add a new node module either:
* manually insert it into the `package.json` file or
* run the `yarn add NAME_GOES_HERE`.

When ran, the {APP_AUTOMATION} server attempts to automatically resolve and install the requested dependencies.

[CAUTION]
====
We are observing some anomalies when running *Yarn inside a docker container*.

If you're getting an error message similar to the one below, it means that Yarn is not able to *install the dependencies*.
This error occurs when Yarn is unable to store its cache.

****
{
  "type": "error",
  "data": "https://registry.yarnpkg.com/rxjs/-/rxjs-6.6.3.tgz: Extracting tar content of undefined failed, the file appears to be corrupt: \\"ENOSPC: no space left on device, write\\""
}
****

.To fix the anomaly, you need to:
. SSH *into the {APP_AUTOMATION} container* (`docker-compose exec -u root corredor sh`),
. `cd` *into the mounted volume*,
. run *`yarn --cache-folder /tmp`*.

The dependencies should now be *installed and available* for use.
The above `yarn` command *manually runs the installing* process, *discarding the cache*.
====

Node modules can then be used *just like in any other situation*.

.Example package.json:
[source,json]
----
{
  "dependencies": {
    "axios": "^0.18.0"
  }
}
----

.Example usage from automation scripts:
[source,js]
----
import axios from 'axios'

export default {
  // ...

  async exec() {
    await axios.get(...)

    // ...
  }
}
----


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/compose/module.adoc

| module
| Constraint checks the value against the module handle.

| module.handle
| Constraint checks the value against the module handle.

| module.name
| Constraint checks the value against the module name.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/compose/namespace.adoc

| namespace
| Constraint checks the value against the namespaces slug.

| namespace.slug
| Constraint checks the value against the namespaces slug.

| namespace.name
| Constraint checks the value against the namespaces name.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/compose/page.adoc

| page
| Constraint checks the value against the page's handle.

| page.handle
| Constraint checks the value against the page's handle.

| page.title
| Constraint checks the value against the page's title.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/compose/record.adoc

| record.updatedAt
| Constraint checks the value against the record's `updatedAt` attribute in RFC3339 format (example: `2006-01-02T15:04:05Z07:00`)

| record.createdAt
| Constraint checks the value against the record's `createdAt` attribute in RFC3339 format (example: `2006-01-02T15:04:05Z07:00`)

| record.deletedAt
| Constraint checks the value against the record's `deletedAt` attribute in RFC3339 format (example: `2006-01-02T15:04:05Z07:00`)

| record.values.*
| Constraint checks the value against the record's value.
Any field defined by the record's module can be used.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/index.adoc

include::ROOT:partial$variables.adoc[]

// @todo fact-check resource ID's

= Resource constraints

== {APP_NAME_COMPOSE}

=== Module (`compose:module`)

[cols="2m,5"]
|===
|property|Description
include::./compose/module.adoc[]
include::./compose/namespace.adoc[]
|===

=== Namespace (`compose:namespace`)

[cols="2m,5"]
|===
|property|Description
include::./compose/namespace.adoc[]
|===

=== Page (`compose:page`)

[cols="2m,5"]
|===
|property|Description
include::./compose/page.adoc[]
include::./compose/namespace.adoc[]
|===

=== Record (`compose:record`)

[cols="2m,5"]
|===
|property|Description
include::./compose/record.adoc[]
include::./compose/module.adoc[]
include::./compose/namespace.adoc[]
|===

// System

== System

=== application (`system:application`)

[cols="2m,5"]
|===
|property|Description
include::./system/application.adoc[]
|===

=== auth (`system:auth`)

[cols="2m,5"]
|===
|property|Description
include::./system/user.adoc[]
|===

=== user (`system:user`)

[cols="2m,5"]
|===
|property|Description
include::./system/user.adoc[]
|===

=== role (`system:role`)

[cols="2m,5"]
|===
|property|Description
include::./system/role.adoc[]
|===

=== role member (`system:role-member`)

[cols="2m,5"]
|===
|property|Description
include::./system/user.adoc[]
include::./system/role.adoc[]
|===

=== sink (`system:sink`)

[cols="2m,5"]
|===
|property|Description
include::./system/sink.adoc[]
|===

=== mail (`system:mail`)

[cols="2m,5"]
|===
|property|Description
include::./system/mail.adoc[]
|===


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/messaging/channel-member.adoc

| channel-member.type
| Constraint checks the value against the membership flag.
The value can be `owner`, `member` or `invitee`.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/messaging/channel.adoc

| channel
| Constraint checks the value against the channel's name.

| channel.name
| Constraint checks the value against the channel's name.

| channel.topic
| Constraint checks the value against the channel's topic.

| channel.type
| Constraint checks the value against the channel's type.
The value can be `public`, `private` or `group`.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/messaging/command.adoc

| command
| Constraint checks the value against the command's name.
The name does not include the leading `/`, for example `'shrug'`.

| command.name
| Constraint checks the value against the command's name.
The name does not include the leading `/`, for example `'shrug'`.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/messaging/message.adoc

| message
| Constraint checks the value against the message's content.

| message.type
| Constraint checks the value against the message type.
The value can be `channelEvent`, `inlineImage`, `attachment`, `illeism` or omitted.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/system/application.adoc

| application.name
| Constraint checks the value against the application's name.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/system/mail.adoc

| mail.header.subject
| Constraint checks the value against the email's subject.

| mail.header.from
| Constraint checks the value against the email's from.
This will be truthy if **any** value matches.

| mail.header.to
| Constraint checks the value against the email's to.
This will be truthy if **any** value matches.

| mail.header.replyTo
| Constraint checks the value against the email's reply to.
This will be truthy if **any** value matches.

| mail.header.cc
| Constraint checks the value against the email's cc.
This will be truthy if **any** value matches.

| mail.header.bcc
| Constraint checks the value against the email's bcc.
This will be truthy if **any** value matches.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/system/role.adoc

| role
| Constraint checks the value against the role's handle.

| role.handle
| Constraint checks the value against the role's handle.

| role.name
| Constraint checks the value against the role's name.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/system/sink.adoc

| request.remoteAddress
| Constraint checks the value against the request's remote address.

| request.method
| Constraint checks the value against the request's method.
The value can be any standard HTTP request method.

| request.path
| Constraint checks the value against the request's URL path.
For example, `www.address.tld/some/path` would require `/some/path`.

| request.username
| Constraint checks the value against the request's basic authentication username.

| request.password
| Constraint checks the value against the request's  basic authentication password.

| request.content-type
| Constraint checks the value against the request's content type header field.


| request.get.*
| Constraint checks the value against the request's get query parameters.
This will be truthy if **any** value matches in case of multiple query parameter values.

| request.post.*
| Constraint checks the value against the request's post body parameters.
// @todo a bit more descriptive?

| request.header.*
| Constraint checks the value against the request's header parameters.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-constraints/system/user.adoc

| user
| Constraint checks the value against the user's handle.

| user.handle
| Constraint checks the value against the user's handle.

| user.email
| Constraint checks the value against the user's email.


# src/modules/integrator-guide/pages/automation/automation-scripts/references/resource-events.adoc

= Resources and events

== Server scripts

:leveloffset: +2
include::generated:partial$resource-events.gen.adoc[]
:leveloffset: -2

== Client scripts

=== compose

==== Events
.On events:
* `on('manual')`

=== compose:namespace

.On events:
* `on('manual')`

=== compose:module

==== Events
.On events:
* `on('manual')`

=== compose:record

==== Events
.On events:
* `on('manual')`

=== ui:compose:record-page

==== Events
.Before/after events:
* `before('formSubmit')`
* `before('delete')`
* `after('formSubmit')`
* `after('delete')`

.On events:
* `on('formSubmitError')`

=== ui:compose:admin-record-page

==== Events

.Before/after events:
* `before('formSubmit')`
* `before('delete')`
* `after('formSubmit')`
* `after('delete')`

.On events:
* `on('formSubmitError')`


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/client-scripts/explicit-notify.adoc

= Prompt notification

This example prompts the user to enter a value and then displays it as a notification.

.client-scripts/compose/crm/Contact/CollectValue.js
[source,js]
----
export default {
  label: "Script label",
  description: 'Script description',

  * triggers ({ on }) {
    // This script myst be invoked manually (explicitly)
    yield on('manual')
      // for a record
      .for('compose:record')
      // if the record belongs to the Quote module
      .where('module', 'Contact')
      // and the module belongs to the crm namespace -- this is the slug
      .where('namespace', 'crm')
      // visible in the compose application
      .uiProp('app', 'compose')
  },

  // Refer to the low-code platform developer guide for details on these two parameters
  async exec ({ $record }, { Compose, ComposeUI }) {

    const value = window.prompt('Please insert a value')
    if (!value) {
      ComposeUI.warning('No value provided')
      return false
    }

    // Do something with the inserted value
    // ...

    ComposeUI.success(`Hi! You've entered ${value}!`)
  }
}
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/client-scripts/implicit-prefill.adoc

= Prefill values

This example prefills some record values in case they are not provided.

[NOTE]
====
This can also be done with the module field default value setting.
====

.client-scripts/compose/crm/Contact/Prefill.js
[source,js]
----
export default {
  label: "Script label",
  description: 'Script description',

  * triggers ({ before }) {
    // This script myst be invoked manually (explicitly)
    yield before('formSubmit')
      // for a record page on Compose
      .for('ui:compose:record-page')
      // if the record belongs to the Request module
      .where('module', 'Request')
      // and the module belongs to the crm namespace -- this is the slug
      .where('namespace', 'crm')
  },

  // Refer to the low-code platform developer guide for details on these two parameters
  async exec ({ $record, $module }, { Compose }) {
    // Lets get the defaults from a Default module.
    // This allows some more flexibility

    if (['crm'].includes($module.namespace.slug.toLowerCase())) {
      // interested only in CRM namespace
      return
    }

    if (['lead'].includes($module.handle.toLowerCase())) {
      // interested only in Lead module
      return
    }

    const defaults = await Compose.findFirstRecord('Defaults')

    for (const k in $record.values) {
      if (!$record.values[k]) {
        $record.values[k] = defaults.values[k]
      }
    }

    // IMPORTANT: client-scripts work with references, so you don't need to
    // explicitly return the $record -- this is already applied when we
    // assigned a new value above.
    return $record
  }
}
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/client-scripts/index.adoc

= Client scripts

== Before submitting the form

[TIP]
====
.Example use-cases:
* *calculate complex fields*
* *value validation*
* *pre-fill missing values*
====

[TIP]
====
You can set the default value for a field in the module editor.

*DevNote*: provide some links.
====

.Before submitting the form:
[source,js]
----
include::example$client-script-sample/before-form-record.js[]
----

== Generic on click action

[TIP]
====
.Example use-cases:
* *OAuth flows*
* *send notifications*
* *render documents*
====

.Generic on click action:
[source,js]
----
include::example$client-script-sample/button-generic.js[]
----

== Process record on click

[TIP]
====
.Example use-cases:
* *email the record contact*
* *email the record owner*
* *generate report for the specific record*
====

.Process record on click:
[source,js]
----
include::example$client-script-sample/button-record.js[]
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/server-scripts/explicit-send-email.adoc

= Send an email to the contact

The example script sends an email to the contact it was invoked for.

[IMPORTANT]
====
Make sure that your SMTP configuration is working.
====

.server-scripts/Contact/SendMail.js
[source,js]
----
export default {
  label: "Script label",
  description: 'Script description',

  * triggers ({ on }) {
    // This script myst be invoked manually (explicitly)
    yield on('manual')
      // for a record
      .for('compose:record')
      // if the record belongs to the Quote module
      .where('module', 'Contact')
      // and the module belongs to the crm namespace -- this is the slug
      .where('namespace', 'crm')
      // visible in the compose application
      .uiProp('app', 'compose')
  },

  // Refer to the low-code platform developer guide for details on these two parameters
  async exec ({ $record }, { Compose }) {
    let emailContent
    let emailSubject

    // Determine the email content and subject.
    // You could also do other bits inhere

    if (!$record.values.Email) {
      // This will stop the script's execution
      return false
    }

    await Compose.sendMail(
      $record.values.Email,
      emailSubject,
      { html: emailContent }
    )
  }
}
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/server-scripts/implicit-send-email.adoc

= Notify owner about the update

The example fetches the lead owner and sends them an email.

[IMPORTANT]
====
Make sure that your SMTP configuration is working.
====

.server-scripts/Lead/NotifyChange.js
[source,js]
----
export default {
  label: "Script label",
  description: 'Script description',

  * triggers ({ after }) {
    // This script myst be invoked after the record is updated (implicitly)
    yield after('update')
      // for a record
      .for('compose:record')
      // if the record belongs to the Lead module
      .where('module', 'Lead')
      // and the module belongs to the crm namespace -- this is the slug
      .where('namespace', 'crm')
  },

  // Refer to the low-code platform developer guide for details on these two parameters
  async exec ({ $record }, { Compose, System }) {
    let emailContent
    let emailSubject

    if (!$record.ownedBy) {
      // This will stop the script's execution
      return false
    }

    // Lets get the owner
    const owner = await System.findUserByID($record.ownedBy)

    // Determine the email content and subject.
    // You could also do other bits inhere

    await Compose.sendMail(
      owner.email,
      emailSubject,
      { html: emailContent }
    )
  }
}
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/server-scripts/implicit-value-update.adoc

= Calculate the lead cost

The example calculates the lead cost when it is created *or* updated.

.server-scripts/Lead/UpdateCost.js
[source,js]
----
export default {
  label: "Script label",
  description: 'Script description',

  * triggers ({ before }) {
    // This script myst be invoked before the record is created or updated (implicitly)
    yield before('create', 'update')
      // for a record
      .for('compose:record')
      // if the record belongs to the Lead module
      .where('module', 'Lead')
      // and the module belongs to the crm namespace -- this is the slug
      .where('namespace', 'crm')
  },

  // Refer to the low-code platform developer guide for details on these two parameters
  async exec ({ $record }, { Compose }) {
    if (!$record.values.LeadSource) {
      // This will use the original record, since no changes are required.
      // You could also use return false to stop the execution
      return $record
    }

    switch ($record.values.LeadSource) {
      case 'source-a':
        $record.values.LeadCost = 10
        break

      case 'source-b':
        $record.values.LeadCost = 20
        break

      default:
        $record.values.LeadCost = 30
        break
    }

    // Returning $record in a before script will automatically update the record.
    // IMPORTANT: This is not the same for after scripts -- they need to be explicitly updated.
    return $record
  }
}
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/server-scripts/index.adoc

= Server scripts

== Generic implicit script

[NOTE]
====
Use this generic template to cover 90% of use-cases.
====

.Generic implicit script:
[source,js]
----
include::example$server-script-sample/implicit-generic.js[]
----

[#ss-before-record]
== Before saving a record

[TIP]
====
.Example use-cases:
* *calculate complex fields*
* *value validation*
* *create a changelog entry*
====

[IMPORTANT]
====
It would be best if you used field expressions for most field validations and value calculations.

*DevNote*: provide some references.
====

.Before saving a record:
[source,js]
----
include::example$server-script-sample/before-record.js[]
----

== After saving a record

[TIP]
====
.Example use-cases:
* *notify the owner about the change*
* *send the change to an external integration*
* *create a changelog entry*
====

[IMPORTANT]
====
If you want to *change the value*, you should use <<ss-before-record>> instead.
====

.After saving a record:
[source,js]
----
include::example$server-script-sample/after-record.js[]
----

== Generic on click action

[TIP]
====
.Example use-cases:
* *OAuth flows*
* *send notifications*
* *render documents*
====

.Generic on click action:
[source,js]
----
include::example$server-script-sample/button-generic.js[]
----

== Process record on click

[TIP]
====
.Example use-cases:
* *email the record contact*
* *email the record owner*
* *generate report for the specific record*
====

.Process record on click:
[source,js]
----
include::example$server-script-sample/button-record.js[]
----

== Respond to an HTTP request

[TIP]
====
.Example use-cases:
* *creating records from an external form*
* *document approval/signature tracking*
* *credit card payment capturing*
====

[IMPORTANT]
====
You will need to *add the `base-64` package*.
====

.Respond to an HTTP request:
[source,js]
----
include::example$server-script-sample/sink-generic.js[]
----


# src/modules/integrator-guide/pages/automation/automation-scripts/samples/triggers/index.adoc

= Triggers

== Explicit trigger (button)

[source,js]
----
triggers ({ on }) {
  return on('manual')
    .for('compose:record')
    .uiProp('app', 'compose')
},
----

[source,js]
----
triggers ({ on }) {
  return on('manual')
    .for('compose:record')
    .where('module', 'Module1')
    .uiProp('app', 'compose')
},
----

== Implicit trigger (automatic)

[source,js]
----
// Before something
triggers ({ before }) {
  // You can pass in multiple events: create, update, delete
  return before('create', 'update')
      .for('compose:record')
      .where('module', 'Module1')
},

// After something
triggers ({ after }) {
  // You can pass in multiple events: create, update, delete
  return after('create', 'update')
      .for('compose:record')
      .where('module', 'Module1')
},

// After where record value 'Name' is 'John'
triggers ({ after }) {
  return after('create', 'update')
      .where('module', 'Module1')
      .where('record.values.Name', 'John')
},

// After user is created/updated, where email ends with @corteza.com
triggers ({ after }) {
  return after('create', 'update')
      .for('system:user')
      .where('user.email', '^[a-zA-Z0-9]{1,20}@corteza.com$')
},
----


[#sample-trigger-deferred-interval]
== Deferred (interval)

[source,js]
----
// Every day at 2AM
triggers ({ on }) {
  return on('interval')
    .every('0 2 * * *')
},

// Every 4th month at 12:00 AM
triggers ({ on }) {
  return on('interval')
    .every('00 12 1 */4 *')
},

----

[#sample-trigger-deferred-timestamp]
== Deferred (timestamp)

[source,js]
----
// On christmas eve
triggers ({ at }) {
    // You can pass multiple timestamps (timestamp1, timestamp2, ..., timestampN)
  return at('2020-12-24T21:00:00Z')
},
----

== On HTTP request

[source,js]
----
// When POST request on a certain path is recieved
triggers ({ on }) {
  return on('request')
    .where('request.path', '/some/path/here')
    // HTTP protocol; GET, POST, PUT, PATCH, DELETE
    .where('request.method', 'POST')
    .for('system:sink'),
},

// If request.headers authorization is empty
triggers ({ on }) {
  return on('request')
    .where('request.path', '/some/path/here')
    // HTTP protocol; GET, POST, PUT, PATCH, DELETE
    .where('request.headers.authorization', '')
    .for('system:sink'),
},
----


# src/modules/integrator-guide/pages/automation/automation-scripts/testing.adoc

include::ROOT:partial$variables.adoc[]

= Testing

[NOTE]
====
*DevNote*: provide some complex examples using Sinon and promises.
====

Extensions are essentially Node.js projects with additional bits, meaning that the extensions can be tested in the same way as node.js projects.

You are free to use any testing framework and any testing methodology.

[NOTE]
====
We usually use https://www.chaijs.com/[Chai], https://mochajs.org/[Mocha], https://www.npmjs.com/package/nyc[Nyc], and https://sinonjs.org/[Sinon].
====

[NOTE]
====
*DevNote* provide some more examples for other frameworks?
====


# src/modules/integrator-guide/pages/automation/execution-flow-details.adoc

include::ROOT:partial$variables.adoc[]

= Execution flow details
:keywords: automation, execution flow
:description: Learn how {PRODUCT_NAME}'s automation works under-the-hood and the different execution flows

The section goes into the details of what causes the automation to execute, the important steps of the execution flow, and what happens with the result of the automation.
A simplified explanation is described xref:automation/index.adoc#automation-flow-overview[here].

[#exec-flow-implicit]
== Implicit automation

An automation is considered *implicit*, if the trigger uses a `before`, or an `after` event; for example `beforeCreate` and `afterCreate`.

Implicit automation is automatically executed whenever we interact with specific resources, such as records or users.
The two variations of events (`before` and `after`) follow the same path, with the difference in when the event is dispatched, and how the resulting value is used.

`before` events are dispatched first and their execution result *may* affect the rest of the execution, while the `after` events are dispatched after and the execution result does *not* affect the rest of the execution.

.The diagram provides an abstract overview of the execution flow for implicit automation. The flow is explained in details bellow the diagram.
[plantuml,exec-flow-dig-implicit,svg,role="exec-flow-dig-implicit data-zoomable"]
----
@startuml
actor User as u
participant "Corteza component" as cc

u -> cc: Perform operation for resource

activate cc

cc -> cc: Access control check
cc -> cc: Content sanitization and validation
note over cc
Not all resources implement
sanitization and validation.
end note

box "Automation system"

participant "Event bus" as evtbs

cc -> evtbs: Dispatch the before event

activate evtbs
evtbs -> evtbs: Filter for registered triggers

participant "Automation" as aa

evtbs -> aa: Trigger execution

activate aa

aa -> aa: Execute automation
note over aa
The automation inherits the
invoking users' permissions
when trying to access Corteza.
end note

aa -> cc: Return the execution result
note over cc
If the automation is asynchronous
the component will not await
for the automation to complete.
end note

deactivate aa
deactivate evtbs

end box

cc -> cc: Process execution result
note over cc
Refer to the bellow description
for details on how the
result is handled.
end note

cc -> cc: Content sanitization and validation
note over cc
Not all resources implement
sanitization and validation.
===
The content is again sanitized
and validated as the automation
may change the values.
end note

cc -> cc: Complete the initial operation
note over cc
This normally changes the data
in the database, hence a
destructive operation.
end note

cc -> evtbs: Dispatch the after event

activate evtbs
evtbs -> evtbs: Filter for registered triggers

evtbs -> aa: Trigger execution

activate aa

aa -> aa: Execute automation
note over aa
The automation inherits the
invoking users' permissions
when trying to access Corteza.
end note

note over cc
The component does not
await for the after event to
complete.
end note

deactivate aa
deactivate evtbs

cc -> u: Response

deactivate cc
@enduml
----

.Detailed outline of the implicit automation execution flow:
[cols="2s,4a"]
|===
| A component receives a request to interact with a resource.
| For example; we wish to create a new record, or update the email of a user.

| Access control checks if the invoker is allowed to perform the operation.
| If the invoker is not allowed to perform the operation, the request is rejected and no automation is executed.

| Content sanitization and validation prepare and validate the data.
| Before any _destructive_ operation occurs and before the `before` event is dispatched, the values are validated and sanitized.
If the validation fails, the request is rejected and no automation is executed.

| The `before` event is dispatched on the `eventbus`.
| If the automation is *synchronous*, the operation awaits for the dispatched event to resolve before continuing the initial operation.
If the automation is *asynchronous*, the initial operation does not await.

.The resulting value of the *synchronous* automation affects how the initial operation should continue:
* If the execution resulted as successful (no errors):
** If the resulting value is set (non-zero value), the resulting value replaces the original value and the initial operation continues.
** If the resulting value is not set (zero value), the original value is used and any modifications by the workflow are omitted.
* If the execution results as failed (an error occurred), the initial operation is canceled and the resource remains untouched.

[CAUTION]
====
A failed execution only terminates the current operation, and will not revert any changes that were made in the executed automation.
====

| Content validation and sanitization occurs.
| Before any _destructive_ operation occurs, the *modified values* are validated and sanitized.
If the validation fails, the request is rejected and the `after` event is *not* dispatched.

| The resource is manipulated.
| The original operation completes and the change is permanently written to the store.

| The `after` event is dispatched on the `eventbus`.
| The operation does *not* await for the event to resolve and the result of the automation is therefore ignored.

[CAUTION]
====
The resulting value of the automation is ignored and does *not* affect the original operation.
====

|===

[#exec-flow-explicit]
== Explicit automation

An automation is considered *explicit*, if the trigger uses an `onManual` event for any resource.

[TIP]
====
In some cases, you can use explicit automation to replace the need for sink routes.

*DevNote* add some documentation regarding the above statement.
====

Explicit automation is executed when manually invoked.
On the front-end this is usually done with a button press, but under-the-hood, this is just an HTTP request to an API endpoint.

[CAUTION]
====
Automation scripts and workflows define separate API endpoints to invoke explicit automation.

For *automation script* this is a `POST $API/$COMPONENT/automation/trigger`, where `$API` is the base URL to your {PRODUCT_NAME} API, and the `$COMPONENT` is the name of the component that should execute the automation script (`compose` or `system`).

For *workflows* this is a `POST $API/automation/$WORKFLOW_ID/exec`, where `$API` is the base URL to your {PRODUCT_NAME} API, and the `$WORKFLOW_ID` is the ID of the workflow you wish to execute.
====

.The diagram provides an abstract overview of the execution flow for explicit automation. The flow is explained in details bellow the diagram.
[plantuml,exec-flow-dig-explicit,svg,role="exec-flow-dig-explicit data-zoomable"]
----
@startuml
actor User as u
participant "Corteza component" as cc

u -> cc: Request to execute an automation

activate cc

cc -> cc: Find the requested automation
cc -> cc: Access control
note over cc
Access control checks if the
user is allowed to execute
this automation.
===
This is workflow specific.
end note

box "Automation system"

participant "Automation" as aa

cc -> aa: Request to execute automation

activate aa

aa -> aa: Execute automation
note over aa
The automation inherits the
invoking users' permissions
when trying to access Corteza.
end note

aa -> cc: Return the execution result
note over cc
If the automation is asynchronous
the component will not await
for the automation to complete.
end note

deactivate aa

end box

cc -> u: Response

deactivate cc
@enduml
----

.Detailed outline of the explicit automation execution flow:
[cols="2s,4a"]
|===
| A component receives a request to execute an automation.
| For example; a CRM user pressed the button to send an email message, or to initiate an outbound phone call.

| (#Workflow specific#) The RBAC facility checks if the invoker is allowed to execute the automation.
| If the invoker is not allowed to execute the workflow, the request is rejected.

[CAUTION]
====
Custom security context (the run as option) does *not* affect the RBAC at this stage.
If the automation in question was triggered by another automation, which defined the run as option, the RBAC will check over the specified invoker.
====

| The automation is executed and the results are returned as a standard HTTP response.
| The results provide the output of the automation, along with some metadata such as execution stack traces and error messages.
|===

[#exec-flow-deferred]
== Deferred automation

An automation is considered *deferred*, if the trigger uses an `onInterval` on an `onTimestamp` event.

Deferred automation is invoked by the system based on the provided temporal information.
The execution is not tied to an operation (such as a manual invocation or an event).

Under-the-hood, {PRODUCT_NAME} defines a ticker, that dispatches `onInterval` and `onTimestamp` events once every minute (can be configured via xref:devops-guide:references/configuration/server.adoc#_eventbus_scheduler_interval[`EVENTBUS_SCHEDULER_INTERVAL`] `.env` variable).
The dispatched events are then used to match and invoke any automation with conforming triggers.

[NOTE]
====
{PRODUCT_NAME} dispatches interval and timestamp events for the system and compose components.
Internally, these events are the same, but are kept for legacy reasons.
====

[CAUTION]
====
Deferred automation *requires* you to explicitly set the invoking user as the automation is executed by the system and we are unable to determine the invoking user.
====

.The diagram provides an abstract overview of the execution flow for deferred automation. The flow is explained in details bellow the diagram.
[plantuml,exec-flow-dig-deferred,svg,role="exec-flow-dig-deferred data-zoomable"]
----
@startuml

participant "Scheduler" as sch

activate sch
note over sch
The scheduler is started at
boot time and terminated when
the server is shut down.
end note

box "Automation system"

participant "Event bus" as evtbs

sch -> evtbs: Dispatch event in intervals
note over sch
The default interval is 1min,
but can be configured.
end note

activate evtbs
evtbs -> evtbs: Filter for registered triggers

participant "Automation" as aa

evtbs -> aa: Trigger execution

activate aa

aa -> aa: Execute automation

deactivate aa
deactivate evtbs
deactivate sch

end box

@enduml
----

.Detailed outline of the explicit automation execution flow:
[cols="2s,4a"] 
|===
| The system ticker dispatches an `onInterval` and an `onTimestamp` event.
| The events are dispatched on the eventbus.

| The automation is executed asynchronously and the results are ignored.
| The execution value of the automation does not affect any other automation.

|===

[#exec-flow-sink]
== Sink automation

An automation is considered *sink*, if the trigger is bound to the `System Sink` resource.

A sink automation is executed when the system component receives an HTTP request to the `/sink` API endpoint.
The execution is not tied to an operation (such as a manual invocation or an event).

[CAUTION]
====
Sink automation *requires* you to explicitly set the invoking user as the automation is executed by an external user and we are unable to determine the invoking user.
====

.The diagram provides an abstract overview of the execution flow for sink automation. The flow is explained in details bellow the diagram.
[plantuml,exec-flow-dig-sink,svg,role="exec-flow-dig-sink data-zoomable"]
----
@startuml

actor Unknown as u

box "Corteza system component"
participant "HTTP Router" as rr
participant "System service" as ss

activate rr
activate ss

u -> rr: HTTP request to /sink

note over u, rr #F5D380A5
Sink requests are validated with
a sink signature, not with the
standard auth token.
end note

rr -> ss: Request to handle

ss -> ss: Verify sink signature
note over ss
* existence,
* location,
* structure,
* validity.
end note

ss -> ss: Validate request with signature
note over ss
The signature claims are
used to validate the request
and the contents.
end note

end box

box "Automation system"

participant "Event bus" as evtbs

ss -> evtbs: Dispatch the onRequest event

activate evtbs
evtbs -> evtbs: Filter for registered triggers

participant "Automation" as aa

evtbs -> aa: Trigger execution

activate aa

aa -> aa: Execute automation
aa -> ss: Return the execution result
note over ss
If the automation is asynchronous
the component will not await
for the automation to complete.
end note

deactivate aa
deactivate evtbs

end box

ss -> ss: Prepare HTTP response
note over ss
Set headers, status, and payload.
end note

ss -> u: Response
note over u, ss
The system component bypasses the REST
layer when responding to sink requests.
end note

deactivate ss

@enduml
----

.Detailed outline of the sink automation execution flow:
[cols="2s,4a"]
|===
| The system component receives an HTTP request to the `/sink` API endpoint.
| For example; `GET $API/system/sink/leads/?__sign=$SIGN`, where `$API` is the base URL to your {PRODUCT_NAME} API, and the `$SIGN` is the sink route signature.

Refer to the xref:devops-guide:sink-route.adoc[DevOps guide/sink routes] for setup details.

| The signature is validated
| Firstly the sink signature is validated to make sure it was not altered.

[NOTE]
====
Sink signatures are generated on-the-fly based on the xref:devops-guide:references/configuration/server.adoc#_auth_jwt_secret[JWT secret] and are *not* stored in the database.
====

| The signature is used to validate the request.
| The system validates the protocol, headers, origin, and other signature constraints.

| The `onRequest` event is dispatched on the `eventbus`.
| If the automation is *synchronous*, the operation awaits for the dispatched event to resolve before continuing the initial operation.
If the automation is *asynchronous*, the initial operation does not await.

.The resulting value of the *synchronous* automation affects how the server should respond:
* If the execution results as failed (an error occurred), the server responds with the error message and (optionally) error stack traces and other debugging metadata.
* If the execution results as successful (no errors), the server prepares a response based on the execution result:
** the status code and response headers are set,
** the response body is encoded as a byte stream and sent as the response.

[CAUTION]
====
Currently only strings and byte slices can be used as the response.
====
|===

[#exec-flow-email]
== Email automation

System email; receive/send

[NOTE]
====
*DevNote*: @todo
====


# src/modules/integrator-guide/pages/automation/index.adoc

include::ROOT:partial$variables.adoc[]

= Automation
:keywords: automation, automate business logic, bpmn, scripting
:description: Learn how to implement custom business logic using the powerful automation facilities {PRODUCT_NAME} offers

{PRODUCT_NAME} provides a powerful automation system that implements custom business logic.
This allows you to extend {PRODUCT_NAME} and support your business needs.

{PRODUCT_NAME} allows you to perform tasks as trivial as inserting missing values, or as complex as collecting payments for your subscription service.
The <<applications,applications>> section covers the applications that the automation system was designed for.

[TIP]
====
Our https://github.com/cortezaproject/corteza-ext/blob/2021.3.x/crm/config/1600_workflows.yaml[CRM] and https://github.com/cortezaproject/corteza-ext/blob/2021.3.x/case-management/config/1600_workflows.yaml[Case Management] applications are open-source.
You can refer to their workflows if you need some inspiration.
====

== Important notes

[IMPORTANT]
====
Please read this sub-section carefully.
It outlines some system design decisions that may not work as expected if not used properly or if their function is assumed.
====

=== Execution cycles

When your automation interacts with {PRODUCT_NAME}, that interaction may execute additional automation.

For example; if your automation is executed *before the record is updated*, and the given automation *explicitly calls an update* for the *same* record, *the same automation will be executed indefinitely* (illustrated on the <<inf-exec-cycle,bellow diagram>>).

There is a mechanism in place to prevent indefinite execution for *workflows*, but none for automation scripts.

When you need to explicitly update the same resource, define some flags to help you keep track of what is going on.
Some updates are automatically performed when using implicit automation.
Refer to xref:automation/execution-flow-details.adoc#exec-flow-implicit[execution flow details] for more insight into the internals.

[#inf-exec-cycle]
.The following is a diagram outlining the potential infinite execution cycle. Note how the explicit update loops back to the update request step.
[plantuml,inf-exec-cycle,svg,role="inf-exec-cycle data-zoomable"]
----
@startuml
|#E5412215|The internet|
:A user updates the lead status;
|Corteza|
repeat :A record update request is received;
  :A before record update automation is executed;
  :Interact with the record and change some values;
backward:HTTP request to Corteza;
note right #E5412215
  Even built-in functions follow
  the exact same path that an external
  request would, meaning that they
  undergo the exact same processing.
end note
repeat while (**Explicitly update** the record)
@enduml
----

=== Asynchronous execution

An automation can be executed synchronously or asynchronously.

When an automation is executed asynchronously, it is *unable* to alter the operation that caused the automation to execute.

To exemplify; an asynchronous automation can not change the values of the record that is about to be created or updated.

[CAUTION]
====
Any workflow that defines a prompt or a delay step is executed asynchronously as the system can not guarantee that the execution will be finished in a timely manner, which may cause further complications and confusion.
====

== Access control

When an automation is executed and the automation interacts with {PRODUCT_NAME}, *the invoking user* (the user that caused the automation to execute) is used when performing access control checks.

If the invoking user is allowed to access a certain resource, the automation is also allowed to access that same resource.
If the invoking user is *not* allowed to access a certain resource, the automation is also *not* allowed to access that same resource.

Any automation executed on the back-end (server scripts and workflows) is able to overwrite this by explicitly setting the invoking user.
The flow of defining the invoking user differs for both automation scripts and workflows, so it is covered in their respective sections.

== Automation facilities

{PRODUCT_NAME} provides two facilities for defining automation;  xref:automation/automation-scripts/index.adoc[automation scripts] and xref:automation/workflows/index.adoc[workflows].

An xref:automation/automation-scripts/index.adoc[automation script] is a piece of JavaScript code that allows you to code your automation.
Automation scripts are low-level and require programming knowledge, as well as some extra steps when setting up.

[IMPORTANT]
====
As of xref:ROOT:changelog/202103.adoc[2021.3], when the workflow feature was introduced, automation scripts are disabled by default and can be enabled by setting the xref:devops-guide:references/configuration/server.adoc#_corredor_enabled[`CORREDOR_ENABLED=true`] `.env` variable.
====

A xref:automation/workflows/index.adoc[workflow] is presented as a simplified BPMN diagram, which allows you to configure instead of code.
Workflows are easier to visualize and maintain, therefore they should be used whenever possible.
If your automation requirement is one of larger scale and includes operations that are not supported by the workflow engine, an automation script is a better choice.

[TIP]
====
A workflow can xref:automation/workflows/automation-scripts.adoc[execute automation scripts]. 
This allows you to mix-and-match the two.
====

[#automation-flow-overview]
== Abstract overview of the automation flow

[NOTE]
====
Refer to xref:automation/execution-flow-details.adoc[execution flow details] for more insight into the internals.
====

An *automation trigger* tells {PRODUCT_NAME} when the automation should be executed.
When the system starts or when there is a change, the triggers are registered on the *event bus*.

[CAUTION]
====
When working with automation scripts and the {APP_AUTOMATION} server is running in production, the {APP_AUTOMATION} server needs to be restarted in order to process new changes.

You can enable the xref:devops-guide:references/configuration/corredor.adoc#CORREDOR_EXT_SERVER_SCRIPTS_WATCH[`CORREDOR_EXT_SERVER_SCRIPTS_WATCH`] and xref:devops-guide:references/configuration/corredor.adoc#CORREDOR_EXT_CLIENT_SCRIPTS_WATCH[`CORREDOR_EXT_CLIENT_SCRIPTS_WATCH`] `.env` variables to be on the lookout for changes.
====

[#internals-overview]
.The diagram below provides the general idea of how the different components interact and how a request invokes an automation. Refer to the xref:automation/execution-flow-details.adoc[execution flow details] section for a deeper dive into the internals.
[plantuml,internals-overview,svg,role="internals-overview data-zoomable"]
----
@startuml
actor User as u
participant "Corteza component" as cc

u -> cc: Perform operation for resource

activate cc

cc -> cc: Preprocessing
note over cc
Preprocessing includes parsing,
access control, data sanitation
and validation.
end note

box "Automation system"

participant "Event bus" as evtbs

cc -> evtbs: Dispatch event

activate evtbs
evtbs -> evtbs: Filter for registered triggers

participant "Automation" as aa

evtbs -> aa: Trigger execution

activate aa

aa -> aa: Execute automation
note over aa
The automation inherits the
invoking user's permissions
when trying to access Corteza.
end note

aa -> cc: Return the execution result
note over cc
If the automation is asynchronous
the component will not await
for the automation to complete.
end note

deactivate aa
deactivate evtbs

end box

cc -> cc: Postprocessing
note over cc
Any additional processing before the
operation completes and the data is
written to the store.
end note

cc -> u: Response

deactivate cc
@enduml
----

When a {PRODUCT_NAME} component receives a request to interact with a resource, it may generate a series of events (usually two; a before and an after event) that describe what is about to happen and the current context.
For example; when we wish to create a new record the compose component would dispatch a `before record create` and an `after record create` events.
Besides the description, the event contains the data that describes the involved resource along with some metadata (the *initial scope*).

[NOTE]
====
The provided data and metadata depend on the trigger.
Refer to the lists of xref:automation/automation-scripts/references/resource-constraints/index.adoc[trigger constraints] and xref:automation/automation-scripts/references/resource-events.adoc[resource events] for more details.
====

The event is dispatched on the *event bus* where the automation system executes every automation that matches the events' constraints with the provided *initial scope* (execution arguments).
The provided data may be used to control the automation execution and, in some cases, manipulate the original operation.

[NOTE]
====
Some flows may bypass the event bus and execute a specific automation directly.
====

[CAUTION]
====
An automation obtains the permissions of the *invoking user* (the user that caused the automation to execute).
A workflow that attempts to perform operations (such as accessing sensitive data), for which the invoking user does not have sufficient permissions, fails.

The invoking user may be overwritten by explicitly setting the security context (the *`runAs`* parameter).
====

When the automation finishes executing, it returns an *execution result*.
The execution result _may_ dictate how the initial operation resolves.

.A quick outline of how the execution result affects the initial operation:
* If the automation is asynchronous, the execution result is *disregarded* and does not manipulate the initial operation.
* If the automation results in an *unknown error*, the initial operation is canceled and no additional processing is done.
* If the automation results *without errors and it returns a zero value*, the initial operation continues as if no automation occurred.
* If the automation results *without errors and it returns a non-zero value*, the returned value is used to replace the original value, if the operation permits it.

[#applications]
== Applications

=== Extend standard operations

{PRODUCT_NAME} components dispatch events on the event bus when the system is about to interact with the resource of the components.
This allows you to detect specific operations and build upon the standard flow, such as create audit log entries, or send a welcome email when a user signs up.
You can also cancel the operation by raising errors when something is not ok.

You can react to such events, by defining a `before`/`after` event listener for a system resource.
For example; if you were to bind the `beforeCreate` event for `Compose Record` resource, you would label such triggers as *implicit*.
You should use the same label for the corresponding automation.

[CAUTION]
====
Only `before` events are able to alter the original operation.
====

Refer to xref:automation/execution-flow-details.adoc#exec-flow-implicit[execution flow details] for more information.

=== Time-based execution

{PRODUCT_NAME} allows you to execute an automation at a specific time or in an interval by using a deferred trigger.
This allows you to delay execution until a specific time, or to perform routine tasks such as generate report emails.

*Timestamp* triggers execute the automation at a specific time using the https://en.wikipedia.org/wiki/ISO_8601[ISO 8601] format.
For example; `2021-01-01T10:30:00Z` executes on first of January at 10:30 AM.

*Interval* triggers execute the automation in an interval using a https://en.wikipedia.org/wiki/Cron[cron expression].
For example; `0 0 1 * *` executes on the first day of each month at 00:00.

[TIP]
====
https://crontab.guru/[Crontab guru] is a tool that helps you write and debug your cron expressions.
====

The default granularity for timestamps and intervals is *one minute*.
You can change this by changing the xref:devops-guide:references/configuration/server.adoc#_eventbus_scheduler_interval[`EVENTBUS_SCHEDULER_INTERVAL`] `.env` variable.

[CAUTION]
====
Finer granularity may lower the performance of the systems.
====

Refer to xref:automation/execution-flow-details.adoc#exec-flow-deferred[execution flow details] for more information.

=== Webhooks and custom endpoints

{PRODUCT_NAME} allows you to execute an automation when a request is received on a specific HTTP API endpoint.
This allows you to define custom API endpoints and webhooks to use with third-party services.

We react to API requests by defining an `onRequest` event for the `System Sink` resource.
For example; you define a sink route with the path of `POST /system/sink/api/request-demo` that collects potential leads sent over by the landing page.

[CAUTION]
====
To use a sink route, you must first register it in the system.
Refer to the xref:devops-guide:sink-route.adoc[DevOps guide] for details.
====

Refer to xref:automation/execution-flow-details.adoc#exec-flow-sink[execution flow details] for more information.

=== Process email requests

{PRODUCT_NAME} allows you to execute an automation when an email is received or sent by the system.

Reacting to email requests can be done by defining an event on the `System Mail` resource; either `onReceive` for inbound emails, or `onSend` for outbound emails.

[CAUTION]
====
You must firstly follow the xref:devops-guide:email-relay.adoc[DevOps guide] to configure the system.
====

Refer to xref:automation/execution-flow-details.adoc#exec-flow-mail[execution flow details] for more information.

[#automation-application-general]
=== General automation

Alongside the event-based model, {PRODUCT_NAME} allows you to implement general use automation that is executed by manual invocation.
Such automation triggers are labeled as *explicit* as they require explicit invocation.

[TIP]
====
Explicit triggers can be invoked via the REST API which may allow you to avoid sink routes and their additional configuration.
====

Define explicit triggers by defining the `onManual` event.
An explicit automation is usually represented as a button on of the {PRODUCT_NAME} user interfaces either inside the xref:compose-configuration/page-blocks.adoc#page-block-automation[automation] or the xref:compose-configuration/page-blocks.adoc#page-block-record-list[record list] page block.

[NOTE]
====
Explicit automation can be defined or specific resources (such as records and users) which indicate the initial scope (execution arguments) of the automation.
====

Refer to xref:automation/execution-flow-details.adoc#exec-flow-explicit[execution flow details] for more information.

== Examples of usage

.Automation examples:
* populate missing values on a newly created record,
* create an audit log when changing specific record values,
* send an email when a new user is added to the system,
* send a monthly report email to executive members.

[NOTE]
====
*DevNote* add some examples and references to the above examples.
====

== Where to next?

To dive deeper into the execution flow and what happens under-the-hood, refer to the xref:automation/execution-flow-details.adoc[execution flow details section].

Refer to the xref:automation/workflows/index.adoc[workflows] section and the xref:automation/automation-scripts/index.adoc[automation scripts] section to learn about the two automation systems.

To see some actual examples, refer to out https://github.com/cortezaproject/corteza-ext/blob/2021.3.x/crm/config/1600_workflows.yaml[CRM] and https://github.com/cortezaproject/corteza-ext/blob/2021.3.x/case-management/config/1600_workflows.yaml[Case Management] applications.
You can use these workflows as a base to implement your own.

You can get in touch with us on our https://forum.cortezaproject.org/[forum] with any questions and suggestions.


# src/modules/integrator-guide/pages/automation/workflows/automation-scripts.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Execution of Automation Scripts
:keywords: automation, workflow execute script
:description: Learn how to combine automation scripts with workflows to execute complex operations

A workflow allows you to execute automation scripts registered within the {APP_AUTOMATION} server.
The ability to execute automation scripts can come in handy when you need to implement complex business logic, but still wish to keep the visual description of a workflow.

== The automation script

[NOTE]
====
Refer to the xref:automation/automation-scripts/index.adoc[] for details regarding automation script internals and how to deploy them to the {APP_AUTOMATION} server.
====

The automation script must define a *manual trigger for the system resource*.
Feel free to use the following example as a starting point.

./server-scripts/invoked-from-the-workflow.js
[source,js]
----
export default {
  label: 'Called From Workflow',
  description: 'This script will be called from workflow function',
  triggers ({ on }) {
    /**
     * Due to how the Corredor scripting system is designed right now,
     * triggers still need to be defined (even if the script is
     * executed explicitly from the workflow).
     */
    return on('manual').for('system')
  },

  exec (args, { logger }) {
    logger.info('success')
  }
}
----

== The workflow

To execute an automation-script, add a function step {ICON_WORKFLOW_FUNCTION} that calls the `Corredor automation script executor` function.
Insert the *script reference* under the script argument.

.The script reference can be obtained by:
* Navigating to the menu:{PRODUCT_NAME} {APP_NAME_ADMIN}[Automation,{APP_AUTOMATION} scripts] and find the automation script you wish to execute and copy its reference.
* Construct it manually using the pattern of `/server-scripts/path-to/the-script/script-name.js:default`.
For the example above, the reference is `/server-scripts/invoked-from-the-workflow.js:default`.

[NOTE]
====
Refer to the xref:automation/automation-scripts/index.adoc[] documentation in case you cannot see your automation scripts.
====

Place a trigger {ICON_WORKFLOW_TRIGGER} and connect it to the function step you've defined earlier.

To test if everything works correctly, click on the run icon in the top right corner of the trigger.
If everything works correctly, you will see a `"success"` string logged by the {APP_AUTOMATION} server after the test has been run.

== Passing custom arguments

Add an expression step {ICON_WORKFLOW_EXPRESSIONS} between the trigger and the function step.

.Define the following expressions:
[source]
----
scriptArgs          (Vars) <1>
scriptArgs.from     (Boolean) = false <2>
scriptArgs.workflow (String)  = "some string" <3>
----
<1> Define a new set of variables that will be passed to the automation script.
<2> Define a `from` variable with the value of `false`.
<3> Define a `workflow` variable with the value of `"some string"`.

Update the function step and set the `args` argument to `scriptArgs` (the variables we've defined in the expression step).

.The automation script can access the prepared arguments as it follows:
[source,js]
----
export default {
  label: 'Called From Workflow',
  description: 'This script will be called from workflow function',
  triggers ({ on }) {
    /**
     * Due to how the Corredor scripting system is currently designed,
     * triggers still need to be defined (even if the script is
     * executed explicitly from the workflow).
     */
    return on('manual').for('system')
  },

  exec (args, { logger }) {
    // unpack arguments
    const { from, workflow } = args

    // log all arguments
    logger.info('these are the special arguments we received', { from, workflow })
  }
}
----

To test whether everything works correctly, click on the run icon in the top right corner of the trigger.
If everything works correctly, you will see a `'these are the special arguments we received' { from: false, workflow: 'some string' }` string logged by the {APP_AUTOMATION} server.

== Reading an execution result

Specify the target variable to collect the output of the automation script in the function step that executes it.
The automation script should return an object.

[CAUTION]
====
Standard automation script rules for return values apply.
If the automation script returns a `false`, we consider this an `Abort` signal and the workflow results with an error.
====

.An example of an automation script that returns a result:
[source,js]
----
export default {
  // ...

  exec (args, { logger }) {
    logger.info('returning some values from the script')
    return {
      a: 123,
      b: true
    }
  }
}
----


# src/modules/integrator-guide/pages/automation/workflows/best-practices.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Best Practices
:keywords: automation, best practices, design patterns
:description: Learn the best approaches to solving common workflow problems

== Define as many trigger constraints as sanity allows

When you click on the configuration icon {ICON_WORKFLOW_COG} in the header of the trigger, you see that it is possible to define multiple trigger constraints.

When defining a "loose trigger" you can run into a situation where some events may trigger the workflow even though they shouldn't.

An example of this is the case module in our CRM and in our Case Management.

.Defining a trigger with these constraints:
image::automation/workflows/best-practices/constraints-no.png[]

If the case was created in the CRM or in the Case Management, it causes the workflow to execute regardless.

To fix this edge-case, you can define an extra constraint that checks the namespace.
See the example below.

image::automation/workflows/best-practices/constraints-yes.png[]

== One expression step may have multiple expressions

When you click on the configuration icon {ICON_WORKFLOW_COG} in the header of the expression step, you see that you can add multiple expressions.

Use this to reduce the number of expression steps, but don't go overboard.
If you wish to change the values of a contact and an account record, define only two expression steps where each focuses only on one record.

.An over-engineered workflow example:
image::automation/workflows/best-practices/compact-no.png[]

The above could easily be rewritten into the below form.

.An appropriate workflow example:
image::automation/workflows/best-practices/compact-yes.png[]

== Most iterators are able to load and process data

xref:automation/workflows/index.adoc#iterator-kind-item[Item iterators] that work with system resources (e.g. {PRODUCT_NAME} {APP_NAME_COMPOSE} records, system users and roles) can both fetch and process the data.

When you need to iterate over external resources (for example, social media posts), you need to fetch those beforehand.

== Use handles whenever possible

Most resources allow you to define a user-friendly identifier next to the system generated identifier (a handle or a slug in case of a namespace).

These identifiers make it easier to write workflows that work across different instances where the identifier may not be the same.
Coherency is also increased; it's easier to read `lead` as an identifier to the lead module instead of `12897612987021`.


# src/modules/integrator-guide/pages/automation/workflows/email-send.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Working with Email
:attachment-path: ../../_attachments/automation/workflows/
:keywords: automation, email sending, workflow email send
:description: Learn how to use workflows for automatic email sending

[IMPORTANT]
====
You need to configure {PRODUCT_NAME} with your SMTP provider to send email messages.
====

== Sending emails directly

Use the *email* function step {ICON_WORKFLOW_FUNCTION} to immediately send an email message.

If you call the email function without specifying the `from` argument, the `SMTP_FROM` `.env` variable is used.

.An example of a workflow set to send an email message:
image::automation/workflows/email-send/email-direct-ex-1.png[role="data-zoomable"]

The source code for the workflow can be found link:{attachment-path}email_direct_send.json[here].

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) Test trigger*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked
2. *(2) Send Email*:
** *type*: `Email`
** *arguments*:
*** *subject*
**** *value type*: constant
**** *value*: `Hello, world!`
*** *replyTo*
**** *value type*: constant
**** *value*: `replyto@test.tld`
*** *from*
**** *value type*: constant
**** *value*: `from@test.tld`
*** *to*
**** *value type*: constant
**** *value*: `to@test.tld`
*** *cc*
**** *value type*: constant
**** *value*: `cc@test.tld`
*** *html*
**** *value type*: constant
**** *value*: `br>Hello, world!</br>`
*** *plain*
**** *value type*: constant
**** *value*: `Hello, world!`
====
****

.The resulting email message:
[source]
----
Cc: cc@test.tld
Content-Type: multipart/alternative; boundary=4305315520b0c6018a31f71ea361d14aba596d49cb6041dcf323dbe83440
Date: Sun, 29 Aug 2021 11:16:06 +0200
From: from@test.tld
MIME-Version: 1.0
Message-ID: omDfvBmYViB5Jo2Y-MESerSmRIi0Z0a7wt9z_LaX_wk=@mailhog.example
Received: from localhost by mailhog.example (MailHog)
          id omDfvBmYViB5Jo2Y-MESerSmRIi0Z0a7wt9z_LaX_wk=@mailhog.example; Sun, 29 Aug 2021 09:16:06 +0000
ReplyTo: replyto@test.tld
Return-Path: <from@test.tld>
Subject: Hello, world!
To: to@test.tld

--4305315520b0c6018a31f71ea361d14aba596d49cb6041dcf323dbe83440
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; charset=UTF-8

Hello, world!
--4305315520b0c6018a31f71ea361d14aba596d49cb6041dcf323dbe83440
Content-Transfer-Encoding: quoted-printable
Content-Type: text/html; charset=UTF-8

<br>Hello, world!</br>
--4305315520b0c6018a31f71ea361d14aba596d49cb6041dcf323dbe83440--
----

== Email builder

The *email builder* function step {ICON_WORKFLOW_FUNCTION} allows you to assemble an email message without sending it.

The email builder allows you to further enrich the email message with additional parameters such as other recipients.

.An example of a workflow made to construct an email message with the email builder.
image::automation/workflows/email-send/email-builder-ex-1.png[role="data-zoomable"]

The source code for the workflow can be found link:{attachment-path}email_builder_send.json[here].

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) Test trigger*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked

2. *(2) Prepare Email*:
** *type*: `Email`
** *arguments*:
*** *subject*
**** *value type*: constant
**** *value*: `Hello, world!`
*** *html*
**** *value type*: constant
**** *value*: `br>Hello, world!</br>`
*** *plain*
**** *value type*: constant
**** *value*: `Hello, world!`
** *results*:
*** *message target*: `msg`

3. *(3) Add recipient*:
** *type*: `Email add address`
** *arguments*:
*** *message*
**** *value type*: expression
**** *value*: `msg`
*** *type*
**** *value type*: constant
**** *value*: `To`
*** *address*
**** *value type*: constant
**** *value*: `testko@test.tld`
*** *name 
**** *value type*: constant
**** *value*: `testko`

4. *(4) Add recipient*:
** *type*: `Email add address`
** *arguments*:
*** *message*
**** *value type*: expression
**** *value*: `msg`
*** *type*
**** *value type*: constant
**** *value*: `To`
*** *address*
**** *value type*: constant
**** *value*: `testko2@test.tld`
*** *name 
**** *value type*: constant
**** *value*: `testko2`

5. *(5) Send message*:
** *type*: `Email sender`
** *arguments*:
*** *message*
**** *value type*: expression
**** *value*: `msg`
====
****

.The resulting email message:
[source]
----
Content-Type: multipart/alternative; boundary=122730f4fe6b767154618c2972886463a224ea74df15f5c96662da9e6a70
Date: Sun, 29 Aug 2021 11:51:33 +0200
From: Corteza <info@local.cortezaproject.org>
MIME-Version: 1.0
Message-ID: m7mFhiH28t1F8HCaTB7g3CKMKH4qE_N4J6uqLDktytE=@mailhog.example
Received: from localhost by mailhog.example (MailHog)
          id m7mFhiH28t1F8HCaTB7g3CKMKH4qE_N4J6uqLDktytE=@mailhog.example; Sun, 29 Aug 2021 09:51:33 +0000
Return-Path: <info@local.cortezaproject.org>
Subject: Hello, world!
To: "testko" <testko@test.tld>, "testko2" <testko2@test.tld>

--122730f4fe6b767154618c2972886463a224ea74df15f5c96662da9e6a70
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; charset=UTF-8

Hello, world!
--122730f4fe6b767154618c2972886463a224ea74df15f5c96662da9e6a70
Content-Transfer-Encoding: quoted-printable
Content-Type: text/html; charset=UTF-8

<b>Hello, world!</b>
--122730f4fe6b767154618c2972886463a224ea74df15f5c96662da9e6a70--
----

=== Email builder methods

[cols="2s,5a"]
|===
| [#email-builder-fnc-message]#<<email-builder-fnc-message,Email builder>>#
|
The function returns an assembled email message, which you can later extend with the following functions.

| [#email-builder-fnc-sendMessage]#<<email-builder-fnc-sendMessage,Email sender>>#
|
The function sends the given email message.

| [#email-builder-fnc-setSubject]#<<email-builder-fnc-setSubject,Email subject>>#
|
The function sets the email subject.

| [#email-builder-fnc-setHeaders]#<<email-builder-fnc-setHeaders,Email headers>>#
|
The function overwrites the headers originally defined by the <<email-builder-fnc-message,email builder>> function.

| [#email-builder-fnc-setHeader]#<<email-builder-fnc-setHeader,Email header>>#
|
The function overwrites the header originally defined by the <<email-builder-fnc-message,email builder>> function.

| [#email-builder-fnc-setAddress]#<<email-builder-fnc-setAddress,Email set address>>#
|
The function overwrites the email addresses of the specified recipient type with the provided address.

.The available recipient types:
* `To`
* `Cc`
* `ReplyTo`
* `From`

| [#email-builder-fnc-addAddress]#<<email-builder-fnc-addAddress,Email add address>>#
|
The function appends the provided email address to the list of specified recipient type list.

.The available recipient types:
* `To`
* `Cc`
* `ReplyTo`
* `From`

| [#email-builder-fnc-attach]#<<email-builder-fnc-attach,Email attachment>>#
|
The function adds an attachment to the email message.

| [#email-builder-fnc-embed]#<<email-builder-fnc-embed,Email embedded attachment>>#
|
The function embeds an attachment to the email message.

|===

== Email Formats

.The following formats are supported when passing email addresses:
`test@mail.tld name`::
  A name optionally follows the email address.
  See the examples provided below:
  * `test@mail.tld Jane Doe`
  * `test@mail.tld Jane`
  * `test@mail.tld`

`{"test@mail.tld": "name"}`::
  A `KV` where the key is an email and the value is the name.
  Examples:
  * `{"test@mail.tld": "Jane Doe"}`
  * `{"test@mail.tld": "Jane Doe", "test2@mail.tld": "John"}`

== Send attachments

Refer to the xref:automation/workflows/examples/email-attachment.adoc[example workflow] for sending attachments.


# src/modules/integrator-guide/pages/automation/workflows/examples/draft-examples.adoc

include::ROOT:partial$variables.adoc[]

= Draft examples
:attachment-path: ../../../_attachments/automation/workflows/examples/
:page-noindex: true

The module used for the examples:

image::automation/workflows/examples/drafts/module.png[role="data-zoomable"]

The link:{attachment-path}module.json[source code] for the module example.

The records used for the examples:

image::automation/workflows/examples/drafts/records.png[role="data-zoomable"]


== Fetching records

The `compose records search` function step allows you to search over the {APP_NAME_COMPOSE} records.
The two basic arguments `module` and `namespace` tell the workflow where we are fetching the records from.
Further arguments are mainly to filter the data, and to control the size of it.

=== Regular fetch

By not specifying the `query`, all of the records are returned.

image::automation/workflows/examples/drafts/wf.png[role="data-zoomable"]

The link:{attachment-path}records-no-filter.json[source code] for the workflow example.

=== Simple filtering

If we want to filter over some field, such as a status flag, we define so in the query.

image::automation/workflows/examples/drafts/wf.png[role="data-zoomable"]

The link:{attachment-path}records-simple-filter.json[source code] for the workflow example.

=== Date range filtering

If we want to filter between two dates, such as "users between year 2000 and 2020" and "is the current date between the `start` and `end` date fields".

image::automation/workflows/examples/drafts/wf.png[role="data-zoomable"]

The link:{attachment-path}records-range-filter.json[source code] for the workflow example.

Note the `year(joined) >= 2000 AND year(joined) <= 2010` query.

=== Filtering by "age"

This is how we can filter for data where a specific timestamp is "x amount of time old", such as "users wo have registered 30days ago" or "the contract will expire in 1 month".

image::automation/workflows/examples/drafts/wf.png[role="data-zoomable"]

The link:{attachment-path}records-age-filter.json[source code] for the workflow example.

Note the `DATE(DATE_ADD(now(), INTERVAL 2 DAY)) = DATE(joined)` query.

[CAUTION]
====
The above filter checks only the date (day) of the timestamp; so the number `30` from `2021-01-30T01:00:00Z`.
If you need more accuracy such as year and month as well, make sure to properly format the adjusted date
====

== Iterators

You can use iterators to iterate over records, as well as using them as regular for and while loops.

Iterators define xref:automation/workflows/index.adoc#_controlling_iterator_execution[two control blocks] -- continue and break.

Both of the control blocks work as anywhere else; continue ends the current iteration and continues with the next one (if any), while the break ends the current iterator.

When you are nesting iterators, the control block only affects the deepest iterator relative to the control block.

=== Regular

The following example is a simple iterator that goes over all of the records.
If you wish to apply filtering over what records you wish to pull, properly set the `query` argument (same as discussed with above fetching).

image::automation/workflows/examples/drafts/iterator-wf.png[role="data-zoomable"]

The link:{attachment-path}records-iterator-regular.json[source code] for the workflow example.

Notice how the iterator is configured; primarily the results section where we specify under what variable the current record/index resides.

=== Nested

The following example is a simple iterator that goes over all of the records for module A, and then through all of the records for module B (in the example, in both iterators we use the same module, but you get the point).

If you wish to apply filtering over what records you wish to pull, properly set the `query` argument (same as discussed with above fetching).

image::automation/workflows/examples/drafts/iterator-nested-wf.png[role="data-zoomable"]

The link:{attachment-path}records-iterator-nested.json[source code] for the workflow example.

Notice how the iterator is configured; primarily the results section where we specify under what variable the current record/index resides.

== Buttons

.To add a button to a page, you need to:
. Define a workflow with an `onManual` event type,
. add a button to the automation page block.

=== Defining the workflow

image::automation/workflows/examples/drafts/manual-wf.png[role="data-zoomable"]

The link:{attachment-path}page-button.json[source code] for the workflow example.

Make sure to use the appropriate resource on the trigger based on where you wish to show it.
If you wish to show it somewhere in the namespace, uwe the `Compose Namespace` resource, on a page `Compose Page`, on a record page `Compose Record` and so on.

Based on what resource you select, the workflow may receive additional context, such as what record you've pressed the button on.

If it doesn't matter, just use `Compose` as the resource.

=== Adding it to a page

Open the page block builder and add a new automation page block (you can reuse existing automation page blocks and append the new workflow).

image::automation/workflows/examples/drafts/pageblock-automation-add.png[role="data-zoomable"]

=== Using it

Open up the page the button resides on and click it.

image::automation/workflows/examples/drafts/pageblock-automation-pressed.png[role="data-zoomable"]


# src/modules/integrator-guide/pages/automation/workflows/examples/dynamic-config.adoc

= Dynamic Configuration
:page-noindex: true
:attachment-path: ../../../_attachments/automation/workflows/examples/

When defining automation which needs to interact with external systems or you need to make the workflow execution configurable, static workflows may prove challenging to use.

You can define a `settings` module where you can define all of the configurable parameters your automation requires.
This can be anything from URL addresses to login credentials and access tokens.

[CAUTION]
====
When storing access tokens and other credentials, make sure to properly configure access control.
====

.The screenshot outlines a basic example of the `settings` module.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/dynamic-config/settings-module.png",
    "alias": "automation-workflows-examples-dynamic-config-settings-module",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

Inside your workflow, simply fetch the record from the `settings` module and configure your execution using it's values.

.The screenshot outlines a basic example of a workflow that utilizes the `settings` module.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/dynamic-config/example-workflow.png",
    "alias": "automation-workflows-examples-dynamic-config-example-workflow",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 144,
    "y": 164,
    "w": 640,
    "h": 398
  },
  "annotations": [{
    "kind": "box-note",
    "x": 500,
    "y": 242,
    "w": 202,
    "h": 80
  }]
}
----

You can find the source code for the workflow link:{attachment-path}dynamic-config/example-workflow.json[here].


# src/modules/integrator-guide/pages/automation/workflows/examples/email-attachment.adoc

= Add an attachment to an email
:attachment-path: ../../../_attachments/automation/workflows/
:page-noindex: true

For this example, let's assume we want to send out customer a quote for the new product they've ordered.
The quote will be provided by our xref:templates/index.adoc[template system].

[IMPORTANT]
====
In order to render templates as PDF documents, xref:devops-guide:pdf-renderer.adoc[PDF rendering must be setup].
====

.The screenshot outlines the workflow that can be used to send an attachment via email.
image::automation/workflows/examples/email-attachment/workflow.png[role="data-zoomable"]

The link:{attachment-path}email_attachment_send.json[source code] for the workflow example.

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) System; onManual*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked
2. *(2) Render quote*:
** *type*: `Template render`
** *arguments*:
*** *lookup*:
**** *type*: `Handle`
**** *value type*: constant
**** *value*: `quote`
*** *documentName*:
**** *value type*: constant
**** *value*: `quote`
*** *documentType*:
**** *value type*: constant
**** *value*: `application/pdf`
*** *options*:
**** *value type*: constant
**** *value*: `{ "documentSize": "A4", "contentScale": "1", "orientation": "portrait", "margin": "0.3" }`
** *results*:
*** *document target*: `quote`
3. *(3) Render email*:
** *type*: `Template render`
** *arguments*:
*** *lookup*:
**** *type*: `Handle`
**** *value type*: constant
**** *value*: `content`
*** *documentType*:
**** *value type*: constant
**** *value*: `text/html`
** *results*:
*** *document target*: `content`
4. *(4) Build base email*:
** *type*: `Email builder`
** *arguments*:
*** *subject*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `Quote for your product`
*** *to*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `example@mail.tld`
*** *html*:
**** *type*: `Reader`
**** *value type*: expression
**** *value*: `content.document`
** *results*:
*** *message target*: `email`
5. *(5) Attach rendered template*:
** *type*: `Email embedded attachment`
** *arguments*:
*** *message*:
**** *type*: `EmailMessage`
**** *value type*: expression
**** *value*: `email`
*** *content*:
**** *type*: `Reader`
**** *value type*: expression
**** *value*: `quote.document`
*** *name*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `quote.pdf`
6. *(6) Send email*:
** *type*: `Email sender`
** *arguments*:
*** *message*:
**** *type*: `EmailMessage`
**** *value type*: expression
**** *value*: `email`
7. *(7) Done*
====
****

[CAUTION]
====
Make sure that the `name` parameter of the `email embedded attachment` uses a correct extension, such as `.txt` for plain text and `.pdf` for PDF.
If the extension is omitted or incorrect, some email clients may display the attachment incorrectly or ignore it altogether.
====

The resulting email message includes the quote PDF as an attachment.

.The screenshot outlines the raw received email message.
image::automation/workflows/examples/email-attachment/email-mime-contents.png[role="data-zoomable"]

== Example templates

The above example uses two templates: `quote` and `content`

.The screenshot outlines the basic email content template used in the example.
image::automation/workflows/examples/email-attachment/template-base-content.png[role="data-zoomable"]

.The source code for the email content template:
[source,html]
----
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Quote for our services</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
  <h1>Hello!</h1>
  <p>
    Attached is the quote for our services.
  </p>
  <p>
    Best, Team ltd
  </p>
</body>
</html>
----

.The screenshot outlines the basic quote template used in the example.
image::automation/workflows/examples/email-attachment/template-base-quote.png[role="data-zoomable"]

.The source code for the quote template:
[source,html]
----
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Quote#012356</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
  <h1>Quote#012356</h1>
  <p>
    Service quote for our services
  </p>
</body>
</html>
----


# src/modules/integrator-guide/pages/automation/workflows/examples/execution-timeout.adoc

include::ROOT:partial$variables.adoc[]

= Execution timeout
:page-noindex: true

{PRODUCT_NAME} workflows' execution does not timeout by default (the workflow can run indefinitely).

If your use-case requires you to define a timeout, you can implement this manually.

.The below example does two things:
* Schedule a timeout after 10sec of execution,
* repeat the iterator indefinitely.

image::automation/workflows/examples/manual-timeout.png[role="data-zoomable"]

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) Test trigger*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked
2. *(2) Fork*:
** *gateway*: `Inclusive`
** *conditions*:
*** `true`
*** `true`
3. *(3) Wait 10sec*:
** *offset*: `10`
4. *(4) Log context timeout*:
** *type*: `Log debug message`
** *arguments*:
*** *message*:
**** *value type*:  constant
**** *value*: `Context timeout`
5. *(5) Context timeout*: /
6. *(6) Repeat indefinitely*:
** *type*: `Condition`
** *arguments*:
*** *while*:
**** *value type*: expression
**** *value*: `true`
7. *(7) Log iteration*:
** *type*: `Log debug message`
** *arguments*:
*** *message*:
**** *value type*: constant
**** *value*: `Iterator loop`
8. *(8) Done*: /
9. *(9) Completed*: /
====
****


# src/modules/integrator-guide/pages/automation/workflows/examples/gw-parse-payload.adoc

= Parse Integration Gateway Request
:attachment-path: ../../../_attachments/automation/workflows/
:page-noindex: true

For this example, let's parse a request sent to the xref:api-gw/index.adoc[]

.The screenshot outlines the workflow that can be used to process the request.
image::automation/workflows/examples/parse-gateway-payload.png[role="data-zoomable"]

The link:{attachment-path}request_process.json[source code] for the workflow example.

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) System; onManual*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked
2. *(2) Parse request payload*:
** *type*: `Process arbitrary data in jsenv`
** *arguments*:
*** *scope*:
**** *type*: `Any`
**** *value type*: expression
**** *value*: `payload`
*** *source*: refer below
** *results*:
*** *resultAny*: `parsedPayload`
3. *(3) Debug state*
4. *(7) Done*
====
****

== Integration gateway configuration

.Below are the configuration parameters for the corresponding integration gateway:
[cols="1s,5a"]
|===
| Endpoint
| `/examples/payload`

| Prefilter
| Header: `Token == "SOME_SECRET_TOKEN"`

| Processing
| Workflow processer: `On request payload notify user`

| Postfilter
| `Default JSON Response`
|===

== cURL request

.Below is an example of the cURL request that invokes the integration gateway and workflow:
[source,bash]
----
curl -X POST "$CORTEZA_BASE/api/gateway/examples/payload" \
  -H "Content-Type: application/json" \
  -H 'Token: SOME_SECRET_TOKEN' \
  -d '{"name":"Peter","id":123}';
----

== JSEnv parsing function

.Below is the extracted source code which should be used in the JSEnv function step:
[source,js]
----
var inputData;

try {
    inputData = JSON.parse(input)
} catch (e) {
    throw new Error('could not parse input payload: ' + e);
}

if (!inputData.name) {
    throw new Error('could not parse input payload, name missing');
}

return {
    id: inputData.id,
    name: inputData.name
}
----


# src/modules/integrator-guide/pages/automation/workflows/examples/index.adoc

= Examples

:leveloffset: +1

include::./email-attachment.adoc[]

include::./gw-parse-payload.adoc[]

include::./interval.adoc[]

include::./template-rendering.adoc[]

include::./timestamp.adoc[]

include::./record.adoc[]

include::./parallelism.adoc[]

include::./dynamic-config.adoc[]

include::./execution-timeout.adoc[]

include::./messagebus-read-write.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/automation/workflows/examples/interval.adoc

= Interval
:page-noindex: true

For this example, let's assume we want to send an email to all users every Christmas at midnight.
For this, we use a trigger of type `onInterval` with the interval `0 0 25 12 *`

image:automation/workflows/examples/workflow-example-interval.png[]

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) Test trigger*:
** *resource*: `System`
** *event*: `onInterval`
** *enabled*: checked
** *constraints*: 
*** *interval*: `0 0 25 12 *`
2. *(2) Iterate over Users*:
** *type*: `Users`
** *results*:
*** *user target*: `user`
3. *(3) Send Email*:
** *type*: `Email`
** *arguments*:
*** *subject*:
**** *value type*: constant
**** *value*: `Merry christmas`
*** *to*:
**** *value type*: expression
**** *value*: `user.email`
*** *plain*:
**** *value type*: constant
**** *value*: `Merry christmas`
4. *(4) Done*:
====
****


# src/modules/integrator-guide/pages/automation/workflows/examples/messagebus-read-write.adoc

include::ROOT:partial$variables.adoc[]

= Messagebus Queue
:attachment-path: ../../../_attachments/automation/workflows/
:page-noindex: true

Messagebus queue mechanism complements the workflows in a way that any asynchronous computation can be offloaded to another workflow or workflow-extendable process.
More info on the described topics can be found at xref:automation/workflows/index.adoc[], Integration Gateway xref:api-gw/profiler.adoc[] and the xref:developer-guide:corteza-server/messagebus.adoc[] subsystem.

.In this example we will:
* create a queue
* create an endpoint
* write to queue via workflow
* read from queue via workflow
** send a payload to an endpoint
* view endpoint payload in profiler

== Create a new Queue

[IMPORTANT]
====
The `Consumer` here should be `Eventbus`, since this is how the internal mechanism provides the payload data to the {PRODUCT_NAME} subsystems, including Workflows.
====

.The screenshot shows the creation of the queue in UI.
image::automation/workflows/examples/queue-create.png[role="data-zoomable"]

== Write to Queue

This is a workflow we will use just to manually trigger the write to queue.

[NOTE]
====
You can either use any of the automation buttons to trigger this workflow from the UI.
Usually the case would be after creating a record and then sending the new recordID to the queue.
====

The payload is defined as an `Array` that is then stringified
[source,json]
----
toJSON([
  {"key":"foo", "value": "bar"},
  {"key":"bar", "value": "baz"}
])
----

.A screenshot of the add to queue workflow.
image::automation/workflows/examples/queue-wf-add.png[role="data-zoomable"]

The link:{attachment-path}queue_add.json[source code] for the workflow example.

== Read from Queue

Here we parse the queue payload and create a custom HTTP request to an outside, ie. Kafka (in our example an endpoint we will create for this purpose only).

.An example of reading the data from queue.
image::automation/workflows/examples/queue-wf-read.png[role="data-zoomable"]

The link:{attachment-path}queue_read.json[source code] for the workflow example.

== Create a mock service endpoint

What we need now is to trigger the `Queue Write` workflow and a request will be sent to our local server on the `/api/gateway/example_kafka` endpoint.

The resulting request can be seen on the Integration Gateway profiler (if you have it enabled, see more at xref:api-gw/profiler.adoc[]).

.Adding a new endpoint to the Integration Gateway.
image::automation/workflows/examples/queue-endpoint.png[role="data-zoomable"]

== Preview the request in the Profiler

This preview is for example only, a way to use the profiler to debug any sending payloads to production / external services.

.Preview the request headers and other metadata.
image::automation/workflows/examples/queue-profiler-1.png[role="data-zoomable"]

.Preview the request payload.
image::automation/workflows/examples/queue-profiler-2.png[role="data-zoomable"]


# src/modules/integrator-guide/pages/automation/workflows/examples/parallelism.adoc

include::ROOT:partial$icons.adoc[]

= Parallelism
:attachment-path: ../../../_attachments/automation/workflows/examples/
:page-noindex: true

This section provides some examples on how you should perform tasks in parallel.

== Unconditional parallelism

Unconditional parallelism should be used when two or more branches of execution should be done in parallel regardless of the state.

To achieve this, use the *fork gateway* {ICON_WORKFLOW_GATEWAYPARALLEL} where each outbound branch defines one branch of parallel execution.

[CAUTION]
====
If any of the branches defines the *termination step* {ICON_WORKFLOW_TERMINATION}, the entire workflow will be terminated.
====

.The screenshot outlines a basic example of unconditional parallel execution.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/parallelism/unconditional.png",
    "alias": "automation-workflows-examples-parallelism-unconditional",
    "w": 1920,
    "h": 1080
  },
  "view": {
      "x": 105,
      "y": 245,
      "w": 720,
      "h": 600
  },
  "annotations": []
}
----

You can find the source code for the workflow link:{attachment-path}parallelism/unconditional.json[here].

== Unconditional parallel segment

A parallel segment is where the workflow transitions from sequential execution into parallel execution and back into sequential execution.

Unconditional parallelism should be used when two or more branches of execution should be done in parallel regardless of the state.

To achieve this, use the *fork gateway* {ICON_WORKFLOW_GATEWAYPARALLEL} where each outbound branch defines one branch of parallel execution.
Terminate the parallel segment by using the *join gateway* {ICON_WORKFLOW_GATEWAYPARALLEL}.

[CAUTION]
====
If any of the branches defines the *termination step* {ICON_WORKFLOW_TERMINATION}, the entire workflow will be terminated.
====

.The screenshot outlines a basic example of unconditional parallel execution.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/parallelism/unconditional-segment.png",
    "alias": "automation-workflows-examples-parallelism-unconditional-segment",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 372,
    "y": 67,
    "w": 720,
    "h": 918
  },
  "annotations": []
}
----

You can find the source code for the workflow link:{attachment-path}parallelism/unconditional-segment.json[here].

== Conditional parallelism

conditional parallelism should be used when two or more branches of execution should be done in parallel regardless of the state.

To achieve this, use the *fork gateway* {ICON_WORKFLOW_GATEWAYPARALLEL} where each outbound branch defines one branch of parallel execution.

[CAUTION]
====
If any of the branches defines the *termination step* {ICON_WORKFLOW_TERMINATION}, the entire workflow will be terminated.
====

.The screenshot outlines a basic example of conditional parallel execution.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/parallelism/conditional.png",
    "alias": "automation-workflows-examples-parallelism-conditional",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 370,
    "y": 169,
    "w": 722,
    "h": 601
  },
  "annotations": []
}
----

You can find the source code for the workflow link:{attachment-path}parallelism/conditional.json[here].

== Conditional parallel segment

A parallel segment is where the workflow transitions from sequential execution into parallel execution and back into sequential execution.

conditional parallelism should be used when two or more branches of execution should be done in parallel regardless of the state.

To achieve this, use the *fork gateway* {ICON_WORKFLOW_GATEWAYPARALLEL} where each outbound branch defines one branch of parallel execution.
Terminate the parallel segment by using the *join gateway* {ICON_WORKFLOW_GATEWAYPARALLEL}.

[CAUTION]
====
If any of the branches defines the *termination step* {ICON_WORKFLOW_TERMINATION}, the entire workflow will be terminated.
====

.The screenshot outlines a basic example of conditional parallel execution.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/parallelism/conditional-segment.png",
    "alias": "automation-workflows-examples-parallelism-conditional-segment",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 250,
    "y": 67,
    "w": 920,
    "h": 1000
  },
  "annotations": []
}
----

You can find the source code for the workflow link:{attachment-path}parallelism/conditional-segment.json[here].



# src/modules/integrator-guide/pages/automation/workflows/examples/record.adoc

= Workfing with Records
:attachment-path: ../../../_attachments/automation/workflows/examples/record/
:page-noindex: true

The section outlines some tips and tricks you can use when working with records.

== Checking for existence

In case where you wish to perform some task depending on the existence of records, you can use either of the following approaches.

Both approaches are valid and there is no benefit between using one or the other.
Decide based on your preferences/context.

=== Approach A

When searching for records, tick the `incTotal` option and assign the `total` result value to a variable.

Inside the gateway, check if the `total` value is greater then `0`.

.The screenshot outlines a basic example of checking for existence.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/record/existence-a.png",
    "alias": "automation-workflows-examples-record-existence-a",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 325,
    "y": 97,
    "w": 718,
    "h": 600
  },
  "annotations": []
}
----

You can find the source code for the workflow link:{attachment-path}existence-a.json[here].

=== Approach B

Inside the gateway, check if the `count(items)` value is greater then `0`.

.The screenshot outlines a basic example of checking for existence.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/record/existence-b.png",
    "alias": "automation-workflows-examples-record-existence-b",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 325,
    "y": 97,
    "w": 718,
    "h": 600
  },
  "annotations": []
}
----

You can find the source code for the workflow link:{attachment-path}existence-b.json[here].

== Create or update

When creating the record you need to call the `compose record create` function, and when updating the record, you need to call the `compose record update` function.

[NOTE]
====
Only the highlighted portion performs the create/update check; the rest is boilerplate to get it to the desired state.
====

If you need to call one or the other on-the-fyly, you can use the following approach.
You can use the `record.recordID != "0"` to determine if the record needs to be updated -- the default `recordID` value is `"0"`.

.The screenshot outlines a basic example of checking for existence.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/record/create-update.png",
    "alias": "automation-workflows-examples-record-create-update",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 413,
    "y": 67,
    "w": 837,
    "h": 997
  },
  "annotations": [{
    "kind": "box-note",
    "x": 490,
    "y": 824,
    "w": 680,
    "h": 201
  }]
}
----

You can find the source code for the workflow link:{attachment-path}create-update.json[here].

== Removing the value

To remove some record value, use an expression step to set the value in question to an empty `Any`.

.The screenshot outlines a basic example of removing record values.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/record/remove-value.png",
    "alias": "automation-workflows-examples-record-remove-value",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 740,
    "y": 0,
    "w": 1180,
    "h": 482
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "xs",
    "x": 1420,
    "y": 340,
    "w": 490,
    "h": 42
  }]
}
----

You can find the source code for the workflow link:{attachment-path}remove-value.json[here].

== Handling missing values

To use the default value in case the record value does not exist, you need to use the `??` operator.

To exemplify, using `a ?? b` will return `a` if it exists or `b` if it does not.

[NOTE]
====
The below example uses a variable as the default value.
You can use a constant such as `"something string"` or `42`.
====

.The screenshot outlines a basic example of using default values.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/examples/record/missing-value-default.png",
    "alias": "automation-workflows-examples-record-missing-value-default",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 740,
    "y": 0,
    "w": 1180,
    "h": 1003
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "xs",
    "x": 1420,
    "y": 340,
    "w": 490,
    "h": 576
  }]
}
----

You can find the source code for the workflow link:{attachment-path}missing-value-default.json[here].


# src/modules/integrator-guide/pages/automation/workflows/examples/template-rendering.adoc

= Template rendering
:attachment-path: ../../../_attachments/automation/workflows/
:page-noindex: true

In this example, we'll take a look at how to render different templates that were made in our xref:templates/index.adoc[template system].

To start, create a template of type HTML in our templating system located in the admin area.

== Rendering an HTML template

Create a workflow similar to the one below.

Make sure to look at the step details of steps (2) and (3).

.The screenshot outlines the workflow that renders an HTML template and sends it as an email.
image::automation/workflows/examples/template-rendering/html-workflow.png[role="data-zoomable"]

The source code for the workflow can be found link:{attachment-path}template_rendering_html.json[here].

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) System; onManual*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked
2. *(2) Render template*:
** *type*: `Template render`
** *arguments*:
*** *lookup*:
**** *type*: `Handle`
**** *value type*: constant
**** *value*: `email-template`
*** *documentName*:
**** *value type*: constant
**** *value*: `Email template`
*** *documentType*:
**** *value type*: constant
**** *value*: `text/html`
** *results*:
*** *document target*: `renderedTemplate`
3. *(3) Send email*:
** *type*: `Email`
** *arguments*:
*** *subject*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `Email template`
*** *from*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `demo@mail.com`
*** *to*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `test@mail.com`
*** *html*:
**** *type*: `Reader`
**** *value type*: expression
**** *value*: `renderedTemplate.document`
** *results*:
*** *document target*: `content`
====
****

[CAUTION]
====
Make sure that the `documentType` parameter of the `(2) Render template` is of value `text/html`.
====

== Rendering a PDF template
The difference between HTML and PDF rendering is that the `documentType` parameter changes to `application/pdf`.

With PDFs you can also adjust the xref:integrator-guide:templates/index.adoc#tpl-render-options_marginBottom[render options] to modify how the final PDF is rendered.

[IMPORTANT]
====
In order to render templates as PDF documents, you need to setup xref:devops-guide:pdf-renderer.adoc[PDF rendering].
====

.The screenshot outlines the workflow that renders a PDF template and sends it as an email attachment.
image::automation/workflows/examples/template-rendering/pdf-workflow.png[role="data-zoomable"]

The source code for the workflow can be found link:{attachment-path}template_rendering_pdf.json[here].

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) System; onManual*:
** *resource*: `System`
** *event*: `onManual`
** *enabled*: checked
2. *(2) Render template*:
** *type*: `Template render`
** *arguments*:
*** *lookup*:
**** *type*: `Handle`
**** *value type*: constant
**** *value*: `pdf-template`
*** *documentName*:
**** *value type*: constant
**** *value*: `PDF template`
*** *documentType*:
**** *value type*: constant
**** *value*: `application/pdf`
*** *options*:
**** *type*: `renderOptions`
**** *value type*: expression
**** *value*: `{
  "documentSize": "A4",
  "contentScale": "1",
  "orientation": "portrait",
  "margin": "0.3"
}`
** *results*:
*** *document target*: `renderedTemplate`
3. *(3) Build email*:
** *type*: `Email builder`
** *arguments*:
*** *subject*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `PDF template`
*** *from*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `test@mail.com`
*** *to*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `example@mail.com`
*** *html*:
**** *type*: `Reader`
**** *value type*: expression
**** *value*: `content.document`
** *results*:
*** *message target*: `email`
4. *(4) Attach PDF template*:
** *type*: `Attach PDF template`
** *arguments*:
*** *message*:
**** *type*: `EmailMessage`
**** *value type*: expression
**** *value*: `email`
*** *content*:
**** *type*: `Reader`
**** *value type*: expression
**** *value*: `renderedTemplate.document`
*** *name*:
**** *type*: `String`
**** *value type*: constant
**** *value*: `PDF template.pdf`
5. *(5) Send email*:
** *type*: `Email sender`
** *arguments*:
*** *message*:
**** *type*: `EmailMessage`
**** *value type*: expression
**** *value*: `email`
====
****

[TIP]
====
You can combine both types of templates to render dynamic emails with PDF attachments.

The example for the workflow can be found xref:integrator-guide:automation/workflows/examples/email-attachment.adoc[here]
====

# src/modules/integrator-guide/pages/automation/workflows/examples/timestamp.adoc

= Timestamp
:page-noindex: true

For this example, let's assume we want to wish all users a Happy new year.
All the emails need to be sent out at exactly midnight.
For this, we use a trigger of type `onTimestamp` with the timestamp of `2021-01-01T00:00:00Z`

image:automation/workflows/examples/workflow-example-timestamp.png[]

****
.Workflow step details:
[%collapsible.result]
====
1. *(1) Test trigger*:
** *resource*: `System`
** *event*: `onTimestamp`
** *enabled*: checked
** *constraints*: 
*** *timestamp*: `2021-01-01T00:00:00Z`
2. *(2) Iterate over Users*:
** *type*: `Users`
** *results*:
*** *user target*: `user`
3. *(3) Send Email*:
** *type*: `Email`
** *arguments*:
*** *subject*:
**** *value type*: constant
**** *value*: `Happy new year`
*** *to*:
**** *value type*: expression
**** *value*: `user.email`
*** *plain*:
**** *value type*: constant
**** *value*: `Happy new year`
4. *(4) Done*:
====
****


# src/modules/integrator-guide/pages/automation/workflows/execution-lifecycle.adoc

include::ROOT:partial$variables.adoc[]

= Execution Lifecycle

*@todo*

An automation session describes an automation that has executed or is still executing.
Sessions can be used to debug a failing automation and to identify any infinite cycling issues preventing the system from working properly.

.To list current sessions:
. Navigate to menu:system[sessions],
. optionally insert the filtering parameters (the list refreshes automatically).

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/execution-lifecycle/sessions-list.png",
    "alias": "automation-workflows-execution-lifecycle-sessions-list",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 717,
    "w": 288,
    "h": 37
  }]
}
----

== Session states

[NOTE]
====
*DevNote* take note of the states

* completed: Completed
* excluded: Without
* exclusive: Only
* failed: Failed
* inProgress: completed sessions
* inclusive: Including
* prompted: Prompted
* sessions: sessions
* started: Started
* suspended: Suspended
====
//Editor's note: remove the above note or elaborate on every point


# src/modules/integrator-guide/pages/automation/workflows/func-reference.adoc

= Function Reference

:leveloffset: +1

include::generated:partial$afunc.gen.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/automation/workflows/index.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Workflows
:page-aliases: 2024.9@automation/workflows/delaying-scheduling.adoc
:keywords: automation, automate business logic, workflows, bpmn, diagram
:description: Lean how to use workflows for visual business logic configuration based on a simplified BPMN model

{PRODUCT_NAME} workflow allows you to implement custom business logic without the need for any programming knowledge.
This section focuses on the most important aspects of the system.
If you wish to learn more about a specific topic, refer to the subsections under menu:Low-Code Platform Developer Guide[Automation,Workflows].

In contrast to xref:automation/automation-scripts/index.adoc[automation scripts], workflows are presented as a simplified BPMN diagram, allowing you to configure instead of code.
You are not required to have any BPMN knowledge, although it might be helpful.

// [IMPORTANT]
// ====
// All of the data in the workflow is typed.
// Refer to xref:automation/workflows/types.adoc[type index] for more details.
// ====

== Create a new workflow

[NOTE]
====
*DevNote* how to include the flow from the admin panel?
====

To create a workflow, navigate to your {PRODUCT_NAME} instance (for example http://latest.cortezaproject.org/) and click ok the "Workflows" application.

.The screenshot indicates how to access the workflow web application.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "app-selector.png",
    "alias": "automation-workflows-app-selector-workflow",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 828,
    "y": 513,
    "w": 266,
    "h": 218,
    "padding": "md"
  },
  "annotations": []
}
----

A new screen showing you all of the available workflows will appear.

.From there you can:
* create new workflows by clicking on the btn:[New Workflow] button,
* edit existing workflows by clicking on them,
* manage global permissions by clicking on the btn:[Permissions] button,
* manage workflow-specific permissions by clicking on the "Lock" icon next to the workflow, or
* import/export workflows by clicking on the btn:[Import]/btn:[Export] buttons.

.The screenshot indicates how to create a new workflow.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/list.png",
    "alias": "automation-workflows-workflow-list",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 425,
    "y": 96,
    "w": 146,
    "h": 42
  }]
}
----

When you click on the *btn:[New Workflow]* button, a new screen will appear with an open modal window, where you should insert initial parameters to describe the workflow.

* *Label* provides a user-friendly identifier for the workflow, for example "Test Workflow".
A label doesn't define any special constraints.
* *Handle* defines a <<wf-handle-constraints,unique value>> that may be used instead of the system identifier for easier referencing.
* *Description* defines a verbose description of the workflow in order to better explain what the workflow does.
* *Run as* defines which user should be used when executing this workflow (the invoking user).

[#wf-handle-constraints]
.Handle constraints:
include::partial$handle-constraints.adoc[]

.The screenshot shows the newly created workflow where the modal window for the initial parameters is open.
image::automation/workflows/edit.png[role="data-zoomable"]

== About the workflow editor

The workflow editor consists of four main parts; workflow configuration screen, toolbar, canvas, and step configurator.

. *Workflow configuration* (accessible by clicking on the configuration icon {ICON_WORKFLOW_COG} in the header) is where you provide basic workflow configurations.
. *Toolbar* is where you can find all of the available steps.
. *Canvas* is where you can build and configure the workflow.
. *Step configurator* is where you can configure the workflow steps.

.The workflow editor user interface.
image::automation/workflows/editor.svg[role="data-zoomable"]

=== Structure the workflow

To start building your workflow, simply drag-and-drop different elements (further referred to as steps) from the toolbar to the canvas.
If you are using similar steps with similar configurations, using copy-paste to duplicate existing steps might be faster (kbd:[cmd+c] and kbd:[cmd+v]).

.Example of adding a new step from the toolbar to the canvas.
image::automation/workflows/step-add.svg[role="data-zoomable"]

To define the flow of your workflow, simply connect the steps by drawing a connector between them.

.Example of connecting two steps.
image::automation/workflows/step-connect.svg[role="data-zoomable"]

To change the start point or the end point of the connector, click on the connector to view its points; then hover over the connecting point and drag it to another connector point.

.Example of changing the origin connector point.
image::automation/workflows/step-connect-move-from.svg[role="data-zoomable"]

.Example of changing the destination connector point.
image::automation/workflows/step-connect-move-to.svg[role="data-zoomable"]

Add some extra steps to get the feel for the interface.
The resulting workflow doesn't need to be valid or make any sense.
All of the available steps and their configuration will be addressed in detail in the following sections.

.Gesture reference:
* Click and hold the right mouse button, drag the mouse to *pan the canvas*.
* Scroll up to *zoom in the canvas* (inverted when natural scrolling is enabled).
* Scroll down to *zoom out the canvas* (inverted when natural scrolling is enabled).

[TIP]
====
The remaining gestures and keyboard shortcuts can be found in the help menu.
====

[IMPORTANT]
====
Remember, every workflow must start with a trigger {ICON_WORKFLOW_TRIGGER}.
The termination step {ICON_WORKFLOW_TERMINATION} is optional, but may increase clarity.
A single workflow can have multiple triggers and multiple termination steps.
====

When you're satisfied with your workflow or wish to save your progress, click on the save button on the bottom of the screen, or use the kbd:[ctrl+s] shortcut.

.The screenshot shows how to save the workflow.
image::automation/workflows/save.svg[role="data-zoomable"]

=== Configuring the workflow

Without any configuration, most workflow steps don't do anything unless we configure them to perform some task such as evaluating an expression or executing a complex function.

In order to configure specific steps, click on the configuration icon {ICON_WORKFLOW_COG} in the header of the step.
To configure a specific connector, click on its label or double click on it.

The configuration is automatically saved to the step.
The workflow needs to be saved in order for the configuration to take affect.

.The screenshot shows the step connector for the expression step.
image::automation/workflows/step-config.svg[role="data-zoomable"]

== Execution control

Execution control allows you to indicate where the workflow starts, its steps, and where the workflow ends.

[#step-exec-triggers]
=== Triggers

A *trigger* {ICON_WORKFLOW_TRIGGER} defines when the workflow is executed and what steps the workflow execution should perform.

[TIP]
====
A single workflow can have multiple triggers.
Multiple triggers allow you to define fewer workflows for different events.
====

Every time an action occurs (e.g. a record is created or a user signed-up) the system finds all of the workflows with a trigger that conform to that operation.
To exemplify; when a client signs-up for your newsletter, the system finds all of the workflows where the trigger listens to a "user signed up" event.

.A trigger consists of four main components (click on the configuration icon in the header):
. a *resource* which specifies what system resource the trigger reacts to,
. an *event* which specifies what system events the trigger reacts to,
. a series of *constraints* which specify how an event should look like in order for the trigger to react.
** To exemplify; we can react to a {PRODUCT_NAME} created event only when the record was created for a lead module under the CRM namespace,
. an *initial scope* which specifies what variables are available to the workflow as soon as it is executed.
When working with records this is the current record, the previous version of it, the related module, the related namespace, and any record validation errors.

[TIP]
====
Constraint your triggers as much as possible to prevent your workflows from executing when they shouldn't.
====

.An example of a workflow with multiple triggers.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/multi-trigger.png",
    "alias": "automation-workflows-multi-trigger",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 263,
    "y": 83,
    "w": 678,
    "h": 558
  },
  "annotations": [{
    "kind": "box-note",
    "x": 341,
    "y": 163,
    "w": 521,
    "h": 78
  }]
}
----

[#step-exec-terminator]
=== Terminators

A *termination step* {ICON_WORKFLOW_TERMINATION} terminates the execution of a workflow.

[CAUTION]
====
The termination step {ICON_WORKFLOW_TERMINATION} terminates the entire workflow, regardless of any other execution branches.

.An example of a workflow with multiple terminators with a potential early termination issue.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/terminator-long-tasks.png",
    "alias": "automation-workflows-terminator-long-tasks",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 144,
    "y": 84,
    "w": 837,
    "h": 677
  },
  "annotations": [{
    "kind": "box-danger",
    "x": 222,
    "y": 441,
    "w": 680,
    "h": 242
  }]
}
----

In the example above, when any of the long running tasks finishes, the entire workflow will be terminated and the other long running task gets canceled.

Refer to xref:automation/workflows/examples/parallelism.adoc[] for details.
====

The termination step is not required, and is implied wherever the workflow is unable to continue due to the lack of steps.

[TIP]
====
A single workflow can have multiple termination steps.
Multiple termination steps allow you to explicitly terminate the execution of a workflow.
====

.An example of a workflow with multiple termination steps.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/multi-terminator.png",
    "alias": "automation-workflows-multi-terminator",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 384,
    "y": 84,
    "w": 636,
    "h": 717
  },
  "annotations": [{
    "kind": "box-note",
    "x": 461,
    "y": 644,
    "w": 200,
    "h": 77
  }, {
    "kind": "box-note",
    "x": 741,
    "y": 444,
    "w": 200,
    "h": 77
  }]
}
----

[#expressions]
== Expressions

An *expression step* {ICON_WORKFLOW_EXPRESSIONS} defines a set of expressions which allow you to directly interact with values defined in your workflow.
Think of this as defining an equation in spreadsheets.

A single expression step can define multiple expressions, allowing you to aggregate similar operations under a single step; this reduces the size and increases readability.
Refer to xref:expr/index.adoc[] for more details regarding expression definition.

.Examples of usage:
* generate a full name for a contact,
* calculate the grand total for a quote,
* copy values from one record to another.

To configure the expression step, click on the configuration icon {ICON_WORKFLOW_COG} in the header of the expression step.

.The expression configuration interface.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/expressions-example.png",
    "alias": "automation-workflows-expressions-example-cfg",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 1100,
    "y": 0,
    "w": 820,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1313,
    "y": 253,
    "w": 20,
    "h": 20
  }]
}
----

To add a new expression to the expression step, click on the btn:[+ Add Expression] button.
Click on the expression to collapse or collapse the expression editing interface.

.The expression configuration interface with inserted expressions.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/expressions-example.png",
    "alias": "automation-workflows-expressions-example-expr",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 1100,
    "y": 0,
    "w": 820,
    "h": 1080
  },
  "focus": {
    "x": 1420,
    "y": 0,
    "w": 499,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1755,
    "y": 1038,
    "w": 153,
    "h": 28
  }]
}
----

[#functions]
== Functions

A *function step* {ICON_WORKFLOW_FUNCTION} defines what operation should be performed when the function step is executed.
Think of this as defining a macro in spreadsheets.

[IMPORTANT]
====
If you're using logging functions, make sure to correctly set your environment variables.
Refer to the xref:devops-guide:troubleshooting/logging.adoc[DevOps guide] for details.
====

.Examples of usage:
* create a new quote for an account,
* send an email notification to your mailing list,
* delete a suspended user.

[NOTE]
====
Functions that are not natively supported by workflows can be implemented with xref:automation/automation-scripts/index.adoc[automation scripts].
An automation script can be xref:automation/workflows/automation-scripts.adoc[executed from a workflow].
====

To configure the function step, click on the configuration icon {ICON_WORKFLOW_COG} in the header of the function step.

.The function configuration interface.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/functions-example-cfg.png",
    "alias": "automation-workflows-functions-example-cfg",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 1100,
    "y": 0,
    "w": 820,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1313,
    "y": 254,
    "w": 20,
    "h": 20
  }]
}
----

Select what function you wish to perform in the dropdown select box under the "type" section.

.The function configuration interface.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/functions-example-type.png",
    "alias": "automation-workflows-functions-example-type",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 1100,
    "y": 0,
    "w": 820,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1440,
    "y": 286,
    "w": 461,
    "h": 65
  }]
}
----

When you select a function, the list of function arguments appears.
An argument defines what piece of data the function should use to perform some operation.
To exemplify; the `message` parameter in the "log debug message" function defines the message displayed in the debug log.

.The function configuration interface with defined parameters.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/functions-example-args.png",
    "alias": "automation-workflows-functions-example-args",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 1100,
    "y": 0,
    "w": 820,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1432,
    "y": 372,
    "w": 477,
    "h": 557
  }]
}
----

The function step in the above example creates a log entry based on the provided `message` and `fields` arguments.

.Function arguments can be passed in two different ways:
. *Constant values* which are passed into function in their present condition.
Use constant values when the passed data should not change.
. *Expressions* are evaluated and the result is passed into function.
This is useful when you wish to change the input without the need for an additional expression step.

// check vv
// Use expressions when the passed data should change based on the workflows' scope.

[#processing-multiple-items]
== Processing multiple items

When you wish to process multiple items, such as a list of leads that were created in the past month, you should use an *iterator* {ICON_WORKFLOW_ITERATOR}.
An iterator allows you to sequentially process a series of items one after another.

An iterator consists of two main parts; the *configuration* and the *iterator body*.

=== Iterator configuration

To access the iterator configuration, click on the configuration icon {ICON_WORKFLOW_COG} in the header.
The configuration consists of three parts; *type*, *arguments*, and *result* parts.

[cols="1s,5a"]
|===

| [#step-iterator-type]#<<step-iterator-type,Iterator type>>#
|
From the end-user's perspective, the iterator type specifies what arguments you need to provide in order to process the requested set of items.
We characterise three main kinds of iterators:

[#iterator-kind-condition]#<<iterator-kind-condition,Condition iterators>>#::
  A condition iterator repeats for as long as the condition you've provided results as truthy.
  To examplify; a condition of `counter < 10` would make the iterator repeat for as long as the counter is below 10.

[#iterator-kind-item]#<<iterator-kind-item,Item iterators>>#::
  An item iterator traverses the provided set of items from start to finish.
  To examplify; we pass in 10 records, therefore the iterator repeats 10 times, once for each record in the provided set.

[TIP]
====
Most item iterators are able to *fetch and iterate* over items.
====

[#iterator-kind-stream]#<<iterator-kind-stream,Stream iterators>>#::
  A stream iterator traverses the provided file one line at a time.
  To exemplify; we provide a text document containing 10 email addresses each in its own line, therefore the iterator repeats 10 times, once for each line (in this case email address).

[CAUTION]
====
Be careful when using the stream iterator with arbitrary file types.
File types and encodings may cause unwanted behavior.
====

| [#step-iterator-args]#<<step-iterator-args,Iterator arguments>>#
|
Iterator arguments allow you to specify the data that the iterator is allowed to work with.

.Iterator arguments can be passed in two different ways:
. *Constant values* are passed into the iterator function in its present condition.
Use constant values when the passed data should not change.
. *Expressions* are evaluated and the result is passed into the iterator.
This is useful when you wish to change the input without the need for an additional expression step.

// check vv
// Use expressions when the passed data should change based on the workflows' scope.

| [#step-iterator-rsp]#<<step-iterator-rsp,Iterator results>>#
|
During the execution of an iterator a set of results for each iteration is generated.
The results depend on the iterator type.

|===

=== Iterator body

The iterator body is implied by the first outgoing connector.
The second connector indicates where the execution continues after the iterator executes.

[NOTE]
====
Note the "body" and the "end" labels on the outgoing connectors.
====

Use the iterator body to define what should happen to the items in processing, for example; if our intent is to send out email notifications, this is where you do that.

The iterator body is implicitly terminated by the continue {ICON_WORKFLOW_CONTINUE} step if neither of the iterator execution control steps are used prior.

[IMPORTANT]
====
Use either the continue or break steps to terminate the loop body.
The advised approach is less prone to errors such as infinite loops.
Do not create a loop using connectors.

.An example of a valid iterator body.
image::automation/workflows/iterator-body-do.png[role="data-zoomable"]

.An example of an invalid iterator body.
image::automation/workflows/iterator-body-dont.png[role="data-zoomable"]

====

=== Controlling iterator execution

There may be cases where you would like to prematurely terminate the ongoing iteration or the entire iterator all together.
This can be done using the break {ICON_WORKFLOW_BREAK} or the continue {ICON_WORKFLOW_CONTINUE} steps.

[CAUTION]
====
The break and the continue steps are only valid within *iterator bodies*.
====

[cols="1s,5a"]
|===

| [#step-iterator-control-continue]#<<step-iterator-control-continue,Continue>>#
|
The continue step {ICON_WORKFLOW_CONTINUE} terminates the ongoing iteration and continues with the potential following iteration.
The continue step should be used to either prematurely terminate the iterator body or when the iterator body is considered as completed.

.An example of a premature and a complete iterator body.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/iterator-continue.png",
    "alias": "automation-workflows-iterator-continue",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 504,
    "y": 164,
    "w": 677,
    "h": 878
  },
  "annotations": [{
    "kind": "box-note",
    "x": 862,
    "y": 724,
    "w": 200,
    "h": 77
  }, {
    "kind": "box-note",
    "x": 581,
    "y": 884,
    "w": 200,
    "h": 77
  }]
}
----


| [#step-iterator-control-break]#<<step-iterator-control-break,Break>>#
|
The break step {ICON_WORKFLOW_BREAK} terminates the ongoing iteration and any additional iterations performed by the iterator.
The break step should be used to prematurely terminate the entire iterator.
To exemplify; when a system error occurs or when you find the item you are looking for.

.An example of a prematurely terminating the iterator.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/iterator-break.png",
    "alias": "automation-workflows-iterator-break",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 504,
    "y": 164,
    "w": 677,
    "h": 878
  },
  "annotations": [{
    "kind": "box-note",
    "x": 862,
    "y": 724,
    "w": 200,
    "h": 77
  }]
}
----

|===

[#working-with-errors]
== Error handling

Whenever you work with dynamic data (especially end-user input) and external services, you are always reminded that errors can and will occur.
We define two steps for working with errors; *error handler step* {ICON_WORKFLOW_ERROR_HANDLER} and *error step* {ICON_WORKFLOW_ERROR}.

[#step-errors-catch]
=== Error handler

An *error handler step* {ICON_WORKFLOW_ERROR_HANDLER} allows you to catch and react to any errors that may occur in continuation of the workflow.

[NOTE]
====
Think of this as a try-catch.
====

.An example of an error handler in action.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/error-handler.png",
    "alias": "automation-workflows-error-handler",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 344,
    "y": 244,
    "w": 1198,
    "h": 560
  },
  "annotations": [{
    "kind": "box-danger",
    "padding": "lg",
    "x": 702,
    "y": 324,
    "w": 478,
    "h": 77
  }, {
    "kind": "box-note",
    "x": 422,
    "y": 324,
    "w": 200,
    "h": 77
  }]
}
----

The steps in the red zone can be considered as dangerous (can fail).
If any step in the "dangerous" zone fails, the execution continues along the "Catch" connected steps.

[#step-errors-throw]
=== Error

An *error step* {ICON_WORKFLOW_ERROR} allows you to manually trigger an error during the execution of a workflow.
Forcefully terminating the workflow using an error step prevents additional operations from executing (such as the record is not saved or a user is not suspended).

[NOTE]
====
Think of the error step as raising an error or an exception.
====

.An example of an error in action.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/error.png",
    "alias": "automation-workflows-error",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 142,
    "y": 244,
    "w": 960,
    "h": 400
  },
  "annotations": [{
    "kind": "box-note",
    "x": 501,
    "y": 483,
    "w": 200,
    "h": 77
  }]
}
----

== Gateways

Gateways allow you to implement conditional execution based on the ongoing state of your workflow, for example, if a current user is already a subscriber, we should send a renewal request instead of a subscription request.

There are three kinds of gateway steps; *exclusive* {ICON_WORKFLOW_GATEWAYEXCLUSIVE}, *inclusive* {ICON_WORKFLOW_GATEWAYINCLUSIVE}, and *fork* {ICON_WORKFLOW_GATEWAYPARALLEL}.

[CAUTION]
====
The break and the continue steps are not supported for gateways.
If the gateway is nested within an iterator, the iterator will be affected instead.
====

[cols="1s,5a"]
|===

| [#step-gateway-exclusive]#<<step-gateway-exclusive,Exclusive>>#
|
An *exclusive gateway* {ICON_WORKFLOW_GATEWAYEXCLUSIVE} defines two or more connectors.
Only the first connector that meets the condition is evaluated.
Connectors are evaluated in the order they were initially defined in.

.An example of an exclusive gateway in action.
image::automation/workflows/gateway-exclusive.png[role="data-zoomable"]

| [#step-gateway-inclusive]#<<step-gateway-inclusive,Inclusive>>#
|
An *inclusive gateway* inclusive {ICON_WORKFLOW_GATEWAYINCLUSIVE} defines two or more connectors.
Any connector that meets the condition is evaluated.

.An example of an inclusive gateway in action.
image::automation/workflows/gateway-inclusive.png[role="data-zoomable"]

| [#step-gateway-fork]#<<step-gateway-fork,Fork>>#
|
A *fork gateway* {ICON_WORKFLOW_GATEWAYPARALLEL} defines two or more connectors.
Each connector is evaluated and executed in parallel.

[IMPORTANT]
====
All of the different "branches" created by a fork must be collected using a second fork step.
====

|===

=== Important notes

[cols="2s,5a"]
|===
| [#gw-note-inclusive-join]#<<gw-note-inclusive-join,Inclusive and join gateways>>#
|
When using inclusive gateways with join gateways, the workflow may run indefinitely.

The join step waits for all of the inbound paths to resolve.
If any one of the inclusive paths does not resolve, the join gateway never resolves, and the workflow runs indefinitely.

[NOTE]
====
Workflow execution, by design, does not timeout unless forcefully terminated.
====

You can resolve this by reworking your workflow logic to avoid such cases.

.An example of a workflow that will never resolve.
image::automation/workflows/gateway-inclusive-inf.png[role="data-zoomable"]

|===

== Interacting with the user

[CAUTION]
====
Any workflow that uses a prompt step {ICON_WORKFLOW_PROMPT} is treated as asynchronous.
Refer to the xref:automation/execution-flow-details.adoc#exec-flow-implicit[] for potential implications.
====

The *prompt step* {ICON_WORKFLOW_PROMPT} allows you to interact with the user in order to provide additional confirmation or data, such as a recipient email address or filling in any missing parameters.

.The different prompt types:
[cols="1s,5a"]
|===
| [#step-prompt-redirect]#<<step-prompt-redirect,External redirect>>#
|
An *external redirect* redirects the receiving user to the specified URL anywhere on the internet.

[TIP]
====
You can use this prompt to initiate download procedures.
====

| [#step-prompt-reroute]#<<step-prompt-reroute,Internal redirect>>#
|
An *internal redirect prompt* redirects the receiving user to the specified route on the current web application.
Refer to the `/src/views/routes.js` JS file of each {PRODUCT_NAME} web application for a complete list of available routes and their parameters.

| [#step-prompt-recordPage]#<<step-prompt-recordPage,Record page redirect>>#
|
A *record page redirect prompt* redirects the receiving user to the specified record page.
This can be used to redirect the user to the newly created record.

| [#step-prompt-notification]#<<step-prompt-notification,Notification>>#
|
A *notification prompt* displays a notification to the receiving user but is dismissed immediately when shown.
This can be used to show success or other informative notifications.

| [#step-prompt-alert]#<<step-prompt-alert,Alert>>#
|
An *alert prompt* displays a notification to the receiving user.
This can be used to show success or other informative notifications.

| [#step-prompt-choice]#<<step-prompt-choice,Choice>>#
|
A *choice prompt* displays a notification with two buttons to either confirm or reject something to the receiving user.
This can be used to request additional confirmation before performing an operation or to optionally perform additional operations.

| [#step-prompt-input]#<<step-prompt-input,Single input>>#
|
A *single input prompt* displays a notification with a value input box to the receiving user.
This can be used to request additional information from the receiving user, such as missing contact data or their pin code.

| [#step-prompt-options]#<<step-prompt-options,Option select>>#
|
An *option select prompt* displays a notification with a list of available options either as a select or a list of radio buttons.
This can be used as a more verbose <<step-prompt-choice,choice prompt>> or a more constrained <<step-prompt-input,input prompt>>.

| [#step-prompt-record-select]#<<step-prompt-record-select,Record select>>#
|
A *record select* prompt displays a notification with a record list search box from where the selected record is passed into the workflow.
This can be used to allow users to select some record relevant to workflow execution.

|===

== Delay and schedule workflows

{PRODUCT_NAME} workflow allows you to schedule or delay its execution.
This can be a powerful tool when working with external services that throttle their API usage or when a task should be performed in an interval, for example monthly subscription renewal.

To achieve this, you are provided with a delay step {ICON_WORKFLOW_DELAY} and a deferred trigger {ICON_WORKFLOW_TRIGGER}.

****
When you use a delay or a prompt step, the workflow becomes asynchronous and can no longer invalidate actions like create, update, or delete a record.

Operations such as "confirm record creation" are currently not possible with workflows.
If you need to perform value validation or sanitization, use xref:compose-configuration/index.adoc#module-field-expr[field expressions] instead.
****

=== The delay of execution

The delay step {ICON_WORKFLOW_DELAY} allows you to explicitly pause the workflow's execution for a set period of time.

This type of delaying is common when working with APIs that throttle their access.
To exemplify; let's say that the API allows 10 calls per minute and we wish to fetch 100 items.
A possible execution is as it follows:

image::automation/workflows/delay-example.svg[role="data-zoomable"]

[NOTE]
====
In case you wish to wait for an action performed by a user (such as a confirmation), use a xref:automation/workflows/index.adoc#user-interaction[prompt step] instead.
====

=== Execution scheduling

Execution scheduling is performed by configuring the trigger {ICON_WORKFLOW_TRIGGER} to run in an <<deferred-interval,interval>> or at a specific <<deferred-timestamp,timestamp>>.

[cols="1s,5a"]
|===

| [#deferred-interval]#<<deferred-interval,Interval>>#
|
An interval trigger allows you to run the workflow in a specified interval.
This can be used to perform routine daily tasks or process larger data in batches.

A good example is a subscription service where it is necessary to renew the subscriptions of the clients on a monthly basis.
We define an interval that executes the workflow each day, determine what clients need to be renewed that day and renew them.

image::automation/workflows/interval-example.svg[role="data-zoomable"]

[WARNING]
====
The form of the above example should not be used in production.
The actual workflow should implement error handling, transaction logging, and email notifications.
====

To define an interval trigger, click on the click on the configuration icon {ICON_WORKFLOW_COG} and specify the system as the resource resource with the on interval event.

The interval is defined as a https://en.wikipedia.org/wiki/Cron[chron expression] and can be extremely flexible.
You can also use https://crontab.guru/[this amazing tool] to verify that your expressions are valid.

.Common cron examples:
* every hour at minute 0: `0 * * * *`
* every 30 minutes (0 and 30): `0/30 * * * *`
* every day at the start of the day: `0 0 * * *`
* every month at the start of month: `0 0 1 * *`

[TIP]
====
You can define multiple intervals under the same trigger.
====

| [#deferred-timestamp]#<<deferred-timestamp,Timestamp>>#
|
A timestamped trigger allows you to run the workflow at a specified time.

To illustrate; you have just received a new client that requested a series of deadlines where they would like to see the current progress.
We could define a scheduled workflow that is executed at each one of the timestamps.
The workflow would aggregate all of the completed tickets into an email and send it off to the client.

image::automation/workflows/schedule-example.svg[role="data-zoomable"]

Timestamps are defined in the https://en.wikipedia.org/wiki/ISO_8601[ISO 8601, `YYYY-MM-DDThh:mm:ssZ` format].

[TIP]
====
You can define multiple timestamps under the same trigger.
====

|===

== Ready for more?

.The sub-sections under menu:Low-Code Platform Developer Guide[Automation,Workflows] go into more details regarding specific topics, such as:
* the xref:automation/workflows/style-guide.adoc[style guide] and xref:automation/workflows/best-practices.adoc[best practices],
* an introduction into our xref:automation/workflows/testing-debugging.adoc[testing and debugging facility],
* how to xref:automation/workflows/organizing-workflows.adoc[manage and organize larger workflows],
* how to xref:automation/workflows/automation-scripts.adoc[execute automation scripts] available in the {APP_AUTOMATION} server,
* how to xref:api-gw/workflow-processing.adoc[process requests] via Integration gateway.

.For more advanced users who wish to know more about the internals:
* xref:automation/workflows/scope-in-depth.adoc[]
* xref:automation/execution-flow-details.adoc[]


# src/modules/integrator-guide/pages/automation/workflows/record-selection.adoc

include::ROOT:partial$variables.adoc[]

= Processing Record Selection
:page-aliases: 2024.9@workflows/record-selection.adoc
:keywords: automation, process record selection
:description: Learn how to process record selection using workflows

Record lists allow you to enable record selection, allowing you to perform automation over a series of records.

[#wf-config]
== Workflow configuration

.To configure a workflow which supports record selection:
. navigate to the {APP_NAME_WORKFLOW} application and either create or edit a workflow,
. add a trigger with a resource of either `Compose Page` or `Compose Record`,

The workflow receives a `selected` scope variable which defines a list of selected record IDs.
To examplify; the `selected` scope variable may contain a list of `[ '1111', '2222', ..., 'nnnn' ]`.

You can use an item iterator to traverse through the list of selected records.
From there you can use functions and expressions to implement your feature.

== {APP_NAME_COMPOSE} configuration

[IMPORTANT]
====
Make sure you already have some automation which can be used by the record list.
Refer to <<wf-config,workflow configuration>> for details.
====

.To enable record selection:
. navigate to the {APP_NAME_COMPOSE} application and enter the namespace you wish to edit,
. go to menu:Admin panel[Pages],
. click on the page builder next to the page you wish to enable record selection for,
. click on the btn:[edit icon] on the page block with the record list in question,
. go to the "record list" tab and check the "enable record selection" checkbox.

.To bind an automation button to the record list:
. navigate to the {APP_NAME_COMPOSE} application and enter the namespace you wish to edit,
. go to menu:Admin panel[Pages],
. click on the page builder next to the page you wish to enable record selection for,
. click on the btn:[edit icon] on the page block with the record list in question,
. go to the "automation" tab and select the automation you wish to use.


# src/modules/integrator-guide/pages/automation/workflows/scaling/sub-workflows.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Subworkflows
:attachment-path: ../../../_attachments/automation/workflows/scaling/
:keywords: automation, modular, modularity
:description: Learn how to utilize subworkflows to simplify your business logic

Subworkflows enable you to define reusable pieces of logic that other workflows can utilize.
You can think of a subworkflow as a function from classic programming languages.

[TIP]
====
On the list of available workflows, there is an additional subworkflow inclusion filter option.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/scaling/sub-wf-list.png",
    "alias": "sub-wf-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "h": 380,
    "w": 1920
  },
  "annotations": [{
    "x": 425,
    "y": 154,
    "w": 292,
    "h": 29
  }]
}
----
====

[#exec-args]
== Execution Arguments

When calling subworkflows, you can pass an arbitrary execution argument encoded as a `Vars` data type.

Click on the cog {ICON_WORKFLOW_COG} icon on the exec-workflow {ICON_WORKFLOW_EXEC_WORKFLOW} step and locate the "arguments" section.
Any value passed in the `scope` argument will be available in the execution context of the subworkflow.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/scaling/main-wf-args.png",
    "alias": "main-wf-args-in",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 704,
    "y": 0,
    "w": 1216,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 1429,
    "y": 10,
    "w": 480,
    "h": 1060
  },
  "annotations": [{
    "x": 1431,
    "y": 255,
    "w": 480,
    "h": 326
  }]
}
----

[#exec-results]
== Execution Results

After the subworkflow is done with its execution, the calling workflow gains access to the subworkflow's execution scope at the state it finished.

Click on the cog {ICON_WORKFLOW_COG} icon on the exec-workflow {ICON_WORKFLOW_EXEC_WORKFLOW} step and locate the "results" section.
Specify a list of values (and the variable name) you'd like to preserve from the subworkflow.
The `result` field identifies the variable name in the subworkflow's state, and the `target` identifies the variable name in the caller's state.

[TIP]
====
There is no limit to the number of values you can access from the subworkflow's state.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/scaling/main-wf-args.png",
    "alias": "main-wf-args-out",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 704,
    "y": 0,
    "w": 1216,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 1429,
    "y": 10,
    "w": 480,
    "h": 1060
  },
  "annotations": [{
    "x": 1431,
    "y": 646,
    "w": 478,
    "h": 358
  }]
}
----

== Creating Subworkflows

To create a subworkflow, navigate to the {APP_NAME_WORKFLOW} web application and create a new workflow.
Tick the btn:[subworkflow] checkbox when configuring the workflow metadata.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/scaling/sub-wf-create.png",
    "alias": "sub-wf-create",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 570,
    "y": 38,
    "w": 780,
    "h": 611
  },
  "annotations": [{
    "x": 576,
    "y": 522,
    "w": 241,
    "h": 38
  }]
}
----

Configure the rest of the workflow as you would with any other workflow.
Refer to xref:automation/workflows/index.adoc[main workflow documentation] for details.

[IMPORTANT]
====
Subworkflows can not utilize triggers and can not be executed like regular workflows.
====

The following example defines a simple subworkflow where we log the received value and then prepare a new value for the calling workflow.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/scaling/sub-wf-example.png",
    "alias": "sub-wf-example",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 551,
    "y": 258,
    "w": 802,
    "h": 281
  },
  "annotations": []
}
----

The link:{attachment-path}sub-wf-example.json[source code] for the subworkflow example.


== Using Subworkflows

Subworkflows are called from _regular_ workflows using the *exec-workflow* {ICON_WORKFLOW_EXEC_WORKFLOW} step.
The *exec-workflow* {ICON_WORKFLOW_EXEC_WORKFLOW} step requires you to specify what workflow you wish to execute (must be a subworkflow), <<exec-args,execution arguments>>, and <<exec-results,execution results>>.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "automation/workflows/scaling/main-wf-example.png",
    "alias": "main-wf-example",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 104,
    "y": 243,
    "w": 1082,
    "h": 603
  },
  "annotations": [{
    "x": 423,
    "y": 523,
    "w": 263,
    "h": 276
  }]
}
----

The link:{attachment-path}main-wf-example.json[source code] for the workflow example.


# src/modules/integrator-guide/pages/automation/workflows/scope-in-depth.adoc

include::ROOT:partial$variables.adoc[]

= Workflow Scope in Depth
:keywords: automation, variable scope
:description: Learn how variable scope works in workflows

A scope defines what data an ongoing step can access and manipulate.

For the most common use-cases this doesn't really matter, but it can come in handy when defining larger and more complicated workflows.

[IMPORTANT]
====
Non-primitive data types (more can be found xref:automation/workflows/types.adoc[here]) are passed around using pointers, which means that any change to one copy reflects to all of the copies.

To exemplify; a user is present in two different scopes.
In case a change of name in one of the scopes is made, all of the scopes are affected.

.The two expression steps interact with the same user:
image:automation/workflows/scope-in-depth/object_pointers.svg[]
====

== Gateways

When the workflow execution reaches a gateway, a new scope is created for each connector (branch) based on the parent scope (usually that is the `global` scope).

When the branches are joined (they reach the join gateway step), the scopes of all the branches are merged back into the parent scope in the initially defined order (all changes and new variables in the branch scopes are reflected in the parent scope).

[IMPORTANT]
====
The order in which the branches are merged is defined when you first define the connectors.
Visually changing the order of the connectors doesn't affect the merging logic.
====

.Let's take a look at an example;
image::automation/workflows/scope-in-depth/gateway_scope_base.png[]

.A couple of important steps can be seen in the above example:
* *Setting the global scope* initializes the `global_v1` variable to be 1.
* *Setting the local (branch 1) scope* initializes the `local_v1` variable to be 1.
* *Setting the local (branch 2) scope* initializes the `local_v2` variable to be 1.
* *Logging the scope* logs the variables in the ongoing scope.

To break this down further, the below image shows the stack trace of the entire execution with annotated scopes at the important parts (darkened numbered blocks).

image::automation/workflows/scope-in-depth/gateway_scope.svg[]

[NOTE]
====
For this example we used the xref:automation/workflows/index.adoc#step-gateway-fork[fork gateway].
====

. When the workflow starts, you initialize the ongoing (`global`) scope to have a variable `global_v1` with the value of 1.
When the gateway step is reached, two new scopes are created; one for each branch (`branch 1 scope` and `branch 2 scope`).
. When the first branch is reached, the workflow executes it using its scope (`branch 1 scope`).
. When you interact with the ongoing scope by initializing the `local_v1` variable to the value of `1`, only the ongoing scope is changed (the `global` state remains unchanged).
. Upon the reach of the second branch, the workflow executes it using its scope (`branch 2 scope`).
. When interacting with the ongoing scope by initializing the `local_v2` variable to the value of `1`, only the ongoing scope is changed (the `global` state remains unchanged).
. When both branches are executed and the join step is reached, both of the branches and their scopes are merged into the parent scope (in this case the `global` scope) in the initially defined order.
If the first branch was "joined" before the second branch, the scope of the first branch is merged first.

== Iterators

When the workflow execution reaches an iterator, a new scope is created based on the parent scope (usually the `global` scope).

When the iterator has finished executing, which means that all iterations are completed or the iteration was aborted, the iterator's scope is merged back into the parent scope (all changes and new variables in the iterator scope are reflected in the parent scope).

.Let's take a look at an example:
image::automation/workflows/scope-in-depth/loop_scope_base.png[]

.A couple of important steps can be seen in the above example:
* *Setting the global scope* initializes the `global_v1` variable to be 1.
* *Iterator 1* repeats 1 time.
* *Setting the local (iterator 1) scope* increments the `global_v1` variable by 1 and initializes the `local_v1` variable to be 1.
* *Iterator 2* repeats 1 time.
* *Setting the local (iterator 2) scope* increments the `global_v1` variable by 1 and initializes the `local_v2` variable to be 1.
* *Logging the scope* logs the variables from the ongoing scope.

To break this down further, the below image shows the stack trace of the entire execution with annotated scopes at the important parts (darkened numbered blocks).

image::automation/workflows/scope-in-depth/loop_scope.svg[]

. When the workflow starts, you initialize the ongoing (`global`) scope to have a variable `global_v1` with the value of 1.
. When you reach the first iterator, a new scope (`iterator 1 scope`) is prepared for this iterator based on the parent scope (`global`).
. When you interact with the ongoing scope by incrementing the `global_v1` and by setting the `local_v1` variable to the value of `1`, only the ongoing scope is changed (the `global` state remains unchanged).
. When you reach the second iterator, a new scope (`iterator 2 scope`) is prepared for this iterator based on the parent scope (`iterator 1 scope`).
. When you interact with the ongoing scope by incrementing the `global_v1` and by setting the `local_v2` variable to the value of `1`, only the ongoing scope is changed (the `iterator 1 scope` state remains unchanged).
. After the second iterator has finished executing (all of the iterations were handled), the scopes from the second and first iterator are merged.
The ongoing scope (`iterator 1 scope`) is updated with the merged scope.
. After the first iterator has finished the execution (all of the iterations were handled), the global scope and the first iterator scope are merged.
The ongoing scope (`global`) is updated with the merged scope.


# src/modules/integrator-guide/pages/automation/workflows/style-guide.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Style Guide
:page-aliases: 2024.9@automation/workflows/organizing-workflows.adoc, 2024.9@automation/workflows/style-guide-best-practices.adoc
:keywords: automation, style guide, designing workflows
:description: Learn how you should structure your workflows for consistency and ease of maintenance

Workflows are based on and inherit the base rules from the BPMN 2.0 standard.
We define some additional rules to help keep workflows consistent.

== Follow the KISS principle

The Keep It Simple, Stupid principle indicates that your workflows should not be needlessly overcomplicated.
Over-engineering usually reduces clarity and introduces more failure points.

To exemplify, instead of using a gateway to set a `Boolean` variable to the correct value, write an expression that evaluates the desired value.

.The screenshot outlines an over-engineered version.
image::automation/workflows/styleguide/simple-gateway.png[]

.The screenshot outlines a simplified version.
image::automation/workflows/styleguide/simple-expression.png[]

[CAUTION]
====
Most operations can be transformed into expressions but at the cost of clarity.
If a simplification causes the clarity to decrease, you should choose to avoid it.
====

[TIP]
====
Larger complex operations can be replaced by xref:automation/workflows/automation-scripts.adoc[automation scripts].
====

== Avoid crossing connectors

When working with larger workflows, crossing connectors may mislead and confuse the reader.
Workflow steps define many anchor points to help you achieve this.

.An example of crossing connectors:
image::automation/workflows/styleguide/connectors-nok.png[]

.An example of corrected, non-crossing connectors:
image::automation/workflows/styleguide/connectors-ok.png[]

[TIP]
====
A connector defines a series of anchor points that you may use to adjust the flow of the connector.
The anchor points become available when you click on the connector.

image::automation/workflows/styleguide/connector-anchors.png[]
====

== Step labels

All workflow steps should have a short label that outlines the core of the step.
To exemplify, an expression that calculates the sales commissions is best to be labelled as "Calculate sales commissions".

A *trigger* label should state the resource and the trigger type.
This allows the reader to understand when the trigger is executed without reading the configuration.

image::automation/workflows/styleguide/label-trigger.png[]

A *gateway* label should state the question that determines the output.
The output path labels should state the answer to the question of the corresponding gateway.

image::automation/workflows/styleguide/label-gateway.png[]

The *function* label should contain the verb and the subject of the function.

image::automation/workflows/styleguide/label-function.png[]

== Coherent layouts

The initial integration usually consists of multiple workflows which can be extended and added in the future.
A consistent layout increases consistency and coherence.

.Here are some tips:
* the flow should go from top-left to bottom-right,
* group the related steps,
* align the steps with the grid,
* keep the layout symmetric as it is generally easier to understand.

== Use swimlanes to organize your workflows

You can use the *swimlane* {ICON_WORKFLOW_SWIMLANE} visual element to organize your workflows.

In smaller workflows that perform simple, singular operations (such as notifying administrator about a client sign-up or logging changes) swimlanes do not make much sense and may even reduce the clarity.

For larger projects however, swimlanes can be an orderly addition as they help you visually group smaller steps into larger operations and thus allow you to understand what a specific part of the workflow does.

.The screenshot shows the refactored workflow with swimlanes to group operations.
image::automation/workflows/styleguide/swimlane.png[role="data-zoomable"]



# src/modules/integrator-guide/pages/automation/workflows/testing-debugging.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Testing and Debugging Workflows
:keywords: automation, workflows, testing, debugging
:description: Learn how to test and debug your workflows

[#testing]
== Testing

Testing is a powerful and essential component of any project.

[CAUTION]
====
The testing approach mentioned below doesn't sandbox your data in any way.
Any changes performed by the workflow are reflected in the system.
====

Let us look at an example.
You want to implement a workflow that calculates the cost of a newly created lead.
The cost of the lead is sent as an email to the administrator.

image::automation/workflows/testing-debugging/manual-test-play.png[]

To test the workflow, click on the play icon {ICON_WORKFLOW_PLAY} in the top right corner of the trigger.
Only saved and valid workflows can be run.

A pop-up asking for the initial scope appears.
The initial scope is data passed to the workflow to perform an operation.

[NOTE]
====
The initial scope depends on the resource and event type.
====

image::automation/workflows/testing-debugging/manual-test-load-resources.png[]

Insert the required parameters and click on the btn:[Load and Configure] button to set the initial scope.
Any missing parameters are automatically added as the empty value of that type.

image::automation/workflows/testing-debugging/manual-test-configure-resources.png[]

The last step allows you to change the variables of the initial scope before test running the workflow.
Click on the btn:[Run Workflow] to run the workflow, or on the btb:[Back] button to return to the previous screen.

When a workflow is manually run, you see a green outline that indicates the execution path based on the provided input.
If any of the steps fail to execute successfully, they are be marked with a red outline.
If there is no error handling, the manual execution is also terminated.

.An example of a successful test:
image::automation/workflows/testing-debugging/manual-test-run-ok.png[]

.An example of a failed test:
image::automation/workflows/testing-debugging/manual-test-run-nok.png[]

In some cases, your workflows may implement steps that should only run in production, such as client charging, mass email notifications, and similar.
We can mock this path of execution by defining a `testing` flag at the beginning.
Before you reach the "in production only" steps, you should use an exclusive gateway to carry out distinctive handling, such as logging a message or using a <<debug-step,debug step {ICON_WORKFLOW_DEBUG}>>.

image::automation/workflows/testing-debugging/manual-test-special.png[]

When you run the workflow after that step, you should see something like the below example:

image::automation/workflows/testing-debugging/manual-test-special-ok.png[]

== Debugging

Knowing how to debug a specific tool or software can save you a lot of time if you encounter an issue.

[#debug-step]
=== The debugging step

The debugging step {ICON_WORKFLOW_DEBUG} allows you to inspect the contents of the scope it resides in.

The debugging step uses the logger configured by the server and it is not visible in the workflow editor itself.

.A simple example:
image::automation/workflows/testing-debugging/debug-example-simple.png[]

=== Test result context

When you <<testing,run a manual test>> for the workflow you might notice an icon in the bottom right corner of the step.

image::automation/workflows/testing-debugging/debug-stepctx.png[]

When you hover over the icon you see the important information regarding the steps' execution.

If you hover over a successful step (step with a green outline), you see the duration of the execution.
Knowing the duration of the execution can help you pinpoint any system bottlenecks.

image::automation/workflows/testing-debugging/debug-stepctx-ok.png[]

If you hover over a failed step (step with a red outline), you see the duration of the execution and the encountered error.

image::automation/workflows/testing-debugging/debug-stepctx-nok.png[]


# src/modules/integrator-guide/pages/automation/workflows/types.adoc

include::ROOT:partial$variables.adoc[]

= Data Types

[CAUTION]
====
Certain variable types can not be initialized directly by expressions, they need to be initialized by a function.
====

The documentation has been moved under xref:expr/type-reference.adoc[menu:Expressions[type reference]].


# src/modules/integrator-guide/pages/compose-configuration/duplication-detection.adoc

include::ROOT:partial$variables.adoc[]

= Duplicate Detection

{PRODUCT_NAME} through the duplicate detection feature helps maintain clean and accurate data by preventing record duplication.
This is achieved by using rules to apply a criterion that determines how closely a field on a new or modified record matches the same field on an existing record.

The user interface displays a warning or an error message to alert the user of an existing record with  identical field values within a module, hence preventing the creation of duplicates.

.Benefits of using {PRODUCT_NAME} duplicate detection:
* Enhancing data accuracy and efficiency.
* Enhancing effective description of records.
* Maintaining data quality.
* Optimizes data storage.

== Duplicate Detection Rules

The duplicate detection feature is enabled by using validation duplicate detection rules on a module.
The rules ensure that no duplicate values are recorded while creating or modifying a record by ensuring that the designated fields do not have the same values.

Duplicate detection validation can be configured using two rules:

[cols="1s,5a"]
|===
| [#strict-duplicate-validation]#<<strict-duplicate-validation,Strict duplicate validation rule>>#
|
This rule ensures that a record will not be saved when a duplicate value is detected in the selected fields in any existing record of this module. 

When the Strict duplicate value validation rule is applied, a pop-up error message indicating the existence of a record with identical values will appear in the bottom right corner of the screen..

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "duplication-detection/error.png",
    "alias": "error",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 152,
    "y": 42,
    "w": 1768,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 1634,
    "y": 930,
    "w": 277,
    "h": 86
  }
}
----


| [#soft-duplicate-validation]#<<soft-duplicate-validation,Soft duplicate validation rule>>#
|
This rule allows the saving of a record but displays a warning message when a duplicate value is identified, indicating that a record with identical field values already exists within the module.

When Soft duplicate value validation is applied, the pop-up warning message is displayed on the bottom right side of the screen.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "duplication-detection/warning.png",
    "alias": "warning",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 152,
    "y": 42,
    "w": 1768,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 1634,
    "y": 930,
    "w": 277,
    "h": 86
  } 
}
----
|
|===

== Enabling duplication detection validation rules

Validation rules can be enabled when creating new modules or when exiting modules.

. Navigate to your {APP_NAME_COMPOSE} namespace.
. Select an existing module or create a new module.
. On the specified module, navigate to the btn:[validation] tab.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "duplication-detection/duplicate-detection-validation.png",
    "alias": "duplicate-detection-validation",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 645,
    "y": 124,
    "w": 90,
    "h": 28
  }]
}
----

There are two sections containing the two validation rules, which are the strict duplicate value validation and the soft duplicate value validation.
Each value validation rule consists of two columns, *Available fields* on the left and *Selected fields* on the right.

[NOTE]
====
only one duplication detection validation rule can be applied on a record field at a time.
====

Select a field from the list of available fields by clicking on it.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "duplication-detection/duplicate-detection-availablefields.png",
    "alias": "duplicate-detection-availablefields",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 661,
    "y": 336,
    "w": 419,
    "h": 139
  }]
}
----

When a field is selected, it is moved to the selected field column to indicate that the validation rule has been applied.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "duplication-detection/duplicate-detection-selectedfields.png",
    "alias": "duplicate-detection-selectedfields",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1088,
    "y": 316,
    "w": 392,
    "h": 32
  }]
}
----

You can remove the validation rule on a record field by unselecting it, and it will be moved back to the available fields column.


# src/modules/integrator-guide/pages/compose-configuration/examples/index.adoc

include::ROOT:partial$variables.adoc[]

= Examples
:keywords: low code, no code, low code configuration examples
:description: Learn from example on how to configure your {PRODUCT_NAME} {APP_NAME_COMPOSE} apps

:leveloffset: +1

include::./record-filtering-nested.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/compose-configuration/examples/record-filtering-nested.adoc

include::ROOT:partial$variables.adoc[]

= Record Filtering With Nested Fields
:page-noindex: true

{PRODUCT_NAME} doesn't natively support filtering using values from referenced values, such as records and users.

Let us use an example where we have two modules: `user` and `package` where each `user` can have a `package`.
We wish to find only the users that have a specific package.

You can use one of the following workarounds.

== Clone the child fields into the parent

Extend the `user` module to add a new field, for example, `filter__package_name`.
You can add additional fields if you wish to use multiple fields.

Define an xref:automation/index.adoc[automation] with a before create/update trigger for the `user` module.

The automation fetches the related package of the user in question and populates the newly created `filter__package_name` field with the `name` field from the corresponding `package` record.

When searching for users, refer to the `filter__package_name` field.

== Perform multiple fetches

[IMPORTANT]
====
This option only applies if you're searching for records outside of the existing web applications.
====

Instead of performing one fetch, you can perform multiple fetches.

Firstly fetch the `package` records based on some query.

.The response would look something like this:
[source,json]
----
[{
  "recordID": "1"
},
{
  "recordID": "2"
}]
----

Next, fetch the `user` records where the query limits the users only to the records obtained in the previous query.

.To exemplify, the query would look like this:
[source]
----
`package='1' OR package='2'`
----


# src/modules/integrator-guide/pages/compose-configuration/field-expr.adoc

include::ROOT:partial$variables.adoc[]

= Field expressions

[#value-expressions]
== Value expressions

Value expressions calculate the fields' value based on the provided expression.
A value expression is a simple expression that results in a single value.
If your field is a multi-value field, you need to return an array of items.

Refer to the xref:expr/index.adoc[] for details on writing expressions.

[IMPORTANT]
====
Currently, you can only use values of the current record.
References are not yet supported.
If you need to reference data across multiple records, use xref:automation/automation-scripts/index.adoc[automation scripts] or xref:automation/workflows/index.adoc[workflows] instead,
====

.Available variables in the evaluation context:
[cols="1s,5a"]
|===

| [#values-ctx-old]#<<values-ctx-old,`old`>>#
|
The `old` variable refers to the original record.
Only set when the field is being updated.

| [#values-ctx-new]#<<values-ctx-new,`new`>>#
|
The `new` variable refers to the current record.

| [#values-ctx-value]#<<values-ctx-value,`<field-name>`>>#
|
A string or an array of strings with current field values.
If the field name collides with any of the system-defined variables, access the value via the <<values-ctx-new,new["field_name_here"]>>.

|===

.Example expression that calculates the price with tax:
[source]
----
price * 1.25
----

.Example expression that generates a full name:
[source]
----
trim(firstName + " " + lastName)
----

.Example of a multi-value expression evaluation:
[source]
----
["foo", "bar", "baz"]
----

[#value-sanitizers]
== Sanitizers

Sanitizers modify the field value to cleanup (sanitise) the data before it is saved.
A sanitiser is a simple expression that results in a single value.

[IMPORTANT]
====
Sanitizers are ran multiple times, once before data is sent to event bus (corredor and workflows) and the second is right before the record is sent to the API.
====

Refer to the xref:expr/index.adoc[] for details on writing expressions.

By their nature, sanitisers *should not* result in an error.
If an error occurs, it is logged in the action log, and the operation continues.

If you define multiple sanitisers, they are run in the specified order.

.Example sanitiser that limits the text length:
[source]
----
length(value) > 5 ? substr(value, 0, 5) + "..." : value
----

.Available variables in the evaluation context:
[cols="1s,5a"]
|===

| [#sanitizer-ctx-value]#<<sanitizer-ctx-value,`value`>>#
|
The `value` variable refers to the current value.

|===

[#value-validators]
== Validators

Validators validate the field value by raising errors when the value is not valid.
A validator is a simple expression that results in a single value, either `true` or `false`.
The value validation is considered invalid when the expression results in `true`.

Validators can not change the value.

Built-in field validators can be disabled; required and unique-multi-value validators can not be disabled.

If you define multiple validators, they are run in the specified order.

[IMPORTANT]
====
The field validator stops when the first error occurs.
For example, if we define validators `A`, `B`, and `C`, and the validator `A` raises an error, validators `B` and `C` are not evaluated.
====

.Validation expressions are not executed when:
* the value is not changed,
* the value is missing.

[TIP]
====
Use the required flag to check for required values.
====

.Available variables in the evaluation context:
[cols="1s,5a"]
|===

| [#validator-ctx-value]#<<validator-ctx-value,`value`>>#
|
The `value` variable refers to the current value.

| [#validator-ctx-oldvalue]#<<validator-ctx-oldvalue,`oldValue`>>#
|
The `oldValue` variable refers to the original value.
Only set when the field is being updated.

| [#validator-ctx-values]#<<validator-ctx-values,`values`>>#
|
The `values` variable refers to all record values (`values.<field-name>`).
You can use this to write validators that are context-aware.

|===

.Example validator to check the text length:
[source]
----
length(title) < 5
----


# src/modules/integrator-guide/pages/compose-configuration/field-types.adoc

include::ROOT:partial$variables.adoc[]

= Field Type Reference
:keywords: low code, no code, field reference, field type reference
:description: Get familiar with the available field types {PRODUCT_NAME} {APP_NAME_COMPOSE} offers

[IMPORTANT]
====
The field type and workflow type may not refer to the same type.

*DevNote* add some additional context about this.
====

[#field-type-checkbox]
== Checkbox (Y/N)

A `Checkbox` field stores a true/false (truthy/faulty) value (a boolean).

A `Checkbox` field should be used when you wish to store a truthy/faulty value.
For example, if the subscription was paid or whether the contact is subscribed to your newsletter.

A field of type `Checkbox` is represented as a label when it is being viewed.
When the field is being edited, it is represented as a checkbox.

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-checkbox-label-true]#<<field-type-checkbox-label-true,True label>>#
|
This option allows you to specify the display label of truthy values.

| [#field-type-checkbox-label-false]#<<field-type-checkbox-label-false,False label>>#
|
This option allows you to specify the display label of faulty values.

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-checkbox-validation-format]#<<field-type-checkbox-validation-format,Format>>#
|
.The value format for a truthy value must be one of the following:
* `true`
* `t`
* `yes`
* `y`
* `1`

Any non truthy value is considered to be a falsy value.
|===

[#field-type-datetime]
== Date and time

The `Date and time` field type stores a temporal value (a timestamp).

The `Date and time` field type should be used when you wish to store some temporal information; a date, a time, or both.
For example, the time that the lead was converted.

A field of the `Date and time` type is represented as a formatted string when viewed.
When the field is being edited, it is represented as a date input, a time input, or a date-time input (depending on the configuration).

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-datetime-do]#<<field-type-datetime-do,Date only>>#
|
Removes the time part of the timestamp and only keeps the date.
When editing the field, only the date input is shown.

| [#field-type-datetime-to]#<<field-type-datetime-to,Time only>>#
|
Removes the date part of the timestamp and only keeps the time.
When editing the field, only the time input is shown.

| [#field-type-datetime-pvo]#<<field-type-datetime-pvo,Past values only>>#
|
Changes the value validator to only allow past values.
The displayed date-time picker disables future values.

| [#field-type-datetime-fvo]#<<field-type-datetime-fvo,Future values only>>#
|
Changes the value validator to only allow future values.
The displayed date-time picker also disables past values.

| [#field-type-datetime-relative]#<<field-type-datetime-relative,Output relative value>>#
|
Displays the value relative to the current time.
For example, `10min ago`, or `last month`.

| [#field-type-datetime-fmt]#<<field-type-datetime-fmt,Output format>>#
|
Defines the format string that is used when displaying the timestamps.
The field supports all of the https://momentjs.com/docs/#/displaying/format/[moment.js] formatting options.

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-datetime-validation-format]#<<field-type-datetime-validation-format,Format>>#
|
The `Date and time` field supports a wide range of formats.
Below is the list of supported date-time parsing formats.

.Date only:
** `2006-01-02`
** `02 Jan 06`
** `Monday, 02-Jan-06`
** `Mon, 02 Jan 2006`
** `2006/_1/_2`

.Time only:
** `15:04:05`
** `15:04`
** `15:04:05Z07:00`
** `15:04:05 MST`
** `15:04:05 -0700`
** `15:04 MST`
** `15:04Z07:00`
** `15:04 -0700`
** `3:04PM`

.Date and time::
** `2006-01-02T15:04:05Z07:00`
** `Mon, 02 Jan 2006 15:04:05 -0700`
** `Mon, 02 Jan 2006 15:04:05 MST`
** `Monday, 02-Jan-06 15:04:05 MST`
** `02 Jan 06 15:04 -0700`
** `02 Jan 06 15:04 MST`
** `Mon Jan 02 15:04:05 -0700 2006`
** `Mon Jan 02 15:04:05 -0700 2006`
** `Mon Jan _2 15:04:05 2006`
** `2006/_1/_2 15:04:05`
** `2006/_1/_2 15:04`

The usual time format is https://en.wikipedia.org/wiki/ISO_8601[`ISO 8601`] with the pattern of `YYYY-MM-DDTHH:MM:SSZ`.

| [#field-type-datetime-validation-future]#<<field-type-datetime-validation-future,Future>>#
|
When the field is configured to only allow future values, the validator rejects any value which is before the timestamp of when the validation occurred.

| [#field-type-datetime-validation-past]#<<field-type-datetime-validation-past,Past>>#
|
When the field is configured to only allow past values, the validator rejects any value which is after the timestamp of when the validation occurred.
|===

[#field-type-email]
== Email

An `Email` field type stores an email address.

The `Email` field type should be used when you wish to store an email, for example, the primary email address of the client.

A field of type `Email` is represented as a label or a clickable link when it is being viewed (depends on the configuration).
When the field is being edited, it is represented as an email input box.

[IMPORTANT]
====
Internally, the email is stored as a plain-text regardless of the configuration.
Display formatting is performed in the front-end application.
====

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-email-plain]#<<field-type-email-plain,Don't turn email into a link>>#
|
Displays the email as a regular string and not as a clickable link.

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-email-validation-format]#<<field-type-email-validation-format,Format>>#
|
The `Email` field accepts any email format defined by `RFC 5322`.
An example of the most common format is `recipient@mail.tld`.

|===

[#field-type-select]
== Select / dropdown

A `select / dropdown` field type stores a value from a pre-defined set of options.

The `select / dropdown` field type should be used when you wish to force suers to pick one of the pre-defined values.
For example, the stage of a case or the stage of a lead.

A field of type `select / dropdown` is represented as a label when it is being viewed.
When the field is being edited, it is represented as a dropdown input box.

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-select-options]#<<field-type-select-options,Options>>#
|
Defines a set of available options that the field can have.
For example, `new`, `in progress`, `closed`.

An option is a value-label pair, where the label defines how the value is displayed to the user.

[IMPORTANT]
====
Internally, the select field is represented by the *value* and not the label.
When you're referencing the field via automation or an external integration, make sure to use the value and not the label.
====

| [#field-type-select-select]#<<field-type-select-select,Multiple value input type>>#
|
Defines how the multi-value variant of the field is represented.

[NOTE]
====
*DevNote* list and describe the options?
====

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-select-validation-value]#<<field-type-select-validation-value,Value>>#
|
The `Select` field only permits the use of values defined in the field configuration.

|===

[#field-type-number]
== Number

A `Number` field type stores a numeric value.

The `Number` field type should be used when you wish to store any numeric value.
For example, the cost of a subscription or the cost of a lead.

A field of type `Number` is represented as a formatted label when it is being viewed.
When the field is being edited, it is represented as a number input box.

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-number-prefix]#<<field-type-number-prefix,Prefix>>#
|
Adds the specified prefix to the numeric value.
For example, the prefix of `$` and the value of `1000` would result in the label of `$1000`.

| [#field-type-number-suffix]#<<field-type-number-suffix,Suffix>>#
|
Adds the specified suffix to the numeric value.
For example, the suffix of `USD/h` and the value of `1000` would result in the label of `1000USD/h`.

| [#field-type-number-precision]#<<field-type-number-precision,Precision>>#
|
Defines the precision at which the value is to be stored.
For example, the precision of 3 would allow you to store numbers with up to three decimal places.

[IMPORTANT]
====
The precision is limited to 6.
====

| [#field-type-number-format]#<<field-type-number-format,Format>>#
|
Defines the format string that is used when displaying the numbers.
The field supports all of the https://numeraljs.com/#format[numeral.js] formatting options.

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-number-validation-value]#<<field-type-number-validation-value,Value>>#
|
The `Number` field only permits values which can be represented as a 64bit float.
Examples of the most common representations include `1024` and `1024.256`.

|===

[#field-type-record]
== Record

A `Record` field type stores a *reference* to another record.

[IMPORTANT]
====
The stored value is the `recordID` to the referenced record.
If you wish to access the values of the referenced record, you need to fetch it from the REST API.
====

The `Record` field type should be used when you wish to define a relation between two modules.
For example, the parent transaction or the account owner.

[CAUTION]
====
You can only reference records *in the same namespace*.
====

A field of type `Record` is represented as a clickable link to the related record when it is being viewed.
When the field is being edited, it is represented as a searchable dropdown box.

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-record-module]#<<field-type-record-module,Module>>#
|
Defines - the records of which module a field is linked to.

| [#field-type-record-label]#<<field-type-record-label,Record label field>>#
|
Defines what module field from the related module should be used when displaying it's records records.

| [#field-type-record-prefilter]#<<field-type-record-prefilter,Pre-filter records>>#
|
Defines the pre-filter that is used when searching for the related records.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

| [#field-type-record-ff]#<<field-type-record-ff,Query fields on search>>#
|
Defines what fields are used for querying when searching over related records.

| [#field-type-record-select]#<<field-type-record-select,Multiple value input type>>#
|
Defines how the multi-value variant of the field is represented.

[NOTE]
====
*DevNote* list and describe the options?
====

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-record-validation-value]#<<field-type-record-validation-value,Value>>#
|
The `Record` field only permits record IDs (references to other records) which exist in the system.

|===

[#field-type-string]
== String

A `String` field type stores a generic text value.

The `String` field type should be used when you wish to store text.
For example, the name of a contact or the TOS that should be shown to the client.

A field of type `String` is represented as a text when it is being viewed.
When the field is being edited, it is represented as a text input box or a rich text input box (depending on the configuration).

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-string-multi]#<<field-type-string-multi,Multi-line>>#
|
Changes the simple input box to be a multi-line text area.

| [#field-type-string-rte]#<<field-type-string-rte,Use rich text editor>>#
|
Changes the simple string input to be a multi-line rich text editor.
The value is encoded as a standard HTML document, therefore the value can be used in applications where HTML is accepted.

|===

[#field-type-url]
== URL

A `URL` field type stores a URL address.

The `URL` field type should be used when you wish to store a URL address.
For example, the link to the client's homepage.

A field of type `URL` is represented as a label or a clickable link when it is being viewed (depending on the configuration).
When the field is being edited, it is represented as a URL input box.

[IMPORTANT]
====
Internally, a URL is stored as a plain-text regardless of the configuration.
Display formatting is performed in the front-end application.
====

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-url-trimh]#<<field-type-url-trimh,Trim # from the URL>>#
|
Removes the URL fragment (the text after the `#`).

| [#field-type-url-trimq]#<<field-type-url-trimq,Trim ? from the URL>>#
|
Removes the URL query (the text after the `?`).

| [#field-type-url-ssl]#<<field-type-url-ssl,only allow SSL (HTTPS) URLs>>#
|
Only allows secure (HTTPS) URL addresses.

| [#field-type-url-plain]#<<field-type-url-plain,Don't turn URL into a link>>#
|
The URL address is shown as a regular label instead of a clickable link.

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-url-validation-format]#<<field-type-url-validation-format,Format>>#
|
The `URL` field only permits valid URL strings which define a scheme and a host.
The pattern for a valid URL is `[scheme:][//[userinfo@]host][/]path[?query][#fragment]`.

| [#field-type-url-validation-secure]#<<field-type-url-validation-secure,Secure>>#
|
When the field is configured to only allow secure URLs, the scheme must equal to `https`.
|===

[#field-type-user]
== User

A `User` field type stores a *reference* to a system user.

[IMPORTANT]
====
The stored value is the `userID` to the referenced user.
If you wish to access the values of the referenced user, you need to fetch it from the REST API.
====

The `User` field type should be used when you wish to define a relation between a record and a system user.
For example, the owner of the record or the task assignee.

A field of type `User` is represented as label when it is being viewed.
When the field is being edited, it is represented as a searchable dropdown box.

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-user-prefilter]#<<field-type-user-prefilter,Pre-filter users>>#
|
Defines the pre-filter that is used when searching for the related user.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

| [#field-type-user-preselect]#<<field-type-user-preselect,Preset with current user>>#
|
When checked, the current user will populate the given field by default.

| [#field-type-user-role-filter]#<<field-type-user-role-filter,User roles>>#
|
Filters the users based on their membership.

| [#field-type-user-select]#<<field-type-user-select,Multiple value input type>>#
|
Defines how the multi-value variant of the field is represented.

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-user-validation-value]#<<field-type-user-validation-value,Value>>#
|
The `User` field only permits user IDs (references to users) which exist in the system.

|===

[#field-type-file-upload]
== File upload

A `File upload` field type stores a *reference* to an uploaded attachment.

[IMPORTANT]
====
The stored value is the `attachmentID` to the referenced user.
If you wish to access the values of the referenced file, you need to fetch it from the REST API.
====

The `File upload` field type should be used when you wish to attach a document to the record.
For example, a client's quote or a legal document.

A field of type `File upload` is represented as clickable link when it is being viewed.
When the field is being edited, it is represented as a drag-and-drop file upload box.

.Additional configurations:
[cols="1s,5a"]
|===

| [#field-type-file-vm]#<<field-type-file-vm,View mode>>#
|
Defines how the files are presented when they are being viewed.

[NOTE]
====
*DevNote* list & describe the available options.
====

|===

.Value validation:
[cols="1s,5a"]
|===

| [#field-type-file-validation-value]#<<field-type-file-validation-value,Value>>#
|
The `File` field only permits file IDs (references to files) which exist in the system.

|===

[#field-type-location]
== Location

A `Location` field type stores a location which can be selected and plotted on a map.

The `Location` field type should be used when you wish to store a location.
For example, a client's geo location.

A field of type `Location` is represented as a location on a map.
When the field is being edited, it is represented as a selectable location on a map.

The `Location` field does not define kind specific configuration options.


# src/modules/integrator-guide/pages/compose-configuration/import-export.adoc

include::ROOT:partial$variables.adoc[]

= Importing and exporting namespaces
:keywords: low code, no code, import, export
:description: Learn how to import and export {APP_NAME_COMPOSE} applications

{PRODUCT_NAME} makes it easy to export entire namespaces which can then be imported into an entirely different {PRODUCT_NAME} instance.

.To export the namespace:
. go to menu:{PRODUCT_NAME} {APP_NAME_COMPOSE}[],
. click on the btn:[Edit] button for the namespace you wish to export,
. click on the btn:[Export] button in the top-left corner to export the namespace,
. save the `.zip` file.

.To import the namespace:
. go to menu:{PRODUCT_NAME} {APP_NAME_COMPOSE}[],
. click on the btn:[Import] button for the top-left corner,
. drag'n drop the `.zip` file into the file drop area.

[CAUTION]
====
The exported namespace will exclude workflow references and access control permissions.
Those need to be configured manually after the fact.
====


# src/modules/integrator-guide/pages/compose-configuration/index.adoc

include::ROOT:partial$variables.adoc[]

= {APP_NAME_COMPOSE} configuration
:keywords: low code, no code, app
:description: Learn how to configure your {APP_NAME_COMPOSE} application using {PRODUCT_NAME}

{PRODUCT_NAME} provides a powerful Low-Code development platform allowing you to setup your application with ease.
{PRODUCT_NAME} {APP_NAME_COMPOSE} allows you to extend {PRODUCT_NAME} and support your business needs.

With {PRODUCT_NAME} {APP_NAME_COMPOSE} we define the logical data structure, how the data is displayed, and how it should be visualized.
The second part is the xref:automation/index.adoc[automation] process, which allows you to implement custom business logic and automate tasks.

If you wish to learn more about a specific topic, refer to the subsections under menu:Low-Code Platform Developer Guide[{APP_NAME_COMPOSE} configuration].

== App configuration

[#config-namespaces]
=== Create a new namespace

A *namespace* is a container for the configuration and the data specific to an application, such as a CRM.
A namespace uses <<config-modules,modules>> to define the data structure, <<config-pages,pages>> to define how the data is displayed, and <<config-charts,charts>> to visualize the data.

[IMPORTANT]
====
A namespace *can not* directly access data from another namespace.
If this is needed, consider implementing this using xref:automation/index.adoc[automation] to programmatically define the interaction.
====

To create a new namespace, navigate to your {PRODUCT_NAME} instance (for example http://latest.cortezaproject.org/) and click on the {APP_NAME_COMPOSE} application.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "app-selector.png",
    "alias": "compose-configuration-app-selector",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 400,
    "y": 255,
    "w": 266,
    "h": 217
  },
  "annotations": []
}
----

A new screen with a list of all namespaces will appear.

image::compose-configuration/ns-create.png[role="data-zoomable"]

.From there you can:
* create a new namespace by clicking on the btn:[Create new namespace] button,
* edit existing namespaces by clicking on the btn:[Edit] icon next to the namespace,
* manage global permissions by clicking on the btn:[Permissions button]

Click on the btn:[Create new namespace] button, insert the required parameters, and click on the btn:[Save] or the btn:[Save and close] button in the bottom right corner.

image::compose-configuration/ns-edit.png[role="data-zoomable"]

.Available namespace parameters:
[cols="2s,5a"]
|===

| [#ns-param-name]#<<ns-param-name,Name>>#
|
The namespace name is the human-friendly label that is shown when identifying the namespace.
The name should be short and descriptive.

| [#ns-param-slug]#<<ns-param-slug,Short name>>#
|
The short name (slug) is a unique human-friendly system identifier for the namespace that can be used instead of the namespace ID when referencing the namespace.

.The short name is usually a variation of the full name that must conform to the following constraints:
include::partial$handle-constraints.adoc[]

| [#ns-param-enable]#<<ns-param-enable,Enable on namespace list>>#
|
The enabled flag controls if the namespace is enabled and can be accessed.
When disabled, the namespace is still visible, but can not be accessed.

| [#ns-param-enable-app]#<<ns-param-enable-app,Enable on application list>>#
|
The enabled application flag controls if the namespace should be immediately treated as an application and shown on the app selector.

| [#ns-param-logo]#<<ns-param-logo,Logo>>#
|
The namespace logo input allows you to upload a custom logo for the specific namespace.
The default logo is the one defined in the theme.

| [#ns-param-icon]#<<ns-param-icon,Icon>>#
|
The namespace icon input allows you to upload a custom icon to use alongside the namespace.

| [#ns-param-subtitle]#<<ns-param-subtitle,Subtitle>>#
|
The subtitle is the subtitle of the namespace

| [#ns-param-description]#<<ns-param-description,Description>>#
|
The description allows you to provide a more verbose description of the namespace, what it is for, and what kind of data does it contain.

|===

After you've created the namespace, you can access it by clicking on the btn:[Visit namespace button].
At this point, your namespace is empty and doesn't have any modules, charts, or pages.

image:compose-configuration/ns-access.png[width=49%]
image:compose-configuration/ns-empty.png[width=49%]

[#config-modules]
=== Creating a new module

A *module* defines the shape of a record and provides a container for the records, such as an account or a contact.
A module uses a series for <<module-field,module fields>> to define the records' structure and a <<config-record-page,record page>> to define how the record is presented to the user.

When configuring a new namespace, you are presented with an onboarding screen from where you can click on the btn:[Create Module] button to create your first module.

If you wish to add additional modules, or are configuring an already existing namespace, navigate to menu:Admin panel[Modules], and click on the btn:[New Module] button.

image::compose-configuration/module-create.png[role="data-zoomable"]

.From the module editor screen you can:
* Edit the module metadata,
* edit <<module-fields,module fields>> for the given module,
* edit xref:compose-configuration/record-storage.adoc[DAL connection parameters] and privacy settings for the given module,
* configure xref:compose-configuration/duplication-detection.adoc[duplicate detection] for the given module,
* configure xref:compose-configuration/record-revisions.adoc[record revisions] for the given module,
* manage permissions for the given module by clicking on the btn:[Permissions] button,
* manage module field permissions for the given module by clicking on the btn:[Field permissions] button.

.Available module parameters:
[cols="2s,5a"]
|===

| [#mod-param-name]#<<mod-param-name,Name>>#
|
The module name is a user-friendly label that is shown when identifying the module.
The name should be short and descriptive.

| [#mod-param-handle]#<<mod-param-handle,Handle>>#
|
The short name (handle) is a unique user-friendly *system identifier* that can be used instead of the module ID when referencing the module.

.The handle is usually a variation of the full name and therefore must conform to the following constraints:
include::partial$handle-constraints.adoc[]

|===

[#generate-synthetic-data]
=== Generate synthetic data for a module

{PRODUCT_NAME} provides a tool to generate synthetic data for a module.
You can use it to generate a large amount of data for a module to test the application's performance or to demonstrate the implementation.

The tool is currently only available in the command line interface (CLI) and supports synthetic data generation for {APP_NAME_COMPOSE} records (`compose records synthetic`) and users (`users synthetic`).

Generated records are flagged with `synthetic:true` in the record's meta field, and users will have their handles prefixed with `synthetic_` and email domain `synthetic.tld`.

==== Usage

.Show help for synthetic {APP_NAME_COMPOSE} record generator:
[source,shell]
----
corteza-server compose records synthetic --help
----

.Generate 10 leads in the crm namespace:
[source,shell]
----
corteza-server compose records synthetic generate --namespace crm --module lead --total 10
----

.Remove all synthetic records in leads module in the crm namespace:
[source,shell]
----
corteza-server compose records synthetic rm --namespace crm --module lead
----

[#config-record-page]
=== Creating record pages

A *record page* defines how the data is presented to the user when viewing, creating and editing records for that module.
A record page consists of a series of page blocks that are defined with the <<page-builder,page builder>>.

[IMPORTANT]
====
In case your module does not define a record page, you are not able to create or update its records through the user interface.

You are still able to view its records, create the records using inline record lists, the API, or an xref:automation/index.adoc[automation].
====

A record page is tied to the specified module, and to the record it is pointing to.
This allows you to configure the page blocks to react to the currently viewed record for dynamic resource filtering.

[TIP]
====
You can utilize xref:compose-configuration/page-layouts.adoc[page layouts] for even more flexibility on how users interact with the data.
====

The record page can be created directly from the module edit screen by clicking on the btn:[Create record page] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/create-record-page-1.png",
    "alias": "record_page_create_module_edit",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 1462,
    "y": 98,
    "w": 193,
    "h": 42
  }]
}
----

Alternatively, you can create missing record pages from the list of modules by clicking on the btn:[Create record page] button next to a module.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/create-record-page-2.png",
    "alias": "record_page_create_module_list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 1398,
    "y": 372,
    "w": 173,
    "h": 31
  }]
}
----

[#config-charts]
=== Creating charts

A *chart* defines how a specific modules' records are visualized.
A chart is bound to your module and allows you to aggregate and transform the data which is then visualized on a chart.

[NOTE]
====
One chart can only show records of one module.
====

If you're configuring a new namespace, you are presented with an onboarding screen from where you can click on the btn:[Create Chart] button to create your first chart.

If you wish to add additional charts or are configuring an already configured namespace, navigate to menu:Admin panel[Charts], then click on the btn:[New Chart] button.

image::compose-configuration/chart-create.png[role="data-zoomable"]

.{PRODUCT_NAME} defines three chart categories:
* <<chart-generic,Generic charts>> which include the usual line, bar, pie, and doughnut charts,
* <<chart-funnel,funnel charts>> which define the funnel chart,
* <<chart-gauge,gauge charts>> which define the gauge chart.

Refer to the chart specific sub-sections for more details

.From the chart editor screen you can:
* Edit the chart metadata,
* edit the charts' report configuration,
* edit the charts' visual representation.

[#config-list-pages]
=== Creating list pages

A *list page* defines how the application is presented to the user when interacting with it.
A list page consists of a series of page blocks that are defined with the <<page-builder,page builder>>.

In contrast to record pages, list pages are broader and only bound to the namespace they are on.
They are general purpose and used to provide access to different record pages via record lists, dashboards, and other layouts.

When configuring a new namespace, you are presented with an onboarding screen.
From there you click on the btn:[Build Page] button in order to create your first page.

[TIP]
====
You can utilize xref:compose-configuration/page-layouts.adoc[page layouts] for even more flexibility on how users interact with the data.
====

If you wish to add additional pages or you are configuring an already configured namespace, navigate to menu:Admin panel[Pages], and click on the btn:[New Page] button.
From there you can click on the btn:[Page builder] button to enter the <<page-builder,page builder>>

.Available page parameters:
[cols="2s,5a"]
|===

| [#pg-list-param-title]#<<pg-list-param-title,Page title>>#
|
The page title is a label that is shown when viewing the page and when displaying the page navigation.
The page title should be short and descriptive.

| [#pg-list-param-handle]#<<pg-list-param-handle,Handle>>#
|
The short name (handle) is a unique, user-friendly system identifier for the module.
It can be used instead of the page ID when referencing the page.

.The handle is usually a variation of the title and therefore must conform to the following constraints:
include::partial$handle-constraints.adoc[]

|===

[#config-navigation]
=== Structuring the navigation

The page navigation of your application is generated based on your list pages and their position in the *page tree*.
Navigate to the menu:Admin panel[Pages] to see your current pages and how they are structured.

To *change the order of pages*, drag and drop the page to the desired position.

image:compose-configuration/page-tree-base.png[width=49%]
image:compose-configuration/page-tree-reorder.png[width=49%]
image:compose-configuration/page-tree-reorder-view.png[]

To *create a dropdown menu* (a sub-page or a nested page), drag and drop the page into another page.

image:compose-configuration/page-tree-base.png[width=49%]
image:compose-configuration/page-tree-nest.png[width=49%]
image:compose-configuration/page-tree-nest-view.png[]

To always have sub-pages expanded, enable the checkbox under the `Other options` sub-section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-edit-module-cases.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 400,
    "y": 250,
    "w": 1400,
    "h": 560
  },
  "annotations": [{
    "x": 1125,
    "y": 440,
    "w": 270,
    "h": 20
  }]
}
----

After enabling the option, sub-pages will be expanded in the public view of {PRODUCT_NAME}.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/public-page-case-expanded-sub-pages.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 315,
    "h": 475
  },
  "annotations": [{
    "padding": "lg",
    "x": 35,
    "y": 330,
    "w": 83,
    "h": 5
  }]
}
----

[#module-field]
== Module fields

A *module field* defines the shape of the modules' records (what parameters will we store), what data type specific parameters are, and additional settings to control how the field should behave.
Each module can have multiple module fields.

To edit module fields, navigate to menu:Admin panel[Modules] and click on the module you wish to edit.
The module fields are listed in the "manage module fields" section, below the module metadata.

.A detailed breakdown of module fields:
[cols="1s,5a"]
|===

| [#module-field-name]#<<module-field-name,Name>>#
|
A field name defines how the value is stored internally and what key is used when accessing the value from an automation.

[CAUTION]
====
Once a module is populated with at least one record, the name can not be changed.
====

A field name should be short and descriptive.
There is *a limit of 64 characters* imposed.

.A name field must conform tho the following constraints:
include::partial$handle-constraints.adoc[]

| [#module-field-title]#<<module-field-title,Title>>#
|
A field title defines what label is used when presenting the field and the value to the user.

The field name should be short, descriptive, and modeled after the field title.
If you omit the title, the <<module-field-name,name>> is used instead.

| [#module-field-type]#<<module-field-type,Type>>#
|
A field type defines what type of data the field stores.
For example, if we wish to store email addresses of our users, the field type will be `Email`.

Refer to the xref:compose-configuration/field-types.adoc[] section for more details regarding field types.

| [#module-field-settings-base]#<<module-field-settings-base,Base field settings>>#
|
Base field settings control the general behavior of the module field.
Base field settings are accessible directly under the "Attributes" column of the module field list.

[IMPORTANT]
====
When exporting multi-value fields into the CSV format, only the *first value* is exported.
====

| [#module-field-settings-ts]#<<module-field-settings-ts,Type specific field settings>>#
|
Type-specific field settings control the behavior of the module field based on the <<module-field-type,field type>>.

To access type-specific settings, click on the btn:[settings icon] next to the field type and navigate to the second tab (the one with the same name as the field type).

Refer to xref:compose-configuration/field-types.adoc[module field type reference] for details.

| [#module-field-expr]#<<module-field-expr,Field expressions>>#
|
Field expressions allow you to define a formula (calculated) field.
When a field defines an expression, the value is updated by the system when the result of the expression changes.

[CAUTION]
====
The value of a formula field can not be manually changed.
====

Click on the btn:[settings icon] next to the field type and navigate to the "General" tab.
Check the "field value expression" checkbox and insert the formula into the new input box.

Refer to the <<field-expressions,field expressions>> for more details.

image::compose-configuration/field-value-expr.png[role="data-zoomable"]

| [#module-field-validation]#<<module-field-validation,Field validation>>#
|
Value sanitizers allow you to implement custom value sanitization (value transformation) before the value is stored.
Value validators allow you to implement custom value validation before it is stored.

Click on the btn:[settings icon] next to the field type and navigate to the "Validation" tab.

[IMPORTANT]
====
* Custom sanitizers are run *before* the built-in sanitizers.
* Built-in sanitizers *can not be disabled*.
====

Refer to the <<field-expressions,field expressions>> for more details.

image::compose-configuration/field-validation.png[role="data-zoomable"]

|===

== Chart configuration

[#chart-generic]
=== Generic chart configuration

.Generic charts include:
* bar charts
* line charts
* pie charts
* doughnut charts

[cols="1s,5a"]
|===

| [#chart-config-generic-module]#<<chart-config-generic-module,Module>>#
|
The module specifies the data source (what records to use) for the chart.
The chart can only show records of the same namespace that the chart was created in.

| [#chart-config-generic-filter]#<<chart-config-generic-filter,Filter>>#
|
The filter allows you to define what records you wish to show in the chart.
For example, you wish to aggregate the leads that you created in the last month.

The dropdown menu provides you with a selection of the most common filters.
Click on the "customize filter checkbox" if you wish to modify the selected filter or to write your own.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details regarding filter definition.

| [#chart-config-generic-yxs]#<<chart-config-generic-yxs,Y-axis>>#
|
The y-axis section allows you to configure the position of the axis (left or right), the label, and minimum, as well as maximum, values.

| [#chart-config-generic-dimension]#<<chart-config-generic-dimension,Dimensions>>#
|
The dimensions section allows you to specify what field is to be used to plot the dimension; the x-axis.

[NOTE]
====
The current implementation only permits one dimension per chart.
====

.You may only use simple, single-value fields as dimension fields:
* `DateTime`
* `Select`
* `Number`
* `Bool`
* `String` with rich-text editor disabled.

Field of the `DateTime` type also allows you to define the grouping function.

| [#chart-config-generic-metric]#<<chart-config-generic-metric,Metrics>>#
|
The metric section allows you to specify what field is to be used to determine each dimension's value and how it is to be plotted.

You may only use numeric fields as dimension fields.
A special `count` field returns the number of records that match the configuration parameters.

****
There is a post-processing function input set up; it allows you to transform the generated values by the reporting system.
They are written as simple JavaScript expressions that return a single number based on two variables.

* `m`: the value of the previous dimension entry (the value is `undefined` for the first entry)
* `n`: the value of the current dimension entry

.An example that creates an aggregated chart:
[source,js]
----
m ? m + n : n
----
****

|===

[#chart-funnel]
=== Funnel chart configuration

A funnel chart is constructed from a series of reports where each report may define its dimension and metric.
This allows you to piece together reports from different modules, which allows you to visualize the data between multiple modules.

[cols="1s,5a"]
|===

| [#chart-config-funnel-module]#<<chart-config-funnel-module,Module>>#
|
The module specifies the data source (which records to use) for the chart.
The chart can only show records of the same namespace that the chart was created in.

| [#chart-config-funnel-filter]#<<chart-config-funnel-filter,Filter>>#
|
The filter allows you to define what records you wish to show in the chart.
For example, you wish to aggregate the leads that you created in the last month.

The dropdown menu provides you with a selection of the most common filters.
Click on the "customize filter checkbox" if you wish to modify the selected filter or write your own.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details regarding filter definition.

| [#chart-config-funnel-dimension]#<<chart-config-funnel-dimension,Dimensions>>#
|
The dimensions section allows you to specify what field is to be used to plot the dimension.

Only fields of type `Select` may be used as the dimension field.
After you select a field, all of the field options are presented to you.
Select which values you wish to show and their order.

| [#chart-config-funnel-metric]#<<chart-config-funnel-metric,Metrics>>#
|
The metric section allows you to specify what field is to be used to determine each dimension's value.

You may only use numeric fields as dimension fields.
The `count` field returns the number of records that match the configuration parameters.

|===

[#chart-gauge]
=== Gauge chart configuration

[cols="1s,5a"]
|===

| [#chart-config-gauge-module]#<<chart-config-gauge-module,Module>>#
|
The module specifies the data source (what records to use) for the chart.
The chart can only show records of the same namespace that the chart was created in.

| [#chart-config-gauge-filter]#<<chart-config-gauge-filter,Filter>>#
|
The filter allows you to define what records you wish to show in the chart.
For example, you wish to aggregate the leads that you created in the last month.

The dropdown menu provides you with a selection of the most common filters.
Click on the "customize filter checkbox" if you wish to modify the selected filter or write your own.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details regarding filter definition.

| [#chart-config-gauge-dimension]#<<chart-config-gauge-dimension,Dimensions>>#
|
The dimensions section allows you to specify what field is to be represented on the gauge.
Only fields of type `Select` may be used as the dimension field.

Each dimension has a series of steps that can be added by clicking on the btn:[+ Add] button.
Each step defines a label and the maximum value for the step.
The colours are defined based on the set colour scheme.

| [#chart-config-gauge-metric]#<<chart-config-gauge-metric,Metrics>>#
|
The metric section allows you to specify how the value of the gauge is calculated.

You may only use numeric fields as dimension fields.
The `count` field returns the number of records that match the configuration parameters.

****
There is a special post-processing function input set up; it allows you to transform the generated values by the reporting system.
They are written as simple JavaScript expressions that return a single number based on the two variables.

* `m`: the value of the previous dimension entry (the value is `undefined` for the first entry)
* `n`: the value of the current dimension entry

.An example of a chart that converts the price to be in thousands:
[source,js]
----
n / 1000
----
****

|===

[#page-builder]
== Page builder

[IMPORTANT]
====
If all page blocks are on the same y-axis (one single row), the page will stretch the blocks to fill the entire page.
This is useful when creating record or list pages with a single page block that should span the entire page.

image:compose-configuration/page-resize-config.png[width="49%"]
image:compose-configuration/page-resize-view.png[width="49%"]

====

The page builder is used to define the pages' structure using *page blocks* and a drag-and-drop interface.
Each page has a grid of 12 columns and is not limited vertically.

image::compose-configuration/page-builder-empty.png[role="data-zoomable"]

Click on the btn:[+ Add block] button to open the page block picker where you can configure and add a new page block.
The entire page block reference is available xref:compose-configuration/page-blocks.adoc[here].

image::compose-configuration/page-builder-block-picker.png[role="data-zoomable"]

When you configure and save a page block it is added to the page.

image::compose-configuration/page-builder-block-base.png[role="data-zoomable"]

To reposition the page block, simply drag-and-drop it to the desired position.

The page block may be placed anywhere on the x-axis, but its y-axis must connect with another page block or with the top of the page.
If the position is not valid, or it overlays with another page block, the page builder may automatically adjust the surrounding page blocks to conform to the constraints.

image::compose-configuration/page-builder-block-base.png[role="data-zoomable"]
image::compose-configuration/page-builder-block-repos.png[role="data-zoomable"]

To resize the page block, simply grab the arrow in the bottom-right corner and resize to your needs.
The page block may not exceed the maximum width of 12 columns.
The height is not limited.

image::compose-configuration/page-builder-block-base.png[role="data-zoomable"]
image::compose-configuration/page-builder-block-resize.png[role="data-zoomable"]

By placing a few extra blocks and changing their layout, you can create interesting home pages and dashboards like the CRM's.

image::compose-configuration/page-builder-example.png[role="data-zoomable"]

== Page Block Duplication

Page blocks can be duplicated, which makes it a breeze to reuse a page block.
This saves you the hassle of having to recreate a page block every time you need to reuse one.

=== Copying a page block

A great use case for copying a page block is when you want to use it on a different page in the same namespace or even a different namespace!

For copying, all you have to do is navigate to the page that holds the page block you are interested in, click the button highlighted below and the page block will be copied to your clipboard.
In the image below, the title of the pages have been highlighted to indicate that they are different pages.

.Copying a page block
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-copy.png",
    "w": 1920,
    "h": 1080
  },
  "annotations": [
    {
      "x": 278,
      "y": 19,
      "w": 355,
      "h": 31,
      "kind": "box"
    },
    {
      "x": 115,
      "y": 373,
      "w": 15,
      "h": 16,
      "kind": "box"
    }
  ]
}
----

You can then navigate to any other page to reuse this page block as many times as you want by pasting it with kbd:[Ctrl+V] just as you would any other content on your clipboard.

.Pasting a page block
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-paste.png",
    "w": 1920,
    "h": 1080
  },
  "annotations": [
    {
      "x": 276,
      "y": 10,
      "w": 380,
      "h": 50,
      "kind": "box"
    }
  ]
}
----

=== Cloning a page block

Cloning a page block is similar to copying, but instead of copying the page block to your clipboard, it will be cloned on the same page.
For example, if for any reason you would like to have a duplicate of a page block on a page, you can do that in the toolbar of the page block by clicking its clone button.

Below, we have a page with a single block, and we want to clone it.
All we have to do is click the clone button highlighted below.

.Cloning a page block
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-dup.png",
    "w": 1920,
    "h": 1080
  },
  "annotations": [
    {
      "x": 278,
      "y": 19,
      "w": 355,
      "h": 31,
      "kind": "box"
    },

    {
      "x": 72,
      "y": 372,
      "w": 20,
      "h": 20,
      "kind": "box"
    }
  ]
}
----

After cloning the block, here is what the page now looks like with the cloned block.

.Page with a cloned page block
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-clone.png",
    "w": 1920,
    "h": 1080
  },
  "annotations": [
    {
      "x": 278,
      "y": 19,
      "w": 355,
      "h": 31,
      "kind": "box"
    },
    {
      "x": 14,
      "y": 410,
      "w": 778,
      "h": 137,
      "padding": "lg",
      "kind": "box"
    }
  ]
}
----

[#copying-list-pages]
== Copying list pages

The option to save a list page as copy allows us to create a new page that contains the same page blocks as another list page.
This is very useful because instead of re-adding the same page blocks from another page, they can be copied simply by pressing a button.

[IMPORTANT]
====
Only page lists can be copied. Record pages cannot be saved as copies.
====

To copy the contents of another list page, navigate to the page itself and click on the btn:[Save as copy].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-save-as-copy-button.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 535,
    "w": 1920,
    "h": 555
  },
  "focus": {
    "x": 0,
    "y": 1000,
    "w": 1920,
    "h": 60
  },
  "annotations": [{
    "kind": "box",
    "x": 1440,
    "y": 1017,
    "w": 165,
    "h": 45
  }]
}
----

A new page with the same contents will be added to the list of pages.
The structure of the new page's name will be `Copy of <name of the page it was copied from> (<number of copies>)`.
For example, if the page that was copied from is called `Leads`, then the newly created page will be `Copy of Leads (1)`.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/copied-page.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 315,
    "h": 475
  },
  "annotations": [{
    "kind": "box",
    "x": 30,
    "y": 370,
    "w": 95,
    "h": 15
  }]
}
----

== Configuring Page Icons

Page icons can be set to list or record pages.
This gives us the ability to further customize a page and easily distinguish it from other pages.

To set the page icon, inside your namespace, navigate to the menu:admin panel[pages], and edit the page you wish to set the icon for.
Find the page icon section under the page description and click on the btn:[edit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-edit.png",
    "alias": "base-set-icon",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 450,
    "y": 190,
    "w": 1400,
    "h": 600
  },
  "annotations": [{
    "padding": "lg",
    "x": 600,
    "y": 400,
    "w": 470,
    "h": 60
  }]
}
----

A modal will open with two sub-sections: `Upload icon` and `Or add link to icon`.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-edit-configure-icon.png",
    "alias": "page-edit-configure-icon-view-modal",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 570,
    "y": 40,
    "w": 780,
    "h": 330
  }
}
----

[NOTE]
====
The currently supported icon format is `.icon`.
Svg image format isn't supported yet.
====

In the `Upload icon` sub-section you can drag and drop or click on the button and choose an icon.
The uploaded icon can be previewed in the list of icons.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-edit-configure-icon.png",
    "alias": "page-edit-configure-icon-upload-section",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 570,
    "y": 40,
    "w": 780,
    "h": 330
  },
  "annotations": [{
    "padding": "lg",
    "x": 585,
    "y": 108,
    "w": 750,
    "h": 60
  }]
}
----

In the `or add link to icon` sub-section you can add a link to an icon and preview it.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-edit-configure-icon.png",
    "alias": "page-edit-configure-icon-add-link",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 570,
    "y": 40,
    "w": 780,
    "h": 330
  },
  "annotations": [{
    "padding": "lg",
    "x": 585,
    "y": 190,
    "w": 750,
    "h": 60
  }]
}
----

After uploading an icon, all of the available icons are shown at the bottom of the modal window.
Select one (if not already selected) and click on the btn:[save] button.

The page icon will be shown in the page edit screen and the sidebar navigation next to the page name.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-edit-configure-set-icon.png",
    "alias": "page-edit-configure-set-icon-focus-sidebar-content",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 750,
    "h": 700
  },
  "annotations": [{
    "x": 27,
    "y": 280,
    "w": 75,
    "h": 30
  }]
}
----

[#field-expressions]
== Field expressions

[#value-expressions]
=== Value expressions

Value expressions calculate the fields' value based on the provided expression.
A value expression is a simple expression that results in a single value.
If your field is a multi-value field, you need to return an array of items.

Refer to the xref:expr/index.adoc[] for details on writing expressions.

[IMPORTANT]
====
Currently, you can only use values of the current record.
References are not yet supported.
If you need to reference data across multiple records, resort to using an xref:automation/index.adoc[automation] instead.
====

.Available variables in the evaluation context:
[cols="1s,5a"]
|===

| [#values-ctx-old]#<<values-ctx-old,`old`>>#
|
The `old` variable refers to the original record.
Only set when the field is being updated.

| [#values-ctx-new]#<<values-ctx-new,`new`>>#
|
The `new` variable refers to the current record.

| [#values-ctx-value]#<<values-ctx-value,`<field-name>`>>#
|
A string or an array of strings with current field values.
If the field name collides with any of the system-defined variables, access the value via the <<values-ctx-new,new["field_name_here"]>>.

|===

.Example expression that calculates the price with tax:
[source]
----
price * 1.25
----

.Example expression that generates a full name:
[source]
----
trim(firstName + " " + lastName)
----

.Example expression of a multi-value expression evaluation:
[source]
----
["foo", "bar", "baz"]
----

[#value-sanitizers]
=== Sanitizers

Sanitizers modify the field value to cleanup (sanitize) the data before it is saved.
A sanitizer is a simple expression that results in a single value.

[IMPORTANT]
====
Sanitizers are ran multiple times, once before data is sent to event bus (corredor and workflows) and the second is right before the record is sent to the API.
====

Refer to the xref:expr/index.adoc[] for details on writing expressions.

By their nature, sanitizers *should not* result in an error.
If an error occurs, it is logged in the action log, and the operation continues.

If you define multiple sanitizers, they are run in the specified order.

.Example sanitizer that limits the text length:
[source]
----
length(value) > 5 ? substr(value, 0, 5) + "..." : value
----

.Available variables in the evaluation context:
[cols="1s,5a"]
|===

| [#sanitizer-ctx-value]#<<sanitizer-ctx-value,`value`>>#
|
The `value` variable refers to the current value.

|===

[#value-validators]
=== Validators

Validators validate the field value by raising errors when the value is not valid.
A validator is a simple expression that results in a single value, either `true` or `false`.
The value validation is considered invalid when the expression results in `true`.

[IMPORTANT]
====
Validators can not change the field's value.
====

Built-in field validators can be disabled; required and unique-multi-value validators can not be disabled.

If you define multiple validators, they are run in the specified order.

[IMPORTANT]
====
The field validator stops when the first error occurs.
For example, if we define validators `A`, `B`, and `C`, and the validator `A` raises an error, validators `B` and `C` are not evaluated.
====

.Validation expressions are not executed when:
* the value is not changed,
* the value is missing.

[TIP]
====
Use the required flag to check for required values.
====

.Available variables in the evaluation context:
[cols="1s,5a"]
|===

| [#validator-ctx-value]#<<validator-ctx-value,`value`>>#
|
The `value` variable refers to the current value.

| [#validator-ctx-oldvalue]#<<validator-ctx-oldvalue,`oldValue`>>#
|
The `oldValue` variable refers to the original value.
Only set when the field is being updated.

| [#validator-ctx-values]#<<validator-ctx-values,`values`>>#
|
The `values` variable refers to all record values (`values.<field-name>`).
You can use this to create context-aware validators.

|===

.Example validator to check the text length:
[source]
----
length(title) < 5
----

== Page Block Magnification

Page blocks have a magnification option that allows the user to inspect the details of the block in distraction-free mode.
By default, block magnification is disabled.
When set, blocks that have this configuration will have a zoom-in icon in the top right corner of the block, allowing the user to magnify the block upon clicking on the icon.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/magnification-icon.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "padding": "lg",
    "x": 1375,
    "y": 87,
    "w": 15,
    "h": 15
  }]
}
----

=== Configuring Page Block Magnification

To display the magnification icon and enable block magnification, navigate to the page builder, choose a block, and go to its general tab.
There you will find the block magnification options as a select dropdown.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/enable-magnification.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 411,
    "y": 502,
    "w": 533,
    "h": 66
  }]
}
----

Pick any of the two magnification options.
Now, the magnification icon will be visible and users will be able to zoom in the specific block.

.Page Block Magnification Options:
[cols="1s,5a"]
|===

| [#magnification-modal]#<<magnification-modal,Modal>>#
|
The block magnification is in the form of a modal.

image:compose-configuration/magnification-modal.png[role="data-zoomable"]

| [#magnification-fullscreen]#<<magnification-fullscreen,Fullscreen>>#
|
The block magnification is in the form of a full-width and full-height modal.

image:compose-configuration/magnification-fullscreen.png[role="data-zoomable"]

|===


== Page Block Refresh

Page blocks have a refresh option to automatically renew their data without having to reload the entire page, this is useful for page blocks that display data that changes frequently, such as a list of new leads, an update to a chart, or a list of recent comments.

[NOTE]
====
Automation, file, content and navigation blocks do not have the refresh option.
====

=== Enabling Auto-Refresh

When enabled, page blocks that have this configuration will automatically refresh based on an interval.
To enable auto-refresh, navigate to the page builder, choose a block that supports refresh, and go to its general tab.
There you will find the refresh option.

.Page block general tab.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-general.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [
    {
      "x": 965,
      "y": 335,
      "w": 550,
      "h": 100,
      "kind": "box"
    }
  ]
}
----

You'll want to enter a value expressed in seconds into the input above the *Show refresh button* toggle, click save and close, save the page and you should see the block start to refresh when your interval elapses.

The lowest interval allowed is 5 seconds.
To turn auto-refresh off on a block, you need to set its value to 0.

=== Enabling Manual Refresh

To enable manual refresh, navigate to the page builder, choose a block that supports refresh, and go to its general tab.
There you will find a toggle as highlighted below.
Switch it on.

.Page block general tab.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-general.png",
    "alias": "compose-configuration/page-block-general-manual-refresh",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [
    {
      "x": 965,
      "y": 443,
      "w": 195,
      "h": 20,
      "kind": "box"
    }
  ]
}
----

When enabled, page blocks that have this configuration will have a refresh button in the top right corner of the page block,
allowing the user to manually refresh the page block.

.Refresh icon on page blocks with manual refresh.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/pageblock-refreshicon.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [
    {
      "x": 1869,
      "y": 83,
      "w": 20,
      "h": 20,
      "kind": "box"
    }
  ]
}
----

== Field Conditions
  Fields in a module can be displayed conditionally.

=== Rendering a field conditionally
You can choose when a field is displayed.
You can configure this option in a record page.
Edit the record page of a desired module, in the *Field Conditions* section of the record block's configurator you'll find applicable fields that can be configured.
Click on the btn:[Add] and input the expression that should be evaluated to conditionally display a field.

.Field conditions in record page configurator.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/cond_fields_config.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [
    {
      "x": 407,
      "y": 797,
      "w": 1090,
      "h": 148,
      "kind": "box"
    }
  ]
}
----

Supposing we want to show the last name field only if the first name is the name "John" for a module.

image:compose-configuration/cond_fields_firstname.png[role="data-zoomable"]

image:compose-configuration/cond_fields_lastname.png[role="data-zoomable"]


# src/modules/integrator-guide/pages/compose-configuration/page-blocks.adoc

include::ROOT:partial$variables.adoc[]

= Page Block Reference
:keywords: low code, no code, page block reference, page block type reference
:description: Get familiar with the available page block types {PRODUCT_NAME} {APP_NAME_COMPOSE} offers

[NOTE]
====
Refer to xref:accessing-corteza/ql.adoc#query-mv[menu:accessing {PRODUCT_NAME}[query language]] for details on how to filter multi-value fields.
====

[#page-block-automation]
== Automation

The automation page block allows you to show xref:automation/index.adoc#automation-application-general[automation with manual triggers].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-automation.png",
    "alias": "compose-configuration/page-block-reference/config-automation",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 957
  },
  "annotations": []
}
----

The automation page block allows you to use both xref:automation/automation-scripts/index.adoc[automation scripts] and xref:automation/workflows/index.adoc[workflows].

.If you can't see your automation scripts make sure:
* there were no compilation errors,
* you refreshed your page after you've added the scripts,
* the trigger defined a `.uiProp('app', 'compose')` constraint.

.If you can't see your workflows make sure:
* there are no errors in the workflow,
* the workflow has an `onManual` trigger,
* the workflow is enabled.

[#page-block-calendar]
== Calendar

A *calendar page block* allows you to show events from different event sources in a calendar.

image:compose-configuration/page-block-reference/config-calendar-base.png[...,49%,role="preview data-zoomable"]
image:compose-configuration/page-block-reference/config-calendar-es.png[...,49%,role="preview data-zoomable"]

.Supported calendar views:
* month view
* week view
* day view
* agenda view

Calendar page blocks support two event sources; *reminders* and *records*.

The *reminders* event source allows you to show your reminders as a calendar event.

The *records* event source allows you to show a record as a calendar event.
This allows you to have a module for storing tasks which you can then show on the calendar.

[TIP]
====
When using records, you can define a pre-filter, which allows you to show only specific records.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.
====

[TIP]
====
The calendar page block pre-filter supports value interpolation.
====

[#page-block-chart]
== Chart

The *chart page block* allows you to display a pre-configured chart on your page.
Refer to xref:compose-configuration/index.adoc#charts[{APP_NAME_COMPOSE} configuration] for more details.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-chart.png",
    "alias": "compose-configuration/page-block-reference/config-chart",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 258
  },
  "annotations": []
}
----

[#page-block-content]
== Content

The *content page block* allows you to show static content on the page.
This can be an important announcement, a how-to guide, or any other piece of information.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-content.png",
    "alias": "compose-configuration/page-block-reference/config-content",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 497
  },
  "annotations": []
}
----

[#page-block-file]
== File

The *file page block* allows you to upload static files such as a TOS, a work schedule, or a brochure to the page.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-file.png",
    "alias": "compose-configuration/page-block-reference/config-file",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 352
  },
  "annotations": []
}
----

The attachment is static and does not change based on the current context.

.Additional configurations:
[cols="1s,5a"]
|===

| [#page-block-file-vm]#<<page-block-file-vm,View mode>>#
|
Defines how the files are presented when they are being viewed.

[NOTE]
====
*DevNote* list & describe the available options.
====
|===

[#page-block-iframe]
== IFrame

The *iframe page block* allows you to embed an external website into your application.

[IMPORTANT]
====
Make sure to keep any *iframe embedding limitation* in mind.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-iframe.png",
    "alias": "compose-configuration/page-block-reference/config-iframe",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 259
  },
  "annotations": []
}
----

[#page-block-metric]
== Metric

The *metric page block* allows you to display a calculated numerical value based on the data in your namespace.
This is usually an indicator important to your process.
It may be information such as the total finances in your sales pipeline or the current number of open accounts.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-metric.png",
    "alias": "compose-configuration/page-block-reference/config-metric",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 957
  },
  "annotations": []
}
----

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-metric-label]#<<page-block-metric-label,Label>>#
|
Defines what the metric shows.
The label doesn't define any value restrictions, nor is it required.

| [#page-block-metric-d-module]#<<page-block-metric-d-module,Dimension module>>#
|
Defines what records will be used when computing the metric.

| [#page-block-metric-d-filter]#<<page-block-metric-d-filter,Dimension filter>>#
|
Defines how to filter the records when computing the metric.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

[TIP]
====
The filter supports value interpolation.
====

| [#page-block-metric-m-field]#<<page-block-metric-m-field,Metric field>>#
|
Defines what numerical field is to be used when computing the metric.
Each module has a system-defined `count` field, which represents the total number of records conforming to the specified filter.

| [#page-block-metric-m-agg]#<<page-block-metric-m-agg,Aggregation operation>>#
|
Specifies how the values are aggregated when the metric is computed.
You can pick one of the `count`, `sum`, `max`, `min`, or `avg` functions.

| [#page-block-metric-m-trans]#<<page-block-metric-m-trans,Value transformation>>#
|
Allows you to define how the result of the metric is transformed before shown in the page block.

Value transformation expressions are written as simple JavaScript expressions that return a single number based on the two variables.

[NOTE]
====
*DevNote* provide some more insight into this.
====

| [#page-block-metric-m-fmt]#<<page-block-metric-m-fmt,Format>>#
|
Defines the format string that is used when displaying the metric.
The field supports all of the https://numeraljs.com/#format[numeral.js] formatting options.

The format is applied before the prefix and suffix.

| [#page-block-metric-m-pfx]#<<page-block-metric-m-pfx,Prefix>>#
|
Adds the specified prefix to the resulting metric before it is shown in the page block.
For example, the prefix of `$` and the value of `1000` would result in the label of `$1000`.

| [#page-block-metric-m-sfx]#<<page-block-metric-m-sfx,Suffix>>#
|
Adds the specified suffix to the resulting metric before it is shown in the page block.
For example, the suffix of `USD/h` and the value of `1000` would result in the label of `1000USD/h`.

| [#page-block-metric-m-style]#<<page-block-metric-m-style,Style>>#
|
Allows you to define the visual aspects of how the metrics are shown.

|===

[#page-block-record-list]
== Record list

The *record list page blocks* allow you to display records in a table.
Record lists also provide the features for adding, importing, and exporting records.

[IMPORTANT]
====
When using the search box on the record list, the system only includes the selected fields.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-record-list.png",
    "alias": "compose-configuration/page-block-reference/config-record-list",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 957
  },
  "annotations": []
}
----

[TIP]
====
You can trigger *explicit automation scripts* within the record list's header.
Click the "Automation" tab to *select the automation scripts*.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-record-list-automation.png",
    "alias": "compose-configuration/page-block-reference/config-record-list-automation",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 957
  },
  "annotations": []
}
----
====

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-rl-module]#<<page-block-rl-module,Module>>#
|
Defines the module that the record list is set to use when interacting with records.

| [#page-block-rl-module-fields]#<<page-block-rl-module-fields,Module fields>>#
|
Allows you to define the fields and their order when displaying the table.

| [#page-block-rl-inline]#<<page-block-rl-inline,Allow inline record editing>>#
|
Allows you to create, edit, and delete records directly from the record list when the containing record page is in edit mode.

[IMPORTANT]
====
This option is only available for *record pages*.
====

| [#page-block-rl-add-hide]#<<page-block-rl-add-hide,Hide add record button>>#
|
Hides the btn:[+ Add record] button, which prevents you from adding new records from the user interface.

[CAUTION]
====
This does *not* prevent the records from being created if accessed from another user interface or by an automation.
====

| [#page-block-rl-prefilter]#<<page-block-rl-prefilter,Pre-filter records>>#
|
Defines the pre-filter that is used when searching and displaying records on the record list.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

| [#page-block-rl-search-hide]#<<page-block-rl-search-hide,Hide search box>>#
|
Hides the _search input_ box, which prevents you from applying additional filters to the record list.

[CAUTION]
====
The <<page-block-rl-prefilter,prefilter>> is applied regardless of this option.
====

| [#page-block-rl-presort]#<<page-block-rl-presort,Presort records>>#
|
Defines the initial sorting that is applied when displaying the record list.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

[NOTE]
====
When applying custom sorting from the table, the presort is overwritten.
====

| [#page-block-rl-sort-hide]#<<page-block-rl-sort-hide,Hide sorting>>#
|
Hides the _sort controls_ from the record list preventing you from modifying the initial sort.

[CAUTION]
====
The <<page-block-rl-presort,presort>> is applied regardless of this option.
====

| [#page-block-rl-limit]#<<page-block-rl-limit,Records per page>>#
|
Defines the maximum number of records that can be shown on a page.

| [#page-block-rl-paging-hide]#<<page-block-rl-paging-hide,Hide paging>>#
|
Hides the paging controls from the record list, which prevents you from navigating between different pages.

| [#page-block-rl-paging-full]#<<page-block-rl-paging-full,Modify paging>>#
|
Modifies the previous/next page controls to include a list of available pages, which allows easier navigation between pages.

[CAUTION]
====
It is advisable that you disable this option when the module contains a large number of records.
====

| [#page-block-rl-count]#<<page-block-rl-count,Show total record count>>#
|
Shows the total number of records that conform to the defined filters.

[CAUTION]
====
We suggest you disable this option when the module contains a large number of records.
====

| [#page-block-rl-export]#<<page-block-rl-export,Allow records export>>#
|
Enables the record export option and defines the btn:[Export] button in the header of the record list.

| [#page-block-rl-selection]#<<page-block-rl-selection,Allow record selection>>#
|
Adds a series of checkboxes on the record list, which allows you to perform operations over a selection of records.

| [#page-block-rl-reminder-hide]#<<page-block-rl-reminder-hide,Hide record reminder button>>#
|
Hides the _create reminder_ button preventing you from making record-based reminders directly from the record list.

When the feature is enabled, a reminder can be created by clicking on the _reminder_ button next to the record.

| [#page-block-rl-clone-hide]#<<page-block-rl-clone-hide,Hide record clone button>>#
|
Hides the _clone record_ button, which prevents you from cloning records directly from the record list.

When the feature is enabled, a record can be cloned by clicking on the _clone button_ next to the record.

| [#page-block-rl-edit-hide]#<<page-block-rl-edit-hide,Hide record edit button>>#
|
Hides the _edit record_ button, which prevents you from opening the record editor directly from the record list.

When the feature is enabled, the record editor can be opened by clicking on the _edit_ icon next to the record.

| [#page-block-rl-view-hide]#<<page-block-rl-view-hide,Hide record view button>>#
|
Hides the _view record_ button, which prevents you from opening the record viewer directly from the record list.

When the feature is enabled, the record viewer can be opened by clicking on the _view_ icon next to the record.

|===

[#page-block-record-organizer]
== Record organizer

The *record organizer page blocks* allow you to define a series of columns (_stages_) that the record of a given module may reside in.
The records are moved around using the drag-and-drop interface.

A single record organizer page block defines one column.
Add additional record organizer page blocks to define additional columns.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-ro.png",
    "alias": "compose-configuration/page-block-reference/config-ro",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 856
  },
  "annotations": []
}
----

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-ro-module]#<<page-block-ro-module,Module>>#
|
Defines the module that the record list is to use when interacting with records.

| [#page-block-ro-prefilter]#<<page-block-ro-prefilter,Pre-filter records>>#
|
Defines the pre-filter that is used when searching and displaying records in the organizer.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

| [#page-block-ro-label]#<<page-block-ro-label,Label field>>#
|
Defines what field is used when displaying the record in the record organizer.

| [#page-block-ro-descr]#<<page-block-ro-descr,Description field>>#
|
Defines additional text that is used when displaying the record in the record organizer.

| [#page-block-ro-sort]#<<page-block-ro-sort,Record sort field>>#
|
Defines what field is used to define the order of the records.
When a record is repositioned, all of the related records change the value of the fields to represent the new order.

| [#page-block-ro-key-f]#<<page-block-ro-key-f,Key field>>#
|
Defines what field is used to define what column the record is in.
When a record is repositioned, the value of the given field changes to represent the new state.

| [#page-block-ro-key-v]#<<page-block-ro-key-v,Key value>>#
|
Defines what value the key field must have to be shown in a given column.

|===

[#page-block-record-revisions]
== Record revisions

The *record revisions page blocks* allow you to display the revision history tracked for a particular module.
The revision history is listed in ascending order, with the latest change at the bottom.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-record-revisions.png",
    "alias": "compose-configuration/page-block-reference/config-record-revisions",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 510
  },
  "annotations": []
}
----

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-record-revisions-preload-revisions]#<<page-block-record-revisions-preload-revisions,Preload record revisions>>#
|
Defines if the record revisions page block should display the revision history unconditionally or if the page block should load the revision history on demand (when unchecked).
Keeping the option disabled may help with performance regarding more extensive revision histories, but you can generally enable it.

If the revisions are loaded on demand, the page block displays a btn:[show record revisions] button that allows the user to load the revision history.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-record-revisions-on-demand.png",
    "alias": "compose-configuration/page-block-reference/config-record-revisions-on-demand",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 1380,
    "y": 360,
    "h": 352,
    "w": 543
  },
  "focus": {
    "x": 1410,
    "y": 90,
    "h": 882,
    "w": 473
  },
  "annotations": [{
    "x": 1540,
    "y": 517,
    "h": 32,
    "w": 217
  }]
}
----

| [#page-block-record-revisions-show-all-changes]#<<page-block-record-revisions-show-all-changes,Show changes for all fields>>#
|
Defines if the revision history page block should show all changed values or just a subset.
If the checkbox is unchecked, the table underneath lets you pick what fields the page block should show.

|===

[#page-block-record]
== Record

The *record page block* allows you to display the contents of the records on the *record page*.
When creating or editing the record, record page blocks provide a way of input or manipulation of the values.

[IMPORTANT]
====
Record page blocks are available only on record pages.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-record.png",
    "alias": "compose-configuration/page-block-reference/config-record",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 865
  },
  "annotations": []
}
----

[TIP]
====
You can define multiple record page blocks for the same record page, which allows you to group corresponding things together.
====

[#page-block-sm]
== Social media feed

The *social media feed page block* allows you to embed a specified feed directly into your application.

[NOTE]
====
Currently, only *Twitter feeds* are supported.
====

When added on a *list page*, the specified feed is provided as a fixed URL address.

When added on a *record page*, the specified feed is provided either as a fixed URL address or as a URL field.
Using a module field instead of a fixed value allows a social media feed to change depending on the context.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/config-sf.png",
    "alias": "compose-configuration/page-block-reference/config-sf",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 410,
    "y": 50,
    "w": 1100,
    "h": 340
  },
  "annotations": []
}
----

[#page-block-comment]
== Comment

The *comment page block* allows you to show the records in a comment-like formatting.

image:compose-configuration/page-block-reference/config-comments.png[...,49%,role="preview data-zoomable"]
image:compose-configuration/page-block-reference/added-comments.png[...,49%,role="preview data-zoomable"]


.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-comment-module]#<<page-block-comment-module,Module>>#
|
Defines the module that the page block will use when showing the comment list.

| [#page-block-comment-prefilter]#<<page-block-comment-prefilter,Pre-filter>>#
|
Defines the pre-filter that is applied to the records when showing the comment list.
Refer to the xref:accessing-corteza/ql.adoc[QL reference] for details.

| [#page-block-comment-title]#<<page-block-comment-title,Title>>#
|
Defines what module field should be used when displaying the comment's title.

| [#page-block-comment-content]#<<page-block-comment-content,Content>>#
|
Defines what module field should be used when displaying the comment's content.

| [#page-block-comment-reference]#<<page-block-comment-reference,Reference>>#
|
Defines what module field will be used to store the reference to a specific record the comment is for.
This allows you to show specific comments for specific records.

| [#page-block-comment-sort]#<<page-block-comment-sort,Sort>>#
|
Defines the direction in which the comments will be sorted.
The sorting is done based on when the comment was created at.

|===

[#page-block-report]
== Report

The *report page block* allows you to show particular reporter components inside your {PRODUCT_NAME} {APP_NAME_COMPOSE} app.

image:compose-configuration/page-block-reference/config-report.png[...,49%,role="preview data-zoomable"]
image:compose-configuration/page-block-reference/added-report.png[...,49%,role="preview data-zoomable"]

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-report-report]#<<page-block-report-report,Report>>#
|
Defines the report the page bock will use when showing data.

| [#page-block-report-display-element]#<<page-block-report-display-element,Display element>>#
|
Defines the display element from the selected report the page block will use when showing data.

|===

[#page-block-map]
== Map

The *map page block* allows you to show a map with markers, lines and polygons from different Location field values of different record sources.

image:compose-configuration/page-block-reference/config-map.png[...,49%,role="preview data-zoomable"]
image:compose-configuration/page-block-reference/added-map.png[...,49%,role="preview data-zoomable"]

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-zoom-min]#<<page-block-zoom-min,Zoom min>>#
|
Defines the minimum zoom level of the map.

| [#page-block-zoom-max]#<<page-block-zoom-max,Zoom max>>#
|
Defines the maximum zoom level of the map.

| [#page-block-zoom-lockbounds]#<<page-block-zoom-lockbounds,Lock bounds>>#
|
Defines if the map should be prevented from being panned out or zoomed out of the current rectangular area of the map, specified by its longitude and latitude coordinates. This means that the map will only display the area within the bounds of the specified coordinates and prevent the user from panning or zooming out beyond those bounds.

|===

[#page-block-navigation]
== Navigation

The *navigation page block* allows you to define custom navigation inside your {PRODUCT_NAME} {APP_NAME_COMPOSE} applications applications. The navigation can be an addition to the pre-defined one or a complete replacement.

image:compose-configuration/page-block-reference/config-navigation.png[...,49%,role="preview data-zoomable"]
image:compose-configuration/page-block-reference/added-navigation.png[...,49%,role="preview data-zoomable"]

.Additional configurations:
[cols="2s,5a"]
|===
| [#page-block-navigation-appearance]#<<page-block-navigation-appearance,Appearance>>#
|
Defines the style of the navigation

.Supported appearances:
* Tabs +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-tabs.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-tabs",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

* Pill +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-pills.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-pills",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

* Small +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-small.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-small",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

| [#page-block-navigation-justify]#<<page-block-navigation-justify,Justify>>#
|
Sets equal width for all elements on the navigation

.Options:
* Justify +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation.png",
    "alias": "compose-configuration-page-block-reference-added-navigation.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

* None +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-justify-none.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-justify-none",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----


| [#page-block-navigation-alignment]#<<page-block-navigation-alignment,Alignment>>#
|
Defines the text alignment of each navigation item

.Supported alignments:
* Left +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-left.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-left",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

* Center +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-center.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-center",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

* Right +

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/page-block-reference/added-navigation-right.png",
    "alias": "compose-configuration-page-block-reference-added-navigation-right",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "h": 400,
    "w": 1599
  },
  "annotations": []
}
----

| [#page-block-navigation-item-type]#<<page-block-navigation-item-type,Navigation item type>>#
|
Defines the functionality of a navigation item

.Supported navigation item types:
* Text: This type displays a navigation item as just test with no extra functionalities.
* URL: This type of navigation item has a URL option. When clicked, it will redirect to the corresponding URL.
* Compose page: This type of navigation item has a Compose page option. When clicked, it will redirect to the corresponding Compose page.
* Dropdown: This type of navigation item has a dropdown option. When clicked, it will display a dropdown with the corresponding dropdown items.

|===


# src/modules/integrator-guide/pages/compose-configuration/page-layouts.adoc

include::ROOT:partial$variables.adoc[]

= Page Layouts

Page layouts enable you to dynamically change the contents of the page based on who is viewing what and from where.

{PRODUCT_NAME} provides a flexible mechanism of defining what layouts are available, which is shown when, and how they interact with each other.
The entire system and their interaction is defined using simple expressions, constraints, and actions.

.Example use-cases:
* User onboarding through multiple pages where each page focuses on a single bit of information such as contact information, billing data, and payment methods.
* Show different amount of data based on the role or device type.

[NOTE]
====
.Planed feature improvements:
* Expand the supported set of actions,
* allow users to _fork_ predefined layouts and create personal ones,
* allow interactions to span through multiple different pages; currently a _layout session_ exists while you're on a specific page.
====

== Configuring Page Layouts

Page layouts can be managed at the bottom of the page editor.

While in your {APP_NAME_COMPOSE} namespace, navigate to the menu:admin page[pages], and click on the btn:[edit] button next to the page you wish to edit.
The user interface available under compose page editor.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_new.png",
    "alias": "page_new",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "annotations": [{
    "x": 576,
    "y": 481,
    "w": 1092,
    "h": 190
  }]
}
----

By default, when you create a page, you'll get a _primary_ page layout.
To add additional layouts, click on the btn:[Add layout] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_layout_new.png",
    "alias": "page_layout_new",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 574,
    "y": 481,
    "w": 1092,
    "h": 237
  },
  "annotations": [{
    "x": 622,
    "y": 644,
    "w": 109,
    "h": 31
  }]
}
----

Click on the configuration button to define when the layout may be visible and what buttons and actions are available.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_new.png",
    "alias": "page_new_config",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 574,
    "y": 481,
    "w": 1092,
    "h": 237
  },
  "annotations": [{
    "x": 1433,
    "y": 553,
    "w": 48,
    "h": 38
  }]
}
----

The <<visibility-condition,condition>> is an expression that determines if the layout can be shown or not.
Visibility conditions are simple expressions that evaluate into a `true` (show) or `false` (hide).

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_layout_config.png",
    "alias": "page_layout_config_expr",
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 400,
    "y": 40,
    "w": 1120,
    "h": 700
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 406,
    "y": 147,
    "w": 1106,
    "h": 63
  }]
}
----

Roles define a list of roles for which this page layout will be visible for.
If a user is not a member of a specific role, the layout is not visible regardless of the expression.

[IMPORTANT]
====
This is not the same as hiding them behind RBAC.
Users will still be able to access these layouts via the API, but the {APP_NAME_COMPOSE} layout manager will not consider them.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_layout_config.png",
    "alias": "page_layout_config_roles",
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 400,
    "y": 40,
    "w": 1120,
    "h": 700
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 406,
    "y": 230,
    "w": 1106,
    "h": 63
  }]
}
----

The record toolbar section defines what buttons (default actions) the specific page layout may use.
Controlling these buttons is useful when we want to define a series of page layouts and just the last one should have the option to submit the form.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_layout_config.png",
    "alias": "page_layout_config_toolbar",
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 400,
    "y": 40,
    "w": 1120,
    "h": 700
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 406,
    "y": 332,
    "w": 1106,
    "h": 190
  }]
}
----

Under actions, you can define additional operations you want to perform through via the specific page layout.

[NOTE]
====
Currently, the only supported action is to navigate to a different layout.
New actions are in the pipelines.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_layout_actions.png",
    "alias": "page_layout_actions_actions",
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 400,
    "y": 40,
    "w": 1120,
    "h": 746
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 406,
    "y": 542,
    "w": 1106,
    "h": 137
  }]
}
----

== Building Page Layouts

The contents of page layouts are defined in the page layout builder.
The builder has the same look and feel as the previous page builder.

In the list of pages, click on the btn:[page builder] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_tree.png",
    "alias": "page_tree",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "x": 1298,
    "y": 197,
    "h": 205,
    "w": 122
  }]
}
----

Alternatively, if you're editing a page, you can navigate to the page builder from there.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/multi-page-views/page_new.png",
    "alias": "page_new_builder",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "focus": {
    "x": 574,
    "y": 481,
    "w": 1092,
    "h": 237
  },
  "annotations": [{
    "x": 1480,
    "y": 553,
    "w": 48,
    "h": 38
  }]
}
----

== Display Evaluation Logic

When a user navigates to a page, the page layout manager needs to determine what page layout should be presented.

.The layout manager uses the following logic to determine what page layout to show:
. Filter out any page layouts which can't te accessed by the user's set of roles,
. filter out any page layouts where the visibility expression returns `false`,
. if the remaining set of layouts is *not empty*, use the first layout,
. if the remaining set of layouts is *empty*, use the first layout with no expression,
. if no page layout matches this flow, the user is redirected to where they came from.

[#visibility-condition]
== Visibility Conditions

Visibility conditions are expressions which determine if a page layout can be shown to the user.
A page layout is showable if the visibility condition returns a truthy value (`true` or any other value JavaScript considers truthy).

Refer to the xref:expr/index.adoc[expressions page] for details on the syntax.

=== Variable Reference

.A list of available variables:
[cols="1s,5a"]
|===
| [#eval-var-user]#<<eval-var-user,user>>#
| The variable contains the current authenticated user object.

| [#eval-var-record]#<<eval-var-record,record>>#
| The variable contains the current record object.
`null` if no record available.

| [#eval-var-screen.width]#<<eval-var-screen.width,screen.width>>#
| The variable defines the current screen width in pixels.

| [#eval-var-screen.height]#<<eval-var-screen.height,screen.height>>#
| The variable defines the current screen height in pixels.

| [#eval-var-screen.userAgent]#<<eval-var-screen.userAgent,screen.userAgent>>#
| The variable defines the current browser user agent.

| [#eval-var-screen.breakpoint]#<<eval-var-screen.breakpoint,screen.breakpoint>>#
| The variable defines the current breakpoint.
The breakpoint is the same as the ones the responsive layouts use.

| [#eval-var-oldLayout]#<<eval-var-oldLayout,oldLayout>>#
| The variable defines the previous layout the user was on.
`null` if this is the first layout.

| [#eval-var-layout]#<<eval-var-layout,layout>>#
| The variable defines the current layout the user is on.

| [#eval-var-isView]#<<eval-var-isView,isView>>#
| The variable defines if the interface is in view mode.

| [#eval-var-isCreate]#<<eval-var-isCreate,isCreate>>#
| The variable defines if the interface is in create mode.

| [#eval-var-isEdit]#<<eval-var-isEdit,isEdit>>#
| The variable defines if the interface is in edit mode.
|===

// == Page Layout Actions

// In addition to customizing the look of your pages, page layout actions enable you to customize the behavior.
// Actions are presented as buttons on the toolbar of the page.

// .A list of available actions:
// [cols="1s,5a"]
// |===
// | [#action-goto]#<<action-goto,user>>#
// | The variable contains the current authenticated user object.

// |===

# src/modules/integrator-guide/pages/compose-configuration/record-modal.adoc

= Opening Records in Modal Windows

Record list, Calendar and Record page blocks have an option to open records in a modal window.
By default, records are opened in a new page.
When set, this option allows users to inspect specific records, while staying on the original page.

== Configuring the Option

To enable the option of opening records in a modal, navigate to the page builder, choose the record list block and go to its record list tab.
Scroll down to the Records section and you will find the option in the "On record click" select dropdown.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/enabling-record-in-modal.png",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 0,
    "y": 0,
    "w": 1920,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 407,
    "y": 460,
    "w": 538,
    "h": 64
  }]
}
----

Select the "Open record in a modal" option.
Now, when you go to the public page that displays the record list and click on any record inside the list, it will open inside a modal.

image:compose-configuration/displaying-record-in-modal.png[Opening Record in a Modal, role="data-zoomable"]

# src/modules/integrator-guide/pages/compose-configuration/record-revisions.adoc

include::ROOT:partial$variables.adoc[]

= Tracking Record Revisions

{PRODUCT_NAME} provides a record revision feature which allows you to configure modules to track changes on records by introducing a new revision counter and providing a history of changes.
{PRODUCT_NAME} keeps a revision counter for each record (starting from 1) that increments every time the record is updated, and only changes in record values are stored for each revision.

Revisions must be enabled for a specific module and can be viewed inside a record revision page block.
When enabled, all record changes are stored in the database with the author and the timestamp.

[NOTE]
====
A revision is only added when a record is updated, so newly created records don't have revisions, which reduces the number of stored revisions.
====

[#configure-module]
== Enabling Revision Tracking

To enable revision tracking for specific records, we need to enable the option on the {APP_NAME_COMPOSE} module.
In addition to module configuration, you'll need to <<configure-record-page,configure the record page>> to display the revision history.

[IMPORTANT]
====
Record revisions are stored in the same connection as the module itself.
====

Firstly, navigate to your {APP_NAME_COMPOSE} namespace and enter the admin area (you can also enable record revision for brand new modules).

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/ns-home.png",
    "alias": "compose-configuration-record-revisions-ns-home",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 17,
    "y": 135,
    "w": 318,
    "h": 35
  }]
}
----

In the list of modules, click on the one you wish to enable record revisions for.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-modules.png",
    "alias": "compose-configuration-record-revisions-admin-modules",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 525,
    "y": 222,
    "h": 65,
    "w": 1220
  }]
}
----

Click on the record revisions tab and check the *enable record revisions checkbox*.
Optionally input the identifier option.

[NOTE]
====
The identifier option allows you to specify the database table or collection which {PRODUCT_NAME} should use to log the revisions.
A system-defined location is used that should satisfy most use cases.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-module-edit-revisions-enable.png",
    "alias": "compose-configuration-record-revisions-admin-module-edit-revisions-enable",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 547,
    "y": 255,
    "w": 213,
    "h": 19
  }]
}
----

Once finished, click the btn:[save] button to save the changes and enable record revision tracking.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-module-edit-revisions-enable.png",
    "alias": "compose-configuration-record-revisions-admin-module-edit-revisions-enable-save",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 1821,
    "y": 1015,
    "w": 81,
    "h": 47
  }]
}
----

[#configure-record-page]
== Displaying the Revision History

To display the revision history, we need to add a xref:compose-configuration/page-blocks.adoc#page-block-record-revisions[*record revision* page block] to the record page.
You can skip this step if you only want to track the revision history and not display it.

[IMPORTANT]
====
Since they are tightly correlated, the record revision page block can only appear on the record page.
====

Navigate to the record page directly from the module itself or from the list of pages (the screenshot below shows how to access the record page from the module edit screen).

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-module-edit-open-record-page.png",
    "alias": "compose-configuration-record-revisions-admin-module-edit-open-record-page",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 1563,
    "y": 175,
    "w": 133,
    "h": 18
  }]
}
----

Next, click on the btn:[+ add block] button in the toolbar to open up the page block selection modal window.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-record-page-base.png",
    "alias": "compose-configuration-record-revisions-admin-record-page-base",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 1028,
    "y": 1013,
    "w": 144,
    "h": 48
  }]
}
----

Find and click on the record revisions page block in the page selection modal.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-record-page-add-block-select.png",
    "alias": "compose-configuration-record-revisions-admin-record-page-add-block-select",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 530,
    "y": 41,
    "w": 860,
    "h": 895
  },
  "annotations": [{
    "kind": "box",
    "x": 554,
    "y": 680,
    "h": 50,
    "w": 250
  }]
}
----

In the page block configuration modal window, click on the record revisions tab and make sure the configuration matches your needs.
The configuration allows you to select a subset of module fields to show on the record revisions page block.

Once satisfied, click on the btn:[save] button to configure the page block and add it to the record page.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-record-page-add-block-configure.png",
    "alias": "compose-configuration-record-revisions-admin-record-page-add-block-configure",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 344,
    "y": 42,
    "w": 1232,
    "h": 584
  },
  "annotations": [{
    "kind": "box",
    "x": 1454,
    "y": 583,
    "w": 115,
    "h": 36
  }]
}
----

Place the newly added record revisions page block to fit your page.

When the revision tracking is enabled, {PRODUCT_NAME} also provides a new *record revision* module field, which indicates the revision number.
You can add the module field on both the *record* and *record list* page blocks.

Once satisfied with your changes, click on the btn:[save] button to save your changes.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/admin-record-page-add-block-place.png",
    "alias": "compose-configuration-record-revisions-admin-record-page-add-block-place",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "y": 68,
    "x": 1394,
    "w": 518,
    "h": 882
  }, {
    "kind": "box",
    "x": 1820,
    "y": 1015,
    "w": 82,
    "h": 48
  }]
}
----

== Viewing the Revision History

[NOTE]
====
To view the revision history, you'll firstly need to <<configure-module,configure the module>> and <<configure-record-page,add the record revisions page block>> to the record page.
====

To view record revisions, click on the record you wish to see the revision history for.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/ns-home-with-revisions.png",
    "alias": "compose-configuration-record-revisions-ns-home-with-revisions",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "kind": "box",
    "x": 370,
    "y": 464,
    "w": 1533,
    "h": 51
  }]
}
----

You can view the entire revision history in the record revisions page block.
Each revision entry logs the timestamp, the performed operation, and the user that performed the operation.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/view-record-revision-overview.png",
    "alias": "compose-configuration-record-revisions-view-record-revision-overview",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 1410,
    "y": 89,
    "w": 482,
    "h": 886
  },
  "annotations": []
}
----

To view the revision details, click on the btn:[change(s)] button at the far right of the revision you wish to inspect.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/view-record-revision-overview.png",
    "alias": "compose-configuration-record-revisions-view-record-revision-overview-expand-details",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "padding": "xs",
    "x": 1410,
    "y": 89,
    "w": 482,
    "h": 886
  },
  "annotations": [{
    "kind": "box",
    "x": 1784,
    "y": 149,
    "w": 88,
    "h": 41
  }]
}
----

The detailed view will list the logged value changes for that revision.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/record-revisions/view-record-revision-details.png",
    "alias": "compose-configuration-record-revisions-view-record-revision-details",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "padding": "xs",
    "x": 1410,
    "y": 89,
    "w": 482,
    "h": 886
  },
  "annotations": [{
    "kind": "box",
    "x": 1468,
    "y": 220,
    "w": 420,
    "h": 255
  }]
}
----


# src/modules/integrator-guide/pages/compose-configuration/record-storage.adoc

include::ROOT:partial$variables.adoc[]

= Customizing Record Storage

The redefined {PRODUCT_NAME} record storage now enables you to *customize the way records are stored* under the hood.
Customizing record storage enables you to *easily integrate external data* as if it was created through {PRODUCT_NAME}, *offload* datasets to *dedicated databases*, or larger datasets to *specialized data* centres*.

[NOTE]
====
To store records into a different connection, you'll xref:dal-connections/index.adoc[need to create it first].
====

By default, *{PRODUCT_NAME} stores* all records (along with their values) into a *single table*, which should suffice for *most basic use-cases*.
If your use case doesn't require storing records in dedicated storage, feel free to skip this section.

[IMPORTANT]
====
The schema changes, suggested by {PRODUCT_NAME}, may not be the most optimal and may change through future releases.
Prefer to make necessary database alterations manually if you prefer to have full control over what happens.
====

When you customize the record storage, in cases where the used database can not store records for this module (to exemplify; the table or column does not exist), {PRODUCT_NAME} suggests a set of changes you can make to properly store the data.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/schema-alterations-base.png",
    "alias": "compose-configuration-dal-module-schema-alterations-base",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 340,
    "y": 0,
    "h": 490,
    "w": 1230
  },
  "focus": {
    "x": 400,
    "y": 40,
    "h": 400,
    "w": 1120
  },
  "annotations": []
}
----

You can either resolve these alterations directly via {PRODUCT_NAME} using the suggested change by clicking on the btn:[Resolve] or btn:[Automatically Resolve] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/schema-alterations-base.png",
    "alias": "compose-configuration-dal-module-schema-alterations-apply",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 340,
    "y": 0,
    "h": 490,
    "w": 1230
  },
  "focus": {
    "x": 400,
    "y": 40,
    "h": 400,
    "w": 1120
  },
  "annotations": [{
    "x": 1375,
    "y": 147,
    "h": 27,
    "w": 65
  }, {
    "x": 1353,
    "y": 405,
    "h": 30,
    "w": 160
  }]
}
----

Alternatively, you can do the changes directly in the database and dismiss the alteration by clicking on the btn:[Dismiss] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/schema-alterations-base.png",
    "alias": "compose-configuration-dal-module-schema-alterations-dismiss",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 340,
    "y": 0,
    "h": 490,
    "w": 1230
  },
  "focus": {
    "x": 400,
    "y": 40,
    "h": 400,
    "w": 1120
  },
  "annotations": [{
    "x": 1447,
    "y": 147,
    "h": 27,
    "w": 65
  }]
}
----

== Configuration

The record storage configuration options are available in the *module edit page* under the btn:[data store] tab.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-base",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 790
  },
  "annotations": [{
    "x": 617,
    "y": 187,
    "w": 120,
    "h": 44
  }]
}
----

=== Connection

Basic connection parameters define *what connection* {PRODUCT_NAME} should use when storing the module's records and *where in the connection* the data should be stored -- such as what table or collection.

[CAUTION]
====
Changing the connection will reset the sensitivity level configuration on the module and fields if the sensitivity level is incompatible with the new connection.
// @todo add notes on module-level privacy
// Refer to xref:compose-configuration/privacy.adoc[privacy settings] to learn more about sensitivity levels.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-connection",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 790
  },
  "focus": {
    "padding": "xs",
    "x": 537,
    "y": 249,
    "w": 1200,
    "h": 240
  },
  "annotations": []
}
----

[cols="1s,5a"]
|===
| [#config-connection-connection]#<<config-connection-connection,Database connection>>#
|
The *database connection* specifies what connection {PRODUCT_NAME} should use when handling the module's records.
By default, {PRODUCT_NAME} uses the primary connection.

| [#config-connection-ident]#<<config-connection-ident,Collection or database table name>>#
|
The *collection or database table name* specifies where the module's records are stored inside the connection.

[IMPORTANT]
====
If the identifier is omitted, the connection-defined identifier is used.
If the connection doesn't provide a default, the system default `compose_recrd` is used.
====

For some scenarios, {PRODUCT_NAME} can create the appropriate structures if they don't already exist in the connection (such as a new table in an RDBMS database).

[NOTE]
====
*DevNote* expand notes when tables can are automatically created.
====

include::partial$dal-model-ident-placeholders.adoc[]
|===

=== Module Field Mapping

The module field mapping and encoding parameters specify which module fields should be stored and how they should be stored.
Refer to the <<encoding-codec,field encoding codecs>> section for details on the available value encoding codecs.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 300,
    "w": 1568,
    "h": 580
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": []
}
----

[cols="1s,5a"]
|===
| [#config-module-fields-map]#<<config-module-fields-map,Map module field>>#
|
The *map module field checkbox* allows you to choose whether {PRODUCT_NAME} should store the module field's values or not.
If the checkbox is unchecked, {PRODUCT_NAME} will drop the values.

Generally, you'll want to store all of the module fields.
If a field is no longer needed, you should remove it from the module definition.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields-use",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 487,
    "y": 450,
    "w": 1300,
    "h": 310
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": [{
    "x": 567,
    "y": 542,
    "w": 77,
    "h": 19
  }]
}
----

| [#config-module-fields-codec]#<<config-module-fields-codec,Codec>>#
|
The *encoding codec* defines what coded {PRODUCT_NAME} should use when dealing with the field's values.
Refer to the <<encoding-codec,field encoding codecs>> section for details.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields-codec",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 487,
    "y": 450,
    "w": 1300,
    "h": 310
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": [{
    "x": 859,
    "y": 534,
    "w": 261,
    "h": 33
  }]
}
----

| [#config-module-fields-codec-conf]#<<config-module-fields-codec-conf,Codec configuration>>#
|
The *codec configuration* provides the required configuration parameters to the selected encoding codec.
Refer to the <<encoding-codec,field encoding codecs>> section for details.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields-ident",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 487,
    "y": 450,
    "w": 1300,
    "h": 310
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": [{
    "x": 1152,
    "y": 534,
    "w": 552,
    "h": 33
  }]
}
----

|===

=== System Fields

The *system module field mapping* and encoding parameters allow you to specify which module fields should be stored and how they should be stored.
Refer to the <<encoding-codec,field encoding codecs>> section for details on the available value encoding codecs.

[TIP]
====
System fields, for the most part, provide metadata about the record.
If needed, you can omit specific system fields from being stored.
Omitting system fields can come in handy when connecting to existing databases whose structure doesn't define all supported system fields.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-system.png",
    "alias": "compose-configuration-dal-module-config-system",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 270,
    "w": 1568,
    "h": 850
  },
  "focus": {
    "padding": "xs",
    "x": 537,
    "y": 350,
    "w": 1200,
    "h": 590
  },
  "annotations": []
}
----

[cols="1s,5a"]
|===
| [#config-module-fields-map]#<<config-module-fields-map,Map module field>>#
|
The *map module field checkbox* allows you to choose whether {PRODUCT_NAME} should store the module field's values or not.
If the checkbox is unchecked, {PRODUCT_NAME} will drop the values.

Generally, you'll want to store all of the system module fields, but you can omit the ones your custom schema does not support.

[CAUTION]
====
Omitting system fields like the `id` and the timestamps may lead to unexpected behaviour.
We suggest you keep all of the system fields.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields-use",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 487,
    "y": 450,
    "w": 1300,
    "h": 310
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": [{
    "x": 567,
    "y": 542,
    "w": 77,
    "h": 19
  }]
}
----

| [#config-module-fields-codec]#<<config-module-fields-codec,Codec>>#
|
The *encoding codec* defines what coded {PRODUCT_NAME} should use when dealing with the field's values.
Refer to the <<encoding-codec,field encoding codecs>> section for details.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields-codec",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 487,
    "y": 450,
    "w": 1300,
    "h": 310
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": [{
    "x": 859,
    "y": 534,
    "w": 261,
    "h": 33
  }]
}
----

| [#config-module-fields-codec-conf]#<<config-module-fields-codec-conf,Codec configuration>>#
|
The *codec configuration* provides the required configuration parameters to the selected encoding codec.
Refer to the <<encoding-codec,field encoding codecs>> section for details.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/config-base.png",
    "alias": "compose-configuration-dal-module-config-fields-ident",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 487,
    "y": 450,
    "w": 1300,
    "h": 310
  },
  "focus": {
    "x": 537,
    "y": 500,
    "w": 1200,
    "h": 210
  },
  "annotations": [{
    "x": 1152,
    "y": 534,
    "w": 552,
    "h": 33
  }]
}
----

|===

[#encoding-codec]
== Field Encoding Codecs

The field encoding codec defines how the record value for the corresponding field should be stored and retrieved later.
The available encoding codecs are listed in the table below with an explanation, configuration, and use cases.

[cols="1s,5a"]
|===
| [#field-codec-json]#<<field-codec-json,JSON>>#
|
The JSON field codec encodes the record value into a JSON object.
The location of the JSON object (relative to the connection's storage, such as the table column) is defined by the identifier provided alongside the encoding codec definition.

[NOTE]
====
This encoding strategy is used by default for *user-defined module fields*.
====

The encoding codec is useful when you wish to retrieve values from JSON objects.

[IMPORTANT]
====
.Currently, {PRODUCT_NAME} only supports the following JSON structure (future versions plan to expand the flexibility):
[source,json]
----
{
  "identifier": [<1>
    ...<2>
  ]
}
----
<1> The value identifier should match the module field's name.
<2> One or more values are stored for the record.
Values are provided as an array to allow the field to go from a single to a multi-value field.
====

| [#field-codec-alias]#<<field-codec-alias,Alias>>#
|
The alias field codec encodes the record value as a stand-alone value under a custom identifier.
The location (relative to the connection's storage, such as the table column) is defined by the identifier provided alongside the encoding codec definition.

The encoding codec is useful when you retrieve values from a dedicated location that can have a different identifier to the module field, such as a table column or collection attribute.

| [#field-codec-column]#<<field-codec-column,Column>>#
|
The column field codec encodes the record value as a stand-alone value using the same identifier as the module field.
The location (relative to the connection's storage, such as the table column) is defined by the module field's name.

[NOTE]
====
This encoding strategy is used for *system-defined module fields*.
====

The encoding codec is useful when you wish to retrieve values from a dedicated location with the same identifier as the module field, such as a table column or collection attribute.

|===

== Troubleshooting

== Module Issues

In case the module is miss configured or the underlying connection reports any errors, a list of identified issues is presented in the module edit screen.
If there are any issues, a new btn:[issues] tab is displayed.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "compose-configuration/dal-module/troubleshooting-issues.png",
    "alias": "compose-configuration-dal-module-troubleshooting-issues",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "annotations": [{
    "x": 1189,
    "y": 186,
    "w": 110,
    "h": 43
  }]
}
----





# src/modules/integrator-guide/pages/compose-configuration/samples/page-blocks/index.adoc

= Page blocks

include::record-lists.adoc[]

include::metrics.adoc[]


# src/modules/integrator-guide/pages/compose-configuration/samples/page-blocks/metrics.adoc

== Metric page block samples

Divide the result by 1000 to show cost in thousands::
  `v / 1000`

Round result to remove decimal places::
  `Math.round(v)`

Round result to remove decimal places (round up)::
  `Math.ceil(v)`

Round result to remove decimal places (round down)::
  `Math.floor(v)`

Round result to two decimal places::
  `Math.round(v * 100) / 100`

[IMPORTANT]
====
Expressions use *standard JavaScript syntax*, so you can use any standard JavaScript expression.
====

[TIP]
====
You can specify rounding with the value formatting.
====


# src/modules/integrator-guide/pages/compose-configuration/samples/page-blocks/record-lists.adoc

== Record list samples

[#record-list-sample-filtering]
=== Filtering

[TIP]
====
Record list pre-filtering supports *value interpolation* that is *relative to the content*; such as a record.

.Available variables:
* **record**: current record (when available)
* **recordID**: current record's recordID (when available)
* **ownerID**: current record's owner (when available)
* **userID**: current user's userID
====

Show only records created this year::
    `YEAR(created_at) = YEAR()`.

Show only records linked to the viewed record::
    `related_contact = $\{recordID\}`.

Show only active contacts::
    `is_active = '1'`.

Show lost opportunities::
    `status = 'closed/lost'`.

[#record-list-sample-sorting]
=== Sorting

Sort by latest::
    `created_at DESC`.

Sort by latest and opportunity stage::
    `created_at DESC, stage DESC`.


# src/modules/integrator-guide/pages/corteza-studio/index.adoc

include::ROOT:partial$variables.adoc[]

= {PRODUCT_NAME} Studio
:description: {PRODUCT_NAME} Studio allows users to customize {PRODUCT_NAME} web applications styling according to their preferences.

{PRODUCT_NAME} Studio allows users to customize {PRODUCT_NAME} web applications styling according to their preferences. 

[IMPORTANT]
====
For {PRODUCT_NAME} Studio, to function properly, you need to xref:devops-guide:installing-sass/index.adoc[Install dart-sass binaries] in your system and 
`HTTP_WEBAPP_ENABLED` enviroment variable set to `true`.
====

== Customizing {PRODUCT_NAME} Web Applications

There are two ways of customizing your {PRODUCT_NAME} web applications style:

=== Branding

In the admin area, navigate to the menu:User Interface[Settings] branding section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "corteza-studio/branding-section.png",
    "alias": "corteza-studio-branding-section",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 535,
    "y": 200,
    "w": 1180,
    "h": 750
  },
  "annotations": []
}
----

A screen showing you all of the available {PRODUCT_NAME}-specific branding color configuration options.

.From there you can:
* Click on the *variable's* rounded color input, which will pop up a modal window with a color picker.
* Pick a color then click the btn:[Save and close ] button to save your input variable color changes.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "corteza-studio/choose-color.png",
    "alias": "corteza-studio-choose-color",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 450,
    "y": 200,
    "w": 1180,
    "h": 780
  },
  "annotations": []
}
----

After making your branding color changes, click the btn:[Submit] button. This action will save your input changes and automatically refresh your admin web application with the updated branding color.

=== Custom CSS Editor

In the admin area, navigate to the menu:User Interface[Settings] Custom CSS section.

[NOTE]
====
Custom CSS editor supports both SASS and CSS syntax enabling you to customize your {PRODUCT_NAME} web application(s) styling using your preferred stylesheet language.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "corteza-studio/custom-css.png",
    "alias": "corteza-studio-custom-css-editor",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 535,
    "y": 110,
    "w": 1180,
    "h": 480
  },
  "annotations": []
}
----

In this section, you can add your stylesheet code that specifically targets your web application(s).
Afterward, simply click the btn:[Submit] button to save your input changes.
This action will save your input changes and automatically refresh your web application with the updated styling.

[CAUTION]
====
Please note that the Custom CSS editor stylesheet code takes precedence over the configuration of branding section variables.
====


# src/modules/integrator-guide/pages/create-application.adoc

include::ROOT:partial$variables.adoc[]

= Application Management

An application on the {PRODUCT_NAME} low-code platform is a link to a resource's home page. 
Each application has a corresponding thumbnail for each resource as shown in the screenshot below.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/c-applications.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

== Creating an Application

To create a new application, access your {PRODUCT_NAME} instance and click the btn:[Admin Area] application.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/c-application.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 967,
    "y": 356,
    "w": 204,
    "h": 166
  }]
}
----

Locate and click on the menu:System[Applications] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/application-button.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 13,
    "y": 179,
    "w": 161,
    "h": 24
  }]
}
----

Locate and click on the btn:[new] button. 

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/new-application.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1369,
    "y": 64,
    "w": 50,
    "h": 24
  }]
}
----

Complete the form with the application's name and click the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/create-application.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1451,
    "y": 216,
    "w": 64,
    "h": 25
  }]
}
----

== Editing an Application

[NOTE]
====
After creating a new application, you are automatically redirected to the edit application page.
====

To make changes to the details of an application, access your {PRODUCT_NAME} instance and click the btn:[Admin Area] application.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/c-application.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 967,
    "y": 356,
    "w": 204,
    "h": 166
  }]
}
----

Locate and click on the menu:System[Applications] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/application-button.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 13,
    "y": 179,
    "w": 161,
    "h": 24
  }]
}
----

Locate and click on the btn:[Edit] icon. 

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/new-edit-application.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1487,
    "y": 189,
    "w": 40,
    "h": 24
  }]
}
----

Make the necessary changes to the form; for instance, you could modify the name or replace the application's thumbnail.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/edit-application.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

After completing the form with the application's details, click the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/edit-applications.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1452,
    "y": 973,
    "w": 63,
    "h": 23
  }]
}
----

== Enabling Visibility of the Application 

To enable visiblity of an application, locate and click on the btn:[Listed] checkbox on the edit application page.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/application-checkbox.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 798,
    "y": 658,
    "w": 66,
    "h": 21
  }]
}
----

This step makes the application visible in your {PRODUCT_NAME} instance's list of available applications, as shown in the screenshot below.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "application/c-applications.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----


# src/modules/integrator-guide/pages/dal-connections/connection-management.adoc

include::ROOT:partial$variables.adoc[]

= Connection Management

The connection management user interface resides in the {PRODUCT_NAME} {APP_NAME_ADMIN} web application, under the menu:system[connections] section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/management/interface.png",
    "alias": "dal-connections-management-interface",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 16,
    "y": 577,
    "h": 37,
    "w": 288
  }]
}
----

== Listing Connections

.To list current connections:
. navigate to menu:system[connections],
. optionally include deleted connections,
. the list refreshes automatically.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/management/interface.png",
    "alias": "dal-connections-management-interface-filtering",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 534,
    "y": 450,
    "w": 1204,
    "h": 586
  },
  "annotations": []
}
----

[IMPORTANT]
====
The list includes only external connections; the primary connection is available at the top of the list.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/management/interface.png",
    "alias": "dal-connections-management-interface-primary",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 106,
    "w": 1202,
    "h": 300
  },
  "annotations": []
}
----
====

== Creating Connections

.To create a new connection:
. navigate to menu:system[connections],
. click on the btn:[add connection] button and fill out the form.

[NOTE]
====
refer to the xref:dal-connections/index.adoc#configuration[connection configuration] section for details on the form.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/management/interface.png",
    "alias": "dal-connections-management-interface-create",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 534,
    "y": 450,
    "w": 1204,
    "h": 586
  },
  "annotations": [{
    "x": 548,
    "y": 515,
    "h": 34,
    "w": 160
  }]
}
----

== Editing Connections

.To update an existing connection:
. navigate to menu:system[connections],
. click on the btn:[edit] button and update the connection.

[NOTE]
====
refer to the xref:dal-connections/index.adoc#configuration[connection configuration] section for details on the form.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/management/interface.png",
    "alias": "dal-connections-management-interface-edit",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 534,
    "y": 450,
    "w": 1204,
    "h": 586
  },
  "annotations": [{
    "x": 1689,
    "y": 658,
    "h": 56,
    "w": 55
  }]
}
----

== Deleting Connections

.To update an existing connection:
. navigate to menu:system[connections],
. click on the btn:[edit] button,
. click and confirm the btn:[delete] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/management/delete.png",
    "alias": "dal-connections-management-delete",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 436,
    "y": 280,
    "w": 1400,
    "h": 801
  },
  "focus": {
    "x": 512,
    "y": 1015,
    "w": 1248,
    "h": 58
  },
  "annotations": [{
    "x": 527,
    "y": 1023,
    "w": 85,
    "h": 36
  }]
}
----


# src/modules/integrator-guide/pages/dal-connections/index.adoc

include::ROOT:partial$variables.adoc[]

= DAL Connections

DAL connections (also referred to as *connections*) define a location where {PRODUCT_NAME} can store and retrieve the data.
A connection outlines the physical location of the data storage, describes its properties (such as encoding and recovery) and provides connection parameters.

[NOTE]
====
.Currently, only connections to the following RDBMS databases are supported:
* MySQL,
* PostgreSQL,
* SQLite.
====

You can define as many connections as you need to help your business conform to data privacy regulations, offload specific datasets to specialized databases, and easily integrate external data.

[TIP]
====
You can connect to databases with already existing data, removing the need to migrate it over to {PRODUCT_NAME}.
====

The connection management interface is available in the {PRODUCT_NAME} {APP_NAME_ADMIN} under the menu:system[connections] section

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/list.png",
    "alias": "dal-connections-list",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 16,
    "y": 577,
    "h": 37,
    "w": 288
  }]
}
----

== Connection Types

[cols="1s,5a"]
|===
| [#connection-type-primary]#<<connection-type-primary,Primary connection>>#
|
The primary connection is the default connection the {PRODUCT_NAME} uses to store records and is the same as the `DB_DSN` defined in your `.env` file.
The primary connection is defined when provisioning a fresh {PRODUCT_NAME} instance or upgrading from an older release.

[IMPORTANT]
====
Primary connections only partially support modification and block any change which would change its identification or underlying storage connection.
====

| [#connection-type-external]#<<connection-type-external,External connection>>#
|
The administrator adds external connections that can be used as an alternative to the primary connection.

[CAUTION]
====
Modifying connection parameters may lead to data loss issues when {PRODUCT_NAME} can no longer connect to the original storage location.
====

// | [#connection-type-federation-node]#<<connection-type-federation-node,Federation node>>#
// |
|===

[#configuration]
== Connection Configuration

=== Basic Settings

Basic settings provide the general outline of the connection, such as its identification, physical location, ownership, and data sensitivity levels.
Data sensitivity levels are discussed in the data privacy sections.

[NOTE]
====
*DevNote* link to the data privacy section
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-basic.png",
    "alias": "dal-connections-config-basic",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 106,
    "w": 1200,
    "h": 409
  },
  "annotations": []
}
----

[cols="1s,5a"]
|===
| [#connection-config-basic-name]#<<connection-config-basic-name,Name>>#
|
The name specifies a user-friendly label for this connection.
The name is used when displaying connections on the user interfaces, such as the map on the privacy console.

| [#connection-config-basic-handle]#<<connection-config-basic-handle,Handle>>#
|
The handle specifies a user-friendly identifier used by the system.
The handle, in some cases, can be used instead of the ID to identify the connection uniquely.

The handle implies the same constraints as any other handle.

include::partial$handle-constraints.adoc[]

| [#connection-config-basic-location-name]#<<connection-config-basic-location-name,Location name>>#
|
The location name specifies the physical location of where the data is located.
The location name can be the name of the data centre, the region, or the continent.

| [#connection-config-basic-location-coordinates]#<<connection-config-basic-location-coordinates,Location coordinates>>#
|
The location coordinates provide the exact location of where the data is located.
The connection is plotted on the map in the data privacy console when the coordinates are provided.

| [#connection-config-basic-ownership]#<<connection-config-basic-ownership,Ownership>>#
|
The ownership specifies who owns the data or the data centre where the data is stored.
The ownership can come in handy if you're offloading your database management needs to external service providers.

| [#connection-config-basic-max-sensitivity-level]#<<connection-config-basic-max-sensitivity-level,Highest allowed sensitivity level>>#
|
The highest allowed sensitivity level specifies the upper limit of what can be stored in the given connection regarding data privacy.
Any modules and fields utilizing the connection can not exceed the upper limit.

You can define multiple connections with multiple sensitivity levels to better conform to data privacy regulations worldwide.

|===

=== Connection Properties

Connection properties provide additional information regarding the database or data centre.
The connection properties primarily focus on data encryption and restoration.

[CAUTION]
====
Connection properties outline the underlying storage we're connecting to.
These properties *do not* configure {PRODUCT_NAME} to perform anything outlined by the properties.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-properties.png",
    "alias": "dal-connections-config-properties",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 190,
    "w": 1200,
    "h": 733
  },
  "annotations": []
}
----

[cols="1s,5a"]
|===
| [#connection-config-properties-encrypt-rest]#<<connection-config-basic-encrypt-rest,Encrypt data at rest enabled>>#
|
Data at rest encryption indicates the data is encrypted when stored in the data centre.
Data encryption at rest helps mitigate damages in case of a breach.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-properties.png",
    "alias": "dal-connections-config-properties-connection-config-properties-encrypt-rest",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 440,
    "y": 92,
    "h": 925,
    "w": 1397
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 190,
    "w": 1200,
    "h": 733
  },
  "annotations": [{
    "x": 548,
    "y": 247,
    "h": 145,
    "w": 1177
  }]
}
----

| [#connection-config-properties-protected-rest]#<<connection-config-basic-protected-rest,Data at rest protection provided>>#
|
Data at rest protection indicates that the data is physically protected from unauthorised access when stored in the data centre.
Data protection helps reduce the chance of a data breach.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-properties.png",
    "alias": "dal-connections-config-properties-connection-config-properties-protected-rest",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 440,
    "y": 92,
    "h": 925,
    "w": 1397
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 190,
    "w": 1200,
    "h": 733
  },
  "annotations": [{
    "x": 548,
    "y": 413,
    "h": 145,
    "w": 1177
  }]
}
----

| [#connection-config-properties-encrypt-transit]#<<connection-config-basic-encrypt-transit,Encrypt data at transit enabled>>#
|
Data at transit encryption indicates the data when transported between systems, is encrypted.
Data encryption at transit helps mitigate the risks of wiretapping attacks.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-properties.png",
    "alias": "dal-connections-config-properties-connection-config-properties-encrypt-transit",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 440,
    "y": 92,
    "h": 925,
    "w": 1397
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 190,
    "w": 1200,
    "h": 733
  },
  "annotations": [{
    "x": 548,
    "y": 579,
    "h": 145,
    "w": 1177
  }]
}
----

| [#connection-config-properties-data-backup-rest]#<<connection-config-basic-data-backup-rest,Data at rest backup and restoration implemented>>#
|
Data at rest backup and restoration indicates the data is backed up and can be restored in case of system failures and disasters.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-properties.png",
    "alias": "dal-connections-config-properties-connection-config-properties-data-backup-restore",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 440,
    "y": 92,
    "h": 925,
    "w": 1397
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 190,
    "w": 1200,
    "h": 733
  },
  "annotations": [{
    "x": 548,
    "y": 747,
    "h": 145,
    "w": 1177
  }]
}
----

|===

=== Connection Parameters

Connection parameters provide the parameters needed for {PRODUCT_NAME}'s DAL to connect to the underlying storage.

Connection parameters define how {PRODUCT_NAME} should interact with the underlying storage.
Connection parameters also define some default values in regard to the internals of the storage driver, such as default table or collection identifier.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/config-connection.png",
    "alias": "dal-connections-config-connection",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "padding": "xs",
    "x": 535,
    "y": 480,
    "w": 1200,
    "h": 523
  },
  "annotations": []
}
----

[cols="1s,5a"]
|===
| [#connection-config-conn-default-container]#<<connection-config-conn-default-container,Default table or container name>>#
|
The default table or container name specifies where {PRODUCT_NAME} should store the records inside of the connection.
In the context of RDBMS, the identifier would specify what table {PRODUCT_NAME} should use.

The identifier input supports value placeholders which help reduce the required configuration for larger instances.

include::partial$dal-model-ident-placeholders.adoc[]

To exemplify; the following identifier `compose_records_{\{namespace}}_{\{module}}` could produce the identifier of `compose_records_crm_lead`.

| [#connection-config-conn-type]#<<connection-config-conn-type,Connection and parameter type>>#
|
The connection and parameter type specify how we'll provide the connection parameters and, consequentially, the underlying storage driver type.
Refer to the <<drivers,connection parameter types>> section for a complete overview of available options and their input formatting.

| [#connection-config-conn-parameters]#<<connection-config-conn-parameters,Connection parameters>>#
|
The connection parameters specify the connection parameters used by {PRODUCT_NAME} and depend on the option selected in <<connection-config-conn-type,connection parameter type>>.
Refer to the <<drivers,Connection Types>> sub-section for details.

|===

[#drivers]
== Connection Parameter Types

[cols="1s,5a"]
|===
| [#connection-driver-dsn]#<<connection-driver-dsn,`corteza::dal:connection:dsn`>>#
|
The `corteza::dal:connection:dsn` connection type specifies we'll use a DSN string to connect to the database.

. You must provide the configuration parameters in the following format:
[source,json]
----
{
  "dsn": ""
}
----

.Currently, {PRODUCT_NAME} supports the following databases:
* MySQL
* PostgreSQL
* SQLite

|===


# src/modules/integrator-guide/pages/dal-connections/troubleshooting.adoc

include::ROOT:partial$variables.adoc[]

= Troubleshooting

== Connection Issues

In case the connection is miss configured or generally unable to connect to the storage location, a list of identified issues is presented in the connection configuration screen.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "dal-connections/troubleshooting-connection-issues.png",
    "alias": "dal-connections-troubleshooting-connection-issues",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 352,
    "y": 0,
    "w": 1568,
    "h": 1080
  },
  "focus": {
    "x": 535,
    "y": 379,
    "w": 1200,
    "h": 629
  },
  "annotations": [{
    "x": 565,
    "y": 436,
    "w": 1144,
    "h": 82
  }]
}
----



# src/modules/integrator-guide/pages/data-privacy/sensitivity-levels.adoc

include::ROOT:partial$variables.adoc[]

= Sensitivity Levels
:keywords: data privacy, sensitive data, data sensitivity
:description: Learn how to introduce data privacy policies to your {PRODUCT_NAME} {APP_NAME_COMPOSE} application
// @note the initial version of this feature was written by https://github.com/Njukierick

*Sensitivity levels* provide a way to classify what connections, modules, and fields store sensitive information.

[IMPORTANT]
====
Currently, the user interface permits up to 10 sensitivity levels.
====

.Sensitivity levels can be defined in three locations:
[cols="1s,5a"]
|===
| [#sensitivity-level-connection]#<<sensitivity-level-connection,DAL Connection>>#
|
The sensitivity level on a *DAL connection* specifies the highest sensitivity level of a record stored in the given connection.
The connection sensitivity level also dictates the highest sensitivity level defined on underlying *modules* and *module fields*.

To exemplify, you can make {PRODUCT_NAME} save all medical records to a dedicated encrypted database.

By default, if no sensitivity level is specified, the data is considered non-sensitive.

| [#sensitivity-level-module]#<<sensitivity-level-module,{APP_NAME_COMPOSE} Module>>#
|
The sensitivity level on a *{APP_NAME_COMPOSE} Module* specifies the sensitivity level of records stored in the given module.
The module sensitivity level also dictates the highest sensitivity level defined on underlying *module fields*.

By default, if no sensitivity level is specified, the data is considered non-sensitive.

| [#sensitivity-level-module-field]#<<sensitivity-level-module-field,{APP_NAME_COMPOSE} Module Field>>#
|
The sensitivity level on a *{APP_NAME_COMPOSE} module field* specifies the sensitivity level of a record value stored in the given module.

[NOTE]
====
Specific record values can be defined as less sensitive to the {APP_NAME_COMPOSE} module.
====

By default, if no sensitivity level is specified, the data is considered non-sensitive.

|===

== Configuring Sensitivity Levels

To configure sensitivity levels, open the {PRODUCT_NAME} {APP_NAME_ADMIN} web application and navigate to menu:system[sensitivity levels].
You can create new and manage existing sensitivity levels from the list of sensitivity levels.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/sensitivity-level-ui.png",
    "alias": "data-privacy-sensitivity-levels-sensitivity-level-ui-loc",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "x": 24,
    "y": 574,
    "w": 270,
    "h": 16
  }]
}
----

To create a new sensitivity level, click on the btn:[new] button in the top right corner of the list

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/sensitivity-level-ui.png",
    "alias": "data-privacy-sensitivity-levels-sensitivity-level-ui",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 330,
    "y": 10,
    "w": 1580,
    "h": 1070
  },
  "annotations": [{
    "x": 1605,
    "y": 80,
    "w": 62,
    "h": 30
  }]
}
----

Fill out the form and click on the btn:[submit] button.

[CAUTION]
====
The level parameter determines the order regarding which one is more sensitive.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/sensitivity-level-create.png",
    "alias": "data-privacy-sensitivity-levels-sensitivity-level-create",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 330,
    "y": 10,
    "w": 1580,
    "h": 1070
  },
  "annotations": []
}
----

== Configuring DAL Connections

To configure DAL connections with sensitivity levels, open the {PRODUCT_NAME} {APP_NAME_ADMIN} web application and navigate to menu:system[connections].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/dal-connections-ui.png",
    "alias": "data-privacy-sensitivity-levels-dal-connections-ui-loc",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "x": 24,
    "y": 536,
    "w": 270,
    "h": 16
  }]
}
----

From the list of DAL connections, click on the edit icon next to the one you wish to update.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/dal-connections-ui.png",
    "alias": "data-privacy-sensitivity-levels-dal-connections-ui",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 330,
    "y": 10,
    "w": 1580,
    "h": 1070
  },
  "annotations": [{
    "x": 1631,
    "y": 113,
    "w": 17,
    "h": 17
  }]
}
----

Locate the "highest sensitivity level" parameter and set it to the desired sensitivity level.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/dal-connections-edit.png",
    "alias": "data-privacy-sensitivity-levels-dal-connections-edit",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 330,
    "y": 10,
    "w": 1580,
    "h": 1070
  },
  "annotations": [{
    "x": 1135,
    "y": 336,
    "w": 520,
    "h": 65
  }]
}
----

== Configuring {APP_NAME_COMPOSE} Modules

To configure a {PRODUCT_NAME} {APP_NAME_COMPOSE} with a sensitivity level, open the {PRODUCT_NAME} {APP_NAME_COMPOSE} web application and navigate to the admin panel of the desired namespace.
From the list of modules, click on the module you wish to update.

[CAUTION]
====
If incompatible, changing the sensitivity level value on a module will reset the sensitivity level defined on module fields.
====

Navigate to the btn:[privacy settings] tab and locate the "highest allowed sensitivity level" option.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/module-privacy.png",
    "alias": "data-privacy-sensitivity-levels-module-privacy-sensitivity-level",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 572,
    "y": 89,
    "w": 1093,
    "h": 360
  },
  "annotations": [{
    "padding": "sm",
    "x": 585,
    "y": 232,
    "h": 85,
    "w": 1070
  }, {
    "padding": "sm",
    "x": 1020,
    "y": 170,
    "w": 149,
    "h": 40
  }]
}
----

Additionally, you can set the sensitivity level to specific fields.
Under the btn:[fields] tab, click on the btn:[edit] button next to the field you want to update.
Navigate to the btn:[privacy] tab and locate the "sensitivity level" option.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/module-field-privacy.png",
    "alias": "data-privacy-sensitivity-levels-module-field-privacy-sensitivity-level",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 570,
    "y": 40,
    "w": 780,
    "h": 383
  },
  "annotations": [{
    "padding": "sm",
    "x": 581,
    "y": 162,
    "h": 66,
    "w": 758
  }, {
    "padding": "sm",
    "x": 1042,
    "y": 100,
    "w": 86,
    "h": 40
  }]
}
----

= Usage Disclosure

*Usage disclosure* provides a way for you to communicate to the end user how their sensitive data is used within the system and your organization.

[NOTE]
====
Usage disclosure is shown on the privacy console when the user interacts with their sensitive information.
====

.Usage disclosure can be defined on two levels:
* <<usage-disclosure-module,*Module-level disclosure*>> notes how the entire record is used,
* <<usage-disclosure-field,*module field-level disclosure*>> notes how the specific value is used.

[#usage-disclosure-module]
== Module-Level Disclosure

*Module-level disclosure* notes how the entire record is used.
Module-level usage disclosures are ideal for noting the general idea of what the module is used for, such as sellable data to advertisement providers.

To set module-level usage disclosure, navigate to the admin panel of your {APP_NAME_COMPOSE} namespace and edit the relevant module.
The sensitive data usage disclosure input is available under the btn:[privacy settings] tab.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/module-privacy.png",
    "alias": "data-privacy-sensitivity-levels-module-privacy-usage-disclosure",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 574,
    "y": 90,
    "w": 1091,
    "h": 360
  },
  "annotations": [{
    "x": 585,
    "y": 338,
    "h": 85,
    "w": 1070
  }, {
    "x": 1020,
    "y": 170,
    "w": 149,
    "h": 40
  }]
}
----

[#usage-disclosure-field]
== Field-Level Disclosure

*Module field-level disclosure* notes how a specific record value is used.
Module field-level usage disclosures are ideal to note specific fields that may not be intuitive from the general module-level disclosure.

To set module field-level usage disclosure, navigate to the admin panel of your {APP_NAME_COMPOSE} namespace and edit the relevant module.
Click on the btn:[edit] button next to the module field you wish to set the disclosure.
The sensitive data usage disclosure input is available under the btn:[privacy] tab.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "data-privacy/sensitivity-levels/module-field-privacy.png",
    "alias": "data-privacy-sensitivity-levels-module-field-privacy-usage-disclosure",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 570,
    "y": 40,
    "w": 780,
    "h": 383
  },
  "annotations": [{
    "x": 581,
    "y": 244,
    "h": 88,
    "w": 758
  }, {
    "x": 1042,
    "y": 100,
    "w": 86,
    "h": 40
  }]
}
----


# src/modules/integrator-guide/pages/discovery/examples/index.adoc

= Examples

:leveloffset: +1

include::./limit-namespace.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/discovery/examples/limit-namespace.adoc

include::ROOT:partial$variables.adoc[]

= Index Only Specified Namespace
:page-noindex: true

xref:discovery/index.adoc#data-visibility[Data visibility] is controlled with the standard access control facility.
The {APP_NAME_DISCOVERY} indexes everything it currently has access to.
To control data visibility, configure access control rules for the role assigned to the xref:discovery/index.adoc#indexer-user[{APP_NAME_DISCOVERY} indexer user].

In this example we configure {PRODUCT_NAME} {APP_NAME_DISCOVERY} to only index records from the discovery namespace.

Click on the btn:[permissions] button to open up global namespace access control rules.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/examples/limit-namespace/namespace-list.png",
    "alias": "discovery-examples-limit-namespace-namespace-list",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 830,
    "y": 72,
    "w": 150,
    "h": 43
  }]
}
----

Select the *authenticated* role and set the `read any namespace` rule to `deny`.
Alternatively, you may set the same rule to deny for the {APP_NAME_DISCOVERY} indexer role.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/examples/limit-namespace/namespace-rbac-global.png",
    "alias": "discovery-examples-limit-namespace-namespace-rbac-global",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box-note",
    "x": 406,
    "y": 105,
    "w": 255,
    "h": 47
  }, {
    "x": 706,
    "y": 105,
    "w": 556,
    "h": 31
  }]
}
----

Next, click on the btn:[edit] button for the namespace you wish to allow access to, and click on the btn:[permissions] button to open up access control rules for the given namespace.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/examples/limit-namespace/namespace-edit.png",
    "alias": "discovery-examples-limit-namespace-namespace-edit",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 825,
    "y": 68,
    "h": 44,
    "w": 150
  },
  "annotations": [{
    "x": 825,
    "y": 68,
    "h": 44,
    "w": 150
  }]
}
----

Select the *discoverer* role (the role assigned to the {APP_NAME_DISCOVERY} indexer user) and set the `read namespace` rule to `allow`.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/examples/limit-namespace/namespace-rbac.png",
    "alias": "discovery-examples-limit-namespace-namespace-rbac",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "x": 406,
    "y": 611,
    "h": 48,
    "w": 256
  }, {
    "x": 705,
    "y": 105,
    "h": 31,
    "w": 613
  }]
}
----

After the {APP_NAME_DISCOVERY} indexer reindexes your instance, the search results become limited to the discovery namespace for which the access is allowed.

[IMPORTANT]
====
The {APP_NAME_DISCOVERY} indexer must finish it's re-indexing in order for the changes to take affect.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/examples/limit-namespace/search-results-limited.png",
    "alias": "discovery-examples-limit-namespace-search-results-limited",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "x": 16,
    "y": 252,
    "h": 49,
    "w": 288
  }]
}
----


# src/modules/integrator-guide/pages/discovery/index.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= {PRODUCT_NAME} {APP_NAME_DISCOVERY}
:keywords: discovery, search, record searcher, record searching, resource searcher, resource searching, data discovery
:description: Learn how to configure and use {PRODUCT_NAME} {APP_NAME_DISCOVERY}, a powerful search engine for your data

{PRODUCT_NAME} {APP_NAME_DISCOVERY} provides a powerful search engine to interact with your data.
{PRODUCT_NAME} {APP_NAME_DISCOVERY} defines an intuitive interface to search and, in some cases, visualize the data such as geographical metadata.

Refer to the xref:devops-guide:discovery/index.adoc[menu:DevOps Guide[{PRODUCT_NAME} {APP_NAME_DISCOVERY}]] to learn how to configure the systems.

To access {PRODUCT_NAME} {APP_NAME_DISCOVERY}, navigate to your {PRODUCT_NAME} instance and click on the {APP_NAME_DISCOVERY} application.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "app-selector-discovery.png",
    "alias": "discovery-app-selector",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 1224,
    "y": 462,
    "w": 262,
    "h": 220
  },
  "annotations": []
}
----

In the {PRODUCT_NAME} {APP_NAME_DISCOVERY} application you are presented with an intuitive user interface where the *general filters* are available on the left side of the screen, a *search box* on the top, and the *search results* just below the search box.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/search-results.png",
    "alias": "discovery-search-results",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "x": 16,
    "y": 85,
    "w": 289,
    "h": 364
  }, {
    "x": 344,
    "y": 65,
    "w": 1559,
    "h": 46
  }, {
    "x": 344,
    "y": 165,
    "w": 1563,
    "h": 293
  }]
}
----

== Advanced Querying

To find exactly what you're looking for, apply a general filter.
It is located on the left side of the screen.
Click on the checkbox next to a filter to apply it to the search results.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/search-results.png",
    "alias": "discovery-search-filtering",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 0,
    "y": 0,
    "w": 320,
    "h": 1080
  }
}
----

You can insert a search query in the input box on the top of the screen to filter over the remaining search results.
The querying tries to find the best results based on the available data and the search term you've provided.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/search-results.png",
    "alias": "discovery-search-querying",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "x": 344,
    "y": 65,
    "h": 45,
    "w": 1560
  }]
}
----

=== Visualizing a Geographical Location

If a search result defines a geographical location, it can be visualized on a map.
To visualize search results on a map, click on the *map button* {ICON_DISCOVERY_MAP} in the bottom-right corner.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/search-results.png",
    "alias": "discovery-search-map",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 1600,
    "y": 780,
    "h": 300,
    "w": 320
  },
  "annotations": [{
    "kind": "box-note",
    "x": 1841,
    "y": 1000,
    "w": 65,
    "h": 65
  }]
}
----

When you click on the map button {ICON_DISCOVERY_MAP} a map appears right from the resulting data.
Mappable search results are represented as pins on the map; search results that can not be mapped are omitted from the map but still preserved in search results.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/search-results-mapped.png",
    "alias": "discovery-search-results-mapped",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box-danger",
    "x": 1820,
    "y": 215,
    "w": 26,
    "h": 40
  }, {
    "kind": "box-danger",
    "x": 1576,
    "y": 531,
    "w": 26,
    "h": 40
  }, {
    "kind": "box-danger",
    "x": 1543,
    "y": 819,
    "w": 26,
    "h": 40
  }]
}
----

[#integration-configuration]
== Integration Configuration

{PRODUCT_NAME} {APP_NAME_DISCOVERY} is a stand alone application, independent from the rest of the {PRODUCT_NAME} system.
In order to make {APP_NAME_DISCOVERY} functional, you must *grant access* by creating an *auth client* along with *a user* and *a role*.

[IMPORTANT]
====
Access control defines what data the {APP_NAME_DISCOVERY} indexer has access to; more in the <<index-configuration,index configuration>> sections.
====

=== Indexer Role

Firstly define a new role for the {APP_NAME_DISCOVERY} indexer to use.
Open the {PRODUCT_NAME} {APP_NAME_ADMIN} web application and navigate to menu:system[roles].
Click on the btn:[new] button, fill in the parameters and click on the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/role.png",
    "alias": "discovery-role",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 71,
    "w": 1070,
    "h": 392
  },
  "annotations": []
}
----

[#indexer-user]
=== Indexer User

Next, define a new user that the {APP_NAME_DISCOVERY} indexer should identify as.
In the {PRODUCT_NAME} {APP_NAME_ADMIN} web application navigate to menu:system[users].
Click on the btn:[new] button and fill in the parameters and click on the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/user.png",
    "alias": "discovery-user",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 70,
    "h": 324,
    "w": 1070
  },
  "annotations": []
}
----

After you save the user, assign them the role you've created earlier.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/user.png",
    "alias": "discovery-user-membership",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 436,
    "h": 203,
    "w": 1070
  },
  "annotations": []
}
----

=== Indexer Auth Client

Lastly, define an auth client that the {APP_NAME_DISCOVERY} indexer should use to authenticate with {PRODUCT_NAME}.

[NOTE]
====
Since authentication between two systems is being performed, you should to use the `client_credentials` grant type.
====

In the {PRODUCT_NAME} {APP_NAME_ADMIN} web application navigate to menu:system[auth clients].
Click on the btn:[new] button and fill in the basic parameters; make sure you select the `client_credentials` grant type and check the `allow client access to Corteza Discovery API on behalf of user`.
Select the previously created user in the `impersonate user` input and click on the btn:[submit] button.

[NOTE]
====
It is recommended you define a new auth client for a new external application instead of reusing existing ones.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/auth-client.png",
    "alias": "discovery-auth-client",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 855,
    "y": 366,
    "h": 16,
    "w": 547
  }, {
    "kind": "box-note",
    "padding": "sm",
    "x": 855,
    "y": 618,
    "h": 16,
    "w": 547
  }, {
    "kind": "box-note",
    "x": 855,
    "y": 748,
    "h": 40,
    "w": 800
  }]
}
----

Copy the *client ID* and *client secret* from the auth client and keep them safe for later use.
The clientID is located in the URL address bar, and the client secret is in the field labeled as such

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/auth-client-credentials.png",
    "alias": "discovery-auth-client-credentials",
    "w": 2123,
    "h": 1210
  },
  "view": {
    "x": 1,
    "y": 38,
    "w": 2087,
    "h": 1170
  },
  "annotations": [{
    "kind": "box-note",
    "padding": "sm",
    "x": 456,
    "y": 47,
    "w": 147,
    "h": 15
  }, {
    "kind": "box-note",
    "x": 678,
    "y": 363,
    "w": 1056,
    "h": 38
  }]
}
----

[#index-configuration]
== Indexing Configuration

[#data-visibility]
=== Data Visibility

*Data visibility* defines *what is indexed* and is controlled by the standard *access control facility*.
The {APP_NAME_DISCOVERY} indexes everything it currently has access to.

To control data visibility, configure *access control rules* for the role we've defined in the <<integration-configuration,integration configuration section>> above.

Refer to the example where the indexer is limited to only show records from a specified namespace.

=== Indexing Policy

Indexing policy defines how the data is indexed and who it can be accessed by.
Indexing policy allows you to make specific fields accessible publicly or only for authenticated users.

[IMPORTANT]
====
Currently, the indexing policy applies to specific fields.
To control entire rows, use <<data-visibility,data visibility>>.
====

There are three policies: *private*, *protected*, and *public*.
The private policy is used by default.

[NOTE]
====
Currently, only compose modules allow custom indexing policy.
====

If a resource supports indexing policy, there is a *discovery settings* {ICON_DISCOVERY_ICON} button on the configuration page.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/module-discovery.png",
    "alias": "discovery-module-discovery",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "w": 1600,
    "h": 1080
  },
  "focus": {
    "x": 580,
    "y": 100,
    "h": 42,
    "w": 208
  },
  "annotations": [{
    "x": 585,
    "y": 100,
    "h": 43,
    "w": 203
  }]
}
----

When you click on the discovery settings {ICON_DISCOVERY_ICON} button, a popup opens.
It presents the index policy configurator.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/indexing-policy.png",
    "alias": "discovery-indexing-policy",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 200,
    "y": 0,
    "w": 1520,
    "h": 680
  },
  "focus": {
    "padding": "sm",
    "x": 571,
    "y": 47,
    "w": 773,
    "h": 482
  },
  "annotations": []
}
----

To configure the policy, click on the corresponding tab and add the fields you wish to apply the policy to.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "discovery/indexing-policy-added.png",
    "alias": "discovery-indexing-policy-added",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 200,
    "y": 0,
    "w": 1520,
    "h": 680
  },
  "focus": {
    "padding": "sm",
    "x": 571,
    "y": 47,
    "w": 773,
    "h": 482
  },
  "annotations": [{
    "kind": "box-note",
    "x": 581,
    "y": 250,
    "w": 758,
    "h": 133
  }]
}
----

[IMPORTANT]
====
If a search result is covered by multiple index policies, the one covered by the most restricting policy is returned.
====

.Available indexing policies:
[cols="1s,5a"]
|===
| [#indexing-policy-private]#<<indexing-policy-private,Private>>#
| Private indexing policy is used by known, authenticated users to do cross-system searches.

Private index policy should be used whenever indexing sensitive data or data you don't wish to expose publicly.

| [#indexing-policy-protected]#<<indexing-policy-protected,Protected>>#
| Protected indexing policy is meant for foreign systems that are under some kind of access control.

[IMPORTANT]
====
Currently not in use; support will be added in a future release.
====

Protected indexing policy should be used when you have an external system accessing the data and that external system performs the required access control.

If external systems are not involved, use either private or public indexing policies.

| [#indexing-policy-public]#<<indexing-policy-public,Public>>#
| Public indexing policy is meant for users that are not logged-in.

[IMPORTANT]
====
Currently not in use; support will be added in a future release.
====

Public indexing policy should be used when you want to make data available publicly without the need to know who is accessing it.

|===


# src/modules/integrator-guide/pages/expr/datetime-formatting.adoc

[#datetime-formatting]
= Date and time formatting

== `%Y`

Description::
    Returns the year with century as a decimal number.
example::
    `strftime(dateField, "%Y")` results in "1993"

== `%y`

Description::
    Returns the year without century as a decimal number (00-99).
example::
    `strftime(dateField, "%y")` results in "93"

== `%C`

Description::
    Returns year / 100 as a decimal number; single digits are preceded by a zero.
example::
    `strftime(dateField, "%C")` results in "19"

== `%m`

Description::
    Returns the month as a decimal number (01-12).
example::
    `strftime(dateField, "%m")` results in "02"

== `%B`

Description::
    Returns the full national month name.
example::
    `strftime(dateField, "%B")` results in "February"

== `%b`

Description::
    Returns the abbreviated national month name.
example::
    `strftime(dateField, "%b")` results in "Feb"

== `%U`

Description::
    Returns the week number of the year (Sunday as the first day of the week) as a decimal number (00-53).
example::
    `strftime(dateField, "%U")` results in "05"

== `%V`

Description::
    Returns the week number of the year (Monday as the first day of the week) as a decimal number (01-53).
example::
    `strftime(dateField, "%V")` results in "05"

== `%W`

Description::
    Returns the week number of the year (Monday as the first day of the week) as a decimal number (00-53).
example::
    `strftime(dateField, "%W")` results in "05"

== `%A`

Description::
    Returns the full national weekday name.
example::
    `strftime(dateField, "%A")` results in "Tuesday"

== `%a`

Description::
    Returns the abbreviated national weekday name.
example::
    `strftime(dateField, "%a")` results in "Tue"

== `%d`

Description::
    Returns the day of the month as a decimal number (01-31).
example::
    `strftime(dateField, "%d")` results in "02"

== `%e`

Description::
    Returns the day of the month as a decimal number (1-31).
example::
    `strftime(dateField, "%e")` results in " 2"

== `%j`

Description::
    Returns the day of the year as a decimal number (001-366).
example::
    `strftime(dateField, "%j")` results in "033"

== `%u`

Description::
    Returns the weekday (Monday as the first day of the week) as a decimal number (1-7).
example::
    `strftime(dateField, "%u")` results in "5"

== `%w`

Description::
    Returns the weekday (Sunday as the first day of the week) as a decimal number (0-6).
example::
    `strftime(dateField, "%w")` results in "2"

== `%H`

Description::
    Returns the hour (24-hour clock) as a decimal number (00-23).
example::
    `strftime(dateField, "%H")` results in "06"

== `%k`

Description::
    Returns the hour (24-hour clock) as a decimal number (0-23).
example::
    `strftime(dateField, "%k")` results in " 6"

== `%I`

Description::
    Returns the hour (12-hour clock) as a decimal number (01-12).
example::
    `strftime(dateField, "%I")` results in "06"

== `%l`

Description::
    Returns the hour (12-hour clock) as a decimal number (1-12).
example::
    `strftime(dateField, "%l")` results in " 6"

== `%M`

Description::
    Returns the minute as a decimal number (00-59).
example::
    `strftime(dateField, "%M")` results in "00"

== `%S`

Description::
    Returns the second as a decimal number (00-60).
example::
    `strftime(dateField, "%S")` results in "00"

== `%S`

Description::
    Returns the millisecond as a decimal number (000-999).
example::
    `strftime(dateField, "%S")` results in "000"

== `%p`

Description::
    Returns the national representation of either "ante meridiem" (a.m.)  or "post meridiem" (p.m.).
example::
    `strftime(dateField, "%p")` results in "AM"

== `%c`

Description::
    Returns the national representation of time and date.
example::
    `strftime(dateField, "%c")` results in "Tue Feb  2 06:00:00 1993"

== `%X`

Description::
    Returns the national representation of the time.
example::
    `strftime(dateField, "%X")` results in "06:00:00"

== `%x`

Description::
    Returns the national representation of the date.
example::
    `strftime(dateField, "%x")` results in "02/02/93"

== `%Z`

Description::
    Returns the time zone name.
example::
    `strftime(dateField, "%Z")` results in "-0500"

== `%z`

Description::
    Returns the time zone offset from UTC.
example::
    `strftime(dateField, "%z")` results in "-0500"

== `%n`

Description::
    Returns a newline (\n).
example::
    `strftime(dateField, "%n")` results in "\n"

== `%t`

Description::
    Returns a tab.
example::
    `strftime(dateField, "%t")` results in "\t"

== `%%`

Description::
    Returns a %.
example::
    `strftime(dateField, "%%")` results in "%"

== `%F`

Description::
    Equivalent to %Y-%m-%d.
example::
    `strftime(dateField, "%F")` results in "1993-02-02"

== `%D`

Description::
    Equivalent to %m/%d/%y.
example::
    `strftime(dateField, "%D")` results in "02/02/93"

== `%R`

Description::
    Equivalent to %H:%M.
example::
    `strftime(dateField, "%R")` results in "06:00"

== `%r`

Description::
    Equivalent to %I:%M:%S %p.
example::
    `strftime(dateField, "%r")` results in "06:00:00 AM"

== `%T`

Description::
    Equivalent to %H:%M:%S.
example::
    `strftime(dateField, "%T")` results in "06:00:00"

== `%v`

Description::
    Equivalent to %e-%b-%Y.
example::
    `strftime(dateField, "%v")` results in " 2-Feb-1993"


# src/modules/integrator-guide/pages/expr/fnc-reference.adoc

= Expression Function Reference

:leveloffset: +1

include::partial$expr/fnc-type.adoc[]

include::partial$expr/fnc-array.adoc[]

include::partial$expr/fnc-string.adoc[]

include::partial$expr/fnc-num.adoc[]

include::partial$expr/fnc-datetime.adoc[]

include::partial$expr/fnc-kv.adoc[]

:leveloffset: -1






# src/modules/integrator-guide/pages/expr/index.adoc

include::ROOT:partial$variables.adoc[]

= Expressions

{PRODUCT_NAME} defines an expression language which is used when defining xref:compose-configuration/index.adoc#field-expressions[field expressions], xref:automation/workflows/index.adoc[workflow steps], as well as xref:security-model/index.adoc#role-type-ctx[contextual roles].

[NOTE]
====
We use https://github.com/PaesslerAG/gval[Gval] as the expression evaluation engine.
Refer to the official documentation for technical details.
====

== Syntax

.The most basic form of an expression would follow the following pattern:
[source]
----
<variable|constant|function> <operator> <variable|constant|function>
----

[NOTE]
====
In later texts, we alias the above string and its variations with `expression`.
====

.To examplify:
[source]
----
lead.values.totalCost / 10
----

You can expand the expression by applying additional constructs such as addition and division.

.To examplify:
[source]
----
average(min(lead.values.a, lead.values.b), abs(lead.values.c))
----

== Variables

The expression engine does *not* allow you to define custom variables within the expression itself.
All variables are defined by the system in which the expression is being executed.

The available variables are either documented in the system's user interface or in dedicated documentation pages.

== Objects

Objects allow you to encapsulate different bits of information into a single variable, such as a user, role, or record.

The primitive object-like data types include xref:expr/type-reference.adoc#datatype-kv[`KV`] and xref:expr/type-reference.adoc#datatype-kvv[`KVV`]; other component defined object-like data types can be found xref:expr/type-reference.adoc#object-reference[here].

.In the simplest form, an object is defined as the below example shows:
[source]
----
{
  "username": "testUser",
  "email": "test@mail.tld"
}
----

.If you would like to reference the entire object, you should reference the variable; for example:
[source]
----
newUser // results with { "username": "testUser", "email": "test@mail.tld" }
----

.If you would like to reference specific properties of the object, you should use a selector; for example:
[source]
----
newUser.username // results with "testUser"
newUser["username"] // results with "testUser"
----

[NOTE]
====
An object selector can use either the `["<selector>"]` or the `.<selector>` notation.
====

=== Missing Properties

Accessing missing (non-existing) properties results in an error:

[source]
----
myKV = { "a": "value-of-a" }
myB = myKV.b // throws an error: unknown parameter myKV.b
----

.Use the https://en.wikipedia.org/wiki/%3F:[ternay operator] to make a simple one-line test expression.
[source]
----
myB = has(myKV, "b") ? myKV.b : "b does not exist"
----

.Deeper structures can also be checked in a similar way.
[source]
----
deepKV = { "a": { "b": 42 } }
myB = has(deepKV, "a") && has(deepKV.a, "b") ? deepKV.a.b : "a.b does not exist"
----

=== Missing Record Values

Record values can be accessed in the same way as object and other key-value types.
The underlying selector mechanism on record values performs extra checks and allows selection (reading) of unset values as long as the module field exists.

[source]
----
// Accessing defined fields on a record
hit1 = myRecord.values.existingFieldWithValueSet
hit2 = myRecord.values.existingFieldWithoutAValue

// Accessing undefined fields on a record
miss = myRecord.values.unknownField // will raise an error: "unknown parameter myRecord.values.unknownField"
----

.Use the https://en.wikipedia.org/wiki/Null_coalescing_operator[null coalescing operator] to make a simple one-line test expression for unset fields.
[source]
----
failsafe = myRecord.values.existingFieldWithoutAValue ?? 'value was not yet set'
----

== Arrays

Arrays allow you to encapsulate a series of values into a single variable such as a list of leads or contacts you would like to create.

xref:expr/type-reference.adoc#datatype-array[`Array`] is the only native array data type.
An array can contain any data type, including another array.

[TIP]
====
Nested arrays allow you to define a multidimensional matrix.
====

.In the simplest form, an array is defined as the below example shows:
[source]
----
[{
  "username": "testUser1",
  "email": "test+1@mail.tld"
}, {
  "username": "testUser2",
  "email": "test+2@mail.tld"
}]
----

.If you would like to reference the entire array, you should reference the variable; for example:
[source]
----
newUsers // results with [{ "username": "testUser1", "email": "test+1@mail.tld" }, { "username": "testUser2", "email": "test+2@mail.tld" }]
----

.If you would like to reference specific elements of the array, you should use a selector; for example:
[source]
----
newUser[0] // results with { "username": "testUser1", "email": "test+1@mail.tld" }
newUser[1] // results with { "username": "testUser2", "email": "test+2@mail.tld" }
----

.If you wanted to access a property of the object that is inside an array, you should add an object selector:
[source]
----
newUser[0]["email"] // results with "test+1@mail.tld"
----

[NOTE]
====
An array selector can only use the `[]` notation.
====

== Operators

[cols="2m,5a"]
|===
| [#expr-op-arithmetic]#<<expr-op-arithmetic,Arithmetic>>#
|
* `+` (addition)
* `-` (subtraction)
* `*` (multiplication)
* `**` (power of)
* `/` (division)
* `%` (modulo)

| [#expr-op-comparison]#<<expr-op-comparison,Comparison>>#
|
* `<` (less then)
* `<=` (less or equal then)
* `>` (greater then)
* `>=` (greater or equal then)
* `==` (equal)
* `!=` (not equal)

.String comparison only:
* `=~` (equal regular expression)
* `!~` (not equal regular expression)

| [#expr-op-boolean-algebra]#<<expr-op-boolean-algebra,Boolean algebra>>#
|
* `&&` (and)
* `\|\|` (or)
* `!` (not)

| [#expr-op-bit-operations]#<<expr-op-bit-operations,Bit operations>>#
|
* `<<` (shift)
* `>>` (un shift)
* `&` (bitwise and)
* `\|` (bitwise or)

| [#ternary-cond-operations]#<<ternary-cond-operations,Ternary conditional>>#
|
* `?:` (ternary: `a?b:c` if-a-then-b-else-c)
* `??` (null coalescing operator: `a??b` if-a-is-not-null-then-a-else-b)

|===

=== Order of Execution

Expressions follow "the usual order" of execution where the order is initially based on *operator precedence* where the operators with equal precedence are executed *left to right*.

To exemplify; the order of execution for the expression of `a + b + (c + d * e)` would be:

. `d * e` (`x1`)
. `c + x1` (`x2`)
. `a + b` (`x3`)
. `x3 + x2`

The execution order may be controlled by enclosing parts of the expression within brackets `()`.

=== Operator Precedence

[cols="1m,3a,5a"]
|===
| 0
| Left to right
|
* `()`
* `[]`
* `.`

| 1 (unary)
| Right to left
|
* `+`
* `-`
* `!`

| 2
| Left to right
|
* `*`
* `**`
* `/`
* `%`

| 3
| Left to right
|
* `+`
* `-`

| 4
| Left to right
|
* `<<`
* `>>`

| 5
| Left to right
|
* `<`
* `<=`
* `>`
* `>=`

| 6
| Left to right
|
* `==`
* `!=`
* `=~`
* `!~`

| 7
| Left to right
|
* `&`

| 8
| Left to right
|
* `\|`

| 9
| Left to right
|
* `&&`

| 10
| Left to right
|
* `\|\|`

|===


# src/modules/integrator-guide/pages/expr/string-formatting.adoc

= String Formatting

== `%v`

Description::
    Returns the raw value.
Example::
    `format("%v", "test")` results in "test"

== `%t`

Description::
    Returns the boolean value as true/false.
Example::
    `format("%t", true)` results in "true"

== `%b`

Description::
    Returns the number in base 2 (in the binary format).
Example::
    `format("%b", 10)` results in "1010"

== `%d`

Description::
    Returns the number in base 10.
Example::
    `format("%d", 10)` results in "10"

== `%o`

Description::
    Returns the number in base 8.
Example::
    `format("%o", 10)` results in "12"

== `%O`

Description::
    Returns the number in base 8 with 0o prefix.
Example::
    `format("%O", 10)` results in "0o12"

== `%x`

Description::
    Returns the number in base 16; lower-case a-f.
Example::
    `format("%x", 10)` results in "a"

== `%X`

Description::
    Returns the number in base 16; upper-case A-F.
Example::
    `format("%X", 10)` results in "A"

== `%b`

Description::
    Returns the floating point number in scientific notation with binary exponent.
Example::
    `format("%b", 10.11)` results in "5691424029089464p-49"

== `%e`

Description::
    Returns the floating point number in scientific notation; lower-case e.
Example::
    `format("%e", 10.11)` results in "1.011000e+01"

== `%E`

Description::
    Returns the floating point number in scientific notation; upper-case E.
Example::
    `format("%E", 10.11)` results in "1.011000E+01"

== `%f`

Description::
    Returns the floating point number with a decimal point.
Example::
    `format("%f", 10.11)` results in "10.110000"


# src/modules/integrator-guide/pages/expr/type-reference.adoc

= Type reference

[NOTE]
====
*DevNote* generate the rest.
====

== Type reference

:leveloffset: +2

include::partial$expr/type-reference.adoc[]

:leveloffset: -2

== Object reference

:leveloffset: +2

include::generated:partial$expr-types.gen.adoc[]

:leveloffset: -2


# src/modules/integrator-guide/pages/federation/index.adoc

include::ROOT:partial$variables.adoc[]

[#federation]
= {PRODUCT_NAME} {APP_NAME_FEDERATION}
:page-aliases: 2024.9@administrator-guide:federation/index.adoc

[CAUTION]
====
{PRODUCT_NAME} {APP_NAME_FEDERATION} is currently in experimental mode and the federation function is disabled by default.
Set the `FEDERATION_ENABLED` `.env` variable to `true` if you wish to enable it.
====
//Editors's note: check line 8 for accuracy.

{PRODUCT_NAME} {APP_NAME_FEDERATION} enables different *{PRODUCT_NAME} instances* to establish a *federated network* to *freely and securely* exchange information.

This document helps you through the process of *setting up your federated network* and *configuring data sharing*.

.Quick access:
* <<node-pairing,adding new federated nodes>>,
* <<expose-module,configuring data sharing>>,
* <<module-mapping,consuming shared data>>.

:leveloffset: +1

include::nodes.adoc[]

include::share-data.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/federation/nodes.adoc

include::ROOT:partial$variables.adoc[]

= Federated Nodes
:page-aliases: 2024.9@administrator-guide:federation/nodes.adoc

A *federated node* is a *{PRODUCT_NAME} instance* (server) with the {APP_NAME_FEDERATION} feature enabled.
//Editor's note: what is a federated node? And a node for that matter? It may not be a thing everyone is familiar with.

A node can *expose data to its destination nodes* (acts as an origin), or *consume shared data from its origin nodes* (acts as a destination).

[NOTE]
====
A node can be both *the origin and a destination*.
====

Before we can exchange any data between the nodes, they need to go through the <<node-pairing,node pairing>> process.

[#node-pairing]
== Node pairing

.Node pairing flow outline:
. the origin node <<node-pairing-register,registers a destination node>>,
. the origin node <<node-pairing-invite,sends an invite>> to the destination node,
. the destination node accepts the invite, either <<node-pairing-accept-invite,via email>> or <<node-pairing-accept-invite-manual,via some other channel>>,
. the origin node <<node-pairing-handshake-accept,accepts the handshake request>> sent by the destination node.

[NOTE]
====
You can start the node pairing process from any node.
====

.[#node-pairing-register]#<<node-pairing-register,To register a new node:>>#
. navigate to the {PRODUCT_NAME} {APP_NAME_ADMIN},
. click on the "Nodes" under "Federation" in the navigation drawer,
. click on the "new" button,
. provide the requested data regarding node we wish to connect with,
. press the "Submit" button.

.[#node-pairing-invite]#<<node-pairing-invite,To send the invitation:>>#
. navigate to the {PRODUCT_NAME} {APP_NAME_ADMIN},
. click on the "Nodes" under "Federation" in the navigation drawer,
. click on the node you wish to send an invitation for,
//Editor's note: send the invitation to or for? Keep in mind the different meanings and choose appropriately.
. click on the "Generate Federation Link" button and either
** copy the invitation URL, or
** insert the contact email of the digital location the invite should be sent to.

[WARNING]
====
The generated invite URL includes a secure OTT token, so make sure to send it over a secure channel.
====

.[#node-pairing-accept-invite]#<<node-pairing-accept-invite,To accept the email invitation:>>#
. click on the "Pair Federation Node" button,
. enter the received URL and confirm.

[NOTE]
====
The node pairing does not proceed until the pairing URL is inserted, and the handshake request is accepted by the other party.
====

.[#node-pairing-accept-invite-manual]#<<node-pairing-accept-invite-manual,To accept the invitation without email:>>#
. navigate to the {PRODUCT_NAME} {APP_NAME_ADMIN},
. click on the "Nodes" under "Federation" in the navigation drawer,
. click on the btn:[edit] button
. enter the received URL and confirm.

[NOTE]
====
The node pairing does not proceed until the pairing URL is inserted, and the handshake request is accepted by the other party.
====
//Editor's note: Do you need to say this both here and in 56? If there isn't any particular need, I suggest you keep this one and delete the 56-59.

.[#node-pairing-handshake-accept]#<<node-pairing-handshake-accept,To accept the node pair handshake request:>>#
. navigate to the {PRODUCT_NAME} {APP_NAME_ADMIN},
. click on the "Nodes" under "Federation" in the navigation drawer,
. click on the node you wish to accept the request for,
. click on the warning icon to confirm the request.

[NOTE]
====
This final step is done on the origin server (the one that initiated the handshake).
====


# src/modules/integrator-guide/pages/federation/share-data.adoc

include::ROOT:partial$variables.adoc[]

= Data Synchronization
:page-aliases: 2024.9@administrator-guide:federation/share-data.adoc

When two nodes have *successfully performed the <<node-pairing,node pairing>>* process, we can *share the data between the two nodes*.

[NOTE]
====
Shared modules are created by the {APP_NAME_FEDERATION} system and can not be manually removed or updated.
====

[#expose-module]
== Sharing data

An *origin node* can *share data* with it's *paired destination nodes*.

An origin node *defines what modules* a specific destination node is *allowed to access*.

[NOTE]
====
You can only share data with nodes that have been successfully paired.
====

.To share a new module:
. navigate to {PRODUCT_NAME} {APP_NAME_COMPOSE},
. enter the namespace administration area,
. navigate to the "Modules" sub-page,
. click on the edit icon next to the module you wish to share,
. click on "Federation Settings",
. go to the "Expose" tab,
. select a node you wish to share the module to,
. select the fields you wish to share with the module,
. save the changes.

[TIP]
====
You can copy "Exposed" settings from other nodes by selecting the desired node from the "Copy settings from" dropdown.
====

.A screenshot showing the module sharing interface.
image::federation/expose-module.png[Screenshot of the configuration window.]

[#module-mapping]
== Consume shared data

A *destination node* can *consume shared data* from it's *paired origin node*.

A destination node *defines what modules* it wishes to access and how *values map in the destination module*.

[NOTE]
====
You can only consume data from nodes that we successfully paired.
====

.Consuming data:
. navigate to {PRODUCT_NAME} {APP_NAME_COMPOSE},
. enter the namespace administration area,
. navigate to the "Modules" subpage,
. click on the edit icon next to the module you wish to consume data into,
. click on "Federation Settings",
. go to the "Map" tab,
. select a node you wish to consume the data from,
. select what shared fields map into what module fields,
. save the changes.

.A screenshot showing the module mapping interface.
image::federation/map-module.png[Screenshot of the configuration window.]


# src/modules/integrator-guide/pages/i18n/index.adoc

include::ROOT:partial$variables.adoc[]

= Internationalisation
:page-aliases: 2024.9@personalization/i18n.adoc
:keywords: i18n, internationalization, translate
:description: Learn how to internationalize {PRODUCT_NAME}

{PRODUCT_NAME} allows you to fully translate most aspect of the system.
{PRODUCT_NAME} provides two facilities dedicated to internationalization -- xref:i18n/static.adoc[static translations] and xref:i18n/resource.adoc[resource translations].

[IMPORTANT]
====
Although you are able to define and translate into any language, some language specific use cases, are not yet fully supported.
====

A xref:i18n/static.adoc[*static translation*] is any piece of content defined on the system level and can not be modified neither from the system setup nor the configuration process.
Static translations are button labels, system page titles, and error messages.

A xref:i18n/resource.adoc[*resource translation*] is any piece of {PRODUCT_NAME} {APP_NAME_COMPOSE} content which is defined by an administrator when configuring the {PRODUCT_NAME} instance.
Resource translations are module names, {APP_NAME_COMPOSE} page titles, and namespace names.


# src/modules/integrator-guide/pages/i18n/resource.adoc

include::ROOT:partial$variables.adoc[]
include::ROOT:partial$icons.adoc[]

= Resource Translations
:keywords: i18n {APP_NAME_COMPOSE}, internationalization {APP_NAME_COMPOSE}, translate {APP_NAME_COMPOSE}, resource translate, resource translation
:description: Learn how to internationalize custom {PRODUCT_NAME} {APP_NAME_COMPOSE} applications

A *resource translation* is any piece of {PRODUCT_NAME} {APP_NAME_COMPOSE} content which is defined by an administrator when configuring the {PRODUCT_NAME} instance.

[NOTE]
====
Resource translations differ from instance to instance so the _standard_ static translation flow does not apply here.
====

Resource translations are module names, {APP_NAME_COMPOSE} page titles, and namespace names.

Refer to xref:i18n/static.adoc[static translations] to learn how to translate static content.

[#resource-translations]
== Customize resource translations

[IMPORTANT]
====
Some resources *do not support* resource translations.
Generally, only the resources accessible by end-users support resource translations.
====

The resource translations user interface can be accessed by clicking on the *language* {ICON_I18N} button when editing the resource that supports this feature.


[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "i18n/resource/namespace-edit.png",
    "alias": "i18n-resource-namespace-edit",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 1457,
    "y": 67,
    "w": 55,
    "h": 42
  },
  "annotations": [{
    "kind": "box",
    "x": 1457,
    "y": 67,
    "w": 55,
    "h": 42
  }]
}
----

When you click on the language {ICON_I18N} button, a popup presents the resource translation editor user interface.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "i18n/resource/editor.png",
    "alias": "i18n-resource-editor",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 408,
    "y": 50,
    "w": 1106,
    "h": 358
  },
  "annotations": []
}
----

[#languages]
== Supporting new languages

To add a new language, open up the resource translation editor user interface and click on the btn:[add language] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "i18n/resource/language-dd.png",
    "alias": "i18n-resource-language-dd",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 408,
    "y": 50,
    "w": 1106,
    "h": 358
  },
  "annotations": [{
    "kind": "box",
    "x": 1365,
    "y": 104,
    "w": 149,
    "h": 137
  }]
}
----

Click on the language you wish to add and it will appear in the resource translation editor.

[IMPORTANT]
====
The language must be defined in the `.env` before it can be used here.
Refer to the xref:devops-guide:i18n/index.adoc[DevOps guide] on how to register new languages.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "i18n/resource/language-added.png",
    "alias": "i18n-resource-language-added",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "x": 408,
    "y": 50,
    "w": 1106,
    "h": 358
  },
  "annotations": [{
    "kind": "box",
    "padding": "lg",
    "x": 1070,
    "y": 160,
    "w": 138,
    "h": 160
  }]
}
----


# src/modules/integrator-guide/pages/i18n/static.adoc

include::ROOT:partial$variables.adoc[]

= Static Translations
:keywords: i18n ui, i18n user interface, internationalize ui, internationalize user interface, translate ui, translate user interface,
:description: Learn how to internationalize {PRODUCT_NAME} user interfaces

A *static translation* is any piece of content defined on the system level and can not be modified neither from the system setup nor the configuration process.

Static translations are button labels, system page titles, and error messages.

Refer to xref:i18n/resource.adoc[resource translations] to learn how to translate configurable content.

== Modify static translations

=== Fork the corteza-locale repository

The https://github.com/cortezaproject/corteza-locale[corteza-locale] repository provides a centralized storage for all translations used by {PRODUCT_NAME}.

You can use the repository in question as a base when defining additional languages or modifying existing translations.

=== Modify the translations

All of the translations are located in the `src` directory of the corteza-locale repository.
Translations are grouped by the *language*, and the *repository* that they are used in.

[CAUTION]
====
The language must be defined in the {PRODUCT_NAME} server configuration in order for it to be available.
Refer to the xref:devops-guide:i18n/index.adoc[DevOps guide] of details.
====

Refer to the <<translation-files,modifying translation files>> for details on how the resource files should be structured.

Refer to the <<languages,supporting new languages>> for details on how to define additional languages.

=== Deploying modified translations

Upload the modified translation files to your {PRODUCT_NAME} server.
Refer to the xref:devops-guide:i18n/index.adoc[DevOps guide] for details.

[#translation-files]
== Modifying translation files

.This is how the file structure of the corteza-locale repository looks like:
[source]
----
📁 src
  📁 <language tag> <1>
    📁 <corteza repository> <2>
      📄 <locale namespace file>.yaml <3>
----
<1> The directory must be named with the language tag of the contents.
The language tag must follow the https://en.wikipedia.org/wiki/IETF_language_tag[BCP-47] standard.
<2> The directory must be named the same as the repository in which it will be used in.
To examplify; translations used by {PRODUCT_NAME} {APP_NAME_COMPOSE} is named as `corteza-webapp-compose`.
<3> The file contains a series of translations that are grouped in a locale namespace.

[CAUTION]
====
Locale namespaces are *not* the same thing as {PRODUCT_NAME} {APP_NAME_COMPOSE} namespaces.
There is no correlation.
====

A locale namespace encapsulates content that falls into the common area, such as the sidebar, notifications, module fields.

[NOTE]
====
For the complete list of locale namespaces used by a specific web application take English translations as a reference.

.You can also inspect web application i18n plugin initialization code:
* https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/compose/src/app.js[compose web application]
* https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/admin/src/app.js[admin web application]
* https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/one/src/app.js[one web application]
* https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/workflow/src/app.js[workflow web application]
* https://github.com/cortezaproject/corteza/blob/{VERSION}/client/web/reporter/src/app.js[reporter web application]
====

.The contents of the `en/corteza-webapp-compose/chart.yaml` file:
[source,yaml]
----
colorLabel: '{{count}} colors'
colorScheme: Color scheme
configure:
  reportsLabel: Reports
general:
  label:
    title: Label
    add: Add
  value: Value
  placeholder:
    handle: handle (a - z, 0 - 9, underscore, dash)

// ...
----

[#languages]
== Supporting new languages

.This is how the file structure of the corteza-locale repository looks like:
[source]
----
📁 src
  📁 <language tag> <1>
----
<1> The directory must be named with the language tag of the contents.
The language tag must follow the https://en.wikipedia.org/wiki/IETF_language_tag[BCP-47] standard.

To support an entirely new language, create a new directory in the `src` directory.
For example, to add Italian translations, you would need to create a directory named `it` in the `src` directory.

Languages can be defined using a simple language tag, such as `en` and `sl`.
If you need to be more specific you can use region suffix, such as `en-US` and `en-UK`.
{PRODUCT_NAME} will try to detect the language from the request headers and serve appropriate translation.

.An example file structure after adding the `it` folder:
[source]
----
📁 src
  📁 en <1>
  📁 it <2>
----
<1> This is the default directory with all of the English translations.
<2> This is the newly created directory for the Italian translations.

Inside the newly created directory create a `config.yaml` file.
The `config.yaml` file defines some base properties of the language, such as the display label (the `name` property).

Refer to the https://github.com/cortezaproject/corteza-locale/blob/{VERSION}/src/schema/config.json[`schema/config.json`] file for details.

.An example of the `config.yaml` file contents:
[source,yaml]
----
name: English
----

.An example file structure after adding `config.yaml` file:
[source]
----
📁 src
  📁 en
  📁 it
    📄 config.yaml <1>
----
<1> This is the configuration file that describes the given language.

After defining the boilerplate bits, refer to the predefined English translations (located in the `/src/en` directory) for all of the available translations.


# src/modules/integrator-guide/pages/index.adoc

include::ROOT:partial$variables.adoc[]

= Low-Code Platform Developer Guide
:page-aliases: 2024.9@administrator-guide:index.adoc
:keywords: low-code app, low-code application, custom application, low-code config, low-code configuration, extending {PRODUCT_NAME}, {APP_NAME_COMPOSE} development
:description: Learn how to build your own custom {PRODUCT_NAME} {APP_NAME_COMPOSE} application

The low-code platform developer guide covers the process of extending {PRODUCT_NAME} to cover your business' needs.
An integration can be as simple as the modification of the login screen to include your brand graphics or as complex as the implementation of a completely custom {APP_NAME_COMPOSE} application.

In case you haven't yet setup your {PRODUCT_NAME} instance, refer to the xref:devops-guide:index.adoc[DevOps guide].

== Authentication and Security Model

For *authentication*, {PRODUCT_NAME} implements the OAuth2 protocol, where {PRODUCT_NAME} can act both as an OAuth2 client or as a server.
Refer to the xref:authentication/index.adoc[authentication] section for details.
The login screen can be completely personalized to match your brand and to give your users a piece of mind when entering their credentials.
Refer to the xref:personalization/auth.adoc[menu:personalization[authentication]] section for details.

[TIP]
====
It may be a good idea to include your brand graphics where your {PRODUCT_NAME} instance will be accessed by external users.
====

For *access control*, {PRODUCT_NAME} implements a https://en.wikipedia.org/wiki/Role-based_access_control[RBAC facility] which allows you to fine tune access permissions to your needs.
Refer to the xref:security-model/index.adoc[] section for details.

== Internationalization

{PRODUCT_NAME} allows you to fully translate most aspect of the system.

Refer to the xref:i18n/static.adoc[] page to learn how to translate the user interface.

Refer to the xref:i18n/resource.adoc[] page to learn how to translate your {PRODUCT_NAME} {APP_NAME_COMPOSE} apps.

== Access {PRODUCT_NAME} via the API

{PRODUCT_NAME} is API-centric, meaning that everything can be done via an API endpoint.
Refer to the xref:accessing-corteza/index.adoc[accessing {PRODUCT_NAME}] sections for details regarding to xref:accessing-corteza/index.adoc#authentication[authentication], xref:accessing-corteza/index.adoc#api-endpoints[API endpoints], xref:accessing-corteza/index.adoc#response-format[data format], and the xref:accessing-corteza/ql.adoc[query language].

If you wish to connect an external application with {PRODUCT_NAME} in order to exchange data, you are able to do so by using our xref:accessing-corteza/api-clients.adoc[Node.js API clients].

== Creating a Custom {APP_NAME_COMPOSE} App

Refer to the xref:compose-configuration/index.adoc[{APP_NAME_COMPOSE} configuration] page to learn how you can configure your own {APP_NAME_COMPOSE} app.
For additional details, refer to xref:compose-configuration/field-types.adoc[menu:{APP_NAME_COMPOSE} configuration[field type reference]] for a reference of available field types and xref:compose-configuration/page-blocks.adoc[menu:{APP_NAME_COMPOSE} configuration[page block reference]] for a reference of available page blocks.

Refer to the xref:api-gw/index.adoc[] page to learn how you can define custom webhook endpoints external services can use.

Refer to the xref:reporting/index.adoc[] page to learn how you can create custom reports to visualize the data of your {APP_NAME_COMPOSE}.

== Automating your process

{PRODUCT_NAME} provides a powerful automation facility that allows you to implement nearly anything!
Automation is defined either via xref:automation/workflows/index.adoc[workflows (menu:automation[workflow])] or xref:automation/automation-scripts/index.adoc[automation scripts (menu:automation[automation script])].

A *workflow* is a simplified BPMN diagram, which allows you to describe the automation in a user-friendly manner.
A workflow is the recommended way of implementing an automation.
Workflows are easier to read and maintain.

An *automation script* is a piece of JavaScript code that performs a desired operation.

[CAUTION]
====
When the automation requires multiple complex operations that are not originally supported by the workflow engine, an automation script is a better choice.
====

== {PRODUCT_NAME} {APP_NAME_DISCOVERY}

{PRODUCT_NAME} {APP_NAME_DISCOVERY} provides a powerful search engine to interact with your data.
{PRODUCT_NAME} {APP_NAME_DISCOVERY} defines an intuitive interface to search and, for some cases, visualize the data such as geographical metadata.

Refer to xref:discovery/index.adoc[] page to learn how to configure and use {PRODUCT_NAME} {APP_NAME_DISCOVERY}

== Creating custom documents

[IMPORTANT]
====
To enable PDF document rendering, you will need to run the https://github.com/gotenberg/gotenberg[gotenberg] Docker container.

Refer to the xref:devops-guide:pdf-renderer.adoc[DevOps guide] for details on how to set it up.
====

{PRODUCT_NAME} defines a flexible template facility, which allows you to design custom documents (such as marketing emails and PDF quotes) that you send to your contacts.
The template facility currently supports *PDF*, *HTML*, and *plain text* formats.

Refer to the xref:templates/index.adoc[templates] section to overview the process of defining a template and rendering a document.

[TIP]
====
You can request document rendering from external applications via the REST API.

*DevNote* add a reference to the endpoint.
====

== {PRODUCT_NAME} Federation

{PRODUCT_NAME} {APP_NAME_FEDERATION} enables different {PRODUCT_NAME} instances to establish a federated network to freely and securely exchange information.

Refer to the xref:federation/index.adoc[] page to learn how to configure and use {PRODUCT_NAME} Federation.

== Troubleshooting

Get in touch with us on our https://forum.{DOMAIN}[forum].
Any feedback, questions or suggestions are always welcome!


# src/modules/integrator-guide/pages/miscellaneous.adoc

include::ROOT:partial$variables.adoc[]

= Miscellaneous

== System settings

The majority of system configuration, which affects how the system behaves, is performed on the deployment-level.

Refer to the xref:devops-guide:index.adoc[] for details.

=== User interfaces

The role management user interface resides in the xref:index.adoc#webapp-admin[{PRODUCT_NAME} {APP_NAME_ADMIN}] web application, under:

* menu:system[settings]
* menu:system[email settings]
* menu:compose[settings]
* menu:user interface[settings]

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "miscellaneous/webapp-admin-dashboard.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "w": 320,
    "h": 1080,
    "x": 0,
    "y": 0
  },
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 295,
    "w": 288,
    "h": 30
  }, {
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 330,
    "w": 288,
    "h": 30
  }, {
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 583,
    "w": 288,
    "h": 37
  }, {
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 868,
    "w": 288,
    "h": 37
  }]
}
----

=== System settings

*System settings* are located under menu:system[settings] in the left navigation menu.

System settings allow you to configure internal and external authentication, as well as xref:authentication/mfa.adoc[multi factor authentication] and different authentication flows.

[TIP]
====
You can disable internal sign-up and manually add users that are allowed to access your system.
====

Refer to the xref:authentication/external/index.adoc[] for details on how to configure external providers.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "miscellaneous/system-settings.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 292,
    "w": 288,
    "h": 30
  }]
}
----

=== Email settings

*Email settings* are located under menu:system[email settings] in the left navigation menu.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "miscellaneous/email-settings.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 330,
    "w": 288,
    "h": 30
  }]
}
----

The email settings interface allows you to configure SMTP servers for sending emails from {PRODUCT_NAME}.
Please consult your email services provider for SMTP server information (host, port, user, password).

[CAUTION]
====
Diagnostics and additional information in case of misconfiguration are only available in the server logs.
====

In case of any TLS/certificate issues you can adjust the server name for the TLS check or disable checking and allow use of invalid certificates.

[IMPORTANT]
====
Initial settings are copied from the xref:devops-guide:references/configuration/server.adoc#\_email_sending[`SMTP_*` environmental variables].
{PRODUCT_NAME} logs a warning in case you keep the environmental variables and make changes to either variables or settings.
====

Open your administration panel and navigate to menu:System[Email settings].

.The screenshot shows the SMTP server settings in the administration panel under.
image::email-settings/form.png[Screenshot of the configuration window.,role="data-zoomable"]

- Provide the required server name and port and optional username and password.
Changes are applied immediately and do not require server restart.


=== {APP_NAME_COMPOSE} settings

*{APP_NAME_COMPOSE} settings* are located under menu:compose[settings] in the left navigation menu.
{APP_NAME_COMPOSE} settings allow you to configure general attachment settings, such as the maximum size and allow lists.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "miscellaneous/compose-settings.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 577,
    "w": 288,
    "h": 37
  }]
}
----

=== User interface settings

*User interface settings* are located under menu:user interface[settings] in the left navigation menu.
User interface settings allow you to configure the main and icon logos that {PRODUCT_NAME} applications would use.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "miscellaneous/ui-settings.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 855,
    "w": 288,
    "h": 37
  }]
}
----



# src/modules/integrator-guide/pages/provisioning/index.adoc

include::ROOT:partial$variables.adoc[]

= Provisioning

*DevNote* todo


# src/modules/integrator-guide/pages/reporting/expr-reference.adoc

include::ROOT:partial$variables.adoc[]

= Expression Reference

== Conjunction

[cols="1s,5a"]
|===
| [#expr-conjunction-and]#<<expr-conjunction-and,and>>#
|
Returns `true` if all elements are `true`, `else` if otherwise.

.[#expr-conjunction-and-sig]#<<expr-conjunction-and-sig,Signatures:>>#
* `<Boolean>[ && <Boolean>[...]]` => `<Boolean>`
* `<Boolean>[ and <Boolean>[...]]` => `<Boolean>`
* `and(<Boolean>[, <Boolean>, ...]])` => `<Boolean>`

.[#expr-conjunction-and-ex-a]#<<expr-conjunction-and-ex-a,Expression examples:>>#
* `bool_field && true`
* `(field == 'value') && bool_field`
* `bool_field and true`
* `(field == 'value') and bool_field`

.[#expr-conjunction-and-ex-b]#<<expr-conjunction-and-ex-b,Function examples:>>#
* `and(bool_field, true)`
* `and((field == 'value'), bool_field)`

| [#expr-conjunction-or]#<<expr-conjunction-or,or>>#
|
Returns `true` if any element is `true`, `else` if otherwise.

.[#expr-conjunction-or-sig]#<<expr-conjunction-or-sig,Signatures:>>#
* `<Boolean>[ \|\| <Boolean>[...]]` => `<Boolean>`
* `<Boolean>[ or <Boolean>[...]]` => `<Boolean>`
* `or(<Boolean>[, <Boolean>, ...]])` => `<Boolean>`

.[#expr-conjunction-or-ex-a]#<<expr-conjunction-or-ex-a,Expression examples:>>#
* `bool_field \|\| true`
* `(field == 'value') \|\| bool_field`
* `bool_field or true`
* `(field == 'value') or bool_field`

.[#expr-conjunction-or-ex-b]#<<expr-conjunction-or-ex-b,Function examples:>>#
* `or(bool_field, true)`
* `or((field == 'value'), bool_field)`

|===

== Comparison

[cols="1s,5a"]
|===
| [#expr-comparison-eq]#<<expr-comparison-eq,equals>>#
|
Returns `true` if types are comparable and the values match.

.[#expr-comparison-eq-sig]#<<expr-comparison-eq-sig,Signatures:>>#
* `<Any> = <Any>` => `<Boolean>`
* `<Any> == <Any>` => `<Boolean>`
* `<Any> === <Any>` => `<Boolean>`
* `eq(<Any>, <Any>)` => `<Boolean>`

.[#expr-comparison-eq-ex-a]#<<expr-comparison-eq-ex-a,Expression examples:>>#
* `field == 'value'`
* `number == 10`
* `year(dateField) == year(now())`

.[#expr-comparison-eq-ex-b]#<<expr-comparison-eq-ex-b,Function examples:>>#
* `eq(field, 'value')`
* `eq(number, 10)`
* `eq(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-comparison-ne]#<<expr-comparison-ne,not equals>>#
|
Returns `true` if types are not comparable or the values don't match.

.[#expr-comparison-ne-sig]#<<expr-comparison-ne-sig,Signatures:>>#
* `<Any> != <Any>` => `<Boolean>`
* `<Any> !== <Any>` => `<Boolean>`
* `ne(<Any>, <Any>)` => `<Boolean>`

.[#expr-comparison-ne-ex-a]#<<expr-comparison-ne-ex-a,Expression examples:>>#
* `field != 'value'`
* `number != 10`
* `year(dateField) != year(now())`

.[#expr-comparison-ne-ex-b]#<<expr-comparison-ne-ex-b,Function examples:>>#
* `ne(field, 'value')`
* `ne(number, 10)`
* `ne(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-comparison-lt]#<<expr-comparison-lt,less than>>#
|
Returns `true` if the left value is less than the right value.

.[#expr-comparison-lt-sig]#<<expr-comparison-lt-sig,Signatures:>>#
* `<Any> < <Any>` => `<Boolean>`
* `lt(<Any>, <Any>)` => `<Boolean>`

.[#expr-comparison-lt-ex-a]#<<expr-comparison-lt-ex-a,Expression examples:>>#
* `field < 'value'`
* `number < 10`
* `year(dateField) < year(now())`

.[#expr-comparison-lt-ex-b]#<<expr-comparison-lt-ex-b,Function examples:>>#
* `lt(field, 'value')`
* `lt(number, 10)`
* `lt(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-comparison-le]#<<expr-comparison-le,less than or equal to>>#
|
Returns `true` if left value is less than or equal to the right value.

.[#expr-comparison-le-sig]#<<expr-comparison-le-sig,Signatures:>>#
* `<Any> <= <Any>` => `<Boolean>`
* `le(<Any>, <Any>)` => `<Boolean>`

.[#expr-comparison-le-ex-a]#<<expr-comparison-le-ex-a,Expression examples:>>#
* `field <= 'value'`
* `number <= 10`
* `year(dateField) <= year(now())`

.[#expr-comparison-le-ex-b]#<<expr-comparison-le-ex-b,Function examples:>>#
* `le(field, 'value')`
* `le(number, 10)`
* `le(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-comparison-gt]#<<expr-comparison-gt,greater than>>#
|
Returns `true` if left value is greater than the right value.

.[#expr-comparison-gt-sig]#<<expr-comparison-gt-sig,Signatures:>>#
* `<Any> > <Any>` => `<Boolean>`
* `gt(<Any>, <Any>)` => `<Boolean>`

.[#expr-comparison-gt-ex-a]#<<expr-comparison-gt-ex-a,Expression examples:>>#
* `field > 'value'`
* `number > 10`
* `year(dateField) > year(now())`

.[#expr-comparison-gt-ex-b]#<<expr-comparison-gt-ex-b,Function examples:>>#
* `gt(field, 'value')`
* `gt(number, 10)`
* `gt(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-comparison-ge]#<<expr-comparison-ge,greater or equal than>>#
|
Returns `true` if left value is greater than or equal to the right value.

.[#expr-comparison-ge-sig]#<<expr-comparison-ge-sig,Signatures:>>#
* `<Any> >= <Any>` => `<Boolean>`
* `ge(<Any>, <Any>)` => `<Boolean>`

.[#expr-comparison-ge-ex-a]#<<expr-comparison-ge-ex-a,Expression examples:>>#
* `field >= 'value'`
* `number >= 10`
* `year(dateField) >= year(now())`

.[#expr-comparison-ge-ex-b]#<<expr-comparison-ge-ex-b,Function examples:>>#
* `ge(field, 'value')`
* `ge(number, 10)`
* `ge(year(dateField), year(now()))`

|===

== String Comparison

[cols="1s,5a"]
|===
| [#expr-str-comparison-like]#<<expr-str-comparison-like,like>>#
|
Returns `true` if the left value matches the pattern on the right.

.[#expr-str-comparison-like-sig]#<<expr-str-comparison-like-sig,Signatures:>>#
* `<String> like <String>` => `<Boolean>`
* `like(<String>, <String>)` => `<Boolean>`

.[#expr-str-comparison-like-ex-a]#<<expr-str-comparison-like-ex-a,Expression examples:>>#
* `field like 'value'`
* `field like 'va_ue'`
* `name like 'test%'`

.[#expr-str-comparison-like-ex-b]#<<expr-str-comparison-like-ex-b,Function examples:>>#
* `like(field, 'value')`
* `like(field, 'va_ue')`
* `like(name, 'test%')`

|===

[cols="1s,5a"]
|===
| [#expr-str-comparison-nlike]#<<expr-str-comparison-nlike,not like>>#
|
Returns `true` if the left value does not match the pattern on the right.

.[#expr-str-comparison-nlike-sig]#<<expr-str-comparison-nlike-sig,Signatures:>>#
* `<String> not like <String>` => `<Boolean>`
* `nlike(<String>, <String>)` => `<Boolean>`

.[#expr-str-comparison-nlike-ex-a]#<<expr-str-comparison-nlike-ex-a,Expression examples:>>#
* `field not like 'value'`
* `field not like 'va_ue'`
* `name not like 'test%'`

.[#expr-str-comparison-nlike-ex-b]#<<expr-str-comparison-nlike-ex-b,Function examples:>>#
* `nlike(field, 'value')`
* `nlike(field, 'va_ue')`
* `nlike(name, 'test%')`

|===

== String Operation

|===
| [#expr-string-concat]#<<expr-string-concat,concat>>#
|
.[#expr-str-concat-sig]#<<expr-str-concat-sig,Signatures:>>#
* `concat(<String>[, <String>, ...]])` => `<String>`

.[#expr-str-concat-ex-a]#<<expr-str-concat-ex-a,Expression examples:>>#


.[#expr-str-concat-ex-b]#<<expr-str-concat-ex-b,Function examples:>>#
* `concat('a', 'b')`
* `concat(field, 'b')`
|===

== Arithmetic

[cols="1s,5a"]
|===
| [#expr-arithmetic-add]#<<expr-arithmetic-add,add>>#
|
Adds the two numbers.

.[#expr-arithmetic-add-sig]#<<expr-arithmetic-add-sig,Signatures:>>#
* `<Number> + <Number>` => `<Number>`
* `add(<Number>, <Number>)` => `<Number>`

.[#expr-arithmetic-add-ex-a]#<<expr-arithmetic-add-ex-a,Expression examples:>>#
* `100 + 20`
* `number + 10`
* `year(dateField) + year(now())`

.[#expr-arithmetic-add-ex-b]#<<expr-arithmetic-add-ex-b,Function examples:>>#
* `add(100, 20)`
* `add(number, 10)`
* `add(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-arithmetic-sub]#<<expr-arithmetic-sub,sub>>#
|
Subtracts the two numbers.

.[#expr-arithmetic-sub-sig]#<<expr-arithmetic-sub-sig,Signatures:>>#
* `<Number> - <Number>` => `<Number>`
* `sub(<Number>, <Number>)` => `<Number>`

.[#expr-arithmetic-sub-ex-a]#<<expr-arithmetic-sub-ex-a,Expression examples:>>#
* `100 - 20`
* `number - 10`
* `year(dateField) - year(now())`

.[#expr-arithmetic-sub-ex-b]#<<expr-arithmetic-sub-ex-b,Function examples:>>#
* `sub(100, 20)`
* `sub(number, 10)`
* `sub(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-arithmetic-mult]#<<expr-arithmetic-mult,mult>>#
|
Multiplies the two numbers.

.[#expr-arithmetic-mult-sig]#<<expr-arithmetic-mult-sig,Signatures:>>#
* `<Number> * <Number>` => `<Number>`
* `mult(<Number>, <Number>)` => `<Number>`

.[#expr-arithmetic-mult-ex-a]#<<expr-arithmetic-mult-ex-a,Expression examples:>>#
* `100 * 20`
* `number * 10`
* `year(dateField) * year(now())`

.[#expr-arithmetic-mult-ex-b]#<<expr-arithmetic-mult-ex-b,Function examples:>>#
* `mult(100, 20)`
* `mult(number, 10)`
* `mult(year(dateField), year(now()))`

|===

[cols="1s,5a"]
|===
| [#expr-arithmetic-div]#<<expr-arithmetic-div,div>>#
|
Divides the two numbers amongst each other.

.[#expr-arithmetic-div-sig]#<<expr-arithmetic-div-sig,Signatures:>>#
* `<Number> / <Number>` => `<Number>`
* `div(<Number>, <Number>)` => `<Number>`

.[#expr-arithmetic-div-ex-a]#<<expr-arithmetic-div-ex-a,Expression examples:>>#
* `100 / 20`
* `number / 10`
* `year(dateField) / year(now())`

.[#expr-arithmetic-div-ex-b]#<<expr-arithmetic-div-ex-b,Function examples:>>#
* `div(100, 20)`
* `div(number, 10)`
* `div(year(dateField), year(now()))`

|===

== Aggregation

[cols="1s,5a"]
|===
| [#expr-aggregation-count]#<<expr-aggregation-count,count>>#
|
Returns the number of items.

.[#expr-aggregation-count-sig]#<<expr-aggregation-count-sig,Signatures:>>#
* `count()` => `<Number>`

.[#expr-aggregation-count-ex-a]#<<expr-aggregation-count-ex-a,Expression examples:>>#
* `count()`

.[#expr-aggregation-count-ex-b]#<<expr-aggregation-count-ex-b,Function examples:>>#
* `count()`
|===


[cols="1s,5a"]
|===
| [#expr-aggregation-sum]#<<expr-aggregation-sum,sum>>#
|
Returns the sum of the items.

.[#expr-aggregation-sum-sig]#<<expr-aggregation-sum-sig,Signatures:>>#
* `sum(<Number>)` => `<Number>`

.[#expr-aggregation-sum-ex-a]#<<expr-aggregation-sum-ex-a,Expression examples:>>#
* `field + current_column`

.[#expr-aggregation-sum-ex-b]#<<expr-aggregation-sum-ex-b,Function examples:>>#
* `sum(field)`
|===

[cols="1s,5a"]
|===
| [#expr-aggregation-max]#<<expr-aggregation-max,max>>#
|
Returns the maximum of two values.

.[#expr-aggregation-max-sig]#<<expr-aggregation-max-sig,Signatures:>>#
* `max(<Number>)` => `<Number>`

.[#expr-aggregation-max-ex-a]#<<expr-aggregation-max-ex-a,Expression examples:>>#
* `max(field)`

.[#expr-aggregation-max-ex-b]#<<expr-aggregation-max-ex-b,Function examples:>>#
* `max(field)`
|===

[cols="1s,5a"]
|===
| [#expr-aggregation-min]#<<expr-aggregation-min,min>>#
|
Returns the minimum of two values.

.[#expr-aggregation-min-sig]#<<expr-aggregation-min-sig,Signatures:>>#
* `min(<Number>)` => `<Number>`

.[#expr-aggregation-min-ex-a]#<<expr-aggregation-min-ex-a,Expression examples:>>#
* `min(field)`

.[#expr-aggregation-min-ex-b]#<<expr-aggregation-min-ex-b,Function examples:>>#
* `min(field)`
|===

[cols="1s,5a"]
|===
| [#expr-aggregation-avg]#<<expr-aggregation-avg,avg>>#
|
Returns the average of two values.

.[#expr-aggregation-avg-sig]#<<expr-aggregation-avg-sig,Signatures:>>#
* `avg(<Number>)` => `<Number>`

.[#expr-aggregation-avg-ex-a]#<<expr-aggregation-avg-ex-a,Expression examples:>>#
* `avg(field)`

.[#expr-aggregation-avg-ex-b]#<<expr-aggregation-avg-ex-b,Function examples:>>#
* `avg(field)`
|===

== Date Manipulation

[cols="1s,5a"]
|===
| [#expr-date-now]#<<expr-date-now,now>>#
|
Returns the current timestamp.

.[#expr-date-now-sig]#<<expr-date-now-sig,Signatures:>>#
* `now()` => `<DateTime>`

.[#expr-date-now-ex-a]#<<expr-date-now-ex-a,Expression examples:>>#
* `now()`

|===

[cols="1s,5a"]
|===
| [#expr-date-quarter]#<<expr-date-quarter,quarter>>#
|
Returns the quarter of the timestamp.

.[#expr-date-quarter-sig]#<<expr-date-quarter-sig,Signatures:>>#
* `quarter(<DateTime>)` => `<Number>`

.[#expr-date-quarter-ex-a]#<<expr-date-quarter-ex-a,Expression examples:>>#
* `quarter(date_field)`
* `quarter(now())`
* `quarter(date('2021-01-01T01:00:00Z'))`

|===

[cols="1s,5a"]
|===
| [#expr-date-year]#<<expr-date-year,year>>#
|
Returns the year of the timestamp.

.[#expr-date-year-sig]#<<expr-date-year-sig,Signatures:>>#
* `year(<DateTime>)` => `<Number>`

.[#expr-date-year-ex-a]#<<expr-date-year-ex-a,Expression examples:>>#
* `year(date_field)`
* `year(now())`
* `year(date('2021-01-01T01:00:00Z'))`

|===

[cols="1s,5a"]
|===
| [#expr-date-month]#<<expr-date-month,month>>#
|
Returns the month of the timestamp.

.[#expr-date-month-sig]#<<expr-date-month-sig,Signatures:>>#
* `month(<DateTime>)` => `<Number>`

.[#expr-date-month-ex-a]#<<expr-date-month-ex-a,Expression examples:>>#
* `month(date_field)`
* `month(now())`
* `month(date('2021-01-01T01:00:00Z'))`

|===

== Typecast

[cols="1s,5a"]
|===
| [#expr-cast-float]#<<expr-cast-float,float>>#
|
Casts the value to a float.

.[#expr-cast-float-sig]#<<expr-cast-float-sig,Signatures:>>#
* `float(<Any>)` => `<Float>`

.[#expr-cast-float-ex-a]#<<expr-cast-float-ex-a,Expression examples:>>#
* `float(some_field)`
* `float('10.9')`
* `avg(cost) > float(10.9)`

|===

[cols="1s,5a"]
|===
| [#expr-cast-string]#<<expr-cast-string,string>>#
|
Casts the value to a string.

[CAUTION]
====
The string length for PostgreSQL and MySQL is limited to `8192` characters.
====

.[#expr-cast-string-sig]#<<expr-cast-string-sig,Signatures:>>#
* `string(<Any>)` => `<String>`

.[#expr-cast-string-ex-a]#<<expr-cast-string-ex-a,Expression examples:>>#
* `string(some_field)`
* `string('10.9')`

|===

[cols="1s,5a"]
|===
| [#expr-cast-int]#<<expr-cast-int,int>>#
|
Casts the value to an integer.

.[#expr-cast-int-sig]#<<expr-cast-int-sig,Signatures:>>#
* `int(<Any>)` => `<Int>`

.[#expr-cast-int-ex-a]#<<expr-cast-int-ex-a,Expression examples:>>#
* `int(some_field)`
* `int('10.9')`
* `avg(cost) > int(10.9)`

|===

[cols="1s,5a"]
|===
| [#expr-date-date]#<<expr-date-date,date>>#
|
Casts the value to a timestamp.

.[#expr-date-date-sig]#<<expr-date-date-sig,Signatures:>>#
* `date(<Ant>)` => `<DateTime>`

.[#expr-date-date-ex-a]#<<expr-date-date-ex-a,Expression examples:>>#
* `date(some_field)`
* `date('2021-01-01T01:00:00Z')`

|===


# src/modules/integrator-guide/pages/reporting/index.adoc

include::ROOT:partial$variables.adoc[]

= Reporting

{PRODUCT_NAME} {APP_NAME_REPORTER} allows you to create beautiful reports using the data stored in your {APP_NAME_COMPOSE} applications.
This section focuses on the most important aspects of the system. If you wish to learn more about a specific topic, refer to the subsections under menu:Low-Code Platform Developer Guide[Reporting].

== Creating a New Report

To create a report, navigate to your {PRODUCT_NAME} instance (for example http://latest.cortezaproject.org/) and click ok tne "{APP_NAME_REPORTER}" application.

image::reporter/app-selector.png[role="data-zoomable"]

A new screen showing you all of the available reports will appear.

.From there you can:
* create new reports by clicking on the btn:[New Report] button,
* edit existing reports by clicking on the btn:[edit] button,
* open the report builder by clicking on the btn:[Report builder] button,
* manage global permissions by clicking on the btn:[Permissions] button,
* manage report-specific permissions by clicking on the "Lock" icon next to the report.

image::reporter/report-list.png[role="data-zoomable"]

When you click on the btn:[New report] button, a new screen appears asking you to provide the base report parameters.

* *Name* provides a user-friendly identifier for the report; for example "Test Report".
A name doesn't define any particular constraints.
* *Handle* defines a <<report-handle-constraints,unique value>> that may be used instead of the system identifier for easier referencing.
* *Description* defines a verbose description of the report to better explain what the report shows.
* *Tags* define a series of short text snippets to describe your report.

[#report-handle-constraints]
.Handle constraints:
include::partial$handle-constraints.adoc[]

image::reporter/report-create.png[role="data-zoomable"]

[#report-builder]
== Report Builder

The report builder is used to define the reports' structure using *report blocks* and a drag-and-drop interface.
Each report has a grid of 12 columns and is not limited on the vertical axis.

image::reporter/report-builder-base.png[role="data-zoomable"]

Click on the btn:[+ Add block] button to add a new report block which can hold additional data sources and display elements.

image::reporter/report-builder-block-base.png[role="data-zoomable"]

To access general report block configuration options (the title, description, and layout direction) click on the "edit" icon in the bottom left corner of the report block.

image::reporter/report-builder-block-config.png[role="data-zoomable"]

Display elements can be accessed, added, edited, and removed by navigating to the "elements" tab of the general report block configuration modal.

image::reporter/report-builder-block-el.png[role="data-zoomable"]

Display elements can quickly be added by clicking on the "add" icon in the bottom left corner of the report block.

image::reporter/report-builder-elements.png[role="data-zoomable"]

To reposition the report block, simply drag-and-drop it to the desired position.

The report block may be placed anywhere on the X axis, but its Y axis must connect with another report block or with the top of the page.
If the position is not valid or it overlays with another report block, the report builder may automatically adjust the surrounding report blocks to conform to the constraints.

image:reporter/report-builder-repos-base.png[width=49%]
image:reporter/report-builder-repos.png[width=49%]

To resize the report block, simply grab the arrow in the bottom-right corner and resize to fit your needs.
The report block may not exceed the maximum width of 12 columns.
The height is not limited.

image:reporter/report-builder-resize-base.png[width=49%]
image:reporter/report-builder-resize.png[width=49%]

To delete a report block, click on the "trash can" icon in the bottom-left corner of the report block and confirm the action by clicking on the confirmation button.

image::reporter/report-builder-delete.png[role="data-zoomable"]

== Data Sources

[NOTE]
====
*DevNote* reference to more examples.
====

A data source defines what resource is being accessed, how the data is pre-processed and presented to the reporter.
Most data sources may be used as the input to another data source.

[IMPORTANT]
====
A data source must define a name that is unique amongst other data sources defined by the current report and any of it's blocks.
====

We can define data sources on two levels: on the entire report and on a specific report block.

When defining data sources on the entire report, any of the blocks and its items should be able to access the data provided by the data source.
Such a data source should be used when we wish to define some pre-computed data which we will be using through the entire report.
Report-level data sources can be accessed by clicking on the btn:[Data sources] button in the top right corner of the <<report-builder,report builder>>.

When defining data sources on specific report blocks, only the items inside the given report block are able to access the data provided by the data source.
Such a data source should be used when you wish to additionally transform some pre-computed dat provided by report-level data sources.
Block-level data sources can be accessed by clicking on the "edit" icon of a certain block and navigating to the "data sources" section.

=== Load

The load data source allows you to access resources directly from {PRODUCT_NAME} such as your CRM leads.
Resources can be pre-filtered and presorted, which allows you to show data based on a specific characteristic such as a time span.

The source defines which {PRODUCT_NAME} resource provides data; for example "compose records".

.The example shows a load data source configuration.
image::reporter/load.png[role="data-zoomable"]

.Compose record source configuration options:
[cols="1s,5a"]
|===
| [#ds-load-records-namespace]#<<ds-load-records-namespace,Namespace>>#
|
The namespace defines what {APP_NAME_COMPOSE} namespace is accessed; for example "CRM" or "Case Management".

| [#ds-load-records-module]#<<ds-load-records-module,Module>>#
|
The module defines what module is accessed; for example "lead" or "contact".

| [#ds-load-records-prefilter]#<<ds-load-records-prefilter,Pre-filter>>#
|
The pre-filter defines what filtering should be applied to the accessed data before the data source returns the data.
Pre-filtering allows you to show data based on the specified characteristic, such as the current quarter or leads with a specific status.

Refer to xref:reporting/prefilter.adoc[prefiltering] for more details.

| [#ds-load-records-presort]#<<ds-load-records-presort,Pre-sort order>>#
|
The pre-sort defines how the resulting data should be sorted before the data source returns it.
This allows you to define some initial order, such as newer leads first, or the oldest clients first.

Refer to xref:reporting/presort.adoc[presorting] for more details.

|===

[#datasource-group]
=== Group

The group data source allows you to aggregate and transform data provided by another data source, such as computing the total cost of lead acquisitions or counting the number of jobs that a client requested.

The source defines what data source is to be aggregated and it must be one of the predefined data sources such as a load or another group.

.The example shows a group data source configuration.
image:reporter/group.png[]

.Group data source configuration options:
[cols="1s,5a"]
|===
| [#ds-group-group-by]#<<ds-group-group-by,Group by>>#
|
The group by section defines the columns that denote groups.
To exemplify; defining an expression of `AccountSource` for the accounts CRM module groups the records based on the account source.

The group column must define a name and an optional label and can be referenced by further data sources.

Refer to the xref:reporting/expr-reference.adoc[expression reference] for more details.

[IMPORTANT]
====
A group must define at least 1 group column.
====

| [#ds-group-aggregate]#<<ds-group-aggregate,Aggregate>>#
|
The aggregate section allows you to define how the computed columns are be evaluated.
To exemplify; defining an expression of `count()` returns the number of rows for each group.

The aggregated column must define a name and an optional label and can be referenced by further data sources.

Refer to the xref:reporting/expr-reference.adoc[expression reference] for more details.

[NOTE]
====
*DevNote* reference to more examples.
====

|===

[#datasource-join]
=== Join

The join data source allows you to join two data sources based on a common value, such as a reference using `Record` module fields or a common status column.

[CAUTION]
====
The current versions do not allow you to use the join data source as an input to other data sources.
====

[CAUTION]
====
Any row from the primary source which does not have a related secondary source is omitted from the result.
Anti-joins are not supported.
====

.The example shows a join data source configuration.
image:reporter/join.png[]

.Join data source configuration options:
[cols="1s,5a"]
|===
| [#ds-join-primary-source]#<<ds-join-primary-source,Primary source>>#
|
The primary source defines the base data source involved with the joining, such as the account of the account-contact relationship.

| [#ds-join-primary-column]#<<ds-join-primary-column,Primary column>>#
|
The primary column defines what column from the <<ds-join-primary-source,primary source>> should be used when determining whether the two rows are connected.

| [#ds-join-secondary-source]#<<ds-join-secondary-source,Secondary source>>#
|
The secondary source defines the data source which we are want to join to the primary source, such as the contact of the account-contact relationship.

| [#ds-join-secondary-column]#<<ds-join-secondary-column,secondary column>>#
|
The secondary column defines what column from the <<ds-join-secondary-source,secondary source>> should be used when determining whether the two rows are connected.

|===

== Display Elements

Display elements allow you to access and display the data provided by a xref:reporting/index.adoc#datasources[data source].
Display elements can only exist inside a block.
A single block may define multiple display elements.

[TIP]
====
You can use a <<el-table,table>> and a <<el-chart,chart>> side-by-side to show what data was used to generate the visualization.
====

Most display elements may define additional xref:reporting/prefilter.adoc[pre-filtering] and xref:reporting/presort.adoc[pre-sorting].

[#el-text]
=== Text

The text display element allows you to provide arbitrary content which can be used along side other display elements, providing additional context to the data.

The display element supports rich text using a https://en.wikipedia.org/wiki/WYSIWYG[WYSIWYG] editor.

.The example shows a configured text display element.
image:reporter/text-configuration.png[]

.The example shows a text display element describing the chart display element.
image:reporter/text-usage-1.png[]

=== Metric

The metric display element allows you to display a calculated numerical value from the provided data source.

The calculated value is usually an indicator important to your process, such as the total finances in your sales pipeline, or the current number of open accounts.

.The example shows a configured metric display element.
image:reporter/metric-configuration.png[]

.Metric display element configuration options:
[cols="1s,5a"]
|===
| [#el-metric-label]#<<el-metric-label,Label>>#
|
The label column defines what column from the data source is used when displaying the metric.
The column must be a numerical value.

| [#el-metric-format]#<<el-metric-format,Format>>#
|
Defines the formatting string that is used when displaying the metric.
The field supports all of the https://numeraljs.com/#format[numeral.js] formatting options.

The format is applied before the prefix and suffix.

| [#el-metric-pfx]#<<el-metric-pfx,Prefix>>#
|
Defines the prefix that is pre-pended to the resulting metric before it is shown in the page block.
For example, the prefix of `$` and the value of `1000` would result in the label of `$1000`.

| [#el-metric-sfx]#<<el-metric-sfx,Suffix>>#
|
Defines the suffix that is appended to the resulting metric before it is shown in the page block.
For example, the suffix of `USD/h` and the value of `1000` would result in the label of `1000USD/h`.

| [#el-metric-color]#<<el-metric-color,Text color>>#
|
Defines the text color of the displayed label.

| [#el-metric-background]#<<el-metric-background,Background color>>#
|
Defines the background color of the displayed label.

|===

=== Table

The table display element allows you to display the data source inside a table.

[NOTE]
====
If you are working with a xref:reporting/index.adoc#datasource-join[joined data source], you have to pick the columns for each joined data source.
====

.The example shows a configured table display element.
image:reporter/table-configuration.png[]

.Table display element configuration options:
[cols="1s,5a"]
|===
| [#el-table-columns]#<<el-table-columns,Columns>>#
|
Defines what columns from the data source should be used and also defines their order.

| [#el-table-variant]#<<el-table-variant,Table variant>>#
|
Defines the variant of the table to use.

.The available variants:
* None
* Secondary
* Info
* Danger
* Warning
* Success
* Light
* Dark

| [#el-table-head-variant]#<<el-table-head-variant,Head variant>>#
|
Defines the head variant to use.

.The available variants:
* None
* Light
* Dark

| [#el-table-table-options]#<<el-table-table-options,Table options>>#
|
The section allows you to fine-tune how the table should look like; such as using a dark or light theme, removing borders, and being responsive.

|===

=== Chart

The chart display element allows you to visualize the data source using a chart.

[NOTE]
====
If you are working with a xref:reporting/index.adoc#datasource-join[joined data source], you have to pick the columns for each joined data source.
====

.Currently supported chart types:
* Bar
* Line
* Pie
* Doughnut
* Funnel

[IMPORTANT]
====
Funnel charts are only supported when showing the xref:reporting/index.adoc#datasource-group[group data source].
====

.The example shows a configured chart display element.
image:reporter/chart-configuration.png[]

.Chart display element configuration options:
[cols="1s,5a"]
|===
| [#el-chart-type]#<<el-chart-type,Type>>#
|
Defines what chart from the supported list of charts should be used.

| [#el-chart-scheme]#<<el-chart-scheme,Color scheme>>#
|
The color scheme defines what colors your chart should use when visualizing the data.

Keep in mind that each color scheme defines a limited number of colors so your choice needs to be based on the data you're trying to show.

Bar and line charts use a different colour for each column, while the other charts use a different color for each value.

| [#el-chart-label]#<<el-chart-label,Label column>>#
|
The label column defines what values from the data source are used as the label for each data point of the chart (the legend)..

Only text columns may be selected as a label column.

| [#el-chart-data]#<<el-chart-data,Data column>>#
|
The data columns define what values from the data source is used as the data points of the chart.

Only numeric columns may be selected as a data column.

|===


# src/modules/integrator-guide/pages/reporting/prefilter.adoc

include::ROOT:partial$variables.adoc[]

= Pre-filters

A pre-filter allows you to define the initial filtering that should be applied to the data-source before returning any data.

The pre-filter can either be provided as a configuration using the <<default,default mode>> or as an expression using the <<expression, expression mode>>.

The mode can be controlled with the "filter" icon next to the expression.


[#default]
== Default Mode

The default mode allows you to pass in the pre-filter as a configuration.

.The screenshot illustrates the pre-filter user interface with the default mode enabled.
image::reporter/prefilter-default.png[]

The first input defines what column should be involved with filtering.

The second input defines the comparator operator to use.

[IMPORTANT]
====
Different column types may define different comparator operators.
====

The third input defines the value that should be checked against the column using the specified comparator operator.

[#expression]
== Expression Mode

The expression mode allows you to pass in the pre-filter as an expression, allowing you to cover more complex cases.

.The screenshot illustrates the pre-filter user interface with the expression mode enabled.
image:reporter/prefilter-expression.png[]

Refer to the xref:reporting/expr-reference.adoc[expression reference] for more detail on writing expressions.

An example expression to return rows where the column `Foo` is greater or equal to `10`: `Foo >= 10`

An example expression to return rows where the column `Foo` is equal to the string `Foo = 'Bar'`


# src/modules/integrator-guide/pages/reporting/presort.adoc

include::ROOT:partial$variables.adoc[]

= Presort

A presort allows you to define the default sort that the data-source should apply to the output data.

.The screenshot illustrates the presort user interface.
image::reporter/presort.png[]

The first input defines the column to use in the sort expression.

The second input defines the sort direction; either ascending (older first) or descending (newer first).

When defining multiple sort expressions, the rows are firstly sorted by the first expression and only the rows that have the same value for the given column are sorted based on the next expression.


# src/modules/integrator-guide/pages/security-model/examples/examples-contextual.adoc

include::ROOT:partial$variables.adoc[]

= Contextual Role Expression Examples
:page-noindex: true

[cols="2s,5a"]
|===
| Resource owner
|
Assign this role when the current user is the resource owner.

[source]
----
subjectID == ownerID
----

| Resource owner but not the creator
|
Assign this role when the current user is the resource owner but not the original creator.

[source]
----
subjectID == ownerID && subjectID != creatorID
----

| Mentioned in the multi-value module field
|
Assign this role when the current user is mentioned in the `editor` multi-value field of the given record.

[source]
----
has(record.values.editor, subjectID)
----

| Record owner with a specific record state
|
Assign this role when the current user is the record owner and the value of the `published` field is false.

[source]
----
subjectID == ownerID && !record.values.published
----

|===


# src/modules/integrator-guide/pages/security-model/examples/index.adoc

= Examples
:keywords: security model, examples, security model configuration
:description: Learn from example on how to configure your security model

:leveloffset: +1

include::examples-contextual.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/security-model/index.adoc

include::ROOT:partial$variables.adoc[]

= The Security Model
:page-aliases: 2024.9@administrator-guide:access-control/index.adoc
:keywords: security model, access control
:description: Learn how to configure your security model to conform to your business requirements

{PRODUCT_NAME} defines a https://en.wikipedia.org/wiki/Role-based_access_control[RBAC] access control facility.
RBAC uses the <<glossary-role,*roles*>> of the given <<glossary-user,*user*>> to determine whether they have access to a given <<glossary-resource,*resource*>>.

[NOTE]
====
Most of the {PRODUCT_NAME} resources allow you to define which xref:security-model/roles.adoc[roles] are allowed to access the resource.
Locate the btn:[permissions] button in the user interface in order to manage the resource.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/general-permissions-button.png",
    "alias": "security-model-general-permissions-button",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "h": 550,
    "w": 1600
  },
  "focus": {
    "x": 1466,
    "y": 80,
    "h": 31,
    "w": 206
  },
  "annotations": [{
    "kind": "box",
    "x": 1536,
    "y": 80,
    "w": 134,
    "h": 30
  }]
}
----

Refer to xref:security-model/references/operations.adoc[] for the complete reference of available RBAC rules.
====

{PRODUCT_NAME}'s RBAC facility uses a "flat design" which removes role hierarchy (two roles can not explicitly define a parent/child relationship).

<<role-type-ctx,*Context role membership*>> allows you to dynamically assign users to roles based on the defined set of rules.

[IMPORTANT]
====
While access control for specific records is supported, access control for particular fields of particular records is not.

You can bypass this limitation by using <<role-type-ctx,context role membership>> and module filed rules.
====

== Access Evaluation Flow

When access is evaluated, the system collects all users' roles and RBAC rules as a part of the security context.
The order of rule evaluation is based on <<ac-role-importance,*role importance*>> and <<ac-resource-specificity,*resource specificity*>>.

[CAUTION]
====
If a user is a member of a bypass role, *all operations are permitted* without any restrictions.
====

.Access evaluation flow:
. If any rule defines an explicit *deny*, the evaluation results with *deny*.
. If at least one rule defines an explicit *allow*, the evaluation results with *allow*.
. If there are no explicit allow or deny rules on the current level, the evaluation continues to the next set of rules based on role importance.
. If the evaluation cannot find an explicit allow or deny rules, the evaluation results with *deny*.

[#ac-role-importance]
=== Role Importance

Role importance defines the order in which roles and their corresponding rules are evaluated.

.Role importance for authenticated users:
. bypass roles,
. context roles,
. common roles,
. authenticated roles.

.Role importance for unauthenticated users:
. anonymous roles.

[#ac-resource-specificity]
=== Resource Specificity

Resource specificity defines the order in which rules for the corresponding resources are evaluated.
Resource specificity is defined based on _how specific  this rule is to this resource_.

As an example, a rule that allows users to create records on the account module in the CRM namespace is more specific than the rule just on the CRM namespace.

[TIP]
====
Such specificity allows you to deny access to all but one resource of the given type.
To exemplify; you could deny access to all namespaces and allow access to just one namespace.
====

== Role Types

[NOTE]
====
A list of bypass, authenticated, and anonymous roles is provided in the system configuration and can not be changed at runtime.
Refer to xref:devops-guide:access-control/index.adoc[DevOps guide] for details on how this can be done.

These roles can not be modified or renamed.

.If you wish to alter the roles, you can either:
* temporarily change the role list, edit the roles, revert the role list changes,
* change the provision scripts to supply the required names at the initial {PRODUCT_NAME} run.
====

[#role-type-bypass]
=== Bypass

Bypass roles allow their members unlimited access to {PRODUCT_NAME} with no permission checking.

Out of the box, {PRODUCT_NAME} defines the default bypass role named "Super administrator".
Your system administrator can xref:devops-guide:access-control/index.adoc[change the set of bypass roles] in the `.env` file.
The roles that are defined as authenticated have restricted editing options.

[#role-type-common]
=== Common Roles

Common roles are any additional roles defined in the administration panel, such as a CRM admin and application builder.

[#role-type-ctx]
=== Contextual Roles

[NOTE]
====
You can not use contextual roles within auth clients, nor can they define an explicit member list.
Contextual roles are assigned to users based on the operation and the context.
====

Contextual roles define a series of xref:integrator-guide:/expr/index.adoc[*expressions*], which determine when the role is assigned to the user based on the operations' context.

Each role can define an expression for each resource type.
Each role can only use a resource type once.

[IMPORTANT]
====
Contextual roles are hidden from resource permission screens if the role does not define an expression for that resource.
For example, a record specific role is not shown on the module permission screen.
====

For example, a certain case of use would allow us to use contextual roles to permit resources owners to perform operations they normally wouldn't have, such as editing and deleting said resources.

Refer to the xref:security-model/references/contextual-role-parameters.adoc[] for details.

.Contextual roles are currently supported for:
* records,
* workflows,
* auth clients.

[#role-type-authenticated]
=== Authenticated

Authenticated roles are *implicit*, meaning that users can not explicitly be set as role members.

Out of the box, {PRODUCT_NAME} defines the default authenticated role named "Authenticated".
Your system administrator can xref:devops-guide:access-control/index.adoc[change the set of authenticated roles] in the `.env` file.
The roles that are defined as authenticated have restricted editing options.

If the user is authenticated with {PRODUCT_NAME} when they are accessing a resource, the system additionally assigns them authenticated roles.

[#role-type-anonymous]
=== Anonymous

Anonymous roles are *implicit*, meaning that users can not explicitly be set as role members.

Out of the box, {PRODUCT_NAME} defines the default anonymous role named "Anonymous".
Your system administrator can xref:devops-guide:access-control/index.adoc[change the set of anonymous roles] in the `.env` file.
The roles that are defined as anonymous have restricted editing options.

If the user is *not* authenticated with {PRODUCT_NAME} when they are accessing a resource, the system additionally assigns them anonymous roles.

== Important Notes

=== System Setup

{PRODUCT_NAME} defines a series of system role types: bypass, authenticated, and anonymous.
System role types are defined on the server configuration level, and *cannot* be changed directly through the user interface.

If a role is assigned to one of the system role types, the editing is restricted.
If the role is somehow removed or changed to the extent where the system can not identify it, the system should refuse to start.

.The rationale behind such restrictions:
* The configuration affects the RBAC facility and its setup process.
* Systems that work with access tokens need to be aware of such changes.
* The security model on this level rarely changes, and the change is drastic when it does.

=== Bypass RBAC Roles

If a role is assigned as a bypass, it may *not* appear as any other role type.
In the occasion where this is not the case, the system will refuse to start.

[IMPORTANT]
====
Only members of the bypass role may manage the membership of the bypass role.
====

Bypass roles can be listed on auth clients as permitted or prohibited roles but are *silently ignored* when defined under forced roles.

=== Authenticated and Anonymous

Authenticated and anonymous roles may not appear in any auth client security role lists (the allowed, denied, and forced roles) and are silently ignored.

== Glossary

[cols="1s,5a"]
|===
| [#glossary-user]#<<glossary-user,A user>>#
|
A user is an entity that is accessing {PRODUCT_NAME}.
A user can be a member of security roles and cannot get permissions directly without an assigned role.

| [#glossary-role]#<<glossary-role,A role>>#
|
A role represents a set of users and a set of permissions over resources.

{PRODUCT_NAME}'s RBAC implementation defines a flat structure that removes role hierarchy (two roles can not explicitly specify a parent/child relationship).

| [#glossary-access]#<<glossary-access,Access>>#
|
Defines if the rule permits (`allow`) or denies (`deny`).

| [#glossary-resource]#<<glossary-resource,A resource>>#
|
A structured piece of information stored within {PRODUCT_NAME} that we may or may not control access to.
Each resource belongs to a component and has a unique type.

| [#glossary-resource-type]#<<glossary-resource-type,A resource type>>#
|
A resource type defines the structure of information within the {PRODUCT_NAME} component.

| [#glossary-operation]#<<glossary-operation,Operation>>#
|
Defines what operation the given RBAC rule defines access to.

| [#glossary-rbac-rule]#<<glossary-rbac-rule,RBAC rule>>#
|
A RBAC rule combines *operation*, *role*, *access*, and *resource*.
It defines what someone can (or can not) do on one or more resources inside {PRODUCT_NAME}.

| [#glossary-security-session]#<<glossary-security-session,Security session>>#
|
A security session is created when a user requests to access {PRODUCT_NAME}.

|===


# src/modules/integrator-guide/pages/security-model/permissions-evaluation.adoc

include::ROOT:partial$variables.adoc[]

= Permission Evaluation

The permission evaluation feature allows administrators to check which actions or operations can be performed by a user or a combination of roles.
The evaluation entails comparing the different roles assigned to a user to determine the user's ability to perform the various operations within a resource.

[NOTE]
====
{PRODUCT_NAME} RBAC uses the roles of the given user to determine if they have access to a given resource.
====

== How to evaluate applied permissions

[NOTE]
====
Most of the {PRODUCT_NAME} resources allow you to define which xref:security-model/roles.adoc[roles] are allowed to access the resource.
Locate the btn:[permissions] button in the user interface in order to manage the resource.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/general-permissions-button.png",
    "alias": "general-permissions-button",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 320,
    "y": 0,
    "h": 550,
    "w": 1600
  },
  "focus": {
    "x": 1466,
    "y": 80,
    "h": 31,
    "w": 206
  },
  "annotations": [{
    "kind": "box",
    "x": 1539,
    "y": 80,
    "w": 130,
    "h": 30
  }]
}
----
====

Navigate to the desired resource, and click the btn:[permissions].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/permission-button-page.png",
    "alias": "new-user",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1539,
    "y": 80,
    "w": 131,
    "h": 31
  }]
}
----

Click the btn:[add +] button.
A popup window with two dropdown options displays, the btn:[select role(s)] and btn:[search or select user].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/add-role.png",
    "alias": "add-role",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 762,
    "y": 145,
    "w": 758,
    "h": 97
}]
}
----

Click on the btn:[select roles] or the btn:[select user] dropdown and select a role or a user to evaluate.
Only one of two options can be applied.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/eval-permission.png",
    "alias": "eval-permission.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 585,
    "y": 254,
    "w": 783,
    "h": 410
  },
  "annotations": [{
    "kind": "box",
    "x": 603,
    "y": 353,
    "w": 751,
    "h": 217
  }]
}
----

Click on the btn:[save] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/save-evaluation-permission.png",
    "alias": "save-evaluation-permission",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 585,
    "y": 254,
    "w": 783,
    "h": 410
  },
  "annotations": [{
    "kind": "box",
    "x": 1148,
    "y": 615,
    "w": 200,
    "h": 43
  }]
}
----

If you chose role evaluation, repeat the step again, choosing a different role in order to evaluate the permissions applied to the different roles.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/save-evaluation.png",
    "alias": "save-evaluation",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": []
}
----

== Permission Evaluation on Components 

{PRODUCT_NAME} has three key resource components, namely:
*System*, *Compose* and *Automation*.
Each resource component has operations that are performed in it.

[IMPORTANT]
====
Permissions to the various operations within a component resource are subject to the roles assigned to a user.
====

Permissions can be evaluated by selecting a combination of roles or a particular user.

Follow these steps to access and evaluate the system, compose and automation permissions.

Navigate to your {PRODUCT_NAME} instance (such as {LOCAL_HOSTNAME}) and click the btn:[Admin area] application.

A new screen showing you all of the available components will appear. 
Each component has a btn:[permissions] button.

Click on the btn:[permissions] button on either system, compose or the automation component.
A new screen appears that displays a list of all the available operations within a component.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/system-permissions-button.png",
    "alias": "system-permissions-button.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 14,
    "y": 480,
    "w": 170,
    "h": 32
}]
}
----

Click on the btn:[add +] button.
A popup window appears with two dropdown options.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/system-permissions-add-button.png",
    "alias": "system-permissions-add-button.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  
  "annotations": [{
    "kind": "box",
    "x": 633,
    "y": 152,
    "w": 1265,
    "h": 129
}]
}
----

Click on the btn:[evaluate] button and then click on the btn:[select roles] or the btn:[select user] dropdown and select a role or a user to evaluate.
Only one of two options can be applied.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/evaluate-permissions.png",
    "alias": "user-create",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 772,
    "y": 510,
    "w": 376,
    "h": 121
  }]
}
----

Click on the btn:[save] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/save-eval-permission.png",
    "alias": "save-eval-permission-button",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "focus": {
    "padding": "xs",
    "x": 585,
    "y": 254,
    "w": 783,
    "h": 430
  },
  "annotations": [{
    "kind": "box",
    "x": 1148,
    "y": 615,
    "w": 200,
    "h": 42
  }]
}
----

If you chose role evaluation, repeat the step again, choosing a different role in order to evaluate the permissions applied to the different roles.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/access-control/system-evaluated-permissions.png",
    "alias": "system-evaluated-permissions.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  
  "annotations": []
}
----


# src/modules/integrator-guide/pages/security-model/references/contextual-role-parameters.adoc

include::ROOT:partial$variables.adoc[]

= Contextual Role Evaluation
:keywords: security model, contextual role, contextual role configuration
:description: Learn how to define contextual roles for specific resources

Refer to xref:integrator-guide:/expr/index.adoc[] for details on writing context role expressions.

If the expression returns `true`, the contextual role is applied.

.Common variables:
[cols="1s,5a"]
|===
| [#ctx-eval-var-general-userID]#<<ctx-eval-var-general-userID,userID>>#
|
The ID of the current user.

|===

== Records

.Records variables:
[cols="1s,5a"]
|===
| [#ctx-eval-var-record-ID]#<<ctx-eval-var-record-ID,resource.ID>>#
|
The ID of the resource.

| [#ctx-eval-var-record-recordID]#<<ctx-eval-var-record-recordID,resource.recordID>>#
|
The ID of the resource; same as <<ctx-eval-var-record-ID,resource.ID>>.

| [#ctx-eval-var-record-moduleID]#<<ctx-eval-var-record-moduleID,resource.moduleID>>#
|
The ID of the related module.

| [#ctx-eval-var-record-labels]#<<ctx-eval-var-record-labels,resource.labels>>#
|
The key-value pair of labels associated with this resource.

| [#ctx-eval-var-record-namespaceID]#<<ctx-eval-var-record-namespaceID,resource.namespaceID>>#
|
The ID of the related namespace.

| [#ctx-eval-var-record-ownedBy]#<<ctx-eval-var-record-ownedBy,resource.ownedBy>>#
|
The userID of the resource owner.

| [#ctx-eval-var-record-createdAt]#<<ctx-eval-var-record-createdAt,resource.createdAt>>#
|
The timestamp of when the resource was created.

| [#ctx-eval-var-record-createdBy]#<<ctx-eval-var-record-createdBy,resource.createdBy>>#
|
The userID of the user that created the resource.

| [#ctx-eval-var-record-updatedAt]#<<ctx-eval-var-record-updatedAt,resource.updatedAt>>#
|
The timestamp of when the resource was last updated.
The parameter is not defined if the resource has not yet been updated.

| [#ctx-eval-var-record-updatedBy]#<<ctx-eval-var-record-updatedBy,resource.updatedBy>>#
|
The userID of the user that last updated the resource.
The parameter will be `0` if the resource has not yet been updated.

| [#ctx-eval-var-record-deletedAt]#<<ctx-eval-var-record-deletedAt,resource.deletedAt>>#
|
The timestamp of when the resource was deleted.
The parameter is not defined if the resource has not been deleted.

| [#ctx-eval-var-record-deletedBy]#<<ctx-eval-var-record-deletedBy,resource.deletedBy>>#
|
The userID of the user that deleted the resource.
The parameter will be `0` if the resource has not been updated.

| [#ctx-eval-var-record-values]#<<ctx-eval-var-record-values,resource.values>>#
|
A set of key-value pairs for the record values defined by the module fields.

[NOTE]
====
If a module field is a multi-value, the corresponding key-value entry will be an array.
====

|===

== Workflows

.Workflows variables:
[cols="1s,5a"]
|===
| [#ctx-eval-var-workflow-ID]#<<ctx-eval-var-workflow-ID,resource.ID>>#
|
The ID of the resource.

| [#ctx-eval-var-workflow-workflowID]#<<ctx-eval-var-workflow-workflowID,resource.workflowID>>#
|
The ID of the resource; same as <<ctx-eval-var-workflow-ID,resource.ID>>.

| [#ctx-eval-var-workflow-labels]#<<ctx-eval-var-workflow-labels,resource.labels>>#
|
The key-value pair of labels associated with this resource.

| [#ctx-eval-var-workflow-ownedBy]#<<ctx-eval-var-workflow-ownedBy,resource.ownedBy>>#
|
The userID of the resource owner.

| [#ctx-eval-var-workflow-createdAt]#<<ctx-eval-var-workflow-createdAt,resource.createdAt>>#
|
The timestamp of when the resource was created.

| [#ctx-eval-var-workflow-createdBy]#<<ctx-eval-var-workflow-createdBy,resource.createdBy>>#
|
The userID of the user that created the resource.

| [#ctx-eval-var-workflow-updatedAt]#<<ctx-eval-var-workflow-updatedAt,resource.updatedAt>>#
|
The timestamp of when the resource was last updated.
The parameter is not defined if the resource has not yet been updated.

| [#ctx-eval-var-workflow-updatedBy]#<<ctx-eval-var-workflow-updatedBy,resource.updatedBy>>#
|
The userID of the user that last updated the resource.
The parameter will be `0` if the resource has not yet been updated.

| [#ctx-eval-var-workflow-deletedAt]#<<ctx-eval-var-workflow-deletedAt,resource.deletedAt>>#
|
The timestamp of when the resource was deleted.
The parameter is not defined if the resource has not been deleted.

| [#ctx-eval-var-workflow-deletedBy]#<<ctx-eval-var-workflow-deletedBy,resource.deletedBy>>#
|
The userID of the user that deleted the resource.
The parameter will be `0` if the resource has not been updated.

|===

== Auth clients

.Auth clients variables:
[cols="1s,5a"]
|===
| [#ctx-eval-var-auth-client-ID]#<<ctx-eval-var-auth-client-ID,resource.ID>>#
|
The ID of the resource.

| [#ctx-eval-var-auth-client-labels]#<<ctx-eval-var-auth-client-labels,resource.labels>>#
|
The key-value pair of labels associated with this resource.

| [#ctx-eval-var-auth-client-scope]#<<ctx-eval-var-auth-client-scope,resource.scope>>#
|
The scope defined by the auth client.

| [#ctx-eval-var-auth-client-validGrant]#<<ctx-eval-var-auth-client-validGrant,resource.validGrant>>#
|
The grant that is supported by the auth client.

| [#ctx-eval-var-auth-client-redirectURI]#<<ctx-eval-var-auth-client-redirectURI,resource.redirectURI>>#
|
The redirect URI for the auth client.

| [#ctx-eval-var-auth-client-trusted]#<<ctx-eval-var-auth-client-trusted,resource.trusted>>#
|
The trust setting of the auth client.

| [#ctx-eval-var-auth-client-enabled]#<<ctx-eval-var-auth-client-enabled,resource.enabled>>#
|
The enabled setting for the auth client.

| [#ctx-eval-var-auth-client-validFrom]#<<ctx-eval-var-auth-client-validFrom,resource.validFrom>>#
|
The timestamp denoting when the auth client is valid from.

| [#ctx-eval-var-auth-client-expiresAt]#<<ctx-eval-var-auth-client-expiresAt,resource.expiresAt>>#
|
The timestamp denoting when the auth client is no longer valid.

| [#ctx-eval-var-auth-client-ownedBy]#<<ctx-eval-var-auth-client-ownedBy,resource.ownedBy>>#
|
The userID of the resource owner.

| [#ctx-eval-var-auth-client-createdAt]#<<ctx-eval-var-auth-client-createdAt,resource.createdAt>>#
|
The timestamp of when the resource was created.

| [#ctx-eval-var-auth-client-createdBy]#<<ctx-eval-var-auth-client-createdBy,resource.createdBy>>#
|
The userID of the user that created the resource.

| [#ctx-eval-var-auth-client-updatedAt]#<<ctx-eval-var-auth-client-updatedAt,resource.updatedAt>>#
|
The timestamp of when the resource was last updated.
The parameter is not defined if the resource has not yet been updated.

| [#ctx-eval-var-auth-client-updatedBy]#<<ctx-eval-var-auth-client-updatedBy,resource.updatedBy>>#
|
The userID of the user that last updated the resource.
The parameter will be `0` if the resource has not yet been updated.

| [#ctx-eval-var-auth-client-deletedAt]#<<ctx-eval-var-auth-client-deletedAt,resource.deletedAt>>#
|
The timestamp of when the resource was deleted.
The parameter is not defined if the resource has not been deleted.

| [#ctx-eval-var-auth-client-deletedBy]#<<ctx-eval-var-auth-client-deletedBy,resource.deletedBy>>#
|
The userID of the user that deleted the resource.
The parameter will be `0` if the resource has not been updated.

|===

# src/modules/integrator-guide/pages/security-model/references/operations.adoc

= Resource Operation Reference

:leveloffset: +1

include::generated:partial$access-control/system/index.gen.adoc[]

include::generated:partial$access-control/compose/index.gen.adoc[]

include::generated:partial$access-control/federation/index.gen.adoc[]

include::generated:partial$access-control/automation/index.gen.adoc[]

:leveloffset: -1


# src/modules/integrator-guide/pages/security-model/roles.adoc

include::ROOT:partial$variables.adoc[]

= Role Management
:page-aliases: 2024.9@administrator-guide:roles.adoc
:keywords: security model, roles, role management
:description: Learn how to create and manage the roles your users can be part of


A role is a security group which may or may not have access to specific user interfaces or system resources based on your xref:security-model/index.adoc[security model].

A role can have a series of xref:security-model/users.adoc[users] who are provided with the security model defined by the given role.

== The User Interface

The role management user interface resides in the xref:index.adoc#webapp-admin[{PRODUCT_NAME} {APP_NAME_ADMIN}] web application, under menu:system[roles].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/list.png",
    "alias": "security-model-roles-list-index",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 180,
    "w": 288,
    "h": 37
  }]
}
----

== Tips and Tricks

=== Modular Design

[NOTE]
====
*DevNote* @todo
====

== Listing Roles

.To list current system roles:
. Navigate to menu:system[roles],
. optionally insert the filtering parameters.
. The list refreshes automatically.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/list.png",
    "alias": "security-model-roles-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 960
  },
  "annotations": []
}
----

== Creating Roles

[IMPORTANT]
====
You can only define permissions for existing roles.
====

.To create a new role:
. Navigate to menu:system[roles],
. click on the btn:[new] button,
. insert the parameters for the new role,
. press the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/create.png",
    "alias": "security-model-roles-create",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 460
  },
  "annotations": []
}
----

== Editing Roles

.To edit an existing role:
. Navigate to menu:system[roles],
. click on the btn:[edit] button next to the role you wish to edit,
. update the parameters for the updated role,
. press the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/edit.png",
    "alias": "security-model-roles-edit-index",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 660
  },
  "annotations": []
}
----

[#archiving-roles]
== Archiving Roles

.To archive an existing role:
. Navigate to menu:system[roles],
. click on the btn:[edit] button next to the role you wish to archive,
. click and confirm the btn:[archive] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/edit.png",
    "alias": "security-model-roles-edit-archive",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 660
  },
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "y": 499,
    "x": 672,
    "w": 86,
    "h": 32
  }]
}
----

== Deleting Roles

[TIP]
====
Instead of deleting roles, you can <<archiving-roles,archive the role>>.
====

.To delete an existing role:
. Navigate to menu:system[roles],
. click on the btn:[edit] button next to the role you wish to delete,
. click and confirm the btn:[delete] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/edit.png",
    "alias": "security-model-roles-edit-delete",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 660
  },
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "y": 499,
    "x": 586,
    "w": 77,
    "h": 32
  }]
}
----

== Cloning Role Permissions

.To clone the role's permissions to another role:
. Navigate to menu:system[roles],
. click on the btn:[clone permissions] button,
. select the roles you wish to clone the permissions to,
. press the btn:[clone] button.

.The screenshot shows the clone permissions button.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/clone-permissions-button.png",
    "alias": "security-model-roles-clone-permissions-button",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 1498,
    "y": 90,
    "w": 165,
    "h": 35
  }]
}
----

.The screenshot shows clone permissions to dialog, to select roles for cloning permission to.
[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/roles/clone-permissions.png",
    "alias": "security-model-roles-clone-permissions",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "x": 710,
    "y": 410,
    "w": 500,
    "h": 260
  }]
}
----


# src/modules/integrator-guide/pages/security-model/users.adoc

include::ROOT:partial$variables.adoc[]

= User Management
:page-aliases: 2024.9@administrator-guide:users.adoc
:keywords: security model, users, user management
:description: Learn how to create and manage your platform users

A user is an entity which is allowed to interact with your {PRODUCT_NAME} instance.
A user can be an employee who needs to interact with your {PRODUCT_NAME}, or a system user which may be used to identify external integrations or webhook requests.

A user can be assigned to a series of xref:security-model/roles.adoc[roles] which define the scope of the access for the given user.

[IMPORTANT]
====
For privacy reasons, personal information is masked by default.
This can be configured by setting appropriate access control rules for either all users or a specific user.

.To change information masking for all users:
. Click on the btn:[permissions] button in the top right corner,
. select the role you wish to change this for,
. select the appropriate access option for the "show email details for any user" or "show name details for any user".

.To change information masking for specific users:
. Click on the edit icon next to the user you wish to change this for,
. click on the btn:[permissions] button in the top right corner,
. select the role you wish to change this for,
. select the appropriate access option for the "show email details for (name here)" or "show name details for (name here)".
====

== The User Interface

The user management user interface resides in the xref:index.adoc#webapp-admin[{PRODUCT_NAME} {APP_NAME_ADMIN}] web application, under the menu:system[users] section.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-list.png",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 144,
    "w": 288,
    "h": 37
  }]
}
----

== Listing Users

.To list current system users:
. navigate to menu:system[users],
. optionally insert the filtering parameters.
. The list refreshes automatically.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-list.png",
    "alias": "admin-webapp-users-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 460
  },
  "annotations": []
}
----

== Creating Users

[IMPORTANT]
====
Permissions can only be defined for existing users.
====

.To create a new user:
. navigate to menu:system[users],
. click on the btn:[new] button in the top right corner,
. provide the requested data,
. press the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-create.png",
    "alias": "admin-webapp-users-create",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 480
  },
  "annotations": []
}
----

== Editing Users

.To edit an existing user:
. navigate to menu:system[users],
. click on the btn:[edit] icon next to the user you wish to edit,
. update the parameters you wish to change,
. press the btn:[submit] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-edit.png",
    "alias": "admin-webapp-users-edit",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "annotations": []
}
----

[#suspending-users]
== Suspending Users

.To suspend an existing user:
. Navigate to menu:system[users],
. click on the btn:[edit] icon next to the user you wish to suspend,
. press and confirm the btn:[suspend] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-edit.png",
    "alias": "admin-webapp-users-suspend",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 573,
    "y": 130,
    "w": 1093,
    "h": 385
  },
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "x": 669,
    "y": 478,
    "w": 94,
    "h": 32
  }]
}
----

== Deleting Users

[TIP]
====
Instead of deleting users, you can temporarily <<suspending-users,suspend them>>.
====

.To delete an existing user:
. navigate to menu:system[users],
. click on the btn:[edit] icon next to the user you wish to suspend,
. press and confirm the btn:[delete] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-edit.png",
    "alias": "admin-webapp-users-delete",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 573,
    "y": 130,
    "w": 1093,
    "h": 385
  },
  "annotations": [{
    "kind": "box",
    "padding": "sm",
    "x": 586,
    "y": 478,
    "w": 77,
    "h": 32
  }]
}
----

== Assigning Roles

[CAUTION]
====
In order for the role membership to reflect on the user, they need to re-login.
====

.To assign a role to an existing user:
. navigate to menu:system[users],
. click on the btn:[edit] icon next to the user you wish to edit,
. navigate to the "role membership" section and assign appropriate roles,
. press the btn:[submit] button.

[NOTE]
====
Refer to xref:security-model/index.adoc[the security model] for more information regarding roles and access control.
====

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "security-model/user-edit.png",
    "alias": "admin-webapp-users-assign",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1080
  },
  "focus": {
    "x": 586,
    "y": 557,
    "w": 1069,
    "h": 195
  },
  "annotations": []
}
----


# src/modules/integrator-guide/pages/server-plugins/index.adoc

include::ROOT:partial$variables.adoc[]

= Server plugins

[IMPORTANT]
====
*Deprecation warning:* Plugin support has been deprecated in {PRODUCT_NAME} _2022.9_.
This section of documentation will be removed in {PRODUCT_NAME} _2023.3_.
====


# src/modules/integrator-guide/pages/templates/index.adoc

include::ROOT:partial$variables.adoc[]

= Templates
:description: Templates allow you to define the generic document structure (such as a welcome email message or a quote PDF), which is then converted into an actual document based on the provided data.

Templates allow you to define the generic document structure (such as a welcome email message or a quote PDF), which is then converted into an actual document based on the provided data.

If you wish to learn more about a specific topic, refer to the subsections under menu:Low-Code Platform Developer Guide[Templates].

== Creating a Template

Templates are created and managed in the {PRODUCT_NAME} {APP_NAME_ADMIN}.

Navigate to the menu:System[Templates] and click on the btn:[New] button in the top-right corner.

Enter the basic information; short name, handle, description, and template type.
The template type determines the template format and implicitly entails what document types the template can render to.

A partial template is used as part of another template (for example, a generic header or a footer) and can not be rendered independently.
You can convert the template from and to a partial template.

Click on the btn:[Submit] button to prepare your template.

After you submit the base parameters, three new sections will appear.

[cols="1s,5a"]
|===

| [#templates-toolbox]#<<templates-toolbox,Toolbox>>#
|
The toolbox provides snippets for the most common operations, HTML template sample, and partial inclusion samples.

| [#templates-content]#<<templates-content,Template content>>#
|
The template content editor provides a simple code editor to edit your template.
The HTML template editor implements syntax highlighting and some other useful tools such as auto completion.

| [#templates-preview]#<<templates-preview,Preview>>#
|
The preview section allows you to test how your templates will look when rendered into an actual document.

[IMPORTANT]
====
Refer to the xref:devops-guide:pdf-renderer.adoc[] to configure PDF document rendering.
====

|===

== The Content

[NOTE]
====
Advanced users are welcome to check out the https://golang.org/pkg/text/template/[plain text template full reference], the https://golang.org/pkg/html/template/[html template full reference], and the https://masterminds.github.io/sprig/[extended function docs].
====

Let's start by copying the default HTML sample from the toolbox.

[source,html]
----
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Title</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
  <h1>Hello, world!</h1>
</body>
</html>
----

If you don't need any dynamic content (different name for different contacts), you can stop after this step.
The above template is valid and can already be used.

In case you need dynamic content, more topics need to be covered.

=== Value Interpolation

Value interpolation allows you to define some placeholder that is then replaced with an actual value when the template is rendered.

In this case, this placeholder looks like this:

[source]
----
{{.name}}
----

The value replaces the above placeholder under the `name` property from the provided `value` object.

Let's look at some examples.
Each example first defines the `value` object and then the placeholder.

.Example with a basic property:
[source]
----
{
  "name": "Jane"
}

{{.name}}
----

.Example with a nested property:
[source]
----
{
  "contact": {
    "details": {
      "name": "Jane"
    }
  }
}

{{.contact.details.name}}
----

A complete example would look like this:

.The provided data:
[source,json]
----
{
  "contact": {
    "details": {
      "firstName": "Jane",
      "lastName": "Doe"
    }
  }
}
----

.The template:
[source,html]
----
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Title</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
  <h1>Hello, {{.contact.details.firstName}} {{.contact.details.lastName}}!</h1>
</body>
</html>
----

=== Conditional Rendering

Conditional rendering allows you to show or hide sections of the rendered document based on the input parameters.

.`if` statement:
[source]
----
{{if condition}}
  The condition was true.
{{end}}
----

.`if-else` statement:
[source]
----
{{if condition}}
  The condition was true.
{{else}}
  The condition was false.
{{end}}
----

.`if-else if-else` statement:
[source]
----
{{if condition}}
  The condition was true.
{{else if condition}}
  The other condition was true.
{{else}}
  Neither conditions were true.
{{end}}
----

The `condition` part is an expression that returns a single boolean value.
An example of an expression:

[source]
----
{{if .lead.cost > 1000}}
  The lead {{.lead.name}} was expensive!
{{end}}
----

.Logic operators:
[cols="1s,5a"]
|===

| [#tpl-syntax-and]#<<tpl-syntax-and,AND>>#
|
* *Syntax*: `a && b`
* *Notes*: Results as true if both `a` and `b` evaluate to `true`.

| [#tpl-syntax-or]#<<tpl-syntax-or,OR>>#
|
* *Syntax*: `a \|\| b`
* *Notes*: Results as true if either `a` or `b` evaluates to `true`.

| [#tpl-syntax-not]#<<tpl-syntax-not,NOT>>#
|
* *Syntax*: `!a`
* *Notes*: Results as true if `a` is `false` and vice-versa.

| [#tpl-syntax-eq]#<<tpl-syntax-eq,Equal>>#
|
* *Syntax*: `a == b`
* *Notes*: Results as true if `a` is equal to `b`.

| [#tpl-syntax-neq]#<<tpl-syntax-neq,Not equal>>#
|
* *Syntax*: `a != b`
* *Notes*: Results as true if `a` is not equal to `b`.

| [#tpl-syntax-lt]#<<tpl-syntax-lt,Less than>>#
|
* *Syntax*: `a < b`
* *Notes*: Results as true if `a` is less than `b`.

| [#tpl-syntax-gt]#<<tpl-syntax-gt,Greater than>>#
|
* *Syntax*: `a > b`
* *Notes*: Results as true if `a` is greater than `b`.

| [#tpl-syntax-let]#<<tpl-syntax-let,Less equal than>>#
|
* *Syntax*: `a \<= b`
* *Notes*: Results as true if `a` is less or equal to `b`.

| [#tpl-syntax-get]#<<tpl-syntax-get,Greater equal than>>#
|
* *Syntax*: `a >= b`
* *Notes*: Results as true if `a` is greater or equal to `b`.

|===

=== Handling Lists

Our templates make it quite easy to work with lists.
For example, you would like to generate a quote with lots of line items.

The syntax for iterating over a list looks like this:

[source]
----
{{range .listOfItems}} 
  {{.itemName}}; {{.itemCost}}$
{{end}}
----

If you prefer to specify what variable the current item is stored into, use this syntax:

[source]
----
{{range $index, $item := .ListOfItems}}
  {{$item.itemName}}; {{$item.itemCost}}$
{{end}}
----

=== Using Functions

Sometimes you need to process the data further before it is rendered to the document.

Some lighter processing can be handled directly by the template engine.
More complex processing should be handled by the code that is requesting to render the template.

.A function is called upon as shown below:
[source]
----
{{functionName arg1 arg2 ... argN}}
----

The passed argument can be a constant or a property from the provided data.

You can also chain functions.
When two functions are chained, the left function's output is passed into the argument of the right function.

[source]
----
{{funcA | funcB | ... | funcN}}
----

.Most common function reference:
[cols="1s,5a"]
|===

| [#tpl-syntax-fref-len]#<<tpl-syntax-fref-len,Length of>>#
|
* *Syntax*: `{{len listOfThings}}`
* *Notes*: Returns the number of items in the given `listOfThings`.

| [#tpl-syntax-fref-printf]#<<tpl-syntax-fref-printf,Format string>>#
|
* *Syntax*: `{{printf "pattern goes here" arg1 arg2 ... argn}}`
* *Notes*: Returns the formatted string, following the provided pattern using the values provided as arguments.

| [#tpl-syntax-fref-inlineRemote]#<<tpl-syntax-fref-inlineRemote,Inline remote file>>#
|
* *Syntax*: `{{inlineRemote "url goes here"}}`
* *Notes*: Returns the base64 encoded file denoted by the URL.
The string is formatted in the form of `data:\{mime-type};base64,\{encoded remote file}`.
Useful when attaching images to PDF documents.

| [#tpl-syntax-fref-trim]#<<tpl-syntax-fref-trim,Trim string>>#
|
* *Syntax*: `{{trim "string goes here"}}`
* *Notes*: Removes any spaces from the start/end of the provided string.

| [#tpl-syntax-fref-trimSuffix]#<<tpl-syntax-fref-trimSuffix,Trim suffix from a string>>#
|
* *Syntax*: `{{trimSuffix "suffix to remove here" "string goes here"}}`
* *Notes*: Removes the suffix from the given string.

| [#tpl-syntax-fref-trimPrefix]#<<tpl-syntax-fref-trimPrefix,Trim prefix from a string>>#
|
* *Syntax*: `{{trimPrefix "prefix to remove here" "string goes here"}}`
* *Notes*: Removes the prefix from the given string.

| [#tpl-syntax-fref-upper]#<<tpl-syntax-fref-upper,To uppercase>>#
|
* *Syntax*: `{{upper "string goes here"}}`
* *Notes*: Converts string to upper case.

| [#tpl-syntax-fref-lower]#<<tpl-syntax-fref-lower,To lowercase>>#
|
* *Syntax*: `{{lower "string goes here"}}`
* *Notes*: Converts string to lower case.

|===

=== Using Partials

Partials allow you to keep your documents consistent by using common headers and footers.
Partials can also be useful when displaying {PRODUCT_NAME}'s resources, such as displaying a record in a table.

.Partials are included like shown below:
[source]
----
{{template "partial_handle"}}
----

The `partial_handle` is the handle you used when you defined the partial.
For example:

[source]
----
{{template "email_general_header"}}
----

If your partial needs to access some data that you provided to the current template (the one that uses the partial), you need to provide the second argument to the partial inclusion process.

[source]
----
{{template "email_general_header" .property.to.pass}}
----

See the example below:

[source,json]
----
{
  "contact": {
    "values": {...}
  },
  "account": {
    "values": {...}
  }
}
----

If you want to pass the `contact` to the partial, you should include your partial like shown below:

[source]
----
{{template "partial_handle" .contact}}
----

If you want to pass all of the data to your partial, you should include your partial like shown below:

[source]
----
{{template "partial_handle" .}}
----

You would access the `contact` in your partial like shown below:

[source]
----
{{/* In case of the first example */}}
Hello {{.values.FirstName}}

{{/* In case of the second example */}}
Hello {{.contact.values.LastName}} of the {{.account.values.Name}}
----

// .Another interesting example is a partial that displays a record in a table:
// [source,html]
// ----
// <!-- handle: record_table_generic -->
// <table width="800" cellspacing="0" cellpadding="0" border="0">
//   <thead>
//     <tr>
//       <th>Field</th>
//       <th>Value</th>
//     </tr>
//   </thead>
//   <tbody>
// {{range $key, $value := .values}}
//     <tr>
//       <td>{{ $key }}</td>
// {{if $value }}
//       <td>{{ $value }}</td>
// {{else}}
//       <td>&nbsp;</td>
// {{end}}
//     </tr>
// {{end}}
    
//   </tbody>
// </table>
// ----

// The above example iterates over the `values` of the provided record and displays the key-value pair in the table.
// You would use the `record_table_generic` partial like shown below:

// [source,html]
// ----
// <h2 style="color: #568ba2;text-align: center;">
//   Record as a table example:
// </h2>

// {{template "record_table_generic" .account }}
// ----

// Note the `.account` at the end; it tells the template engine to use the value of the `account` parameter as the base object in the partial.

//Editor's note: what should happen with the // text above? If it should be included  do so.
== The Preview

The preview section at the bottom of the page allows you to check how your documents will look like once the template is rendered.

The input box should contain a valid JSON object (render payload) with two root properties; `variables` and `options`:

[source,json]
----
{
  "variables": {},<1>
  "options": {}<2>
}
----
<1> The `variables` parameter defines what data will be available one the document is rendered.
The structure is not defined.
<2> The `options` parameter defines the rendering options and is currently only available for PDFs.

.An example of the render payload:
[source,json]
----
{
  "variables": {
    "param1": "value1",
    "param2": {
      "nestedParam1": "value2"
    }
  },
  "options": {
    "documentSize": "A4",
    "contentScale": "1",
    "orientation": "portrait",
    "margin": "0.3"
  }
}
----

A

[IMPORTANT]
====
The options marked with #PDF only# can only be used with PDF documents and are ignored elsewhere.
====

.Complete render payload reference:
[cols="1s,5a"]
|===

| [#tpl-render-variables]#<<tpl-render-variables,`variables`>>#
|
* *Type*: `Object<any>`
* *Description*: The variables you wish to apply to the template.
For example, if you wish `\{\{testing}}` to work, you must pass `{"variables": {"testing": "some value"}}`.

| [#tpl-render-options_marginBottom]#<<tpl-render-options_marginBottom,`options.marginBottom`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the bottom of the page.

| [#tpl-render-options_marginLeft]#<<tpl-render-options_marginLeft,`options.marginLeft`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the left side of the page.

| [#tpl-render-options_marginRight]#<<tpl-render-options_marginRight,`options.marginRight`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the right side of the page.

| [#tpl-render-options_marginTop]#<<tpl-render-options_marginTop,`options.marginTop`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the top of the page.

| [#tpl-render-options_marginY]#<<tpl-render-options_marginY,`options.marginY`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the top and bottom of the page.

| [#tpl-render-options_marginX]#<<tpl-render-options_marginX,`options.marginX`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the left and right of the page.

| [#tpl-render-options_margin]#<<tpl-render-options_margin,`options.margin`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Controls the margin on the left, right, top, and bottom of the page.

| [#tpl-render-options_documentSize]#<<tpl-render-options_documentSize,`options.documentSize`>>#
|
#PDF only.#

* *Type*: `string<A0...A10, B0...B10, C0...C10, ANSI A, ANSI B, ANSI C, ANSI D, ANSI E, junior legal, letter, legal, tabloid>`
* *Description*: The size of the document following the ISO216 standard for the A, B, and C series; ANSI standard for ANSI A, B, C, and D; and NA standards for the last few.

| [#tpl-render-options_documentWidth]#<<tpl-render-options_documentWidth,`options.documentWidth`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Specifies the document width if none of the presets fit your needs.

| [#tpl-render-options_documentHeight]#<<tpl-render-options_documentHeight,`options.documentHeight`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n; inches >`
* *Description*: Specifies the document height if none of the presets fit your needs.

| [#tpl-render-options_contentScale]#<<tpl-render-options_contentScale,`options.contentScale`>>#
|
#PDF only.#

* *Type*: `string< float; 0 >= n >`
* *Description*: At what scale the document should be rendered; bigger number => bigger content.

[NOTE]
====
PDF documents are limited to `0 >= n \<= 8`
====

| [#tpl-render-options_orientation]#<<tpl-render-options_orientation,`options.orientation`>>#
|
#PDF only.#

* *Type*: `string<landscape,portrait>`
* *Description*: What orientation to render the document in.

|===


# src/modules/integrator-guide/pages/templates/variables.adoc

include::ROOT:partial$variables.adoc[]

= Variables

Variables allow you to reuse the result of an operation multiple times without needing to recalculate it.

.Define a variable like this:
[source]
----
{{$var = operation}}
----

.Use a variable like this:
[source]
----
{{$var}}
----


# src/modules/integrator-guide/pages/terminology.adoc

= Terminology

include::partial$terminology.adoc[]


# src/modules/integrator-guide/pages/troubleshooting/logging.adoc

include::ROOT:partial$variables.adoc[]

= Logging
:page-aliases: 2024.9@administrator-guide:logging.adoc

{PRODUCT_NAME} logs most of the operations that have occurred in the system in the *action log*.
The *action log* user interface provides an overview of events such as users that have registered or logged in, records that have been created, and templates that have been rendered.

[TIP]
====
Errors reported by the {APP_AUTOMATION} server are also visible in the action log.
====

You can use the action log for debugging and detecting suspicious behavior as it provides a rich insight into what has occurred.

== The action log interface

The action log user interface resides in the xref:index.adoc#webapp-admin[{PRODUCT_NAME} {APP_NAME_ADMIN}] web application, under menu:system[action log].

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "troubleshooting/logging/action-log.png",
    "alias": "troubleshooting-logging-action-log",
    "w": 1920,
    "h": 1080
  },
  "view": {},
  "annotations": [{
    "kind": "box",
    "padding": "xs",
    "x": 16,
    "y": 437,
    "w": 288,
    "h": 37
  }]
}
----

== Listing actions

.To list current action log entries:
. Navigate to menu:system[action log],
. optionally insert the filtering parameters and click on the btn:[search] button.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "troubleshooting/logging/action-log.png",
    "alias": "troubleshooting-logging-action-log-list",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1000
  },
  "annotations": []
}
----

== Inspecting actions

.To inspect a specific action:
. Navigate to menu:system[action log],
. optionally insert the filtering parameters and click on the btn:[search] button,
. click on the action you wish to inspect.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "troubleshooting/logging/action-log-inspect.png",
    "alias": "troubleshooting-logging-action-log-inspect",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 321,
    "y": 0,
    "w": 1599,
    "h": 1000
  },
  "focus": {
    "x": 563,
    "y": 444,
    "w": 1110,
    "h": 425,
    "padding": 5
  },
  "annotations": []
}
----

== Action severity

[NOTE]
====
*DevNote* take note of the severities

* emergency: 'Emergency'
* alert: 'Alert'
* critical: 'Critical'
* error: 'Error'
* warning: 'Warning'
* notice: 'Notice'
* info: 'Info'
* debug: 'Debug'
====
//Editor's note: do so before the text goes out? Also, great job.

# src/modules/integrator-guide/pages/troubleshooting/stale-data.adoc

include::ROOT:partial$variables.adoc[]

= Stale Data

The `stale data` error occurs when {PRODUCT_NAME} detects that a request attempted to change a resource that was already changed by another request.

.The diagram illustrates how the stale data error occurs.
[plantuml,envoy-arch,svg,role=sequence]
----
@startuml
concise "Alice" as alc
concise "Bob" as bb

@0
alc is "Fetching resource R"
bb is "Fetching resource R"

@500
alc is "Editing resource R"
bb is "Editing resource R"

@900
alc is "Updating resource R"

@1600
alc is {hidden}

@1800
bb is "Updating resource R"

@2200
bb is {hidden}


highlight 0 to 500 #Gold;line:DimGrey : \t\tBoth Alice and Bob fetch\nthe same version of resource
highlight 900 to 1600 #Gold;line:DimGrey : Alice caused the resource on the server to change
highlight 1800 to 2200 #Pink;line:DimGrey : Bob tried to update a resource\ndetermined as stale

@enduml
----

== Example: Bulk record update

The example utilizes batch record creation where we are trying to update the record `$RECORD_ID` twice.

[source,bash]
----
curl -X POST "$BASE_URL/api/compose/namespace/$NAMESPACE_ID/module/$MODULE_ID/record/" \
  -H 'accept: application/json, text/plain, */*' \
  -H "authorization: Bearer $JWT" \
  -H 'content-type: application/json' \
  --data-raw "{
    \"records\": [{
      \"set\": [{
        \"recordID\": \"$RECORD_ID\",
        \"moduleID\": \"$MODULE_ID\",
        \"values\": [{ \"name\": \"name\", \"value\": \"Some value\" }],
        \"namespaceID\": \"$NAMESPACE_ID\",
        \"createdAt\": \"2022-02-17T11:44:20Z\",
        \"updatedAt\": \"2022-02-17T17:13:42Z\"
      },
      {
        \"recordID\": \"$RECORD_ID\",
        \"moduleID\": \"$MODULE_ID\",
        \"values\": [{ \"name\": \"name\", \"value\": \"Some OTHER value\" }],
        \"namespaceID\": \"$NAMESPACE_ID\",
        \"createdAt\": \"2022-02-17T11:44:20Z\",
        \"updatedAt\": \"2022-02-17T17:13:42Z\"
      }]
    }]
  }" \
  --compressed
----

The `stale data` error occurs because the first record causes the resource to change on the server.

When the second resource is handled, the current resource on the server is no longer the one that the second record is referencing.

To solve the issue, either split the request in two or determine the latest version locally before sending the request.

== Example: Workflow execution

The example utilizes the `fork` gateway where we first fetch the record and then attempt to update the same instance twice.
Because one resolves before the other, the second one raises a `stale data` error

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "troubleshooting/stale-data-workflow.png",
    "alias": "troubleshooting-stale-data-workflow",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 105,
    "y": 284,
    "w": 1200,
    "h": 481
  },
  "annotations": [{
    "kind": "box-danger",
    "padding": "lg",
    "x": 1024,
    "y": 364,
    "w": 200,
    "h": 321
  }]
}
----

Use the two fork branches to update the values without saving the record to solve the issue.

Save the record at the very end when all of the values are set to what they should be.

[annotation,role="data-zoomable"]
----
{
  "image": {
    "rel": "troubleshooting/stale-data-workflow-fix.png",
    "alias": "troubleshooting-stale-data-workflow-fix",
    "w": 1920,
    "h": 1080
  },
  "view": {
    "x": 235,
    "y": 139,
    "w": 1240,
    "h": 640
  },
  "annotations": [{
    "kind": "box-success",
    "padding": "lg",
    "x": 635,
    "y": 419,
    "w": 760,
    "h": 280
  }]
}
----


# src/modules/integrator-guide/partials/api-example-note.adoc

[NOTE]
====
We omit most of the data returned by these endpoints.

We replace the important data with variables, such as `$RECORD_ID`.
====


# src/modules/integrator-guide/partials/dal-model-ident-placeholders.adoc

.You can use the following placeholders:
* [#ident-placeholder-module]#<<ident-placeholder-module,`{\{module}}`>>#: the `{\{module}}` placeholder is replaced with the module's handle or the ID if the handle is not defined.
* [#ident-placeholder-namespace]#<<ident-placeholder-namespace,`{\{namespace}}`>>#: the `{\{namespace}}` placeholder is replaced with the namespace's slug or the ID if the slug is not defined.


# src/modules/integrator-guide/partials/expr/fnc-array.adoc

= Array functions

== `push(array, ...elements)`

The `push` function adds a the specified elements to the end of the array and returns a new array.

*The original array remains unchanged.*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": []
}
----
|
[source]
----
new = push(arr, 1)
----
|
[source,json]
----
{
  "arr": [],
  "new": [1]
}
----

// 

|
[source,json]
----
{
  "arr": []
}
----
|
[source]
----
new = push(arr, 1, 2, 3)
----
|
[source,json]
----
{
  "arr": [],
  "new": [1, 2, 3]
}
----

// 

|
[source,json]
----
{
  "stuff": [1, 2, 3]
}
----
|
[source]
----
new = push([], 1, 2, 3)
----
|
[source,json]
----
{
  "new": [1, 2, 3]
}
----

|===


== `pop(array)`

The `pop` function returns the last element of the array.

*The original array remains unchanged*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": [1, 2, 3]
}
----
|
[source]
----
last = pop(arr)
----
|
[source,json]
----
{
  "arr": [1, 2, 3],
  "last": 3
}
----

// 

|
[source,json]
----
{
  "arr": []
}
----
|
[source]
----
last = pop(arr)
----
|
[source,json]
----
{
  "arr": [],
  "last": null
}
----

[NOTE]
====
When `Any` type is used the value will be `null`.
When other type is used, the value will be the zero value of that type.
====

// 

|
[source,json]
----
{
  
}
----
|
[source]
----
last = pop([])
----
|
[source,json]
----
{
  "last": null
}
----

[NOTE]
====
When `Any` type is used the value will be `null`.
When other type is used, the value will be the zero value of that type.
====

|===

== `shift(array)`

The `shift` function returns the first element of the array.

*The original array remains unchanged*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": [1, 2, 3]
}
----
|
[source]
----
first = shift(arr)
----
|
[source,json]
----
{
  "arr": [1, 2, 3],
  "first": 1
}
----

// 

|
[source,json]
----
{
  "arr": []
}
----
|
[source]
----
first = shift(arr)
----
|
[source,json]
----
{
  "arr": [],
  "first": null
}
----

[NOTE]
====
When `Any` type is used the value will be `null`.
When other type is used, the value will be the zero value of that type.
====

// 

|
[source,json]
----
{
  
}
----
|
[source]
----
first = shift([])
----
|
[source,json]
----
{
  "first": null
}
----

[NOTE]
====
When `Any` type is used the value will be `null`.
When other type is used, the value will be the zero value of that type.
====

|===

== `count(array, ...elements)`

The `count` function returns the number of occurrences for the given elements.

The `count` function returns the length of the array if no element is provided.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
nm = count(arr, "a")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "nm": 1
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
nm = count(arr, "a", "b")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "nm": 2
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
nm = count(arr)
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "nm": 3
}
----
|===

== `length(array)`

The `length` function returns the length of the input string

== `has(arr, ...elements)`

The `has` function checks if the provided array contains any of the elements.

The function returns `true` if elements are found, else it returns `false`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = has(arr, "a")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": true
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = has(arr, "/", "b")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": true
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = has(arr, "a", "b", "c")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": true
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = has(arr, "/")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": false
}
----
|===

== `hasAll(arr, ...elements)`

The `hasAll` function checks if the provided array contains *all* of the elements.

The function returns `true` if elements are found, else it returns `false`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = hasAll(arr, "a")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": true
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = hasAll(arr, "/", "b")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": false
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = hasAll(arr, "a", "b", "c")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": true
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
out = hasAll(arr, "/")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "out": false
}
----
|===

== `find(arr, elements)`

The `find` function returns the position of the given element (zero-based numbering).
If the element does not exist, the function returns `-1`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
index = find(arr, "a")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "index": 0
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
index = find(arr, "b")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "index": 1
}
----

// 

|
[source,json]
----
{
  "arr": ["a", "b", "c"]
}
----
|
[source]
----
index = find(arr, "/")
----
|
[source,json]
----
{
  "arr": ["a", "b", "c"],
  "index": -1
}
----
|===

== `sort(array, descending)`

The `sort` function returns the sorted array, either ascending if the second parameter is `false` or descending if the second parameter is `true`.

*The original array remains unchanged.*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "arr": ["c", "a", "b"]
}
----
|
[source]
----
sorted = sort(arr, false)
----
|
[source,json]
----
{
  "arr": ["c", "a", "b"],
  "sorted": ["a", "b", "c"]
}
----

// 

|
[source,json]
----
{
  "arr": ["c", "a", "b"]
}
----
|
[source]
----
sorted = sort(arr, true)
----
|
[source,json]
----
{
  "arr": ["c", "a", "b"],
  "sorted": ["c", "b", "a"]
}
----
|===


# src/modules/integrator-guide/partials/expr/fnc-datetime.adoc

= Date and time functions

== `earliest(DateTime, ...DateTime)`

|*earliest*     |`earliest(arg1, arg2, ...argN)`|The function returns earliest DateTime.|`earliest(datefield1, datefield2)` results in "1970-01-01T00:00:00"


The `earliest` function returns the earliest `DateTime`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = earliest(parseISOTime("2019-01-01T00:00:00Z"), parseISOTime("2020-01-01T00:00:00Z"))
----
|
[source,json]
----
{
  "out": "2019-01-01T00:00:00Z"
}
----

|===

== `latest`

The `latest` function returns the latest `DateTime`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = latest(parseISOTime("2019-01-01T00:00:00Z"), parseISOTime("2020-01-01T00:00:00Z"))
----
|
[source,json]
----
{
  "out": "2020-01-01T00:00:00Z"
}
----

|===

== `parseISOTime`

The `parseISOTime` function parses the ISO formatted timestamp.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z"
}
----
|
[source]
----
out = parseISOTime("2020-01-01T00:00:00Z")
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "out": "2020-01-01T00:00:00Z"
}
----

|===

== `modTime`

The `modTime` function returns a new `DateTime` with added `duration`.
The `modTime` function interacts with the time part of the `DateTime`.

Use `modDate`, `modWeek`, `modMonth`, or `modYear` if you wish to adjust larger components.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1h"
}
----
|
[source]
----
out = modTime(in, d)
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1h",
  "out": "2020-01-01T01:00:00Z",
}
----

|===

== `modDate(datetime, days)`

The `modDate` function returns a new `DateTime` with added `days`.
The `modDate` function interacts with the date (days) part of the `DateTime`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1"
}
----
|
[source]
----
out = modDate(in, d)
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1",
  "out": "2020-01-02T00:00:00Z",
}
----

|===

== `modWeek(datetime, weeks)`

The `modWeek` function returns a new `DateTime` with added `weeks`.
The `modWeek` function interacts with the date (days) part of the `DateTime`.


.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1"
}
----
|
[source]
----
out = modWeek(in, d)
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1",
  "out": "2020-01-08T00:00:00Z",
}
----

|===

== `modMonth(datetime, months)`

The `modMonth` function returns a new `DateTime` with added `months`.
The `modMonth` function interacts with the month part of the `DateTime`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1"
}
----
|
[source]
----
out = modMonth(in, d)
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1",
  "out": "2020-02-01T00:00:00Z",
}
----

|===

== `modYear(datetime, years)`

The `modYear` function returns a new `DateTime` with added `years`.
The `modYear` function interacts with the year part of the `DateTime`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1"
}
----
|
[source]
----
out = modYear(in, d)
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "d": "1",
  "out": "2021-00-01T00:00:00Z",
}
----

|===

== `parseDuration`

The `parseDuration` function returns the parsed duration from the given string.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2h"
}
----
|
[source]
----
out = parseDuration(in)
----
|
[source,json]
----
{
  "in": "2h",
  "out": "2h0m0s"
}
----

|===

== `strftime(datetime, pattern)`

The `strftime` function returns the formatted `DateTime` based on the given `pattern`.
Refer to xref:expr/datetime-formatting.adoc[] for more details.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z"
}
----
|
[source]
----
out = strftime(in, "%Y-%m-%d")
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "out": "2020-01-01"
}
----

|===

== `isLeapYear(datetime)`

The `isLeapYear` function returns `true` if the given `DateTime` is a leap year.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z"
}
----
|
[source]
----
out = isLeapYear(in)
----
|
[source,json]
----
{
  "in": "2020-01-01T00:00:00Z",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "2019-01-01T00:00:00Z"
}
----
|
[source]
----
out = isLeapYear(in)
----
|
[source,json]
----
{
  "in": "2019-01-01T00:00:00Z",
  "out": false
}
----

|===

== `now`

The `now` function returns the current `DateTime`

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = now()
----
|
[source,json]
----
{
  "out": "2022-02-24T18:00:00Z"
}
----

|===

== `isWeekDay`

|*isWeekDay*    |`isWeekDay(datetime)`|The function returns true if the specified day is week day.|`isWeekDay(datefield)` results in `true`


The `isWeekDay` function returns `true` if the given `DateTime` is a week day.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "2022-02-24T00:00:00Z"
}
----
|
[source]
----
out = isWeekDay(in)
----
|
[source,json]
----
{
  "in": "2022-02-24T00:00:00Z",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "2022-02-26T00:00:00Z"
}
----
|
[source]
----
out = isWeekDay(in)
----
|
[source,json]
----
{
  "in": "2022-02-26T00:00:00Z",
  "out": false
}
----

|===

== `sub(from, to)`

The `sub` function returns the difference between two `DateTime` in milliseconds.

The `from` must be larger then `to`; if not, the function will error out.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "from": "2022-02-02T00:00:00Z",
  "to": "2022-02-01T00:00:00Z"
}
----
|
[source]
----
out = sub(from, to)
----
|
[source,json]
----
{
  "from": "2022-02-02T00:00:00Z",
  "to": "2022-02-01T00:00:00Z"
  "out": 86400000
}
----

|===


# src/modules/integrator-guide/partials/expr/fnc-kv.adoc

= KV functions

[CAUTION]
====
The resulting type of the KV function is based on the first argument.
You may not provide multiple different KV types (KV, KVV, Vars) into the same function.

To examplify; `merge(KV, KVV, Vars)` is not allowed.
====

== `set(kv, k, v)`

The `set` function assigns a value to the given `KV`-like variable.

*The original value remains unchanged.*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": {}
}
----
|
[source]
----
out = set(in, "foo", "bar")
----
|
[source,json]
----
{
  "in": {},
  "out": {"foo": "bar"}
}
----

|===

== `merge(kv, ...kv)`

|*merge*  |`merge(KV, arg1, ...argN)`|The function combines all of the given KV types into a single KV type.|`merge(&KVV{"foo": ["foo"]}, &KVV{"bar": ["bar"]})` results in `&KVV{"foo": ["foo"], "bar": ["bar"]}`, Same for KV and Vars.

The `merge` function merges all of the `KV`-like variables into a single `KV`.

*The original value remains unchanged.*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "a": {"foo": "foo"},
  "b": {"bar": "baz"}
}
----
|
[source]
----
out = merge(a, b)
----
|
[source,json]
----
{
  "a": {"foo": "foo"},
  "b": {"bar": "baz"}
  "out": {"foo": "foo", "bar": "baz"}
}
----

|===

== `filter(kv, ...include)`

The `filter` function returns a new `KV` including only the specified keys.

*The original value remains unchanged.*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": {"foo": "foo", "bar": "bar"}
}
----
|
[source]
----
out = filter(in, "foo")
----
|
[source,json]
----
{
  "in": {"foo": "foo", "bar": "bar"},
  "out": {"foo": "foo"}
}
----

|===

== `omit(kv, ...exclude)`

The `omit` function returns a new `KV` without the specified keys.

*The original value remains unchanged.*

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": {"foo": "foo", "bar": "bar"}
}
----
|
[source]
----
out = filter(in, "foo")
----
|
[source,json]
----
{
  "in": {"foo": "foo", "bar": "bar"},
  "out": {"bar": "bar"}
}
----

|===


# src/modules/integrator-guide/partials/expr/fnc-num.adoc

= Numeric functions

== `min(...number)`

The `min` function returns the number with the lowest value.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = min(1, 2, 3, -1)
----
|
[source,json]
----
{
  "out": -1
}
----

|===

== `max(...number)`

The `max` function returns the number with the highest value.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = min(1, 2, 3, -1)
----
|
[source,json]
----
{
  "out": 3
}
----

|===

== `round(number, places)`

The `round` function rounds the `number` to the specified number of `places`.
The function returns a float.

[TIP]
====
To get rid of the floating point, simply cast to an `Integer`.
====

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": 10.123
}
----
|
[source]
----
out = round(in, 2)
----
|
[source,json]
----
{
  "in": 10.123,
  "out": 10.12
}
----

// 

|
[source,json]
----
{
  "in": 10.123
}
----
|
[source]
----
out = round(in, 0)
----
|
[source,json]
----
{
  "in": 10.123,
  "out": 10
}
----
|===

== `floor(number)`

The `floor` function rounds the number down to the nearest integer.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": 10.123
}
----
|
[source]
----
out = floor(in)
----
|
[source,json]
----
{
  "in": 10.123,
  "out": 10
}
----

|===


== `ceil(number)`

The `ceil` function rounds the number up to the nearest integer.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": 10.123
}
----
|
[source]
----
out = ceil(in)
----
|
[source,json]
----
{
  "in": 10.123,
  "out": 11
}
----
|===


== `abs(number)`

The `abs` function returns the absolute value of the provided `number`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": -10
}
----
|
[source]
----
out = abs(in)
----
|
[source,json]
----
{
  "in": -10
  "out": 10
}
----

// 

|
[source,json]
----
{
  "in": 10
}
----
|
[source]
----
out = abs(in)
----
|
[source,json]
----
{
  "in": 10
  "out": 10
}
----
|===

== `log(number)`

The `log` function returns the base 10 logarithm of the given `number`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": 100
}
----
|
[source]
----
out = log(in)
----
|
[source,json]
----
{
  "in": 100
  "out": 2
}
----
|===

== `pow(number, exp)`

The `pow` function returns the `number` to the power of `exp`.

|*pow*   |`pow(number, number)`|The function returns x**y, the base-x exponential of y, see link:https://golang.org/pkg/math/#Pow[math.Pow]|`pow(2, 3)` results in 8

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": 2,
  "exp": 3
}
----
|
[source]
----
out = pow(in, exp)
----
|
[source,json]
----
{
  "in": 2,
  "exp": 3,
  "out": 8
}
----

|===


== `sqrt(number)`

The `sqrt` function returns the square root of the given `number`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": 4
}
----
|
[source]
----
out = sqrt(in)
----
|
[source,json]
----
{
  "in": 4,
  "out": 2
}
----

|===


== `sum(...number)`

The `sum` function returns the sum of all the provided arguments.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = sum(1, 2, 3, -1)
----
|
[source,json]
----
{
  "out": 5
}
----
|===


== `average(...number)`

The `average` function returns the average from the provided arguments.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = average(1, 2)
----
|
[source,json]
----
{
  "out": 1.5
}
----
|===


== `random(a, b?)`

The `random` function returns a random number.
When called with one argument (`random(to)`) the random number is between `0` and `to`.
When called with two arguments (`random(from, to)`) the random number is between `from` and `to`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "to": 10
}
----
|
[source]
----
out = random(to)
----
|
[source,json]
----
{
  "to": 10,
  "out": 3.412
}
----

// 

|
[source,json]
----
{
  "from": 5,
  "to": 10
}
----
|
[source]
----
out = random(to)
----
|
[source,json]
----
{
  "from": 5,
  "to": 10,
  "out": 5.9
}
----
|===

== `int(Any)`

The `int` function casts the argument to `Integer`.
If the value can not be casted, the function returns `0`

[TIP]
====
When you assign a value to a variable it is automatically casted to the specified type.
You only need explicit casting when providing arguments.
====

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "10"
}
----
|
[source]
----
out = int(in)
----
|
[source,json]
----
{
  "in": "10",
  "out": 10
}
----

// 

|
[source,json]
----
{
  "in": "NO"
}
----
|
[source]
----
out = int(in)
----
|
[source,json]
----
{
  "in": "NO",
  "out": 0
}
----
|===


# src/modules/integrator-guide/partials/expr/fnc-string.adoc

= String functions

== `trim(string)`

The `trim` function removes all leading and trailing whitespace defined by the Unicode standard.

.List of Unicode whitespaces:
* `U+0020`: Space,
* `U+00A0`: no-break space,
* `U+1680`: ogham space mark,
* `U+180E`: mongolian vowel separator,
* `U+2000`: en quad,
* `U+2001`: em quad,
* `U+2002`: en space,
* `U+2003`: em space,
* `U+2004`: three-per-em space,
* `U+2005`: four-per-em space,
* `U+2006`: six-per-em space,
* `U+2007`: figure space,
* `U+2008`: punctuation space,
* `U+2009`: thin space,
* `U+200A`: hair space,
* `U+200B`: zero width space,
* `U+202F`: narrow no-break space,
* `U+205F`: medium mathematical space,
* `U+3000`: ideographic space,
* `U+FEFF`: zero width no-break space.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "\t abcd \t"
}
----
|
[source]
----
out = trim(in)
----
|
[source,json]
----
{
  "in": "\t abcd \t",
  "out": "abcd"
}
----

// 

|
[source,json]
----
{
  "in": "\t ab cd \t"
}
----
|
[source]
----
out = trim(in)
----
|
[source,json]
----
{
  "in": "\t abcd \t",
  "out": "ab cd"
}
----
|===

== `trimLeft(string, remove)`

The `trimLeft` function removes the specified characters from the start of the string.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = trimLeft(in, "ab")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "cd"
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = trimLeft(in, "abcd")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": ""
}
----
|===

== `trimRight(string, remove)`

The `trimRight` function removes the specified characters from the end of the string.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = trimFight(in, "cd")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "ab"
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = trimFight(in, "abcd")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": ""
}
----
|===

== `toLower(string)`

The `toLower` function returns a new string with upper case letters mapped to their lower case counterpart.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "Abcd"
}
----
|
[source]
----
out = toLower(in)
----
|
[source,json]
----
{
  "in": "Abcd",
  "out": "abcd"
}
----

// 

|
[source,json]
----
{
  "in": "ABCD"
}
----
|
[source]
----
out = toLower(in)
----
|
[source,json]
----
{
  "in": "ABCD",
  "out": "abcd"
}
----
|===

== `toUpper(string)`

The `toUpper` function returns a new string with lower case letters mapped to their upper case counterpart.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "Abcd"
}
----
|
[source]
----
out = toUpper(in)
----
|
[source,json]
----
{
  "in": "Abcd",
  "out": "abcd"
}
----

// 

|
[source,json]
----
{
  "in": "ABCD"
}
----
|
[source]
----
out = toUpper(in)
----
|
[source,json]
----
{
  "in": "ABCD",
  "out": "abcd"
}
----
|===

== `shortest(string1, ...strings)`

The `shortest` function returns the shortest string from the given arguments.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{

}
----
|
[source]
----
out = shortest("a", "aa", "aaa")
----
|
[source,json]
----
{
  "out": "a"
}
----

// 

|
[source,json]
----
{

}
----
|
[source]
----
out = shortest("a")
----
|
[source,json]
----
{
  "out": "a"
}
----
|===

== `longest(arg1, arg2, ...a`

The `longest` function returns the longest string from the given arguments.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{

}
----
|
[source]
----
out = longest("a", "aa", "aaa")
----
|
[source,json]
----
{
  "out": "aaa"
}
----

// 

|
[source,json]
----
{

}
----
|
[source]
----
out = longest("a")
----
|
[source,json]
----
{
  "out": "a"
}
----
|===

== `format(format, ...arguments)`

The `format` function returns a new constructed from the given template and arguments.
Refer to xref:expr/string-formatting.adoc[] for more details.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  
}
----
|
[source]
----
out = format("string %s, and float %.2f", "hi", 12.345)
----
|
[source,json]
----
{
  "out": "string hi, and float 12.35"
}
----
|===

== `title(string)`

The `title` function turns the first character of to uppercase.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = title(in)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "Abcd"
}
----

// 

|
[source,json]
----
{
  "in": "abcd efg"
}
----
|
[source]
----
out = title(in)
----
|
[source,json]
----
{
  "in": "abcd efg",
  "out": "Abcd efg"
}
----
|===

== `untitle(string)`

The `untitle` function turns does the opposite from what `title(string)` does.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "Abcd"
}
----
|
[source]
----
out = untitle(in)
----
|
[source,json]
----
{
  "in": "Abcd",
  "out": "abcd"
}
----

// 

|
[source,json]
----
{
  "in": "Abcd efg"
}
----
|
[source]
----
out = untitle(in)
----
|
[source,json]
----
{
  "in": "Abcd efg",
  "out": "abcd efg"
}
----
|===

== `repeat(string, count)`

The `repeat` function returns a new string where the original one is repeated `count` times.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = count(in, 1)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "abcd"
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = count(in, 2)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "abcdabcd"
}
----
|===

== `replace(string, old, new,`

The `replace` function returns a copy of the string s with the first n non-overlapping instances of old replaced by new.
If old is empty, it matches at the beginning of the string and after each UTF-8 sequence, yielding up to k+1 replacements for a k-rune string.
If n < 0, there is no limit on the number of replacements.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "foo foo foo"
}
----
|
[source]
----
out = replace(in, "foo", "bar", 1)
----
|
[source,json]
----
{
  "in": "foo foo foo",
  "out": "bar foo foo"
}
----

// 

|
[source,json]
----
{
  "in": "foo foo foo"
}
----
|
[source]
----
out = replace(in, "foo", "bar", 0)
----
|
[source,json]
----
{
  "in": "foo foo foo",
  "out": "foo foo foo"
}
----

// 

|
[source,json]
----
{
  "in": "foo foo foo"
}
----
|
[source]
----
out = replace(in, "foo", "bar", -1)
----
|
[source,json]
----
{
  "in": "foo foo foo",
  "out": "bar bar bar"
}
----
|===

== `isUrl(string)`

The `isUrl` function checks if the given string is a valid URL address.
If the string is a valid URL the function returns `true` else it returns `false`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "https://www.example.tld"
}
----
|
[source]
----
out = isUrl(in)
----
|
[source,json]
----
{
  "in": "https://www.example.tld",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "uhoh"
}
----
|
[source]
----
out = isUrl(in)
----
|
[source,json]
----
{
  "in": "uhoh",
  "out": false
}
----
|===

== `isEmail(string)`

The `isEmail` function checks if the given string is a valid email address.
If the string is a valid email the function returns `true` else it returns `false`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "hi@email.tld"
}
----
|
[source]
----
out = isEmail(in)
----
|
[source,json]
----
{
  "in": "hi@email.tld",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "uhoh"
}
----
|
[source]
----
out = isEmail(in)
----
|
[source,json]
----
{
  "in": "uhoh",
  "out": false
}
----
|===

== `split(string, separator)`

The `split` function returns an array of strings where the original string is split by the separator.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "aa.bb.cc"
}
----
|
[source]
----
out = split(in, ".")
----
|
[source,json]
----
{
  "in": "aa.bb.cc",
  "out": ["aa", "bb", "cc"]
}
----

// 

|
[source,json]
----
{
  "in": "aa.bb.cc"
}
----
|
[source]
----
out = split(in, "/")
----
|
[source,json]
----
{
  "in": "aa.bb.cc",
  "out": ["aa.bb.cc"]
}
----
|===

== `join(strings, separator)`

The `join` function joins the strings from the array into a single string separated by the separator.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": ["aa", "bb", "cc"]
}
----
|
[source]
----
out = join(in, ".")
----
|
[source,json]
----
{
  "in": ["aa", "bb", "cc"],
  "out": "aa.bb.cc"
}
----
|===

== `hasSubstring(string, substring, case)`

The `hasSubstring` function checks if the given string contains the substring.

When the third argument is `true` the function is case sensitive else it is not.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasSubstring(in, "bc", false)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "aBCd"
}
----
|
[source]
----
out = hasSubstring(in, "bc", false)
----
|
[source,json]
----
{
  "in": "aBCd",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "aBCd"
}
----
|
[source]
----
out = hasSubstring(in, "bc", true)
----
|
[source,json]
----
{
  "in": "aBCd",
  "out": false
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasSubstring(in, "xy", false)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": false
}
----
|===

== `substring(string, start, end)`

The `substring` function returns the substring of the given string.

Both `start` and `end` are inclusive (`[start, end]`)

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = substring(in, 1, 2)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "bc"
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = substring(in, 1, -1)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": "bcd"
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = substring(in, 4, -1)
----
|
[source,json]
----
{
  "in": "abcd",
  "out": ""
}
----
|===

== `hasPrefix(string, prefix)`

The `hasPrefix` function checks if the given string includes the prefix.
If the prefix exists the function returns `true` else it returns `false`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasPrefix(in, "ab")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasPrefix(in, "cd")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": false
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasPrefix(in, "xy")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": false
}
----
|===

== `hasSuffix(string, prefix)`

The `hasSuffix` function checks if the given string includes the suffix.
If the suffix exists the function returns `true` else it returns `false`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasSuffix(in, "cd")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasSuffix(in, "ab")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": false
}
----

// 

|
[source,json]
----
{
  "in": "abcd"
}
----
|
[source]
----
out = hasSuffix(in, "xy")
----
|
[source,json]
----
{
  "in": "abcd",
  "out": false
}
----
|===

== `shorten(string, type, count)`

The `shorten` function cuts off the given string at `count` characters or words when `type` is set to `char`.

The string is suffixed with ellipsis after the cutoff point.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "This is a whole sentence"
}
----
|
[source]
----
out = shorten(in, "word", 4)
----
|
[source,json]
----
{
  "in": "This is a whole sentence",
  "out": "This is a whole …"
}
----
|===

== `camelize(string)`

The `camelize` function returns a new string in the camelCase form.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "Foo bar"
}
----
|
[source]
----
out = camelize(in)
----
|
[source,json]
----
{
  "in": "Foo bar",
  "out": "fooBar"
}
----
|===

== `snakify(string)`

The `snakify` function returns a new string in the snake_case form.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "Foo bar baz"
}
----
|
[source]
----
out = snakify(in)
----
|
[source,json]
----
{
  "in": "Foo bar baz",
  "out": "foo_bar_baz"
}
----
|===

== `match(string, regex)`

The `match` function checks if the string matches the given regular expression.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result
|===

== `base64encode(string)``

The `base64encode` function returns the base64 encoded input string.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result
|===

== `length(string)`

The `length` function returns the length of the input string

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result
|===

== `count(string, ...characters)`

The `count` function returns the number of occurrences for the given characters.

The `count` function returns the length of the string if no character is provided.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": "foo"
}
----
|
[source]
----
out = count(in, "o")
----
|
[source,json]
----
{
  "in": "foo",
  "out": 2
}
----
|===


# src/modules/integrator-guide/partials/expr/fnc-type.adoc

= Type functions

== `coalesce(...Any)`

The `coalesce` function returns the first non-`null` value.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
}
----
|
[source]
----
out = coalesce(null, 0, 1, 2)
----
|
[source,json]
----
{
  "out": 0
}
----

|===

== `isEmpty(Any)`

The `isEmpty` function returns `true` if the value is empty.

What classifies as empty differs from type to type @todo.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": ""
}
----
|
[source]
----
out = isEmpty(in)
----
|
[source,json]
----
{
  "in": "",
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": 0
}
----
|
[source]
----
out = isEmpty(in)
----
|
[source,json]
----
{
  "in": 0,
  "out": true
}
----

|===

== `isNil(Any)`

The `isNil` function returns `true` if the given value is `null`.

.Examples:
[cols="1a,1a,1a"]
|===
|State |Expression |Result

|
[source,json]
----
{
  "in": null
}
----
|
[source]
----
out = isNil(in)
----
|
[source,json]
----
{
  "in": null,
  "out": true
}
----

// 

|
[source,json]
----
{
  "in": 10
}
----
|
[source]
----
out = isNil(in)
----
|
[source,json]
----
{
  "in": 10,
  "out": false
}
----

|===


# src/modules/integrator-guide/partials/expr/type-reference.adoc

include::ROOT:partial$variables.adoc[]

[#datatype-any]
= `Any`

*Is primitive*: `n/a`

A variable of type `Any` does not perform any type checks and can store anything.
The use of this is not recommended, but it can be used.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| null
| Initializes the variable with the value of `null`.

| v = "test"
| "test"
| Initializes the variable with the string value of `test`.

| v = 42
| 42
| Initializes the variable with the integer value of `42`.

|===

[#datatype-vars]
= `Vars`

*Is primitive*: `no`

Identical to <<datatype-kv,`KV`>> but used for complex structures.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {}
| Initializes a vars variable without value, defaults to empty (`{}`).

| v = { "key": "value" }
| { "key": "value" }
| Initializes a vars variable with the property `key` with value of `value`.

| v = { "key": { "key": "value" } }
| { "key": { "key": "value" } }
| Initializes a vars variable with the property `key` with value of a nested vars variable with the property `key` with value of `value`.

|===

[#datatype-boolean]
= `Boolean`

*Is primitive*: `yes`

A `Boolean` indicates wether a variable is truthy (`true`) or faulty (`false`).

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| false
| Initializes boolean variable without value, defaults to false.

| v = true
| true
| Initializes boolean variable with an boolean value.

| v = "true"
| true
|
.Parsing string values:
* `"1"``, `"t"``, `"T"``, `"true"``, `"TRUE"``, `"True"`` result as `true`
* `"0"``, `"f"``, `"F"``, `"false"``, `"FALSE"``, `"False"`` result as `false`

| v = 10 == 0
| true
| Initializes boolean variable as result of an expression.
|===

[#datatype-datetime]
= `DateTime`

*Is primitive*: `yes`

A `DateTime` contains an absolute temporal value.
A `DateTime` can easily be manipulated using xref:expr/fnc-reference.adoc#datetime[date-time functions].

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| ERROR
| `DateTime` initialization requires a non-null value.

| v = "2022-01-17T07:32:30Z"
| "2022-01-17T07:32:30Z"
| Initializes a DateTime variable to the given ISO 8601 timestamp.

| v = 1642414876
| "2022-01-17T11:21:16"
| Initializes a DateTime variable to the given unix timestamp.

[CAUTION]
====
When initializing DateTime variables with unix timestamps inside workflows, you will need an intermediate variable for the unix timestamp value.
====

|===

[#datatype-duration]
= `Duration`

*Is primitive*: `yes`

A `Duration` variable contains a relative temporal value.
It is usually used in combination with <<datatype-datetime,DateTime>> values to calculate offsets.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| ERROR
| `Duration` initialization requires a non-null value

| v = "1m"
| 1m0s
| Initializes a Duration variable to be 1 minute.

| v = "3h"
| 3h0m0s
| Initializes a Duration variable to be 3 hours.

|===

[#datatype-float]
= `Float`

*Is primitive*: `yes`

A `Float` is a 64bit floating point number following the https://en.wikipedia.org/wiki/IEEE_754[IEEE 754] standard.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| 0
| Initializes a float variable without value, defaults to 0.

| v = 4.2
| 4.2
| Initializes a float variable with a float value.

| v = "4.2"
| "4.2"
| Initializes a float variable with a string value.

| v = "four.two"
| ERROR
| Initializes a float variable with an invalid string value.

|===

[#datatype-integer]
= `Integer`

*Is primitive*: `yes`

An `Integer` is a 64bit signed integer; range `-9223372036854775808` through `9223372036854775807`.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v (Integer)
| 0
| Initializes an integer variable without value, defaults to 0.

| v (Integer) = 42
| 42
| Initializes an integer variable with an integer value.

| v (Integer) = 3.14
| 3
| Initializes an integer variable with a float will cut of the decimals.

| v (Integer) = "42"
| 42
| Initializes an integer variable with a string that contains a valid integer.

| v (Integer) = "forty two"
| ERROR
| Initializing integer variable with a string that contains a invalid integer results in an error.
|===

[#datatype-unsignedinteger]
= `UnsignedInteger`

*Is primitive*: `yes`

An `UnsignedInteger` is a 64bit unsigned integer; range `0` through `18446744073709551615`.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v (Integer)
| 0
| Initializes an unsigned integer variable without value, defaults to 0.

| v (Integer) = 42
| 42
| Initializes an unsigned integer variable with an integer value.

| v (Integer) = 3.14
| 3
| Initializes an unsigned integer variable with a float will cut of the decimals.

| v (Integer) = "42"
| 42
| Initializes an unsigned integer variable with a string that contains a valid integer.

| v (Integer) = "forty two"
| ERROR
| Initializing integer variable with a string that contains a invalid integer results in an error.
|===

[#datatype-string]
= `String`

*Is primitive*: `yes`

A `String` variable contains a text (a string).

[TIP]
====
If the initialization value is a non-null, non-string value; if defined; the value is casted to a string.

*DevNote* provide a complete list for this.
====

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| ""
| Initializes a string variable without value, defaults to empty string (`""`).

| v = "Hi"
| "Hi"
| Initializes a string variable with a string value.

| v = 10
| "10"
| Initializes a string variable with an integer value.

|===

[#datatype-id]
= `ID`

*Is primitive*: `yes`

An `ID` is a unique system assigned identifier for all system resources. 
While it can be assigned or manipulated manually, the system normally either ignores the modifications or errors them out.

An `ID` is a 64bit unsigned integer; range `0` through `18446744073709551615`.

[#datatype-handle]
= `Handle`

*Is primitive*: `yes`

A `Handle` is a user-friendly resource identifier.
Most {PRODUCT_NAME} resources (such as namespaces and modules) allow you to define a unique identifier that can be used instead of its system assigned <<datatype-id,ID>>.

The value must be an empty string or a string matching the following regular expression: `/^[A-Za-z][0-9A-Za-z_\-.]*[A-Za-z0-9]$/`.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| 0
| Initializes a handle variable without value, defaults to empty (`""`).

| v = "transaction"
| "transaction"
| Initializes a handle variable with a string value.

| v = "invalid handle"
| ERROR
| Initializes a handle variable with an invalid string value.

|===

[#datatype-array]
= `Array`

*Is primitive*: `no`

An `Array` contains a list of items, such as a list of users, records or modules.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| []
| Initializes an array variable without value, defaults to empty (`[]`).

| v = [1, 2, 3]
| [1, 2, 3]
| Initializes an array variable with a list of integers.

|===

[#datatype-reader]
= `Reader`

*Is primitive*: `no`

A `Reader` represents a data stream (such as a file or a blob) that can be read or iterated over using the stream iterator.

[IMPORTANT]
====
A `Reader` can only be read once.
If you need to use it multiple times you will need to cache the initial output.
====

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| ERROR
| `Reader` initialization requires a non-nil value.

| v = "Test"
| Reader("Test")
| Initializes a reader variable from the string.

|===

[#datatype-kv]
= `KV`

*Is primitive*: `no`

A `KV` is a hashmap that maps `String` values to `String` keys.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {}
| Initializes a kv variable without value, defaults to empty (`{}`).

| v = { "key": "value" }
| { "key": "value" }
| Initializes a kv variable to the given set of keys and values.

|===

[#datatype-kvv]
= `KVV`

*Is primitive*: `no`

A `KVV` is a hashmap that maps a set of `String` values to `String` keys.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {}
| Initializes a kvv variable without value, defaults to empty (`{}`).

| v = { "key": [ "value 1", "value 2" ] }
| { "key": [ "value 1", "value 2" ] }
| Initializes a kvv variable to the given set of keys and values.

|===

// ---

[#datatype-template]
= `Template`

*Is primitive*: `no`

A `Template` contains a template that can be used by the rendering engine.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| { ... }
| Initializes a template variable without value, defaults to empty.
Refer to the <<objref-template,object reference>> for details.

| v = { "handle": "test", "type": "text/html" }
| { ... "handle": "test", "type": "text/html" ... }
| Initializes a template variable with the given handle and template type.
Refer to the <<objref-template,object reference>> for details.

|===

[#datatype-document]
= `Document`

*Is primitive*: `no`

A `Document` is a rendered <<datatype-template,Template>>.
It uses <<datatype-renderoptions,RenderOptions>> and <<datatype-rendervariables,RenderVariables>> in order to produce a document.

[NOTE]
====
A `Document` is a result of the template render function and should not be constructed manually.
====

[#datatype-renderoptions]
= `RenderOptions`

*Is primitive*: `no`

`RenderOptions` define how a <<datatype-template,Template>> should be rendered into a <<datatype-document,Document>>.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {}
| Initializes a render options variable without value, defaults to empty (`{}`).

| v = { "marginY": "1" }
| { "marginY": "1" }
| Initializes a render options variable to the given object.

|===

[#datatype-emailmessage]
= `EmailMessage`

*Is primitive*: `no`

An `EmailMessage` represents an email that is to be sent to the recipients.
The `EmailMessage` type should not be constructed or interacted with directly.
It is suggested you use the predefined functions to manipulate it's contents.

[CAUTION]
====
A new `EmailMessage` must be initialized using the `Email builder` function.
====

[#datatype-role]
= `Role`

*Is primitive*: `no`

A `Role` contains a system role.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {...}
| Initializes a role variable without value, defaults to empty.
Refer to the <<objref-role,object reference>> for details.

| v = { "handle": "test_role" }
| {... "handle": "test_role" ...}
| Initializes a role variable with the given handle.
Refer to the <<objref-role,object reference>> for details.

|===

[#datatype-user]
= `User`

*Is primitive*: `no`

A `User` contains a system user.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {...}
| Initializes a user variable without value, defaults to empty.
Refer to the <<objref-user,object reference>> for details.

| v = { "handle": "test_user" }
| {... "handle": "test_user" ...}
| Initializes a user variable with the given handle.
Refer to the <<objref-user,object reference>> for details.

|===

[#datatype-composemodule]
= `ComposeModule`

*Is primitive*: `no`

A `ComposeModule` contains a {APP_NAME_COMPOSE} module.
The `ComposeModule` type is mostly used when updating module fields or creating new records.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {...}
| Initializes a module variable without value, defaults to empty.
Refer to the <<objref-module,object reference>> for details.

| v = { "handle": "test_module" }
| {... "handle": "test_module" ...}
| Initializes a module variable with the given handle.
Refer to the <<objref-module,object reference>> for details.

|===

[#datatype-composenamespace]
= `ComposeNamespace`

*Is primitive*: `no`

A `ComposeNamespace` contains a {APP_NAME_COMPOSE} namespace.
The `ComposeNamespace` type is mostly used when interacting with namespace specific {APP_NAME_COMPOSE} resources.

.Initialization patterns:
[cols="2m,2m,4a"]
|===
| Expression | Value/result | Notes

| v
| {...}
| Initializes a namespace variable without value, defaults to empty.
Refer to the <<objref-namespace,object reference>> for details.

| v = { "slug": "test_namespace" }
| {... "slug": "test_namespace" ...}
| Initializes a namespace variable with the given handle.
Refer to the <<objref-namespace,object reference>> for details.

|===

[#datatype-composerecord]
= `ComposeRecord`

*Is primitive*: `no`


A `ComposeRecords` contains a {APP_NAME_COMPOSE} record.
The `ComposeRecords` type is mostly used when interacting with {APP_NAME_COMPOSE} records, such as changing their values or converting them into email notifications.

[CAUTION]
====
A new `ComposeRecord` must be initialized using the `Compose record maker` function.
====

[#datatype-composerecordvalues]
= `ComposeRecordValues`

*Is primitive*: `no`

A `ComposeRecordValues` contains a set of {PRODUCT_NAME} record values.
This type is usually not used on it's own but in the combination with <<datatype-composerecord,ComposeRecord>>.

[#datatype-httprequest]
= `HttpRequest`
*Is primitive*: `no`

A `HttpRequest` contains an http Request (refer to the https://pkg.go.dev/net/http#Request[GO documentation] for details regarding the signature).

[IMPORTANT]
====
The only difference between HttpRequest and go's http.Request is the ability to buffer the request body.

Once there is a first read done on the body, it will be buffered and from there on used if the body is empty (since it is a ReadCloser).
====

[#object-reference]
= Object reference


# src/modules/integrator-guide/partials/fs-client.adoc

include::ROOT:partial$variables.adoc[]

[source,text]
----
/client-scripts <1>
    /auth <2>
        /... <6>

    /admin <3>
        /... <6>

    /compose <4>
        /... <6>

    /shared <5>
        /... <6>
----
<1> Root folder for all client scripts (under each search path).
<2> Defines a bundle for {PRODUCT_NAME} {APP_NAME_AUTH}.
<3> Defines a bundle for {PRODUCT_NAME} {APP_NAME_ADMIN}.
<4> Defines a bundle for {PRODUCT_NAME} {APP_NAME_COMPOSE}.
<5> Reserved directory for any shared logic, such as custom libraries, assets, ...
<6> Undefined file structure; can be defined as needed.


# src/modules/integrator-guide/partials/fs-server.adoc

include::ROOT:partial$variables.adoc[]

[source,text]
----
/server-scripts <1>
    /... <2>
----
<1> Root folder for all server scripts (under each search path).
<2> Undefined file structure; can be defined as needed.


# src/modules/integrator-guide/partials/generated/resource-events.gen.adoc

// This file is auto-generated.
//
// Changes to this file may cause incorrect behavior and will be lost if
// the code is regenerated.
//
// Definitions file that controls how this file is generated:
//  - compose/service/event/events.yaml
//  - messaging/service/event/events.yaml
//  - system/service/event/events.yaml

= Resources and events

== compose

=== Events

.On events:
* `on('manual')`
* `on('interval')`
* `on('timestamp')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:module

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `module`
| `*types.Module`
| yes

| `oldModule`
| `*types.Module`
| no

| `namespace`
| `*types.Namespace`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:namespace

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `namespace`
| `*types.Namespace`
| yes

| `oldNamespace`
| `*types.Namespace`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:page

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `page`
| `*types.Page`
| yes

| `oldPage`
| `*types.Page`
| no

| `namespace`
| `*types.Namespace`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== compose:record

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`
* `on('iteration')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `record`
| `*types.Record`
| yes

| `oldRecord`
| `*types.Record`
| no

| `module`
| `*types.Module`
| no

| `namespace`
| `*types.Namespace`
| no

| `recordValueErrors`
| `*types.RecordValueErrorSet`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== messaging

=== Events

.On events:
* `on('manual')`
* `on('interval')`
* `on('timestamp')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `invoker`
| `auth.Identifiable`
| yes
|===

== messaging:channel

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `channel`
| `*types.Channel`
| yes

| `oldChannel`
| `*types.Channel`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== messaging:channel:member

=== Events
.Before/after events:
* `before('join')`
* `before('part')`
* `before('add')`
* `before('remove')`
* `after('join')`
* `after('part')`
* `after('add')`
* `after('remove')`



=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `member`
| `*types.ChannelMember`
| yes

| `channel`
| `*types.Channel`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== messaging:command

=== Events

.On events:
* `on('invoke')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `command`
| `*types.Command`
| no

| `channel`
| `*types.Channel`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== messaging:message

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `message`
| `*types.Message`
| yes

| `oldMessage`
| `*types.Message`
| no

| `channel`
| `*types.Channel`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system

=== Events

.On events:
* `on('manual')`
* `on('interval')`
* `on('timestamp')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `invoker`
| `auth.Identifiable`
| yes
|===

== system:application

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `application`
| `*types.Application`
| yes

| `oldApplication`
| `*types.Application`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:auth

=== Events
.Before/after events:
* `before('login')`
* `before('signup')`
* `after('login')`
* `after('signup')`



=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `user`
| `*types.User`
| yes

| `provider`
| `*types.AuthProvider`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:mail

=== Events

.On events:
* `on('manual')`
* `on('receive')`
* `on('send')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `message`
| `*types.MailMessage`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:role

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `role`
| `*types.Role`
| yes

| `oldRole`
| `*types.Role`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:role:member

=== Events
.Before/after events:
* `before('add')`
* `before('remove')`
* `after('add')`
* `after('remove')`



=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `user`
| `*types.User`
| yes

| `role`
| `*types.Role`
| yes

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:sink

=== Events

.On events:
* `on('request')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `response`
| `*types.SinkResponse`
| yes

| `request`
| `*types.SinkRequest`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===

== system:user

=== Events
.Before/after events:
* `before('create')`
* `before('update')`
* `before('delete')`
* `after('create')`
* `after('update')`
* `after('delete')`

.On events:
* `on('manual')`

=== Exec arguments

.Argument properties:
[%header, cols=3*]
|===
|Name|Type|Mutable
| `user`
| `*types.User`
| yes

| `oldUser`
| `*types.User`
| no

| `invoker`
| `auth.Identifiable`
| yes
|===


# src/modules/integrator-guide/partials/handle-constraints.adoc

. start with a character,
. contain at most 64 characters,
. contain only characters, numbers, _ (underscore), - (dash) or . (dot),
. end with a character or a number.


# src/modules/integrator-guide/partials/security.adoc

include::ROOT:partial$variables.adoc[]

[#ext-security]
= Security

As with any system, automation scripts can cause unwanted complications if misused or left open for modification by users who might do harm, willingly or otherwise.

You (or whoever is responsible for the system) is responsible for making sure that the automation scripts are audited and written in a way that they are not harmful to the system or the data.

== Automation script execution

Automation script execution **is not** jailed or virtualized and it is ran in the same context as the automation system; either {APP_AUTOMATION} in the case of server scripts or any front-end application in case of client scripts.

It is recommended to make use of security context feature described in the following subsection, and limit the permissions each automation script can use.

== Security context

Automation scripts are no exception to {PRODUCT_NAME} permission system; any operation performed by an automation script (such as record creation) must pass all permission checks required by the resource.
When not defined otherwise, manual and implicit automation triggers use the current user's permission scope for the automation scripts security context.

But there are cases where this is not sufficient, and the execution requires permissions that the invoker does not have. For such cases we can specify a custom security context that the automation script will run in.

[example]
====
An automation script requires system user creation, which requires a specific set of  privileges that user, running the script might not have. Instead of giving our users elevated privileges, we can define the security context of the automation script.
====

The same also applies to deferred, interval and sink automation scripts, since they are executed by the system without any user interaction (at least we can't be sure who exactly executed it).
In this case, the security context is **required**.

[IMPORTANT]
====
Due to privacy and security concerns, security context definition is **not** available for client side scripts.
====

[TIP]
====
When using custom permission context, we strongly recommend using a system user with the minimal required set of permissions to execute the required operations.
====

== Role-based access control

Role-based access control allows us to define what user can access what automation scripts based on their permissions.

[IMPORTANT]
====
This only applies to explicit and client side automation scripts; server side scripts (except explicit scripts) ignore this check.
====


# src/modules/integrator-guide/partials/system-overview.adoc

include::ROOT:partial$variables.adoc[]

= Automation System Overview

== Automation system diagram

[NOTE]
====
This will probably become a UML diagram; this one is for development (faster updates).
@todo add some annotations and explanations on the diagram.
====

.Abstract representation of the automation system.
image::automation-system-dig.png[Sunset]

== Automation system components

=== {APP_AUTOMATION} server

.When {APP_AUTOMATION} server starts, it
. scans all search paths from configuration (`.env`) and load all scripts,
. scans all `package.json` files in all search paths, and install additional packages,
. runs file-change watchers for automation script reloading,
. runs file-change watchers for `package.json` files for dependency reloading.

=== {PRODUCT_NAME} server

.When {PRODUCT_NAME} server starts, it
. connects to {APP_AUTOMATION} server and loads all server and client scripts,
. creates event handlers from server script triggers and registers them in the event bus,
. configures the scheduler system to trigger both `onTimestamp` and `onInterval` events once per minute at the minute.

.When scheduling system on {PRODUCT_NAME} server ticks (once per minute), it
. dispatches event through the event bus,
. checks for registered events with compatible constraints,
. requests {APP_AUTOMATION} server to execute the relevant scripts.

.When user indirectly runs automation script via some action on the *server* (implicitly triggered *server* scripts)
. raises a specific event (`onSomething`, `beforeSomethingElse`, `afterSomethingElse`) and dispatches it through the event bus,
. checks for registered events with compatible constraints,
. requests {APP_AUTOMATION} server to execute the relevant scripts.

.When request is sent to `/sink` endpoint
. raises a `onRequest` event and dispatches it through the event bus,
. checks for registered events with compatible constraints,
. requests {APP_AUTOMATION} server to execute the relevant scripts.

=== {PRODUCT_NAME} web application

.When {PRODUCT_NAME} web application loads in a browser, it
. fetches appropriate automation scripts from the {PRODUCT_NAME} server in the form of a bundle,
. registers client scripts from the bundle in the event bus and the ui hooks.

.When user clicks on an automation button (explicitly triggered *client* script), it
. raises an event from the given configuration and the invocation context (related resource, user, custom arguments, ...),
. checks for registered events with compatible constraints,
. requests the script's execution inside the browser context (client-side execution).

.When user clicks on an automation button (explicitly triggered *server* script), it
. raises an event from the given configuration and the invocation context (related resource, user, custom arguments, ...),
. checks for registered events with compatible constraints,
. requests {APP_AUTOMATION} server to execute the relevant scripts via the {PRODUCT_NAME} server.

.When user indirectly runs automation script via some action in the *client* app (implicitly triggered *client* scripts), it
. raises a specific event (`onSomething`, `beforeSomethingElse`, `afterSomethingElse`) and dispatches it through the event bus,
. checks for registered events with compatible constraints,
. requests the script's execution inside the browser context (client-side execution).


# src/modules/integrator-guide/partials/terminology.adoc

include::ROOT:partial$variables.adoc[]

Extension::
    A collection of automation scripts, corresponding libraries and other assets.

Script or Automation Script::
    Combination of automation triggers, metadata and the code itself.

Client scripts::
    Automation scripts executed within a client's browser.

Server scripts::
    Automation scripts executed inside the {APP_AUTOMATION} server.

Triggers or Automation Triggers::
    A set of rules, constraints and options to define when, where and how an automation script is executed.

Resource Type::
    Defines the resource that this automation script is compatible with.
    It also defines the input and output of the automation script.

Event Type::
    Defines what event causes this automation script to execute.

Trigger constraints::
    A set of constraints that must be truthy for the automation script to be available and executable.

Trigger weight::
    Allows us to specify the order of automation script execution for the given event.

User interface properties or UIProps::
    Determine front-end aspects of the automation script invocation component; such as placement, label and colour (see UIHooks).

Explicitly triggered or manual scripts::
    Automation scripts that are executed explicitly, such as a button press or an API endpoint call.

Implicitly triggered scripts::
    Automation scripts that are executed implicitly as collateral to an event, such as record creation and form submission.

Deferred or scheduled scripts::
    Automation scripts that are executed at a specified time or on a configured interval.

// Batch or iterator scripts::
//     Automation scripts that are executed over a more extensive set of resources at the same time (used for batch processing).
// 
Sink scripts::
    Automation scripts that are executed on HTTP requests and allow the implementation of new endpoints.

Event bus::
    Event handling system inside client web applications and on the server.

UIHooks::
    Define front-end components that are used to execute explicit (manual) automation scripts (see UIProps).